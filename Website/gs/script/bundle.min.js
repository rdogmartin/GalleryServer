/*! jsviews.js v0.9.81 (Beta) single-file version: http://jsviews.com/ */
/*! includes JsRender, JsObservable and JsViews - see: http://jsviews.com/#download */
(function(n,t){var i=t.jQuery;typeof exports=="object"?module.exports=i?n(t,i):function(i){return n(t,i)}:typeof define=="function"&&define.amd?define(["jquery"],function(i){return n(t,i)}):n(t,!1)})(function(n,t){"use strict";function rf(n,t){return function(){var r,i=this,u=i.base;return i.base=n,r=t.apply(i,arguments),i.base=u,r}}function uf(n,t){return u(t)&&(t=rf(n?n._d?n:rf(sr,n):sr,t),t._d=1),t}function or(n,t){for(var i in t.props)du.test(i)&&(n[i]=uf(n[i],t.props[i]))}function yi(n){return n}function sr(){return""}function ts(n){try{console.log("JsRender dbg breakpoint: "+n);throw"dbg breakpoint";}catch(t){}return this.base?this.baseApply(arguments):n}function hr(n){this.name=(t.link?"JsViews":"JsRender")+" Error";this.message=n||this.name}function e(n,t){for(var i in t)n[i]=t[i];return n}function pi(n,t,r){return n?f(n)?pi.apply(o,n):(s.delimiters=[n,t,ri=r?r.charAt(0):ri],wt=n.charAt(0),et=n.charAt(1),a=t.charAt(0),bt=t.charAt(1),n="\\"+wt+"(\\"+ri+")?\\"+et,t="\\"+a+"\\"+bt,ii="(?:(\\w+(?=[\\/\\s\\"+a+"]))|(\\w+)?(:)|(>)|(\\*))\\s*((?:[^\\"+a+"]|\\"+a+"(?!\\"+bt+"))*?)",i.rTag="(?:"+ii+")",ii=new RegExp("(?:"+n+ii+"(\\/)?|\\"+wt+"(\\"+ri+")?\\"+et+"(?:(?:\\/(\\w+))\\s*|!--[\\s\\S]*?--))"+t,"g"),i.rTmpl=new RegExp("<.*>|([^\\\\]|^)[{}]|"+n+".*"+t),l):s.delimiters}function is(n,t){t||n===!0||(t=n,n=undefined);var f,u,e,r,i=this,o=!t||t==="root";if(n){if(r=t&&i.type===t&&i,!r)if(f=i.views,i._.useKey){for(u in f)if(r=t?f[u].get(n,t):f[u])break}else for(u=0,e=f.length;!r&&u<e;u++)r=t?f[u].get(n,t):f[u]}else if(o)while(i.parent)r=i,i=i.parent;else while(i&&!r)r=i.type===t?i:undefined,i=i.parent;return r}function ff(){var n=this.get("item");return n?n.index:undefined}function ef(){return this.index}function rs(t,r){var s,h,c=this,f=c.ctx;if(f&&(f=f[t]),f===undefined&&(f=ir[t]),f&&f._cp){if(r)return h=i._ceo(f[1].deps),h.unshift(f[0].data),h._cp=!0,h;f=o.getCtx(f)}return f&&u(f)&&!f._wrp&&(s=function(){return f.apply(!this||this===n?c:this,arguments)},s._wrp=c,e(s,f)),s||f}function us(n){return n&&(n.fn?n:this.getRsc("templates",n)||it(n))}function fs(n,t,r,u){var f,o,h=typeof r=="number"&&t.tmpl.bnds[r-1],s=t.linkCtx;return u!==undefined?r=u={props:{},args:[u]}:h&&(r=h(t.data,t,i)),o=r.args[0],(n||h)&&(f=s&&s.tag,f||(f=e(new i._tg,{_:{inline:!s,bnd:h,unlinked:!0},tagName:":",cvt:n,flow:!0,tagCtx:r}),s&&(s.tag=f,f.linkCtx=s),r.ctx=vt(r.ctx,(s?s.view:t).ctx)),f._er=u&&o,or(f,r),r.view=t,f.ctx=r.ctx||f.ctx||{},r.ctx=undefined,o=f.cvtArgs(n!=="true"&&n)[0],o=h&&t._.onRender?t._.onRender(o,t,f):o),o!=undefined?o:""}function es(n){var r=this,u=r.tagCtx,f=u.view,t=u.args;return n=n||r.convert,n=n&&(""+n===n?f.getRsc("converters",n)||ut("Unknown converter: '"+n+"'"):n),t=!t.length&&!u.index?[f.data]:n?t.slice():t,n&&(n.depends&&(r.depends=i.getDeps(r.depends,r,n.depends,n)),t[0]=n.apply(r,t)),t}function os(n,t){for(var r,u,i=this;r===undefined&&i;)u=i.tmpl&&i.tmpl[n],r=u&&u[t],i=i.parent;return r||o[n][t]}function ss(n,r,u,f,e,o){r=r||h;var s,et,ct,ot,d,g,l,st,y,c,nt,tt,ht,at,w,p,it,pt,rt,b="",a=r.linkCtx||0,k=r.ctx,yt=u||r.tmpl,ft=typeof f=="number"&&r.tmpl.bnds[f-1];for(n._is==="tag"?(s=n,n=s.tagName,f=s.tagCtxs,ct=s.template):(et=r.getRsc("tags",n)||ut("Unknown tag: {{"+n+"}} "),ct=et.template),o!==undefined?(b+=o,f=o=[{props:{},args:[]}]):ft&&(f=ft(r.data,r,i)),st=f.length,l=0;l<st;l++)c=f[l],a&&a.tag&&(!l||a.tag._.inline)&&!s._er||((tt=yt.tmpls&&c.tmpl)&&(tt=c.content=yt.tmpls[tt-1]),c.index=l,c.tmpl=tt,c.render=cr,c.view=r,c.ctx=vt(c.ctx,k)),(u=c.props.tmpl)&&(c.tmpl=r.getTmpl(u)),s||(s=new et._ctr,ht=!!s.init,s.parent=g=k&&k.tag,s.tagCtxs=f,rt=s.dataMap,a&&(s._.inline=!1,a.tag=s,s.linkCtx=a),(s._.bnd=ft||a.fn)?s._.arrVws={}:s.dataBoundOnly&&ut("{^{"+n+"}} tag must be data-bound")),f=s.tagCtxs,rt=s.dataMap,c.tag=s,rt&&f&&(c.map=f[l].map),s.flow||(nt=c.ctx=c.ctx||{},ot=s.parents=nt.parentTags=k&&vt(nt.parentTags,k.parentTags)||{},g&&(ot[g.tagName]=g),ot[s.tagName]=nt.tag=s);if(!(s._er=o)){for(or(s,f[0]),s.rendering={},l=0;l<st;l++)c=s.tagCtx=f[l],it=c.props,p=s.cvtArgs(),(at=it.dataMap||rt)&&(p.length||it.dataMap)&&(w=c.map,(!w||w.src!==p[0]||e)&&(w&&w.src&&w.unmap(),w=c.map=at.map(p[0],it,undefined,!s._.bnd)),p=[w.tgt]),s.ctx=c.ctx,l||(ht&&(pt=s.template,s.init(c,a,s.ctx),ht=undefined),a&&(a.attr=s.attr=a.attr||s.attr),d=s.attr,s._.noVws=d&&d!==v),y=undefined,s.render&&(y=s.render.apply(s,p),r.linked&&y&&s.linkedElem&&!bo.test(y)&&(y=af(t.templates(y),p[0],undefined,undefined,r,undefined,undefined,s))),p.length||(p=[r]),y===undefined&&(y=c.render(p[0],!0)||(e?undefined:"")),b=b?b+(y||""):y;s.rendering=undefined}return s.tagCtx=f[0],s.ctx=s.tagCtx.ctx,s._.noVws&&s._.inline&&(b=d==="text"?lt.html(b):""),ft&&r._.onRender?r._.onRender(b,r,s):b}function kt(n,t,i,r,u,f,e,o){var h,c,l,s=this,a=t==="array";s.content=o;s.views=a?[]:{};s.parent=i;s.type=t||"top";s.data=r;s.tmpl=u;l=s._={key:0,useKey:a?0:1,id:""+go++,onRender:e,bnds:{}};s.linked=!!e;i?(h=i.views,c=i._,c.useKey?(h[l.key="_"+c.useKey++]=s,s.index=nf,s.getIndex=ff):h.length===(l.key=s.index=f)?h.push(s):h.splice(f,0,s),s.ctx=n||i.ctx):s.ctx=n}function hs(n){var i,t,r;for(i in er)t=i+"s",n[t]&&(r=n[t],n[t]={},o[t](r,n))}function cs(n,t,r){function c(){var t=this;t._={inline:!0,unlinked:!0};t.tagName=n}var s,o,h,f=new i._tg;if(u(t)?t={depends:t.depends,render:t}:""+t===t&&(t={template:t}),o=t.baseTag){t.flow=!!t.flow;t.baseTag=o=""+o===o?r&&r.tags[o]||g[o]:o;f=e(f,o);for(h in t)f[h]=uf(o[h],t[h])}else f=e(f,t);return(s=f.template)!==undefined&&(f.template=""+s===s?it[s]||it(s):s),f.init!==!1&&((c.prototype=f).constructor=f._ctr=c),r&&(f._parentTmpl=r),f}function ls(n){return this.base.apply(this,n)}function of(n,r,u,f){function c(r){var e,o;if(""+r===r||r.nodeType>0&&(s=r)){if(!s)if(/^\.\/[^\\:*?"<>]*$/.test(r))(o=it[n=n||r])?r=o:s=document.getElementById(r);else if(t.fn&&!i.rTmpl.test(r))try{s=t(document).find(r)[0]}catch(h){}s&&(f?r=s.innerHTML:(e=s.getAttribute(fr),e?e!==at?(r=it[e],delete it[e]):t.fn&&(r=t.data(s)[at]):(n=n||(t.fn?at:r),r=of(n,s.innerHTML,u,f)),r.tmplName=n=n||e,n!==at&&(it[n]=r),s.setAttribute(fr,n),t.fn&&t.data(s,at,r)));s=undefined}else r.fn||(r=undefined);return r}var s,h,o=r=r||"";return f===0&&(f=undefined,o=c(o)),f=f||(r.markup?r:{}),f.tmplName=n,u&&(f._parentTmpl=u),!o&&r.markup&&(o=c(r.markup))&&o.fn&&(o=o.markup),o!==undefined?(o.fn||r.fn?o.fn&&(h=o):(r=hf(o,f),lr(o.replace(ku,"\\$&"),r)),h||(h=e(function(){return h.render.apply(h,arguments)},r),hs(h)),n&&!u&&n!==at&&(tf[n]=h),h):void 0}function as(n,i){return t.isFunction(n)?n.call(i):n}function sf(n){for(var i=[],r=n.length,t=0;t<r;t++)i.push(n[t].unmap());return i}function vs(n,i){function w(n){l.apply(this,n)}function s(){return new w(arguments)}function b(n,t){for(var i,o,r,e,s=u.length,f=0;f<s;f++)r=u[f],i=undefined,r+""!==r&&(i=r,r=i.getter),(e=n[r])===undefined&&i&&(o=i.defaultVal)!==undefined&&(e=as(o,n)),t(e,i&&v[i.type],r)}function nt(t){t=t+""===t?JSON.parse(t):t;var u,s,r,e=t,i=[];if(f(t)){for(t=t||[],s=t.length,u=0;u<s;u++)i.push(this.map(t[u]));return i._is=n,i.unmap=d,i.merge=k,i}if(t){b(t,function(n,t){t&&(n=t.map(n));i.push(n)});e=this.apply(this,i);for(r in t)r===tt||o[r]||(e[r]=t[r])}return e}function k(n){n=n+""===n?JSON.parse(n):n;var a,i,p,w,h,u,v,y,e,l,t=this;if(f(t)){for(y={},l=[],p=n.length,w=t.length,a=0;a<p;a++){for(e=n[a],v=!1,i=0;i<w&&!v;i++)y[i]||(u=t[i],r&&(y[i]=v=r+""===r?e[r]&&(o[r]?u[r]():u[r])===e[r]:r(u,e)));v?(u.merge(e),l.push(u)):l.push(s.map(e))}c?c(t).refresh(l,!0):t.splice.apply(t,[0,t.length].concat(l));return}b(n,function(n,i,r){i?t[r]().merge(n):t[r](n)});for(h in n)h===tt||o[h]||(t[h]=n[h])}function d(){var s,n,h,c,e,i,r=this;if(f(r))return sf(r);for(s={},c=u.length,h=0;h<c;h++)n=u[h],e=undefined,n+""!==n&&(e=n,n=e.getter),i=r[n](),s[n]=e&&i&&v[e.type]?f(i)?sf(i):i.unmap():i;for(n in r)n==="_is"||o[n]||n===tt||n.charAt(0)==="_"&&o[n.slice(1)]||t.isFunction(r[n])||(s[n]=r[n]);return s}var h,l,v=this,u=i.getters,y=i.extend,r=i.id,e=t.extend({_is:n||"unnamed",unmap:d,merge:k},y),a="",p="",g=u?u.length:0,c=t.observable,o={};for(w.prototype=e,h=0;h<g;h++)(function(n){n=n.getter||n;o[n]=h+1;var t="_"+n;a+=(a?",":"")+n;p+="this."+t+" = "+n+";\n";e[n]=e[n]||function(i){if(!arguments.length)return this[t];c?c(this).setProperty(n,i):this[t]=i};c&&(e[n].set=e[n].set||function(n){this[t]=n})})(u[h]);return l=new Function(a,p.slice(0,-1)),l.prototype=e,e.constructor=l,s.map=nt,s.getters=u,s.extend=y,s.id=r,s}function hf(n,i){var r,f=b._wm||{},u=e({tmpls:[],links:{},bnds:[],_is:"template",render:cr},i);return u.markup=n,i.htmlTag||(r=ur.exec(n),u.htmlTag=r?r[1].toLowerCase():""),r=f[u.htmlTag],r&&r!==f.div&&(u.markup=t.trim(u.markup)),u}function ys(n,t){function r(f,e,s){var a,h,l,c;if(f&&typeof f===rt&&!f.nodeType&&!f.markup&&!f.getTgt&&!(n==="viewModel"&&f.getters||f.extend)){for(l in f)r(l,f[l],e);return e||o}return e===undefined&&(e=f,f=undefined),f&&""+f!==f&&(s=e,e=f,f=undefined),c=s?n==="viewModel"?s:s[u]=s[u]||{}:r,h=t.compile,e===null?f&&delete c[f]:(e=h?h.call(c,f,e,s,0):e,f&&(c[f]=e)),h&&e&&(e._is=n),e&&(a=i.onStore[n])&&a(f,e,h),e}var u=n+"s";o[u]=r}function cf(n){l[n]=function(t){return arguments.length?(s[n]=t,l):s[n]}}function lf(n){function t(t,i){this.tgt=n.getTgt(t,i)}return u(n)&&(n={getTgt:n}),n.baseMap&&(n=e(e({},n.baseMap),n)),n.map=function(n,i){return new t(n,i)},n}function cr(n,t,r,u,e,o){var l,w,v,c,y,p,k,d,s=u,a="";if(t===!0?(r=t,t=undefined):typeof t!==rt&&(t=undefined),(v=this.tag)?(y=this,s=s||y.view,c=s.getTmpl(v.template||y.tmpl),arguments.length||(n=s)):c=this,c){if(!s&&n&&n._is==="view"&&(s=n),s&&n===s&&(n=s.data),p=!s,ai=ai||p,s||((t=t||{}).root=n),!ai||b.useViews||c.useViews||s&&s!==h)a=af(c,n,t,r,s,e,o,v);else{if(s?(k=s.data,d=s.index,s.index=nf):(s=h,s.data=n,s.ctx=t),f(n)&&!r)for(l=0,w=n.length;l<w;l++)s.index=l,s.data=n[l],a+=c.fn(n[l],s,i);else s.data=n,a+=c.fn(n,s,i);s.data=k;s.index=d}p&&(ai=undefined)}return a}function af(n,t,r,u,o,s,h,l){function it(n){b=e({},r);b[v]=n}var y,rt,a,g,nt,tt,w,k,ut,v,b,p,d="";if(l&&(ut=l.tagName,p=l.tagCtx,r=r?vt(r,l.ctx):l.ctx,n===o.content?w=n!==o.ctx._wrp?o.ctx._wrp:undefined:n!==p.content?n===l.template?(w=p.tmpl,r._wrp=p.content):w=p.content||o.content:w=o.content,p.props.link===!1&&(r=r||{},r.link=!1),(v=p.props.itemVar)&&(v.charAt(0)!=="~"&&c("Use itemVar='~myItem'"),v=v.slice(1))),o&&(h=h||o._.onRender,r=vt(r,o.ctx)),s===!0&&(tt=!0,s=0),h&&(r&&r.link===!1||l&&l._.noVws)&&(h=undefined),k=h,h===!0&&(k=undefined,h=o._.onRender),r=n.helpers?vt(n.helpers,r):r,b=r,f(t)&&!u)for(a=tt?o:s!==undefined&&o||new kt(r,"array",o,t,n,s,h),o&&o._.useKey&&(a._.bnd=!l||l._.bnd&&l),v&&(a.it=v),v=a.it,y=0,rt=t.length;y<rt;y++)v&&it(t[y]),g=new kt(b,"item",a,t[y],n,(s||0)+y,h,w),nt=n.fn(t[y],g,i),d+=a._.onRender?a._.onRender(nt,g):nt;else v&&it(t),a=tt?o:new kt(b,ut||"data",o,t,n,s,h,w),l&&!l.flow&&(a.tag=l),d+=n.fn(t,a,i);return k?k(d,a):d}function vf(n,t,i){var r=i!==undefined?u(i)?i.call(t.data,n,t):i||"":"{Error: "+n.message+"}";return s.onError&&(i=s.onError.call(t.data,n,i&&r,t))!==undefined&&(r=i),t&&!t.linkCtx?lt.html(r):r}function ut(n){throw new i.Err(n);}function c(n){ut("Syntax error\n"+n)}function lr(n,t,i,r,u){function tt(t){t-=e;t&&y.push(n.substr(e,t).replace(rr,"\\n"))}function p(t,i){t&&(t+="}}",c((i?"{{"+i+"}} block has {{/"+t+" without {{"+t:"Unmatched or missing {{/"+t)+", in template:\n"+n))}function it(o,s,l,a,w,b,g,it,rt,ut,ft,et){(g&&s||rt&&!l||it&&it.slice(-1)===":"||ut)&&c(o);b&&(w=":",a=v);rt=rt||i&&!u;var ot=(s||i)&&[[]],ht="",ct="",lt="",at="",vt="",yt="",pt="",wt="",st=!rt&&!w;l=l||(it=it||"#data",w);tt(et);e=et+o.length;g?nt&&y.push(["*","\n"+it.replace(/^:/,"ret+= ").replace(bu,"$1")+";\n"]):l?(l==="else"&&(po.test(it)&&c('for "{{else if expr}}" use "{{else expr}}"'),ot=f[7]&&[[]],f[8]=n.substring(f[8],et),f=h.pop(),y=f[2],st=!0),it&&wf(it.replace(rr," "),ot,t).replace(yo,function(n,t,i,r,u,f,e,o){return r="'"+u+"':",e?(ct+=f+",",at+="'"+o+"',"):i?(lt+=r+"j._cp("+f+',"'+o+'",view),',yt+=r+"'"+o+"',"):t?pt+=f:(u==="trigger"&&(wt+=f),ht+=r+f+",",vt+=r+"'"+o+"',",d=d||du.test(u)),""}).slice(0,-1),ot&&ot[0]&&ot.pop(),k=[l,a||!!r||d||"",st&&[],yf(at||(l===":"?"'#data',":""),vt,yt),yf(ct||(l===":"?"data,":""),ht,lt),pt,wt,ot||0],y.push(k),st&&(h.push(f),f=k,f[8]=e)):ft&&(p(ft!==f[0]&&f[0]!=="else"&&ft,f[0]),f[8]=n.substring(f[8],et),f=h.pop());p(!f&&ft);y=f[2]}var b,w,k,d,g,nt=s.allowCode||t&&t.allowCode||l.allowCode===!0,o=[],e=0,h=[],y=o,f=[,,o];if(nt&&t._is&&(t.allowCode=nt),i&&(r!==undefined&&(n=n.slice(0,-r.length-2)+a),n=wt+n+bt),p(h[0]&&h[0][2].pop()[0]),n.replace(ii,it),tt(n.length),(e=o[o.length-1])&&p(""+e!==e&&+e[8]===e[8]&&e[0]),i){for(w=vr(o,n,i),g=[],b=o.length;b--;)g.unshift(o[b][7]);ar(w,g)}else w=vr(o,t);return w}function ar(n,t){var r,i,u=0,f=t.length;for(n.deps=[];u<f;u++){i=t[u];for(r in i)r!=="_jsvto"&&i.hasOwnProperty(r)&&i[r].length&&(n.deps=n.deps.concat(i[r]))}n.paths=i}function yf(n,t,i){return[n.slice(0,-1),t.slice(0,-1),i.slice(0,-1)]}function pf(n,t){return"\n\t"+(t?t+":{":"")+"args:["+n[0]+"]"+(n[1]||!t?",\n\tprops:{"+n[1]+"}":"")+(n[2]?",\n\tctx:{"+n[2]+"}":"")}function wf(n,t,i){function d(h,d,g,nt,tt,it,rt,ut,ft,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt){function ri(n,i,o,s,h,l,a,v){var y=o===".";if(o&&(tt=tt.slice(i.length),/^\.?constructor$/.test(v||tt)&&c(n),y||(n=(s?'view.hlp("'+s+'")':h?"view":"data")+(v?(l?"."+l:s?"":h?"":"."+o)+(a||""):(v=s?"":h?l||"":o,"")),n=n+(v?"."+v:""),n=i+(n.slice(0,9)==="view.data"?n.slice(5):n)),u)){if(dt=e==="linkTo"?p=t._jsvto=t._jsvto||[]:f.bd,kt=y&&dt[dt.length-1]){if(kt._jsv){while(kt.sb)kt=kt.sb;kt.bnd&&(tt="^"+tt.slice(1));kt.sb=tt;kt.bnd=kt.bnd||tt.charAt(0)==="^"}}else dt.push(tt);k[r]=wt+(y?1:0)}return n}nt&&!ut&&(tt=nt+tt);it=it||"";g=g||d||ht;tt=tt||ft;ot=ot||yt||"";var ti,ni,dt,kt,gt,ii=")";if(ot==="["&&(ot="[j._sq(",ii=")]"),!rt||s||o){if(u&&vt&&!s&&!o&&(!e||w||p)&&(ti=k[r-1],bt.length-1>wt-(ti||0))){if(ti=bt.slice(ti,wt+h.length),ni!==!0)if(dt=p||l[r-1].bd,kt=dt[dt.length-1],kt&&kt.prm){while(kt.sb&&kt.sb.prm)kt=kt.sb;gt=kt.sb={path:kt.sb,bnd:kt.bnd}}else dt.push(gt={path:dt.pop()});vt=et+":"+ti+" onerror=''"+a;ni=b[vt];ni||(b[vt]=!0,b[vt]=ni=lr(vt,i,!0));ni!==!0&&gt&&(gt._jsv=ni,gt.prm=f.bd,gt.bnd=gt.bnd||gt.path&&gt.path.indexOf("^")>=0)}return s?(s=!ct,s?h:ht+'"'):o?(o=!lt,o?h:ht+'"'):(g?(k[r]=wt++,f=l[++r]={bd:[]},g):"")+(pt?r?"":(v=bt.slice(v,wt),e?(e=w=p=!1,"\b"):"\b,")+v+(v=wt+h.length,u&&t.push(f.bd=[]),"\b"):ut?(r&&c(n),u&&t.pop(),e=tt,w=nt,v=wt+h.length,nt&&(u=f.bd=t[e]=[]),tt+":"):tt?tt.split("^").join(".").replace(ao,ri)+(ot?(f=l[++r]={bd:[]},y[r]=ii,ot):it):it?it:at?(at=y[r]||at,y[r]=!1,f=l[--r],at)+(ot?(f=l[++r],y[r]=ii,ot):""):st?(y[r]||c(n),","):d?"":(s=ct,o=lt,'"'))}c(n)}var e,p,w,o,s,u=t&&t[0],f={bd:u},l={0:f},v=0,b=(i?i.links:u&&(u.links=u.links||{}))||h.tmpl.links,r=0,y={},k={},g=(n+(i?" ":"")).replace(vo,d);return!r&&g||c(n)}function vr(n,t,i){var tt,u,f,l,ut,vt,yt,gt,pt,ht,it,e,p,ft,et,w,ct,k,a,d,ot,wt,rt,bt,kt,lt,nt,y,at,dt,o=0,h=b.useViews||t.useViews||t.tags||t.templates||t.helpers||t.converters,r="",st={},ni=n.length;for(""+t===t?(k=i?'data-link="'+t.replace(rr," ").slice(1,-1)+'"':t,t=0):(k=t.tmplName||"unnamed",t.allowCode&&(st.allowCode=!0),t.debug&&(st.debug=!0),it=t.bnds,ct=t.tmpls),tt=0;tt<ni;tt++)if(u=n[tt],""+u===u)r+='\n+"'+u+'"';else if(f=u[0],f==="*")r+=";\n"+u[1]+"\nret=ret";else{if(l=u[1],ot=!i&&u[2],ut=pf(u[3],"params")+"},"+pf(p=u[4]),y=u[5],dt=u[6],wt=u[8]&&u[8].replace(bu,"$1"),(kt=f==="else")?e&&e.push(u[7]):(o=0,it&&(e=u[7])&&(e=[e],o=it.push(1))),h=h||p[1]||p[2]||e||/view.(?!index)/.test(p[0]),(lt=f===":")?l&&(f=l===v?">":l+f):(ot&&(a=hf(wt,st),a.tmplName=k+"/"+f,a.useViews=a.useViews||h,vr(ot,a),h=a.useViews,ct.push(a)),kt||(d=f,h=h||f&&(!g[f]||!g[f].flow),bt=r,r=""),rt=n[tt+1],rt=rt&&rt[0]==="else"),at=y?";\ntry{\nret+=":"\n+",ft="",et="",lt&&(e||dt||l&&l!==v)){if(nt=new Function("data,view,j,u"," // "+k+" "+o+" "+f+"\nreturn {"+ut+"};"),nt._er=y,nt._tag=f,i)return nt;ar(nt,e);w='c("'+l+'",view,';ht=!0;ft=w+o+",";et=")"}if(r+=lt?(i?(y?"try{\n":"")+"return ":at)+(ht?(ht=undefined,h=pt=!0,w+(e?(it[o-1]=nt,o):"{"+ut+"}")+")"):f===">"?(yt=!0,"h("+p[0]+")"):(gt=!0,"((v="+p[0]+")!=null?v:"+(i?"null)":'"")'))):(vt=!0,"\n{view:view,tmpl:"+(ot?ct.length:"0")+","+ut+"},"),d&&!rt){if(r="["+r.slice(0,-1)+"]",w='t("'+d+'",view,this,',i||e){if(r=new Function("data,view,j,u"," // "+k+" "+o+" "+d+"\nreturn "+r+";"),r._er=y,r._tag=d,e&&ar(it[o-1]=r,e),i)return r;ft=w+o+",undefined,";et=")"}r=bt+at+w+(o||r)+")";e=0;d=0}y&&(h=!0,r+=";\n}catch(e){ret"+(i?"urn ":"+=")+ft+"j._err(e,view,"+y+")"+et+";}"+(i?"":"ret=ret"))}r="// "+k+"\nvar v"+(vt?",t=j._tag":"")+(pt?",c=j._cnvt":"")+(yt?",h=j._html":"")+(i?";\n":',ret=""\n')+(st.debug?"debugger;":"")+r+(i?"\n":";\nreturn ret;");s.debugMode!==!1&&(r="try {\n"+r+"\n}catch(e){\nreturn j._err(e, view);\n}");try{r=new Function("data,view,j,u",r)}catch(ti){c("Compiled template code:\n\n"+r+'\n: "'+ti.message+'"')}return t&&(t.fn=r,t.useViews=!!h),r}function vt(n,t){return n&&n!==t?t?e(e({},t),n):n:t&&e({},t)}function ps(n){return gu[n]||(gu[n]="&#"+n.charCodeAt(0)+";")}function ws(n){var t,i,r=[];if(typeof n===rt)for(t in n)i=n[t],t!==tt&&n.hasOwnProperty(t)&&!u(i)&&r.push({key:t,prop:i});return r}function bf(n,i,r){var u=this.jquery&&(this[0]||ut('Unknown template: "'+this.selector+'"')),f=u.getAttribute(fr);return cr.call(f?t.data(u)[at]:it(u),n,i,r)}function yr(n){return n!=undefined?wo.test(n)&&(""+n).replace(ko,ps)||n:""}function pt(n,i,f){var b,it,a,e,k,v,h,g,c,y,rt,nt,tt,o,s,p,l,w=n.target,ut=w._jsvBnd;if(ut)while(y=lh.exec(ut))if((y=d[y[1]])&&(s=y.to)){if(e=y.linkCtx,c=e.view,o=e.tag||c.tag,g=t(w),nt=c.hlp(nu),tt=c.hlp(tu),a=hi(w),b=ru[a],f===undefined&&(f=u(a)?a(w):b?g[b]():g.attr(a)),v=s[1],s=s[0],s=s+""===s?[e.data,s]:s,v&&(k=u(v)?v:c.getRsc("converters",v)),e.elem.nodeName==="SELECT"&&(e.elem._jsvSel=f=f||(e.elem.multiple?[]:f)),k&&(f=k.call(o,f)),rt=c.linkCtx,c.linkCtx=e,p={change:"change",oldValue:e._val,value:f},(!nt||!(it=nt.call(e,n,p)===!1))&&(!o||!o.onBeforeChange||!(it=o.onBeforeChange(n,p)===!1))&&f!==undefined&&(h=s[0],f!==undefined&&h)){if(h._jsv)for(l=h,h=e.data;l&&l.sb;)h=e._ctxCb(l,h),l=l.sb;if(o&&(o._.chging=!0),r(h).setProperty(s[1],f),tt&&tt.call(e,n,p),o){if(o.onAfterChange)o.onAfterChange(n,p);o._.chging=undefined}e._val=f}c.linkCtx=rt}}function ah(n,t,r){var h,e,w,p,l,a,u=this,f=u.tag,c=u.data,v=u.elem,s=u.convert,k=v.parentNode,o=u.view,b=o.linkCtx,y=o.hlp(nu);if(o.linkCtx=u,k&&(!y||!(t&&y.call(u,n,t)===!1))&&!(t&&n.data.prop!=="*"&&n.data.prop!==t.path)){if(t&&(u.eventArgs=t),t||u._toLk){if(u._toLk=0,r._er)try{e=r(c,o)}catch(d){l=r._er;a=vf(d,o,new Function("data,view","return "+l+";")(c,o));e=[{props:{},args:[a]}]}else e=r(c,o,i);if(h=vh(e,u,f=u.tag,u.attr||hi(v,!0,s!==undefined)),f){if(p=l||f._er,e=e[0]?e:[e],w=!p&&t&&f.onUpdate&&f.onUpdate(n,t,e)===!1,so(f,e,p),w||h===oi){di(f,n,t);cu(u,c,v);o.linkCtx=b;return}if(f._.chging)return;if(f.onUnbind)f.onUnbind(f.tagCtx,u,f.ctx,n,t);e=f.tagName===":"?i._cnvt(f.cvt,o,e[0]):i._tag(f,o,o.tmpl,e,!0,a)}else r._tag&&(s=s===""?si:s,e=s?i._cnvt(s,o,e[0]||e):i._tag(r._tag,o,o.tmpl,e,!0,a),li(f=u.tag,!0),h=u.attr||h);no(e,u,h,f)&&t&&(y=o.hlp(tu))&&y.call(u,n,t);u._noUpd=0;f&&(f._er=l,di(f,n,t))}cu(u,c,v);o.linkCtx=b}}function vh(n,i,r,f){var e,h,c,o,s=r&&r.parentElem||i.elem;if(n!==undefined){if(o=t(s),f=r&&r.attr||f,u(n)&&ut(i.expr+": missing parens"),c=/^css-/.test(f)&&f.slice(4))e=t.style(s,c),+n===n&&(e=parseInt(e));else if(f!=="link"){if(f==="value")s.type===wi&&(e=o.prop(f=ti));else if(f===ei)if(s.value===""+n)e=o.prop(ti);else return f;e===undefined&&(h=ru[f],e=h?o[h]():o.attr(f))}i._val=e}return f}function nt(n,t){n._df=t;n[(t?"set":"remove")+"Attribute"](ae,"")}function no(i,r,u,e){var et,s,h,rt,ot,k,l,d,a,p,w,ut,ft,g,b=u!==oi&&i!==undefined&&!r._noUpd,st=r.data,o=e&&e.parentElem||r.elem,ht=o.parentNode,tt=t(o),y=r.view,it=r._val,ct=y.linkCtx,c=e;if(e&&(e._.unlinked=!0,e.parentElem=e.parentElem||r.expr||e._elCnt?o:ht,s=e._prv,h=e._nxt),b){if(u==="visible"&&(u="css-display"),/^css-/.test(u))r.attr==="visible"&&(ft=(o.currentStyle||ge.call(n,o,"")).display,i?(i=o._jsvd||ft,i!==oi||(i=we[ut=o.nodeName])||(w=document.createElement(ut),document.body.appendChild(w),i=we[ut]=(w.currentStyle||ge.call(n,w,"")).display,document.body.removeChild(w))):(o._jsvd=ft,i=oi)),(c=c||it!==i)&&t.style(o,u.slice(4),i);else if(u!=="link"){if(/^data-/.test(u)&&t.data(o,u.slice(5),i),u===ti)k=!0,i=i&&i!=="false";else if(u===ei)if(o.value===""+i)i=k=!0,u=ti;else{cu(r,st,o);return}else u==="selected"||u==="disabled"||u==="multiple"||u==="readonly"?i=i&&i!=="false"?u:null:u==="value"&&o.nodeName==="SELECT"&&(o._jsvSel=f(i)?i:""+i);(et=ru[u])?u===v?(y.linkCtx=r,e&&e._.inline?(ot=e.nodes(!0),e._elCnt&&(s&&s!==h?yu(s,h,o,e._tgId,"^",!0):(l=o._df)&&(d=e._tgId+"^",a=l.indexOf("#"+d)+1,p=l.indexOf("/"+d),a&&p>0&&(a+=d.length,p>a&&(nt(o,l.slice(0,a)+l.slice(p)),co(l.slice(a,p))))),s=s?s.previousSibling:h?h.previousSibling:o.lastChild),t(ot).remove(),rt=y.link(y.data,o,s,h,i,e&&{tag:e._tgId,lazyLink:e.tagCtx.props.lazyLink})):(b=b&&it!==i,b&&tt.empty(),b&&(rt=y.link(st,o,s,h,i,e&&{tag:e._tgId}))),y.linkCtx=ct):((c=c||it!==i)&&(u==="text"&&o.children&&!o.children[0]?o.textContent!==undefined?o.textContent=i:o.innerText=i===null?"":i:tt[et](i)),(g=ht._jsvSel)&&(u==="value"||!tt.attr("value"))&&(o.selected=t.inArray(""+i,f(g)?g:[g])>-1)):(c=c||it!==i)&&tt[k?"prop":"attr"](u,i===undefined&&!k?null:i);r._val=i}return rt||c}}function to(n,t){var i=this,f=i.hlp(nu),e=i.hlp(tu);if(!f||f.call(this,n,t)!==!1){if(t){var o=t.change,u=t.index,r=t.items;i._.srt=t.refresh;switch(o){case"insert":i.addViews(u,r);break;case"remove":i.removeViews(u,r.length);break;case"move":i.removeViews(t.oldIndex,r.length,undefined,!0);i.addViews(u,r);break;case"refresh":i._.srt=undefined;i.fixIndex(0)}}e&&e.call(this,n,t)}}function su(n){var r,u,e=n.type,f=n.data,i=n._.bnd;if(!n._.useKey&&i)if((u=n._.bndArr)&&(t([u[1]]).off(ht,u[0]),n._.bndArr=undefined),i!==!!i)e?i._.arrVws[n._.id]=n:delete i._.arrVws[n._.id];else if(e&&f){r=function(t){t.data&&t.data.off||to.apply(n,arguments)};t([f]).on(ht,r);n._.bndArr=[r,f]}}function hi(n,t,i){var u=n.nodeName.toLowerCase(),r=b._fe[u]||n.contentEditable===si&&{to:v,from:v};return r?t?u==="input"&&n.type===ei?ei:r.to:r.from:t?i?"text":v:""}function io(n,i,r,u,f,e,o){var y,h,a,p,w,c=n.parentElem,s=n._prv,l=n._nxt,v=n._elCnt;if(s&&s.parentNode!==c&&ut("Missing parentNode"),o){p=n.nodes();v&&s&&s!==l&&yu(s,l,c,n._.id,"_",!0);n.removeViews(undefined,undefined,!0);h=l;v&&(s=s?s.previousSibling:l?l.previousSibling:c.lastChild);t(p).remove();for(w in n._.bnds)nr(w)}else{if(i){if(a=u[i-1],!a)return!1;s=a._nxt}v?(h=s,s=h?h.previousSibling:c.lastChild):h=s.nextSibling}y=r.render(f,e,n._.useKey&&o,n,o||i,!0);n.link(f,c,s,h,y,a)}function hu(n,t,i){var r,u;return i?(u="^`",li(i,!0),r=i._tgId,r||(d[r=be++]=i,i._tgId=""+r)):(u="_`",li(ft[r=t._.id]=t)),"#"+r+u+(n!=undefined?n:"")+"/"+r+u}function cu(n,t,i){var l,s,f,a,v,o=n.tag,p=n.convertBack,h=[],c=n._bndId||""+be++,w=n._hdl;if(n._bndId=undefined,o&&(h=o.depends||h,h=u(h)?o.depends(o):h,f=o.linkedElem),!n._depends||""+n._depends!=""+h){for(n._depends&&r._apply(!1,[t],n._depends,w,!0),a=n.fn.deps.slice(),s=a.length;s--;)v=a[s],v._jsv&&(a[s]=e({},v));l=r._apply(!1,[t],a,h,w,n._ctxCb);l.elem=i;l.linkCtx=n;l._tgId=c;i._jsvBnd=i._jsvBnd||"";i._jsvBnd+="&"+c;n._depends=h;n.view._.bnds[c]=c;d[c]=l;f&&(l.to=[[],p]);(f||p!==undefined)&&oo(l,o,f&&f[0]||i,p);o&&(o.flow||o._.inline||(i.setAttribute(y,(i.getAttribute(y)||"")+"#"+c+"^/"+c+"^"),o._tgId=""+c))}if(f&&f[0])for(s=f.length;s--;)f[s]._jsvBnd=f[s]._jsvBnd||i._jsvBnd+"+",f[s]._jsvLkEl=o}function ro(n,t,i,r,u,f,e){return lu(this,n,t,i,r,u,f,e)}function lu(n,i,r,u,f,o,s,c){if(u===!0?(f=u,u=undefined):u=typeof u!="object"?undefined:e({},u),n&&i){if(i=i.jquery?i:t(i),!gt){gt=document.body;t(gt).on(he,pt).on("blur","[contenteditable]",pt)}for(var v,b,k,w,a,y,l,d,g,it=hu,rt=u&&u.target==="replace",tt=i.length;tt--;){if(l=i[tt],o=o||fi(l),(g=o===h)&&(h.data=(h.ctx=u||{}).root=r),""+n===n)au(n,l,o,undefined,!0,r,u);else{if(n.markup!==undefined)rt&&(y=l.parentNode),k=n.render(r,u,f,o,undefined,it),y?(s=l.previousSibling,c=l.nextSibling,t.cleanData([l],!0),y.removeChild(l),l=y):(s=c=undefined,t(l).empty());else if(n===!0&&o===h)d={lnk:1};else break;if(l._df&&!c){for(w=p(l._df,!0,ke),v=0,b=w.length;v<b;v++)a=w[v],(a=ft[a.id])&&a.data!==undefined&&a.parent.removeViews(a._.key,undefined,!0);nt(l)}o.link(r,l,s,c,k,d,u)}g&&(h.data=h.ctx=undefined)}}return i}function yh(n,i,r,u,f,e,o,s){function yr(n,t,i,r,u,e,o,s,h,a,v,p,b,k){var d,tt,nt="";return k?(at=0,n):(l=h||a||"",r=r||v,i=i||b,gt&&!i&&(!n||r||l||e&&!at)&&(gt=undefined,w=ht.shift()),r=r||i,r&&(at=0,gt=undefined,dt&&(i||b?ou[w]||/;svg;|;math;/.test(";"+ht.join(";")+";")||(d="'<"+w+".../"):ou[r]?d="'<\/"+r:ht.length&&r===w||(d="Mismatch: '<\/"+r),d&&c(d+">' in:\n"+f)),vi=g,w=ht.shift(),g=eu[w],v=v?"<\/"+v+">":"",vi&&(rt+=st,st="",g?rt+="-":(nt=v+le+"@"+rt+ce+(p||""),rt=ar.shift()))),g?(e?st+=e:t=v||b||"",l&&(t+=l,st&&(t+=" "+y+'="'+st+'"',st=""))):t=e?t+nt+u+(at?"":le+e+ce)+s+l:nt||n,dt&&o&&(at&&c("{^{ within elem markup ("+at+' ). Use data-link="..."'),e.charAt(0)==="#"?ht.unshift(e.slice(1)):e.slice(1)!==(tt=ht.shift())&&c("Closing tag for {^{...}} under different elem: <"+tt+">")),l&&(at=l,ht.unshift(w),w=l.slice(1),dt&&ht[0]&&ht[0]===fh[w]&&ut("Parent of <tr> must be <tbody>"),gt=ou[w],(g=eu[w])&&!vi&&(ar.unshift(rt),rt=""),vi=g,rt&&g&&(rt+="+")),t)}function ri(n,t){var e,c,r,f,u,y,o,s=[];if(n){for(n._tkns.charAt(0)==="@"&&(t=h.previousSibling,h.parentNode.removeChild(h),h=undefined),ct=n.length;ct--;){if(v=n[ct],r=v.ch,e=v.path)for(tt=e.length-1;c=e.charAt(tt--);)c==="+"?e.charAt(tt)==="-"?(tt--,t=t.previousSibling):t=t.parentNode:t=t.lastChild;r==="^"?(l=d[u=v.id])&&(o=t&&(!h||h.parentNode!==t),(!h||o)&&(l.parentElem=t),v.elCnt&&o&&nt(t,(v.open?"#":"/")+u+r+(t._df||"")),s.push([o?null:h,v])):(a=ft[u=v.id])&&(a.parentElem||(a.parentElem=t||h&&h.parentNode||i,a._.onRender=hu,a._.onArrayChange=to,su(a)),f=a.parentElem,v.open?(a._elCnt=v.elCnt,t&&!h?nt(t,"#"+u+r+(t._df||"")):(a._prv||nt(f,ki(f._df,"#"+u+r)),a._prv=h)):(t&&(!h||h.parentNode!==t)?(nt(t,"/"+u+r+(t._df||"")),a._nxt=undefined):h&&(a._nxt||nt(f,ki(f._df,"/"+u+r)),a._nxt=h),kt=a.linkCtx,(y=a.ctx&&a.ctx.onAfterCreate||pr)&&y.call(kt,a)))}for(ct=s.length;ct--;)ii.push(s[ct])}return!n||n.elCnt}function ir(n){var t,i,r;if(n)for(ct=n.length,tt=0;tt<ct;tt++)if(v=n[tt],i=l=d[v.id].linkCtx.tag,r=l.tagName===bi,!l.flow||r){if(!wi){for(t=1;i=i.parent;)t++;li=li||t}(wi||t===li)&&(!bi||r)&&fr.push(l)}}function rr(){var s,c,e="",b={},w=oe+(it?",["+ae+"]":"");for(ui=fu?i.querySelectorAll(w):t(w,i).get(),vt=ui.length,r&&r.innerHTML&&(ei=fu?r.querySelectorAll(w):t(w,r).get(),r=ei.length?ei[ei.length-1]:r),li=0,et=0;et<vt;et++)if(h=ui[et],r&&!cr)cr=h===r;else if(u&&h===u){it&&(e+=ci(h));break}else if(h.parentNode)if(it){if(e+=ci(h),h._df){for(s=et+1;s<vt&&h.contains(ui[s]);)s++;b[s-1]=h._df}b[et]&&(e+=b[et]||"")}else nr&&(v=p(h,undefined,de))&&(v=v[0])&&(ti=ti?v.id!==ti&&ti:v.open&&v.id),!ti&&vr(p(h))&&h.getAttribute(ot)&&ii.push([h]);if(it&&(e+=i._df||"",(c=e.indexOf("#"+it.id)+1)&&(e=e.slice(c+it.id.length)),c=e.indexOf("/"+it.id),c+1&&(e=e.slice(0,c)),ir(p(e,undefined,hh))),f===undefined&&i.getAttribute(ot)&&ii.push([i]),fo(r,g),fo(u,g),it){lt&&lt.resolve();return}for(g&&rt+st&&(h=u,rt&&(u?ri(p(rt+"+",!0),u):ri(p(rt,!0),i)),ri(p(st,!0),i),u&&(e=u.getAttribute(y),(vt=e.indexOf(yi)+1)&&(e=e.slice(vt+yi.length-1)),u.setAttribute(y,st+e))),vt=ii.length,et=0;et<vt;et++)h=ii[et],pt=h[1],h=h[0],pt?(l=d[pt.id])&&((kt=l.linkCtx)&&(l=kt.tag,l.linkCtx=kt),pt.open?(h&&(l.parentElem=h.parentNode,l._prv=h),l._elCnt=pt.elCnt,a=l.tagCtx.view,au(undefined,l._prv,a,pt.id)):(l._nxt=h,l._.unlinked&&(er=l.tagCtx,a=er.view,di(l)))):au(h.getAttribute(ot),h,fi(h),undefined,nr,n,o);lt&&lt.resolve()}var at,kt,l,et,vt,tt,ct,ui,h,a,v,pt,ei,oi,pi,hi,wt,fr,wi,bi,er,dt,li,or,gi,sr,hr,w,gt,ni,ai,yt,g,vi,bt,st,yi,cr,ti,lt,nr,it,tr=this,lr=tr._.id+"_",rt="",ii=[],ht=[],ar=[],pr=tr.hlp(rh),vr=ri;if(e&&(lt=e.lazyLink&&t.Deferred(),e.tmpl?pi="/"+e._.id+"_":(nr=e.lnk,e.tag&&(lr=e.tag+"^",e=!0),(it=e.get)&&(vr=ir,fr=it.tags,wi=it.deep,bi=it.name)),e=e===!0),i=i?""+i===i?t(i)[0]:i.jquery?i[0]:i:tr.parentElem||document.body,dt=!b.noValidate&&i.contentEditable!==si,w=i.tagName.toLowerCase(),g=!!eu[w],r=r&&eo(r,g),u=u&&eo(u,g)||null,f!=undefined){if(ai=document.createElement("div"),ni=ai,yi=st="",bt=i.namespaceURI==="http://www.w3.org/2000/svg"?"svg_ns":(hr=ur.exec(f))&&hr[1]||"",g){for(wt=u;wt&&!(hi=p(wt));)wt=wt.nextSibling;(yt=hi?hi._tkns:i._df)&&(oi=pi||"",(e||!pi)&&(oi+="#"+lr),tt=yt.indexOf(oi),tt+1&&(tt+=oi.length,yi=st=yt.slice(0,tt),yt=yt.slice(tt),hi?wt.setAttribute(y,yt):nt(i,yt)))}if(gt=undefined,f=(""+f).replace(oh,yr),dt&&ht.length&&c("Mismatched '<"+w+"...>' in:\n"+f),s)return;for(pe.appendChild(ai),bt=k[bt]||k.div,or=bt[0],ni.innerHTML=bt[1]+f+bt[2];or--;)ni=ni.lastChild;for(pe.removeChild(ai),gi=document.createDocumentFragment();sr=ni.firstChild;)gi.appendChild(sr);i.insertBefore(gi,u)}return lt?setTimeout(rr,0):rr(),lt&&lt.promise()}function au(n,t,r,u,f,e,o){var k,s,g,p,y,w,l,h,it,nt,tt,b=[];if(u)h=d[u],h=h.linkCtx?h.linkCtx.tag:h,l=h.linkCtx||{type:"inline",data:r.data,elem:h._elCnt?h.parentElem:t,view:r,ctx:r.ctx,attr:v,fn:h._.bnd,tag:h,_bndId:u},uo(l,l.fn);else if(n&&t){for(e=f?e:r.data,k=r.tmpl,n=ph(n,hi(t)),tt=ni.lastIndex=0;s=ni.exec(n);)b.push(s),tt=ni.lastIndex;for(tt<n.length&&c(n);s=b.shift();){for(it=ni.lastIndex,g=s[1],y=s[3];b[0]&&b[0][4]==="else";)y+=bt+wt+b.shift()[3],nt=!0;nt&&(y+=bt+wt+et+"/"+s[4]+a);l={type:f?"top":"link",data:e,elem:t,view:r,ctx:o,attr:g,isLk:f,_toLk:1,_noUpd:s[2]};p=undefined;s[6]&&(p=s[10]||undefined,l.convert=s[5]||"",!g&&p!==undefined&&hi(t)&&(l.convertBack=p=p.slice(1)));l.expr=g+y;w=k.links[y];w||(k.links[y]=w=i.tmplFn(y,k,!0,p,nt));l.fn=w;uo(l,w);ni.lastIndex=it}}}function uo(n,t){function r(i,r){ah.call(n,i,r,t)}r.noArray=!0;n.isLk&&li(n.view=new i.View(i.extendCtx(n.ctx,n.view.ctx),"link",n.view,n.data,n.expr,undefined,hu));n._ctxCb=bh(n.view);n._hdl=r;r(!0)}function ki(n,t){var i;return n?(i=n.indexOf(t),i+1?n.slice(0,i)+n.slice(i+t.length):n):""}function ci(n){return n&&(""+n===n?n:n.tagName===bi?n.type.slice(3):n.nodeType===1&&n.getAttribute(y)||"")}function p(n,t,i){function e(n,t,i,u,e,o){f.push({elCnt:r,id:u,ch:e,open:t,close:i,path:o,token:n})}var r,u,f=[];if(u=t?n:ci(n))return r=f.elCnt=n.tagName!==bi,r=u.charAt(0)==="@"||r,f._tkns=u,u.replace(i||ch,e),f}function fo(n,t){n&&(n.type==="jsv"?n.parentNode.removeChild(n):t&&n.getAttribute(ot)===""&&n.removeAttribute(ot))}function eo(n,t){for(var i=n;t&&i&&i.nodeType!==1;)i=i.previousSibling;return i&&(i.nodeType!==1?(i=document.createElement(bi),i.type="jsv",n.parentNode.insertBefore(i,n)):ci(i)||i.getAttribute(ot)||i.setAttribute(ot,"")),i}function ph(n,i){return n=t.trim(n).replace(ku,"\\$&"),n.slice(-1)!==a?n=et+":"+n+(i?":":"")+a:n}function di(n,i,r){var f,u,o,l,h,c=n.tagCtx,a=c.view,e=c.props,s=n.linkCtx;if(n._.unlinked&&(n.linkedElement!==undefined&&(n.linkedElem=n._.inline?n.contents(!0,n.linkedElement||"*").first():t(s.elem)),n.onBind))n.onBind(c,s,n.ctx,i,r);if(n.onAfterLink)n.onAfterLink(c,s,n.ctx,i,r);if(n._.unlinked=undefined,f=n.targetTag?n.targetTag.linkedElem:n.linkedElem,u=f&&f[0]){if(!n.noVal&&!n._.chging){if(o=n.cvtArgs()[0],u!==s.elem){for(l=f.length;l--;)u=f[l],h=u._jsvLkEl,n._.inline&&(!h||h!==n&&h.targetTag!==n)&&(u._jsvLkEl=n,oo(d[n._tgId],n,u),u._jsvBnd="&"+n._tgId+"+");s._val=o}o!==undefined&&(u.value!==undefined?u.type===wi?u[ti]=o&&o!=="false":u.type==="text"&&(u.value=o):u.contentEditable===si&&(u.innerHTML=o))}n.setSize&&(e.height&&f.height(e.height),e.width&&f.width(e.width));e.title!==undefined&&f.attr("title",e.title);e["class"]&&(r&&f.hasClass(r.oldValue)&&f.removeClass(r.oldValue),f.addClass(e["class"]));e.id&&(f[0].id=e.id);e.name&&f.attr("name",e.name)}}function wh(n){setTimeout(function(){pt(n)},0)}function vu(n,t,i){t&&(t=""+t===t?t:"keydown",n[i](t,t==="keydown"?wh:pt))}function oo(n,i,r,u){var d,v,o,f,l,y,a,p,e,h,w,b=n.linkCtx,k=b.data,c=b.fn.paths;if(i=i||r._jsvLkEl,n&&c){if(p=r._jsvTr||!1,i&&(u=i.convertBack||u,a=i.tagCtx.props.trigger),a=a===undefined?s.trigger:a,p!==a&&(y=t(r),vu(y,p,"off"),vu(y,r._jsvTr=(r.tagName==="INPUT"&&r.type!==wi&&r.type!==ei||r.type==="textarea"||r.contentEditable===si)&&a,"on")),c=(d=c._jsvto)||c[0],v=c&&c.length,v&&(!i||i.tagCtx.args.length)){if(f=c[v-1],f._jsv){for(l=f;f.sb&&f.sb._jsv;)o=f=f.sb;o=f.sb||o&&o.path;f=o?o.slice(1):l.path}if(o)e=[l,f];else{while((w=b._ctxCb(o=f.split("^").join("."),k))&&(h=w.length)){if(e=w,e._cp){if(e=[e[h-3],e[h-2]],f=e[1],f._jsv){for(l=f;f.sb&&f.sb._jsv;)o=f=f.sb;o=f.sb||o&&o.path;f=o?o.slice(1):l.path;e=[l,f]}}else e=h>2?[e[h-3],e[h-2]]:[e[h-2]];k=e[0];f=e[1]}e=e||[k,o]}}else e=[];n.to=[e,u]}}function so(n,t,u){var o,s,h=n.tagCtx.view,f=n.tagCtxs||[n.tagCtx],c=f.length,l=!t;if(t=t||n._.bnd.call(h.tmpl,(n.linkCtx||h).data,h,i),u)f=n.tagCtxs=t,n.tagCtx=f[0];else while(c--)o=f[c],s=t[c],r(o.props).setProperty(s.props),e(o.ctx,s.ctx),o.args=s.args,l&&(o.tmpl=s.tmpl);return i._ths(n,f[0]),f}function gi(n){for(var u,t,i,f=[],e=n.length,r=e;r--;)f.push(n[r]);for(r=e;r--;)if(t=f[r],t.parentNode){if(i=t._jsvBnd)for(i=i.slice(1).split("&"),t._jsvBnd="",u=i.length;u--;)nr(i[u],t._jsvLkEl,t);co(ci(t)+(t._df||""))}}function nr(n,i,r){var v,o,u,c,l,y,p,w,a,s,b,h,e=d[n];if(i)r===i.linkedElem[0]&&(r._jsvLkEl=undefined,i.linkedElem=undefined);else if(e){delete d[n];for(v in e.bnd)c=e.bnd[v],l=e.cbId,f(c)?t([c]).off(ht+l).off(st+l):t(c).off(st+l),delete e.bnd[v];if(o=e.linkCtx){if(u=o.tag){if(y=u.tagCtxs)for(p=y.length;p--;)(w=y[p].map)&&w.unmap();if(a=u.linkedElem,u.onUnbind)u.onUnbind(u.tagCtx,o,u.ctx,!0);u.onDispose&&u.onDispose();u._elCnt||(u._prv&&u._prv.parentNode.removeChild(u._prv),u._nxt&&u._nxt.parentNode.removeChild(u._nxt))}s=a&&a[0]||o.elem;(b=s&&s._jsvTr)&&(vu(a||t(s),b,"off"),s._jsvTr=undefined);h=o.view;h.type==="link"?h.parent.removeViews(h._.key,undefined,!0):delete h._.bnds[n]}delete ct[e.cbId]}}function ho(n){n?(n=n.jquery?n:t(n),n.each(function(){for(var n;(n=fi(this,!0))&&n.parent;)n.parent.removeViews(n._.key,undefined,!0);gi(this.getElementsByTagName("*"))}),gi(n)):(gt&&(t(gt).off(he,pt).off("blur","[contenteditable]",pt),gt=undefined),h.removeViews(),gi(document.body.getElementsByTagName("*")))}function bh(n){return function(t,r,f){var c,s,l,e,o,a,h;if(n&&t){if(t._jsv)return t._jsv.call(n.tmpl,r,n,i);if(t.charAt(0)==="~")return t.slice(0,4)==="~tag"&&(s=n.ctx,t.charAt(4)==="."&&(c=t.slice(5).split("."),s=s.tag),c)?s?[s,c.join("."),r]:[]:(t=t.slice(1).split("."),(e=n.hlp(o=t.shift(),!0))&&(e._cp?(t.length&&(a="."+t.join("."),o=e[h=e.length-1],o._jsv?(o.sb=a,o.bnd=!!f):(e[h]=(o+a).replace("#data.",""),o.slice(0,5)==="#view"&&(e[h]=e[h].slice(6),e.splice(h,0,n)))),e.push(r),l=e):(t.length||u(e))&&(l=[e,t.join("."),r])),l||[]);if(t.charAt(0)==="#")return t==="#data"?[]:[n,t.replace(eh,""),r]}}}function kh(n){return n.type===wi?n[ti]:n.value}function yu(n,t,i,r,u,f){var c,s,l,o,v,h,e,a=0,w=n===t;if(n){for(l=p(n)||[],c=0,s=l.length;c<s;c++){if(o=l[c],h=o.id,h===r&&o.ch===u)if(f)s=0;else break;w||(v=o.ch==="_"?ft[h]:d[h].linkCtx.tag,o.open?v._prv=t:o.close&&(v._nxt=t));a+=h.length+2}a&&n.setAttribute(y,n.getAttribute(y).slice(a));e=t?t.getAttribute(y):i._df;(s=e.indexOf("/"+r+u)+1)&&(e=l._tkns.slice(0,a)+e.slice(s+(f?-1:r.length+1)));e&&(t?t.setAttribute(y,e):nt(i,e))}else nt(i,ki(i._df,"#"+r+u)),f||t||nt(i,ki(i._df,"/"+r+u))}function co(n){var i,u,t,r;if(r=p(n,!0,sh))for(i=0,u=r.length;i<u;i++)t=r[i],t.ch==="_"?(t=ft[t.id])&&t.type&&t.parent.removeViews(t._.key,undefined,!0):nr(t.id)}function li(n,u){n.contents=function(n,i){n!==!!n&&(i=n,n=undefined);var u,r=t(this.nodes());return r[0]&&(u=i?r.filter(i):r,r=n&&i?u.add(r.find(i)):u),r};n.nodes=function(n,t,i){var r,u=this,f=u._elCnt,o=!t&&f,e=[];for(t=t||u._prv,i=i||u._nxt,r=o?t===u._nxt?u.parentElem.lastSibling:t:u._.inline===!1?t||u.linkCtx.elem.firstChild:t&&t.nextSibling;r&&(!i||r!==i);)(n||f||r.tagName!==bi)&&e.push(r),r=r.nextSibling;return e};n.childTags=function(n,t){n!==!!n&&(t=n,n=undefined);var i=this,f=i.link?i:i.tagCtx.view,r=i._prv,e=i._elCnt,u=[];return f.link(undefined,i.parentElem,e?r&&r.previousSibling:r,i._nxt,undefined,{get:{tags:u,deep:n,name:t,id:i.link?i._.id+"_":i._tgId+"^"}}),u};n.refresh=function(n){var r,u,t=this,f=t.linkCtx,e=t.tagCtx.view;return t.disposed&&ut("Removed tag"),n===undefined&&(n=i._tag(t,e,e.tmpl,so(t),!0)),n+""===n&&(u=t._.inline?v:f.attr||hi(t.parentElem,!0),r=no(n,f,u,t)),di(t),r||t};n.update=function(n){var t=this.linkedElem;t&&pt({target:t[0]},undefined,n)};u?n.domChange=function(){var n=this.parentElem,i=t.hasData(n)&&t._data(n).events,r="jsv-domchange";i&&i[r]&&t(n).triggerHandler(r,arguments)}:(n.addViews=function(n,t){var u,i=this,r=t.length,f=i.views;!i._.useKey&&r&&(u=f.length+r,u===i.data.length&&io(i,n,i.tmpl,f,t,i.ctx)!==!1&&(i._.srt||i.fixIndex(n+r)))},n.removeViews=function(n,i,r,u){function s(n){var e,s,h,u,f,c,i=o[n];if(i&&i.link){if(e=i._.id,r||(c=i.nodes()),i.removeViews(undefined,undefined,!0),i.type=undefined,u=i._prv,f=i._nxt,h=i.parentElem,r||(i._elCnt&&yu(u,f,h,e,"_"),t(c).remove()),!i._elCnt)try{u.parentNode.removeChild(u);f.parentNode.removeChild(f)}catch(l){}su(i);for(s in i._.bnds)nr(s);delete ft[e]}}var e,l,c,f=this,h=!f._.useKey,o=f.views;if(h&&(c=o.length),n===undefined)if(h){for(e=c;e--;)s(e);f.views=[]}else{for(l in o)s(l);f.views={}}else if(i===undefined&&(h?i=1:(s(n),delete o[n])),h&&i&&(u||c-i===f.data.length)){for(e=n+i;e-->n;)s(e);o.splice(n,i);f._.sort||f.fixIndex(n)}},n.refresh=function(){var n=this,t=n.parent;t&&(io(n,n.index,n.tmpl,t.views,n.data,undefined,!0),su(n))},n.fixIndex=function(n){for(var i=this.views,t=i.length;n<t--;)i[t].index!==t&&r(i[t]).setProperty("index",t)},n.link=yh)}function dh(n,t,i){if(i.change==="set"){for(var u=n.tgt,f=u.length;f--;)if(u[f].key===i.path)break;f===-1?i.path&&!i.remove&&r(u).insert({key:i.path,prop:i.value}):i.remove?r(u).remove(f):r(u[f]).setProperty("prop",i.value)}}function gh(n,t,i){var u,f=n.src,e=i.change;e==="set"?i.path==="prop"?r(f).setProperty(t.target.key,i.value):(r(f).removeProperty(i.oldValue),r(f).setProperty(i.value,t.target.prop)):e==="remove"?(u=i.items[0],r(f).removeProperty(u.key),delete f[u.key]):e==="insert"&&(u=i.items[0],u.key&&r(f).setProperty(u.key,u.prop))}function nc(n){return n.indexOf(".")<0}var lo=t===!1;if(t=t||n.jQuery,!t||!t.fn)throw"JsViews requires jQuery";var pu="v0.9.81",tr,ii,h,o,w,r,tt,u,f,it,lt,ir,g,i,s,b,l,wt,et,a,bt,ri,wu,ao=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,vo=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*[.^]|\s*$|[^([])|[)\]])([([]?))|(\s+)/g,ai,rr=/[ \t]*(\r\n|\n|\r)/g,bu=/\\(['"])/g,ku=/['"\\]/g,yo=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$_\.]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,po=/^if\s/,ur=/<(\w+)[>\s]/,wo=/[\x00`><\"'&=]/,du=/^on[A-Z]|^convert(Back)?$/,bo=/^\#\d+_`[\s\S]*\/\d+_`$/,ko=/[\x00`><"'&=]/g,go=0,gu={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;","=":"&#61;"},v="html",rt="object",fr="data-jsv-tmpl",at="jsvTmpl",nf="For #index in nested block use #getIndex().",tf={},vi=n.jsrender,ns=vi&&t&&!t.render,er={template:{compile:of},tag:{compile:cs},viewModel:{compile:vs},helper:{},converter:{}};if(o={jsviews:pu,sub:{View:kt,Err:hr,tmplFn:lr,parse:wf,extend:e,extendCtx:vt,syntaxErr:c,onStore:{},addSetting:cf,settings:{allowCode:!1},advSet:sr,_ths:or,_tg:function(){},_cnvt:fs,_tag:ss,_er:ut,_err:vf,_html:yr,_cp:yi,_sq:function(n){return n==="constructor"&&c(""),n}},settings:{delimiters:pi,advanced:function(n){return n?(e(b,n),i.advSet(),l):b}},getCtx:yi,map:lf},(hr.prototype=new Error).constructor=hr,ff.depends=function(){return[this.get("item"),"index"]},ef.depends="index",kt.prototype={get:is,getIndex:ef,getRsc:os,getTmpl:us,hlp:rs,_is:"view"},i=o.sub,l=o.settings,!(vi||t&&t.render)){for(tr in er)ys(tr,er[tr]);lt=o.converters;ir=o.helpers;g=o.tags;i._tg.prototype={baseApply:ls,cvtArgs:es};h=i.topView=new kt;t?(t.fn.render=bf,tt=t.expando,t.observable&&(e(i,t.views.sub),o.map=t.views.map)):(t={},lo&&(n.jsrender=t),t.renderFile=t.__express=t.compile=function(){throw"Node.js: use npm jsrender, or jsrender-node.js";},t.isFunction=function(n){return typeof n=="function"},t.isArray=Array.isArray||function(n){return{}.toString.call(n)==="[object Array]"},i._jq=function(n){n!==t&&(e(n,t),t=n,t.fn.render=bf,delete t.jsrender,tt=t.expando)},t.jsrender=pu);s=i.settings;s.allowCode=!1;u=t.isFunction;t.render=tf;t.views=o;t.templates=it=o.templates;for(wu in s)cf(wu);(l.debugMode=function(n){return n===undefined?s.debugMode:(s.debugMode=n,s.onError=n+""===n?new Function("","return '"+n+"';"):u(n)?n:undefined,l)})(!1);b=s.advanced={useViews:!1,_jsv:!1};g({"if":{render:function(n){var t=this,i=t.tagCtx;return t.rendering.done||!n&&(arguments.length||!i.index)?"":(t.rendering.done=!0,t.selected=i.index,i.render(i.view,!0))},flow:!0},"for":{render:function(n){var u=!arguments.length,t,i=this,r=i.tagCtx,e="",o=0;return i.rendering.done||(t=u?r.view.data:n,t!==undefined&&(e+=r.render(t,u),o+=f(t)?t.length:1),(i.rendering.done=o)&&(i.selected=r.index)),e},flow:!0},props:{baseTag:"for",dataMap:lf(ws),flow:!0},include:{flow:!0},"*":{render:yi,flow:!0},":*":{render:yi,flow:!0},dbg:ir.dbg=lt.dbg=ts});lt({html:yr,attr:yr,url:function(n){return n!=undefined?encodeURI(""+n):n===null?n:""}})}if(s=i.settings,f=(t||vi).isArray,l.delimiters("{{","}}","^"),ns&&vi.views.sub._jq(t),o=t.views,i=o.sub,u=t.isFunction,f=t.isArray,tt=t.expando,!t.observe){var kf=t.event.special,df=[].slice,pr=[].splice,gf=[].concat,dt=parseInt,bs=/\S+/g,st=i.propChng=i.propChng||"propertyChange",ht=i.arrChng=i.arrChng||"arrayChange",ct={},ks=st+".observe",ds=1,gs=1,nh=1,wr=t.hasData,yt=t.data,ne={},br=function(n){return n._cId=n._cId||".obs"+gs++},kr=function(n,t){return this._data=t,this._ns=n,this},dr=function(n,t){return this._data=t,this._ns=n,this},th=function(n){return f(n)?[n]:n},te=function(n,t,i){n=n?f(n)?n:[n]:[];for(var r,o=t,s=o,c=n&&n.length,e=[],h=0;h<c;h++){if(r=n[h],u(r)){e=e.concat(te(r.call(t,t,i),t));continue}else if(""+r!==r){t=s=r;s!==o&&e.push(o=s);continue}s!==o&&e.push(o=s);e.push(r)}return e},ie=function(n,t){for(var i in n)return;delete ct[t]},re=function(n,t){function o(n){return typeof n===rt&&(e[0]||u&&f(n))}if(!(n.data&&n.data.off)){var a,v,y,s=t.oldValue,h=t.value,i=n.data,c=i.observeAll,r=i.cb,u=!r.noArray,e=i.paths,l=i.ns;n.type===ht?(r.array||r).call(i,n,t):(i.prop===t.path||i.prop==="*")&&(c?(a=c._path+"."+t.path,v=c.filter,y=[n.target].concat(c.parents()),o(s)&&ui(u,l,[s],e,r,!0,v,[y],a),o(h)&&ui(u,l,[h],e,r,undefined,v,[y],a)):(o(s)&&ui(u,l,[s],e,r,!0),o(h)&&ui(u,l,[h],e,r)),i.cb(n,t))}},ui=function(){var n=gf.apply([],arguments);return w.apply(n.shift(),n)},gr=function(n,t,i){fe(this._ns,this._data,n,t,[],"root",i)},ue=function(n,t){gr.call(this,n,t,!0)},fe=function(n,t,i,u,e,o,s,h){function k(n,t){for(c=n.length,v=o+"[]";c--;)b(n,c,t,1)}function b(t,f,e,o){var c,s;f!==tt&&(c=r._fltr(v,t[f],a,u))&&(s=a.slice(),o&&y&&s[0]!==y&&s.unshift(y),fe(n,c,i,u||(o?undefined:0),s,v,e,h))}function d(n,t){o=n.data.observeAll._path;y=n.target;switch(t.change){case"insert":k(t.items);break;case"remove":k(t.items,!0);break;case"set":v=o+"."+t.path;b(t,"oldValue",!0);b(t,"value")}y=undefined;i.apply(this,arguments)}var c,l,v,a,y,p,g=!h||h.un||!s;if(t&&typeof t===rt){if(a=[t].concat(e),l=f(t)?"":"*",h&&g&&wr(t)&&h[p=yt(t).obId]){h[p]++;return}if(h||(h={un:s}),i){if(l||u!==0)if(d._cId=br(i),g)w(n,t,l,d,s,u,a,o),p=yt(t).obId,h[p]=(h[p]||0)+1;else{if(--h[yt(t).obId])return;w(n,t,l,d,s,u,a,o)}}else h&&(h[yt(t).obId]=1),w(n,t,l,undefined,s,u,a,o);if(l)for(c in t)v=o+"."+c,b(t,c,s);else k(t,s)}},ee=function(n){return n.indexOf(".")<0&&n.indexOf("[")<0},ih=function(){return[].push.call(arguments,!0),w.apply(this,arguments)};w=function(){function i(){function ft(i,r,u,f){var o,e,k=wr(s),w=th(s),p=bt,b=it;if(i=n?i+"."+n:i,!l&&(f||u))for(a=k&&t._data(s),a=a&&a.events,a=a&&a[u?ht:st],ot=a&&a.length;ot--;)if(y=a[ot]&&a[ot].data,y&&(f&&y.ns!==n||!f&&y.ns===n&&y.cb&&y.cb._cId===c._cId))return;if(l||f)t(w).off(i,re);else{e=u?{}:{fullPath:h,paths:r?[r]:[],prop:v};e.ns=n;e.cb=c;it&&(e.observeAll={_path:b,path:function(){return o=p.length,b.replace(/[[.]/g,function(n){return o--,n==="["?"["+t.inArray(p[o-1],p[o]):"."})},parents:function(){return p},filter:kt});t(w).on(i,null,e,re);wt&&(wt[yt(s).obId||yt(s,"obId",ds++)]=s)}}function ui(n){var t=b;return n.ob=nt(n,t),n.cb=function(r,u){var s=n.ob,h=n.sb,e=nt(n,t);e!==s&&(typeof s===rt&&(at(s,!0),(h||o&&f(s))&&i([s],h,c,nt,!0)),n.ob=e,typeof e===rt&&(at(e),(h||o&&f(e))&&i([e],h,c,nt)));c(r,u)}}function at(n,t,i,u){if(o){var e=s,h=it;s=n;u&&(s=n[u],it+="."+u);kt&&s&&(s=r._fltr(it,s,u?[n].concat(bt):bt,kt));s&&(i||f(s))&&ft(ht+".observe"+(c?br(c):""),undefined,!0,t);s=e;it=h}}var ut,d,dt,g,v,h,ri,l,c,et,gt,ot,y,a,nt,ni,wt,vt,pt,bt,it,kt,ti,ii,lt=ks,p=this!=1?gf.apply([],arguments):df.call(arguments),w=p.pop()||!1,b=p.shift(),s=b,k=p.length;if(w+""===w&&(it=w,bt=p.pop(),kt=p.pop(),w=!!p.pop(),k-=3),w===!!w&&(l=w,w=p[k-1],w=k&&w+""!==w&&(!w||u(w))?(k--,p.pop()):undefined,l&&!k&&u(b)&&(w=b,b=undefined)),c=w,k&&u(p[k-1])&&(nt=c,c=p.pop(),k--),!l||!c||c._cId){for(lt+=c?(gt=c._inId||"",l)?c._cId+gt:(et=br(c))+gt:"",et&&!l&&(wt=ct[et]=ct[et]||{}),ti=n&&n.match(bs)||[""],ii=ti.length;ii--;){if(n=ti[ii],b&&(h=p[0],!h||h+""!==h)&&(f(b)?at(b,l,!0):l&&ft(lt,"")),l&&!k&&!b)for(d in ct){d=ct[d];for(y in d)s=d[y],f(s)?at(s,l,l):ft(lt,"")}for(vt=0,ut=0;ut<k;ut++)if(h=p[ut],h!==""){if(s=b,""+h===h){if(g=h.split("^"),g[1]&&(vt=g[0].split(".").length,h=g.join("."),vt=h.split(".").length-vt),nt&&(ni=nt(h,b,vt))){k+=ni.length-1;pr.apply(p,[ut--,1].concat(ni));continue}g=h.split(".")}else u(h)||(h&&h._jsv?(pt=l?h.cb:ui(h),pt.noArray=!o,pt._cId=c._cId,pt._inId=pt._inId||".obIn"+nh++,(h.bnd||h.prm&&h.prm.length||!h.sb)&&i([s],h.path,[e],h.prm,pt,nt,l),h.sb&&i([h.ob],h.sb,c,nt,l),h=e,s=undefined):s=h),g=[b=h];while(s&&(v=g.shift())!==undefined)if(typeof s===rt){if(""+v===v){if(v==="")continue;if(g.length<vt+1&&!s.nodeType){if(!l&&(a=wr(s)&&t._data(s))){for(a=a.events,a=a&&a[st],ot=a&&a.length,dt=0;ot--;)y=a[ot].data,y&&y.ns===n&&y.cb._cId===c._cId&&y.cb._inId===c._inId&&(y.prop===v||y.prop==="*"||y.prop==="**")&&((d=g.join("."))&&y.paths.push(d),dt++);if(dt){s=s[v];continue}}if(v==="*"||v==="**"){if(!l&&a&&a.length&&ft(lt,"",!1,!0),v==="*"){ft(lt,"");for(d in s)d!==tt&&at(s,l,undefined,d)}else t.observable(n,s)[(l?"un":"")+"observeAll"](c);break}else v&&ft(lt+".p_"+v,g.join("^"))}it&&(it+="."+v);v=s[v]}if(u(v)){(ri=v.depends)&&i([s],te(ri,s,c),c,nt,l);break}s=v;l&&s===b&&(ut>k-2||p[ut+1]+""!==p[ut+1])&&ft(lt,"")}at(s,l)}}return et&&ie(wt,et),{cbId:et,bnd:wt}}}var n,o=this!=!1,s=df.call(arguments),e=s[0];return e+""===e&&o&&(n=e,s.shift(),e=s[0]),i.apply(1,s)};r=function(n,t){return arguments.length===1&&(t=n,n=""),f(t)?new dr(n,t):new kr(n,t)};i.getDeps=function(){var n=arguments;return function(){for(var i,t,r=[],f=n.length;f--;)i=n[f--],t=n[f],t&&(r=r.concat(u(t)?t(i,i):t));return r}};t.observable=r;r._fltr=function(n,t,i,r){if(r&&u(r)?r(n,t,i):!0)return t=u(t)?t.set&&t.call(i[0]):t,typeof t===rt&&t};r.Object=kr;r.Array=dr;t.observe=r.observe=w;t.unobserve=r.unobserve=ih;r._apply=ui;kr.prototype={_data:null,observeAll:gr,unobserveAll:ue,data:function(){return this._data},setProperty:function(n,t,i){n=n||"";var r,s,o,h=n+""!==n,e=this,u=e._data;if(u)if(h)if(i=t,f(n))for(r=n.length;r--;)s=n[r],e.setProperty(s.name,s.value,i===undefined||i);else for(r in n)e.setProperty(r,n[r],i);else if(n!==tt){for(o=n.split(/[.^]/);u&&o.length>1;)u=u[o.shift()];u&&e._setProperty(u,o[0],t,i)}return e},removeProperty:function(n){return this.setProperty(n,ne),this},_setProperty:function(n,t,i,r){var o,e,s,f=t?n[t]:n;u(f)&&f.set&&(n=n._wrp||n,e=f,o=e.set===!0?e:e.set,f=e.call(n));(f!==i||r&&f!=i)&&(!(f instanceof Date)||f>i||f<i)&&(o?(o.call(n,i),i=e.call(n)):(s=i===ne)?f!==undefined?(delete n[t],i=undefined):t=undefined:t&&(n[t]=i),t&&this._trigger(n,{change:"set",path:t,value:i,oldValue:f,remove:s}))},_trigger:function(n,i){t(n).triggerHandler(st+(this._ns?"."+/^\S+/.exec(this._ns)[0]:""),i)}};dr.prototype={_data:null,observeAll:gr,unobserveAll:ue,data:function(){return this._data},insert:function(n,t){var i=this._data;return arguments.length===1&&(t=n,n=i.length),n=dt(n),n>-1&&(t=f(t)?t:[t],t.length&&this._insert(n,t)),this},_insert:function(n,t){var r=this._data,i=r.length;n>i&&(n=i);pr.apply(r,[n,0].concat(t));this._trigger({change:"insert",index:n,items:t},i)},remove:function(n,t){var i,r=this._data;return n===undefined&&(n=r.length-1),n=dt(n),t=t?dt(t):t===0?0:1,t>0&&n>-1&&(i=r.slice(n,n+t),(t=i.length)&&this._remove(n,t,i)),this},_remove:function(n,t,i){var r=this._data,u=r.length;r.splice(n,t);this._trigger({change:"remove",index:n,items:i},u)},move:function(n,t,i){return i=i?dt(i):i===0?0:1,n=dt(n),t=dt(t),i>0&&n>-1&&t>-1&&n!==t&&this._move(n,t,i),this},_move:function(n,t,i){var u,r=this._data,f=r.length,e=n+i-f;e>0&&(i-=e);i&&(u=r.splice(n,i),t>r.length&&(t=r.length),pr.apply(r,[t,0].concat(u)),this._trigger({change:"move",oldIndex:n,index:t,items:u},f))},refresh:function(n){function s(){r&&(u.insert(t-r,c),o+=r,i+=r,r=0,c=[])}var i,t,r,h,f,u=this,c=[],e=u._data,v=e.slice(),l=e.length,o=l,a=n.length;for(u._srt=!0,t=r=0;t<a;t++)if((h=n[t])===e[t-r])s();else{for(i=t-r;i<o;i++)if(h===e[i])break;if(i<o){for(s(),f=0;f++<a-i&&n[t+f]===e[i+f];);u.move(i,t,f);t+=f-1}else r++,c.push(h)}return s(),o>t&&u.remove(t,o-t),u._srt=undefined,u._trigger({change:"refresh",oldItems:v},l),u},_trigger:function(n,i){var r=this,u=r._data,f=u.length,e=t([u]);r._srt?n.refresh=!0:f!==i&&e.triggerHandler(st,{change:"set",path:"length",value:f,oldValue:i});e.triggerHandler(ht+(r._ns?"."+/^\S+/.exec(r._ns)[0]:""),n)}};kf[st]=kf[ht]={remove:function(n){var r,u,f,e,o,i=n.data;if(i&&(i.off=!0,i=i.cb)&&(r=ct[i._cId])){for(f=t._data(this).events[n.type],e=f.length;e--&&!u;)u=(o=f[e].data)&&o.cb&&o.cb._cId===i._cId;u||(delete r[yt(this).obId],ie(r,i._cId))}}};o.map=function(n){function i(t,i,u,f){var o,e=this;this.src&&this.unmap();typeof t===rt&&(e.src=t,e.tgt=u||e.tgt||[],e.options=i||e.options,e.update(),f||(n.obsSrc&&r(e.src).observeAll(e.obs=function(t,i){o||(o=!0,n.obsSrc(e,t,i),o=undefined)},e.srcFlt),n.obsTgt&&r(e.tgt).observeAll(e.obt=function(t,i){o||(o=!0,n.obsTgt(e,t,i),o=undefined)},e.tgtFlt)))}return u(n)&&(n={getTgt:n}),n.baseMap&&(n=t.extend({},n.baseMap,n)),n.map=function(n,t,r,u){return new i(n,t,r,u)},(i.prototype={srcFlt:n.srcFlt||ee,tgtFlt:n.tgtFlt||ee,update:function(t){var i=this;r(i.tgt).refresh(n.getTgt(i.src,i.options=t||i.options))},unmap:function(){var n=this;n.src&&(n.obs&&r(n.src).unobserveAll(n.obs,n.srcFlt),n.obt&&r(n.tgt).unobserveAll(n.obt,n.tgtFlt),n.src=undefined)},map:i,_def:n}).constructor=i,n};i.advSet=function(){n._jsv=s.advanced._jsv?{cbBindings:ct}:undefined}}if(l=o.settings,s=i.settings,b=s.advanced,lt=o.converters,t.templates=it=o.templates,g=o.tags,ur=/<(?!script)(\w+)[>\s]/,t.link)return t;s.trigger=!0;var gt,ni,fi,ot,oe,k,ft,se,y="data-jsv",he="change.jsv",nu="onBeforeChange",tu="onAfterChange",rh="onAfterCreate",ti="checked",wi="checkbox",ei="radio",oi="none",bi="SCRIPT",si="true",ce='"><\/script>',le='<script type="jsv',ae=y+"-df",iu="script,["+y+"]",ru={value:"val",input:"val",html:v,text:"text"},ve={from:"value",to:"value"},uu=0,uh=t.cleanData,ye=l.delimiters,pe=document.createDocumentFragment(),fu=document.querySelector,eu={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},fh={tr:"table"},ou={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},we={},d={},be=1,eh=/^#(view\.?)?/,oh=/((\/>)|<\/(\w+)>|)(\s*)([#\/]\d+(?:_|(\^)))`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>)|$)/g,ke=/(#)()(\d+)(_)/g,sh=/(#)()(\d+)([_^])/g,de=/(?:(#)|(\/))(\d+)(_)/g,hh=/(#)()(\d+)(\^)/g,ch=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,lh=/&(\d+)\+?/g,ge=n.getComputedStyle;if(r=t.observable,!r)throw requiresStr+"JsObservable";return w=r.observe,i.onStore.template=function(n,i){i.link=ro;n&&(t.link[n]=function(){return ro.apply(i,arguments)})},i.viewInfos=p,(l.delimiters=function(){var n=ye.apply(0,arguments);return ye!==pi&&(n=pi.apply(0,arguments)),ni=new RegExp("(?:^|\\s*)([\\w-]*)(\\"+ri+")?(\\"+et+i.rTag+"(:\\w*)?\\"+a+")","g"),n})(),i.addSetting("trigger"),lt.merge=function(n){var t,i=this.linkCtx._val||"",r=this.tagCtx.props.toggle;return r&&(t=r.replace(/[\\^$.|?*+()[{]/g,"\\$&"),t="(\\s(?="+t+"$)|(\\s)|^)("+t+"(\\s|$))",i=i.replace(new RegExp(t),"$2"),n=i+(n?(i&&" ")+r:"")),n},g("on",{attr:oi,noVal:!0,init:function(n){for(var e,f=this,r=0,o=n.args,s=o.length;r<s&&!u(o[r]);r++);f._hi=s>r&&r+1;f._.inline&&(i.rTmpl.exec(e=n.tmpl.markup)||(f.template="<button>"+(t.trim(e)||n.params.args[r]||"noop")+"<\/button>"),f.attr=v)},render:function(){var n=this.tagCtx;return this._.inline&&n.render(n.view,!0)},onAfterLink:function(n,r){var l,o,v,u=this,s=u._hi,f=n.args,h=f.length,y=n.props,p=y.data,c=n.view,e=y.context;if(s){l=f[s-1];o=f.slice(s);f=f.slice(0,s-1);u._sel=f[1];v=u.activeElem=u.activeElem||t(u._.inline?(u._sel=f[1]||"*",u.parentElem):r.elem);e||(e=/^(.*)[\.^][\w$]+$/.exec(n.params.args.slice(-o.length-1)[0]),e=e&&i.tmplFn(et+":"+e[1]+a,c.tmpl,!0)(r.data,c));u._evs&&u.onUnbind();v.on(u._evs=f[0]||"click",u._sel,p==undefined?null:p,u._hlr=function(n){var i,t=!u._.inline;if(!t)for(i=u.contents("*"),h=i.length;!t&&h--;)i[h].contains(n.target)&&(t=!0);if(t)return l.apply(e||r.data,[].concat(o,n,{change:n.type,view:c,linkCtx:r},o.slice.call(arguments,1)))})}},onUpdate:function(){return!1},onUnbind:function(){var n=this;n.activeElem&&n.activeElem.off(n._evs,n._sel,n._hlr)},flow:!0,dataBoundOnly:!0}),e(g["for"],{onArrayChange:function(n,t,i,r){var u,e=n.target,o=e.length,f=this,s=t.change;if(f._.noVws||f.tagCtxs[1]&&(s==="insert"&&o===t.items.length||s==="remove"&&!o))f.refresh();else for(u in f._.arrVws)u=f._.arrVws[u],u.data===e&&u._.onArrayChange.apply(u,arguments);f.domChange(i,r,t);n.done=!0},onAfterLink:function(n,t){for(var s,r,e,o=this,u=o._ars||{},h=o.tagCtxs,l=h.length,c=o.selected||0,i=0;i<=c;i++)n=h[i],e=n.map?n.map.tgt:n.args.length?n.args[0]:n.view.data,(r=u[i])&&e!==r[0]&&(w(r[0],r[1],!0),delete u[i]),!u[i]&&f(e)&&(w(e,s=function(i,r){var u=n;o.onArrayChange(i,r,u,t)}),u[i]=[e,s]);for(i=c+1;i<l;i++)(r=u[i])&&(w(r[0],r[1],!0),delete u[i]);o._ars=u},onDispose:function(){var n,t=this;for(n in t._ars)w(t._ars[n][0],t._ars[n][1],!0)}}),e(g["if"],{onUpdate:function(n,t,i){for(var r,f,u=0;r=this.tagCtxs[u];u++)if(f=r.props.tmpl!==i[u].props.tmpl||r.args.length&&!(r=r.args[0])!=!i[u].args[0],!this.convert&&!!r||f)return f;return!1},onAfterLink:function(n,t,i,r,u){u&&this.domChange(n,t,u)}}),g("props",{baseTag:"for",dataMap:o.map({getTgt:g.props.dataMap.getTgt,obsSrc:dh,obsTgt:gh,tgtFlt:nc}),flow:!0}),e(t,{view:fi=function(n,i,r){function a(n,t){if(n)for(f=p(n,t,ke),s=0,v=f.length;s<v;s++)if((u=ft[f[s].id])&&(u=u&&r?u.get(!0,r):u))break}i!==!!i&&(r=i,i=undefined);var u,f,o,s,v,e,c,l=0,y=document.body;if(n&&n!==y&&h._.useKey>1&&(n=""+n===n?t(n)[0]:n.jquery?n[0]:n,n)){if(i){if(a(n._df,!0),!u)for(c=fu?n.querySelectorAll(iu):t(iu,n).get(),e=c.length,o=0;!u&&o<e;o++)a(c[o]);return u}while(n){if(f=p(n,undefined,de))for(e=f.length;e--;)if(u=f[e],u.open){if(l<1)return u=ft[u.id],u&&r?u.get(r):u||h;l--}else l++;n=n.previousSibling||n.parentNode}}return h},link:lu,unlink:ho,cleanData:function(n){n.length&&uu&&gi(n);uh.apply(t,arguments)}}),e(t.fn,{link:function(n,t,i,r,u,f,e){return lu(n,this,t,i,r,u,f,e)},unlink:function(){return ho(this)},view:function(n,t){return fi(this[0],n,t)}}),t.each([v,"replaceWith","empty","remove"],function(n,i){var r=t.fn[i];t.fn[i]=function(){var n;uu=1;try{n=r.apply(this,arguments)}finally{uu=0}return n}}),li(e(h=i.topView,{tmpl:{links:{}}})),ft={0:h},o.getCtx=function(n){return n&&n._cp&&(n=n[1](n[0].data,n[0],i)),n},i._cp=function(n,t,r){if(r.linked){t=et+":"+t+a;var e=r.tmpl,f=h.tmpl.links,u=f[t];u||(f[t]=u=i.tmplFn(t,e,!0));n=[r,u];n._cp=!0}return n},i._ceo=function tc(n){var t,i=n,r=n.length;if(r)for(i=[];r--;)t=n[r],t._jsv&&(t=e({},t),t.prm=tc(t.prm)),i.unshift(t);return i},se=i.advSet,i.advSet=function(){se();n._jsv=b._jsv?e(n._jsv||{},{views:ft,bindings:d}):undefined;ot=b.linkAttr;oe=iu+",["+ot+"]";k=b._wm;k.optgroup=k.option;k.tbody=k.tfoot=k.colgroup=k.caption=k.thead;k.th=k.td},l.advanced({linkAttr:"data-link",useViews:!1,noValidate:!1,_wm:{option:[1,"<select multiple='multiple'>","<\/select>"],legend:[1,"<fieldset>","<\/fieldset>"],area:[1,"<map>","<\/map>"],param:[1,"<object>","<\/object>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table><tbody>","<\/tbody><\/table>"],td:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"],col:[2,"<table><tbody><\/tbody><colgroup>","<\/colgroup><\/table>"],svg_ns:[1,"<svg>","<\/svg>"],div:t.support.htmlSerialize?[0,"",""]:[1,"X<div>","<\/div>"]},_fe:{input:{from:kh,to:"value"},textarea:ve,select:ve,optgroup:{to:"label"}}}),t},window),function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery"],n):typeof module!="undefined"&&module.exports?module.exports=n(require("jquery")):n(jQuery)}(function(n,t){"use strict";
/*!
     * jsTree 3.3.3
     * http://jstree.com/
     *
     * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
     *
     * Licensed same as jquery - under the terms of the MIT License
     *   http://www.opensource.org/licenses/mit-license.php
     */
/*!
     * if using jslint please allow for the jQuery global and use following options:
     * jslint: loopfunc: true, browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
     */
var s,o,h,c,e,a;if(!n.jstree){var y=0,u=!1,r=!1,f=!1,v=[],l=n("script:last").attr("src"),i=window.document;if(n.jstree={version:"3.3.3",defaults:{plugins:[]},plugins:{},path:l&&l.indexOf("/")!==-1?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},n.jstree.create=function(t,i){var r=new n.jstree.core(++y),u=i;return i=n.extend(!0,{},n.jstree.defaults,i),u&&u.plugins&&(i.plugins=u.plugins),n.each(i.plugins,function(n,t){n!=="core"&&(r=r.plugin(t,i[t]))}),n(t).data("jstree",r),r.init(t,i),r},n.jstree.destroy=function(){n(".jstree:jstree").jstree("destroy");n(i).off(".jstree")},n.jstree.core=function(n){this._id=n;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},n.jstree.reference=function(t){var r=null,i=null;if(t&&t.id&&(!t.tagName||!t.nodeType)&&(t=t.id),!i||!i.length)try{i=n(t)}catch(u){}if(!i||!i.length)try{i=n("#"+t.replace(n.jstree.idregex,"\\$&"))}catch(u){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?r=i:n(".jstree").each(function(){var i=n(this).data("jstree");if(i&&i._model.data[t])return r=i,!1}),r},n.fn.jstree=function(i){var u=typeof i=="string",f=Array.prototype.slice.call(arguments,1),r=null;return i===!0&&!this.length?!1:(this.each(function(){var e=n.jstree.reference(this),o=u&&e?e[i]:null;return r=u&&o?o.apply(e,f):null,e||u||i!==t&&!n.isPlainObject(i)||n.jstree.create(this,i),(e&&!u||i===!0)&&(r=e||!1),r!==null&&r!==t?!1:void 0}),r!==null&&r!==t?r:this)},n.expr.pseudos.jstree=n.expr.createPseudo(function(){return function(i){return n(i).hasClass("jstree")&&n(i).data("jstree")!==t}}),n.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:n.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},n.jstree.core.prototype={plugin:function(t,i){var r=n.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this._model.data[n.jstree.root]={id:n.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}};this.element=n(t).addClass("jstree jstree-"+this._id);this.settings=i;this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl=this.element.css("direction")==="rtl";this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'><\/i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'><\/i>"+this.get_string("Loading ...")+"<\/a><\/li><\/ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||24;this._data.core.node=this._create_prototype_node();this.trigger("loading");this.load_node(n.jstree.root)},destroy:function(n){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk);this._wrk=null}catch(t){}n||this.element.empty();this.teardown()},_create_prototype_node:function(){var r=i.createElement("LI"),n,t;return r.setAttribute("role","treeitem"),n=i.createElement("I"),n.className="jstree-icon jstree-ocl",n.setAttribute("role","presentation"),r.appendChild(n),n=i.createElement("A"),n.className="jstree-anchor",n.setAttribute("href","#"),n.setAttribute("tabindex","-1"),t=i.createElement("I"),t.className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),n.appendChild(t),r.appendChild(n),n=t=null,r},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var t="",r=null,u=0;this.element.on("dblclick.jstree",function(n){if(n.target.tagName&&n.target.tagName.toLowerCase()==="input")return!0;if(i.selection&&i.selection.empty)i.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges();t.collapse()}catch(r){}}}).on("mousedown.jstree",n.proxy(function(n){n.target===this.element[0]&&(n.preventDefault(),u=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(n){n.preventDefault()}).on("click.jstree",".jstree-ocl",n.proxy(function(n){this.toggle_node(n.target)},this)).on("dblclick.jstree",".jstree-anchor",n.proxy(function(n){if(n.target.tagName&&n.target.tagName.toLowerCase()==="input")return!0;this.settings.core.dblclick_toggle&&this.toggle_node(n.target)},this)).on("click.jstree",".jstree-anchor",n.proxy(function(t){t.preventDefault();t.currentTarget!==i.activeElement&&n(t.currentTarget).focus();this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",n.proxy(function(t){if(t.target.tagName&&t.target.tagName.toLowerCase()==="input"||t.which!==32&&t.which!==13&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;this._data.core.rtl&&(t.which===37?t.which=39:t.which===39&&(t.which=37));switch(t.which){case 32:t.ctrlKey&&(t.type="click",n(t.currentTarget).trigger(t));break;case 13:t.type="click";n(t.currentTarget).trigger(t);break;case 37:t.preventDefault();this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget),i&&i.id!==n.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus());break;case 38:t.preventDefault();i=this.get_prev_dom(t.currentTarget);i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault();this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(n){this.get_node(n,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0],i&&n(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:t.preventDefault();i=this.get_next_dom(t.currentTarget);i&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault();i=this._firstChild(this.get_container_ul()[0]);i&&n(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault();this.edit(t.currentTarget)}},this)).on("load_node.jstree",n.proxy(function(t,i){i.status&&(i.node.id!==n.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(n.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var i=[],t=0,r=this._data.core.selected.length;t<r;t++)i=i.concat(this._model.data[this._data.core.selected[t]].parents);for(i=n.vakata.array_unique(i),t=0,r=i.length;t<r;t++)this.open_node(i[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",n.proxy(function(u){if(u.target.tagName&&u.target.tagName.toLowerCase()==="input")return!0;r&&clearTimeout(r);r=setTimeout(function(){t=""},500);var o=String.fromCharCode(u.which).toLowerCase(),e=this.element.find(".jstree-anchor").filter(":visible"),s=e.index(i.activeElement)||0,f=!1;if(t+=o,t.length>1){if(e.slice(s).each(n.proxy(function(i,r){if(n(r).text().toLowerCase().indexOf(t)===0)return n(r).focus(),f=!0,!1},this)),f)return;if(e.slice(0,s).each(n.proxy(function(i,r){if(n(r).text().toLowerCase().indexOf(t)===0)return n(r).focus(),f=!0,!1},this)),f)return}if(new RegExp("^"+o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(e.slice(s+1).each(n.proxy(function(t,i){if(n(i).text().toLowerCase().charAt(0)===o)return n(i).focus(),f=!0,!1},this)),f)return;if(e.slice(0,s+1).each(n.proxy(function(t,i){if(n(i).text().toLowerCase().charAt(0)===o)return n(i).focus(),f=!0,!1},this)),f)return}},this)).on("init.jstree",n.proxy(function(){var n=this.settings.core.themes;this._data.core.themes.dots=n.dots;this._data.core.themes.stripes=n.stripes;this._data.core.themes.icons=n.icons;this._data.core.themes.ellipsis=n.ellipsis;this.set_theme(n.name||"default",n.url);this.set_theme_variant(n.variant)},this)).on("loading.jstree",n.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]();this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()},this)).on("blur.jstree",".jstree-anchor",n.proxy(function(t){this._data.core.focused=null;n(t.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",n.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id);this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave();n(t.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",n.proxy(function(){if(+new Date-u>500&&!this._data.core.focused){u=0;var n=this.get_node(this.element.attr("aria-activedescendant"),!0);n&&n.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",n.proxy(function(n){this.hover_node(n.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",n.proxy(function(n){this.dehover_node(n.currentTarget)},this))},unbind:function(){this.element.off(".jstree");n(i).off(".jstree-"+this._id)},trigger:function(n,t){t||(t={});t.instance=this;this.element.triggerHandler(n.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return n.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(n){for(n=n?n.firstChild:null;n!==null&&n.nodeType!==1;)n=n.nextSibling;return n},_nextSibling:function(n){for(n=n?n.nextSibling:null;n!==null&&n.nodeType!==1;)n=n.nextSibling;return n},_previousSibling:function(n){for(n=n?n.previousSibling:null;n!==null&&n.nodeType!==1;)n=n.previousSibling;return n},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if(typeof t=="string"&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if(typeof t=="string"&&(r=n("#"+t.replace(n.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=n(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=n(t,this.element)).length&&r.hasClass("jstree"))t=this._model.data[n.jstree.root];else return!1;return i&&(t=t.id===n.jstree.root?this.element:n("#"+t.id.replace(n.jstree.idregex,"\\$&"),this.element)),t}catch(u){return!1}},get_path:function(t,i,r){if(t=t.parents?t:this.get_node(t),!t||t.id===n.jstree.root||!t.parents)return!1;var f,e,u=[];for(u.push(r?t.id:t.text),f=0,e=t.parents.length;f<e;f++)u.push(r?t.parents[f]:this.get_text(t.parents[f]));return u=u.reverse().slice(1),i?u.join(i):u},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&r.offsetHeight===0;)r=this._nextSibling(r);return r?n(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._nextSibling(r);while(r&&r.offsetHeight===0);return r?n(r):!1}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&r.offsetHeight===0;)r=this._nextSibling(r);if(r!==null)return n(r)}r=t[0];do r=this._nextSibling(r);while(r&&r.offsetHeight===0);return r!==null?n(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&r.offsetHeight===0;)r=this._previousSibling(r);return r?n(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._previousSibling(r);while(r&&r.offsetHeight===0);return r?n(r):!1}r=t[0];do r=this._previousSibling(r);while(r&&r.offsetHeight===0);if(r!==null){for(t=n(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&r.className.indexOf("jstree-node")!==-1?n(r):!1},get_parent:function(t){return(t=this.get_node(t),!t||t.id===n.jstree.root)?!1:t.parent},get_children_dom:function(n){return(n=this.get_node(n,!0),n[0]===this.element[0])?this.get_container_ul().children(".jstree-node"):!n||!n.length?!1:n.children(".jstree-children").children(".jstree-node")},is_parent:function(n){return n=this.get_node(n),n&&(n.state.loaded===!1||n.children.length>0)},is_loaded:function(n){return n=this.get_node(n),n&&n.state.loaded},is_loading:function(n){return n=this.get_node(n),n&&n.state&&n.state.loading},is_open:function(n){return n=this.get_node(n),n&&n.state.opened},is_closed:function(n){return n=this.get_node(n),n&&this.is_parent(n)&&!n.state.opened},is_leaf:function(n){return!this.is_parent(n)},load_node:function(t,i){var r,e,u,o,f;if(n.isArray(t))return this._load_nodes(t.slice(),i),!0;if(t=this.get_node(t),!t)return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,u=0,o=t.parents.length;u<o;u++)this._model.data[t.parents[u]].children_d=n.vakata.array_filter(this._model.data[t.parents[u]].children_d,function(i){return n.inArray(i,t.children_d)===-1});for(r=0,e=t.children_d.length;r<e;r++)this._model.data[t.children_d[r]].state.selected&&(f=!0),delete this._model.data[t.children_d[r]];f&&(this._data.core.selected=n.vakata.array_filter(this._data.core.selected,function(i){return n.inArray(i,t.children_d)===-1}));t.children=[];t.children_d=[];f&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,n.proxy(function(n){t=this._model.data[t.id];t.state.loading=!1;t.state.loaded=n;t.state.failed=!t.state.loaded;for(var r=this.get_node(t,!0),u=0,f=0,e=this._model.data,o=!1,u=0,f=t.children.length;u<f;u++)if(e[t.children[u]]&&!e[t.children[u]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?t.id!=="#"&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf"));r.removeClass("jstree-loading").attr("aria-busy",!1);this.trigger("load_node",{node:t,status:n});i&&i.call(this,t,n)},this)),!0},_load_nodes:function(n,t,i,r){for(var o=!0,h=function(){this._load_nodes(n,t,!0)},f=this._model.data,s=[],u=0,e=n.length;u<e;u++)!f[n[u]]||(f[n[u]].state.loaded||f[n[u]].state.failed)&&(i||!r)||(this.is_loading(n[u])||this.load_node(n[u],h),o=!1);if(o){for(u=0,e=n.length;u<e;u++)f[n[u]]&&f[n[u]].state.loaded&&s.push(n[u]);t&&!t.done&&(t.call(this,s),t.done=!0)}},load_all:function(t,i){if(t||(t=n.jstree.root),t=this.get_node(t),!t)return!1;var f=[],e=this._model.data,u=e[t.id].children_d,r,o;for(t.state&&!t.state.loaded&&f.push(t.id),r=0,o=u.length;r<o;r++)e[u[r]]&&e[u[r]].state&&!e[u[r]].state.loaded&&f.push(u[r]);f.length?this._load_nodes(f,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r=this.settings.core.data,f,u=function(){return this.nodeType!==3&&this.nodeType!==8};return r?n.isFunction(r)?r.call(this,t,n.proxy(function(r){r===!1?i.call(this,!1):this[typeof r=="string"?"_append_html_data":"_append_json_data"](t,typeof r=="string"?n(n.parseHTML(r)).filter(u):r,function(n){i.call(this,n)})},this)):typeof r=="object"?r.url?(r=n.extend(!0,{},r),n.isFunction(r.url)&&(r.url=r.url.call(this,t)),n.isFunction(r.data)&&(r.data=r.data.call(this,t)),n.ajax(r).done(n.proxy(function(r,f,e){var o=e.getResponseHeader("Content-Type");return o&&o.indexOf("json")!==-1||typeof r=="object"?this._append_json_data(t,r,function(n){i.call(this,n)}):o&&o.indexOf("html")!==-1||typeof r=="string"?this._append_html_data(t,n(n.parseHTML(r)).filter(u),function(n){i.call(this,n)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(n.proxy(function(n){i.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})};this.settings.core.error.call(this,this._data.core.last_error)},this))):(f=n.isArray(r)||n.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,t.id===n.jstree.root?this._append_json_data(t,f,function(n){i.call(this,n)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):typeof r=="string"?t.id===n.jstree.root?this._append_html_data(t,n(n.parseHTML(r)).filter(u),function(n){i.call(this,n)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===n.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(n){i.call(this,n)}):i.call(this,!1)},_node_changed:function(n){n=this.get_node(n);n&&this._model.changed.push(n.id)},_append_html_data:function(t,i,r){t=this.get_node(t);t.children=[];t.children_d=[];var a=i.is("ul")?i.children():i,o=t.id,c=[],u=[],s=this._model.data,f=s[o],v=this._data.core.selected.length,e,h,l;for(a.each(n.proxy(function(t,i){e=this._parse_model_from_html(n(i),o,f.parents.concat());e&&(c.push(e),u.push(e),s[e].children_d.length&&(u=u.concat(s[e].children_d)))},this)),f.children=c,f.children_d=u,h=0,l=f.parents.length;h<l;h++)s[f.parents[h]].children_d=s[f.parents[h]].children_d.concat(u);this.trigger("model",{nodes:u,parent:o});o!==n.jstree.root?(this._node_changed(o),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==v&&this.trigger("changed",{action:"model",selected:this._data.core.selected});r.call(this,!0)},_append_json_data:function(t,i,r,u){if(this.element!==null){t=this.get_node(t);t.children=[];t.children_d=[];i.d&&(i=i.d,typeof i=="string"&&(i=JSON.parse(i)));n.isArray(i)||(i=[i]);var f=null,e={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(n,t){n.data&&(n=n.data);var u=n.dat,c=n.par,y=[],o=[],l=[],h=n.df,k=n.t_id,v=n.t_cnt,r=n.m,f=r[c],p=n.sel,s,i,e,a,w=function(n,i,u){u=u?u.concat():[];i&&u.unshift(i);var c=n.id.toString(),e,a,o,s,f={id:c,text:n.text||"",icon:n.icon!==t?n.icon:!0,parent:i,parents:u,children:n.children||[],children_d:n.children_d||[],data:n.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in h)h.hasOwnProperty(e)&&(f.state[e]=h[e]);if(n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(f.icon=n.data.jstree.icon),(f.icon===t||f.icon===null||f.icon==="")&&(f.icon=!0),n&&n.data&&(f.data=n.data,n.data.jstree))for(e in n.data.jstree)n.data.jstree.hasOwnProperty(e)&&(f.state[e]=n.data.jstree[e]);if(n&&typeof n.state=="object")for(e in n.state)n.state.hasOwnProperty(e)&&(f.state[e]=n.state[e]);if(n&&typeof n.li_attr=="object")for(e in n.li_attr)n.li_attr.hasOwnProperty(e)&&(f.li_attr[e]=n.li_attr[e]);if(f.li_attr.id||(f.li_attr.id=c),n&&typeof n.a_attr=="object")for(e in n.a_attr)n.a_attr.hasOwnProperty(e)&&(f.a_attr[e]=n.a_attr[e]);for(n&&n.children&&n.children===!0&&(f.state.loaded=!1,f.children=[],f.children_d=[]),r[f.id]=f,e=0,a=f.children.length;e<a;e++)o=w(r[f.children[e]],f.id,u),s=r[o],f.children_d.push(o),s.children_d.length&&(f.children_d=f.children_d.concat(s.children_d));return delete n.data,delete n.children,r[f.id].original=n,f.state.selected&&l.push(f.id),f.id},b=function(n,i,u){u=u?u.concat():[];i&&u.unshift(i);var o=!1,e,a,s,c,f;do o="j"+k+"_"+ ++v;while(r[o]);f={id:!1,text:typeof n=="string"?n:"",icon:typeof n=="object"&&n.icon!==t?n.icon:!0,parent:i,parents:u,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in h)h.hasOwnProperty(e)&&(f.state[e]=h[e]);if(n&&n.id&&(f.id=n.id.toString()),n&&n.text&&(f.text=n.text),n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(f.icon=n.data.jstree.icon),(f.icon===t||f.icon===null||f.icon==="")&&(f.icon=!0),n&&n.data&&(f.data=n.data,n.data.jstree))for(e in n.data.jstree)n.data.jstree.hasOwnProperty(e)&&(f.state[e]=n.data.jstree[e]);if(n&&typeof n.state=="object")for(e in n.state)n.state.hasOwnProperty(e)&&(f.state[e]=n.state[e]);if(n&&typeof n.li_attr=="object")for(e in n.li_attr)n.li_attr.hasOwnProperty(e)&&(f.li_attr[e]=n.li_attr[e]);if(f.li_attr.id&&!f.id&&(f.id=f.li_attr.id.toString()),f.id||(f.id=o),f.li_attr.id||(f.li_attr.id=f.id),n&&typeof n.a_attr=="object")for(e in n.a_attr)n.a_attr.hasOwnProperty(e)&&(f.a_attr[e]=n.a_attr[e]);if(n&&n.children&&n.children.length){for(e=0,a=n.children.length;e<a;e++)s=b(n.children[e],f.id,u),c=r[s],f.children.push(s),c.children_d.length&&(f.children_d=f.children_d.concat(c.children_d));f.children_d=f.children_d.concat(f.children)}return n&&n.children&&n.children===!0&&(f.state.loaded=!1,f.children=[],f.children_d=[]),delete n.data,delete n.children,f.original=n,r[f.id]=f,f.state.selected&&l.push(f.id),f.id};if(u.length&&u[0].id!==t&&u[0].parent!==t){for(i=0,e=u.length;i<e;i++)u[i].children||(u[i].children=[]),r[u[i].id.toString()]=u[i];for(i=0,e=u.length;i<e;i++)r[u[i].parent.toString()].children.push(u[i].id.toString()),f.children_d.push(u[i].id.toString());for(i=0,e=f.children.length;i<e;i++)s=w(r[f.children[i]],c,f.parents.concat()),o.push(s),r[s].children_d.length&&(o=o.concat(r[s].children_d));for(i=0,e=f.parents.length;i<e;i++)r[f.parents[i]].children_d=r[f.parents[i]].children_d.concat(o);a={cnt:v,mod:r,sel:p,par:c,dpc:o,add:l}}else{for(i=0,e=u.length;i<e;i++)s=b(u[i],c,f.parents.concat()),s&&(y.push(s),o.push(s),r[s].children_d.length&&(o=o.concat(r[s].children_d)));for(f.children=y,f.children_d=o,i=0,e=f.parents.length;i<e;i++)r[f.parents[i]].children_d=r[f.parents[i]].children_d.concat(o);a={cnt:v,mod:r,sel:p,par:c,dpc:o,add:l}}if(typeof window=="undefined"||typeof window.document=="undefined")postMessage(a);else return a},s=function(t,i){var u,f;if(this.element!==null){this._cnt=t.cnt;f=this._model.data;for(u in f)f.hasOwnProperty(u)&&f[u].state&&f[u].state.loading&&t.mod[u]&&(t.mod[u].state.loading=!0);if(this._model.data=t.mod,i){var s,h=t.add,e=t.sel,o=this._data.core.selected.slice();if(f=this._model.data,e.length!==o.length||n.vakata.array_unique(e.concat(o)).length!==e.length){for(u=0,s=e.length;u<s;u++)n.inArray(e[u],h)===-1&&n.inArray(e[u],o)===-1&&(f[e[u]].state.selected=!1);for(u=0,s=o.length;u<s;u++)n.inArray(o[u],e)===-1&&(f[o[u]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add));this.trigger("model",{nodes:t.dpc,parent:t.par});t.par!==n.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0);t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{this._wrk===null&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"})));!this._data.core.working||u?(this._data.core.working=!0,f=new window.Worker(this._wrk),f.onmessage=n.proxy(function(n){s.call(this,n.data,!0);try{f.terminate();f=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),e.par?f.postMessage(e):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(h){s.call(this,o(e),!1);this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else s.call(this,o(e),!1)}},_parse_model_from_html:function(i,r,u){u=u?[].concat(u):[];r&&u.unshift(r);var s,h,l=this._model.data,f={id:!1,text:!1,icon:!0,parent:r,parents:u,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},o,e,c;for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(f.state[o]=this._model.default_state[o]);if(e=n.vakata.attributes(i,!0),n.each(e,function(t,i){if(i=n.trim(i),!i.length)return!0;f.li_attr[t]=i;t==="id"&&(f.id=i.toString())}),e=i.children("a").first(),e.length&&(e=n.vakata.attributes(e,!0),n.each(e,function(t,i){i=n.trim(i);i.length&&(f.a_attr[t]=i)})),e=i.children("a").first().length?i.children("a").first().clone():i.clone(),e.children("ins, i, ul").remove(),e=e.html(),e=n("<div />").html(e),f.text=this.settings.core.force_text?e.text():e.html(),e=i.data(),f.data=e?n.extend(!0,{},e):null,f.state.opened=i.hasClass("jstree-open"),f.state.selected=i.children("a").hasClass("jstree-clicked"),f.state.disabled=i.children("a").hasClass("jstree-disabled"),f.data&&f.data.jstree)for(o in f.data.jstree)f.data.jstree.hasOwnProperty(o)&&(f.state[o]=f.data.jstree[o]);e=i.children("a").children(".jstree-themeicon");e.length&&(f.icon=e.hasClass("jstree-themeicon-hidden")?!1:e.attr("rel"));f.state.icon!==t&&(f.icon=f.state.icon);(f.icon===t||f.icon===null||f.icon==="")&&(f.icon=!0);e=i.children("ul").children("li");do c="j"+this._id+"_"+ ++this._cnt;while(l[c]);return f.id=f.li_attr.id?f.li_attr.id.toString():c,e.length?(e.each(n.proxy(function(t,i){s=this._parse_model_from_html(n(i),f.id,u);h=this._model.data[s];f.children.push(s);h.children_d.length&&(f.children_d=f.children_d.concat(h.children_d))},this)),f.children_d=f.children_d.concat(f.children)):i.hasClass("jstree-closed")&&(f.state.loaded=!1),f.li_attr["class"]&&(f.li_attr["class"]=f.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),f.a_attr["class"]&&(f.a_attr["class"]=f.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),l[f.id]=f,f.state.selected&&this._data.core.selected.push(f.id),f.id},_parse_model_from_flat_json:function(n,i,r){r=r?r.concat():[];i&&r.unshift(i);var c=n.id.toString(),e=this._model.data,o=this._model.default_state,f,l,s,h,u={id:c,text:n.text||"",icon:n.icon!==t?n.icon:!0,parent:i,parents:r,children:n.children||[],children_d:n.children_d||[],data:n.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in o)o.hasOwnProperty(f)&&(u.state[f]=o[f]);if(n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(u.icon=n.data.jstree.icon),(u.icon===t||u.icon===null||u.icon==="")&&(u.icon=!0),n&&n.data&&(u.data=n.data,n.data.jstree))for(f in n.data.jstree)n.data.jstree.hasOwnProperty(f)&&(u.state[f]=n.data.jstree[f]);if(n&&typeof n.state=="object")for(f in n.state)n.state.hasOwnProperty(f)&&(u.state[f]=n.state[f]);if(n&&typeof n.li_attr=="object")for(f in n.li_attr)n.li_attr.hasOwnProperty(f)&&(u.li_attr[f]=n.li_attr[f]);if(u.li_attr.id||(u.li_attr.id=c),n&&typeof n.a_attr=="object")for(f in n.a_attr)n.a_attr.hasOwnProperty(f)&&(u.a_attr[f]=n.a_attr[f]);for(n&&n.children&&n.children===!0&&(u.state.loaded=!1,u.children=[],u.children_d=[]),e[u.id]=u,f=0,l=u.children.length;f<l;f++)s=this._parse_model_from_flat_json(e[u.children[f]],u.id,r),h=e[s],u.children_d.push(s),h.children_d.length&&(u.children_d=u.children_d.concat(h.children_d));return delete n.data,delete n.children,e[u.id].original=n,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_json:function(n,i,r){r=r?r.concat():[];i&&r.unshift(i);var e=!1,f,l,o,s,h=this._model.data,c=this._model.default_state,u;do e="j"+this._id+"_"+ ++this._cnt;while(h[e]);u={id:!1,text:typeof n=="string"?n:"",icon:typeof n=="object"&&n.icon!==t?n.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in c)c.hasOwnProperty(f)&&(u.state[f]=c[f]);if(n&&n.id&&(u.id=n.id.toString()),n&&n.text&&(u.text=n.text),n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(u.icon=n.data.jstree.icon),(u.icon===t||u.icon===null||u.icon==="")&&(u.icon=!0),n&&n.data&&(u.data=n.data,n.data.jstree))for(f in n.data.jstree)n.data.jstree.hasOwnProperty(f)&&(u.state[f]=n.data.jstree[f]);if(n&&typeof n.state=="object")for(f in n.state)n.state.hasOwnProperty(f)&&(u.state[f]=n.state[f]);if(n&&typeof n.li_attr=="object")for(f in n.li_attr)n.li_attr.hasOwnProperty(f)&&(u.li_attr[f]=n.li_attr[f]);if(u.li_attr.id&&!u.id&&(u.id=u.li_attr.id.toString()),u.id||(u.id=e),u.li_attr.id||(u.li_attr.id=u.id),n&&typeof n.a_attr=="object")for(f in n.a_attr)n.a_attr.hasOwnProperty(f)&&(u.a_attr[f]=n.a_attr[f]);if(n&&n.children&&n.children.length){for(f=0,l=n.children.length;f<l;f++)o=this._parse_model_from_json(n.children[f],u.id,r),s=h[o],u.children.push(o),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d));u.children_d=u.children_d.concat(u.children)}return n&&n.children&&n.children===!0&&(u.state.loaded=!1,u.children=[],u.children_d=[]),delete n.data,delete n.children,u.original=n,h[u.id]=u,u.state.selected&&this._data.core.selected.push(u.id),u.id},_redraw:function(){for(var f=this._model.force_full_redraw?this._model.data[n.jstree.root].children.concat([]):this._model.changed.concat([]),r=i.createElement("UL"),t,o=this._data.core.focused,u=0,e=f.length;u<e;u++)t=this.redraw_node(f[u],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&r.appendChild(t);this._model.force_full_redraw&&(r.className=this.get_container_ul()[0].className,r.setAttribute("role","group"),this.element.empty().append(r));o!==null&&(t=this.get_node(o,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==i.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:f})},redraw:function(n){n&&(this._model.force_full_redraw=!0);this._redraw()},draw_children:function(t){var r=this.get_node(t),f=!1,e=!1,u=!1,o=i;if(!r)return!1;if(r.id===n.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],r.children.length&&r.state.loaded){for(u=o.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",f=0,e=r.children.length;f<e;f++)u.appendChild(this.redraw_node(r.children[f],!0,!0));t.appendChild(u)}},redraw_node:function(t,r,u,f){var e=this.get_node(t),s=!1,y=!1,w=!1,o=!1,h=!1,v=!1,c="",b=i,l=this._model.data,k=!1,a=null,d=0,g=0,nt=!1,p=!1;if(!e)return!1;if(e.id===n.jstree.root)return this.redraw(!0);if(r=r||e.children.length===0,t=i.querySelector?this.element[0].querySelector("#"+("0123456789".indexOf(e.id[0])!==-1?"\\3"+e.id[0]+" "+e.id.substr(1).replace(n.jstree.idregex,"\\$&"):e.id.replace(n.jstree.idregex,"\\$&"))):i.getElementById(e.id),t)t=n(t),u||(s=t.parent().parent()[0],s===this.element[0]&&(s=null),y=t.index()),r||!e.children.length||t.children(".jstree-children").length||(r=!0),r||(w=t.children(".jstree-children")[0]),k=t.children(".jstree-anchor")[0]===i.activeElement,t.remove();else if(r=!0,!u){if(s=e.parent!==n.jstree.root?n("#"+e.parent.replace(n.jstree.idregex,"\\$&"),this.element)[0]:null,s!==null&&(!s||!l[e.parent].state.opened))return!1;y=n.inArray(e.id,s===null?l[n.jstree.root].children:l[e.parent].children)}t=this._data.core.node.cloneNode(!0);c="jstree-node ";for(o in e.li_attr)if(e.li_attr.hasOwnProperty(o)){if(o==="id")continue;o!=="class"?t.setAttribute(o,e.li_attr[o]):c+=e.li_attr[o]}for(e.a_attr.id||(e.a_attr.id=e.id+"_anchor"),t.setAttribute("aria-selected",!!e.state.selected),t.setAttribute("aria-level",e.parents.length),t.setAttribute("aria-labelledby",e.a_attr.id),e.state.disabled&&t.setAttribute("aria-disabled",!0),o=0,h=e.children.length;o<h;o++)if(!l[e.children[o]].state.hidden){nt=!0;break}if(e.parent!==null&&l[e.parent]&&!e.state.hidden&&(o=n.inArray(e.id,l[e.parent].children),p=e.id,o!==-1))for(o++,h=l[e.parent].children.length;o<h;o++)if(l[l[e.parent].children[o]].state.hidden||(p=l[e.parent].children[o]),p!==e.id)break;e.state.hidden&&(c+=" jstree-hidden");e.state.loaded&&!nt?c+=" jstree-leaf":(c+=e.state.opened&&e.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",e.state.opened&&e.state.loaded));p===e.id&&(c+=" jstree-last");t.id=e.id;t.className=c;c=(e.state.selected?" jstree-clicked":"")+(e.state.disabled?" jstree-disabled":"");for(h in e.a_attr)if(e.a_attr.hasOwnProperty(h)){if(h==="href"&&e.a_attr[h]==="#")continue;h!=="class"?t.childNodes[1].setAttribute(h,e.a_attr[h]):c+=" "+e.a_attr[h]}if(c.length&&(t.childNodes[1].className="jstree-anchor "+c),(e.icon&&e.icon!==!0||e.icon===!1)&&(e.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":e.icon.indexOf("/")===-1&&e.icon.indexOf(".")===-1?t.childNodes[1].childNodes[0].className+=" "+e.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+e.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(b.createTextNode(e.text)):t.childNodes[1].innerHTML+=e.text,r&&e.children.length&&(e.state.opened||f)&&e.state.loaded){for(v=b.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",o=0,h=e.children.length;o<h;o++)v.appendChild(this.redraw_node(e.children[o],r,!0));t.appendChild(v)}if(w&&t.appendChild(w),!u){for(s||(s=this.element[0]),o=0,h=s.childNodes.length;o<h;o++)if(s.childNodes[o]&&s.childNodes[o].className&&s.childNodes[o].className.indexOf("jstree-children")!==-1){a=s.childNodes[o];break}a||(a=b.createElement("UL"),a.setAttribute("role","group"),a.className="jstree-children",s.appendChild(a));s=a;y<s.childNodes.length?s.insertBefore(t,s.childNodes[y]):s.appendChild(t);k&&(d=this.element[0].scrollTop,g=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=d,this.element[0].scrollLeft=g)}return e.state.opened&&!e.state.loaded&&(e.state.opened=!1,setTimeout(n.proxy(function(){this.open_node(e.id,!1,0)},this),0)),t},open_node:function(i,r,u){var e,s,f,o;if(n.isArray(i)){for(i=i.slice(),e=0,s=i.length;e<s;e++)this.open_node(i[e],r,u);return!0}if(i=this.get_node(i),!i||i.id===n.jstree.root)return!1;if(u=u===t?this.settings.core.animation:u,!this.is_closed(i))return r&&r.call(this,i,!1),!1;if(this.is_loaded(i))return f=this.get_node(i,!0),o=this,f.length&&(u&&f.children(".jstree-children").length&&f.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(f.children(".jstree-children")[0])&&this.draw_children(i),u?(this.trigger("before_open",{node:i}),f.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(u,function(){this.style.display="";o.element&&o.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),f[0].className=f[0].className.replace("jstree-closed","jstree-open"),f[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),f.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),u&&f.length||this.trigger("after_open",{node:i}),!0;if(this.is_loading(i))return setTimeout(n.proxy(function(){this.open_node(i,r,u)},this),500);this.load_node(i,function(n,t){return t?this.open_node(n,r,u):r?r.call(this,n,!1):!1})},_open_to:function(t){if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;for(var u=t.parents,i=0,r=u.length;i<r;i+=1)i!==n.jstree.root&&this.open_node(u[i],!1,0);return n("#"+t.id.replace(n.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var f,o,e,u;if(n.isArray(i)){for(i=i.slice(),f=0,o=i.length;f<o;f++)this.close_node(i[f],r);return!0}if((i=this.get_node(i),!i||i.id===n.jstree.root)||this.is_closed(i))return!1;r=r===t?this.settings.core.animation:r;e=this;u=this.get_node(i,!0);i.state.opened=!1;this.trigger("close_node",{node:i});u.length?r?u.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="";u.children(".jstree-children").remove();e.element&&e.trigger("after_close",{node:i})}):(u[0].className=u[0].className.replace("jstree-open","jstree-closed"),u.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i})},toggle_node:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=n.jstree.root),t=this.get_node(t),!t)return!1;var u=t.id===n.jstree.root?this.get_container_ul():this.get_node(t,!0),f,e,o;if(!u.length){for(f=0,e=t.children_d.length;f<e;f++)this.is_closed(this._model.data[t.children_d[f]])&&(this._model.data[t.children_d[f]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||u;o=this;u=this.is_closed(t)?u.find(".jstree-closed").addBack():u.find(".jstree-closed");u.each(function(){o.open_node(this,function(n,t){t&&this.is_parent(n)&&this.open_all(n,i,r)},i||0)});r.find(".jstree-closed").length===0&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=n.jstree.root),t=this.get_node(t),!t)return!1;var r=t.id===n.jstree.root?this.get_container_ul():this.get_node(t,!0),e=this,u,f;for(r.length&&(r=this.is_open(t)?r.find(".jstree-open").addBack():r.find(".jstree-open"),n(r.get().reverse()).each(function(){e.close_node(this,i||0)})),u=0,f=t.children_d.length;u<f;u++)this._model.data[t.children_d[u]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(n){return n=this.get_node(n),n&&n.state&&n.state.disabled},enable_node:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.enable_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;t.state.disabled=!1;this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:t})},disable_node:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.disable_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;t.state.disabled=!0;this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0);this.trigger("disable_node",{node:t})},is_hidden:function(n){return n=this.get_node(n),n.state.hidden===!0},hide_node:function(t,i){var r,u;if(n.isArray(t)){for(t=t.slice(),r=0,u=t.length;r<u;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))},show_node:function(t,i){var r,u;if(n.isArray(t)){for(t=t.slice(),r=0,u=t.length;r<u;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))},hide_all:function(t){var i,r=this._model.data,u=[];for(i in r)r.hasOwnProperty(i)&&i!==n.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,u.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:u}),u},show_all:function(t){var i,r=this._model.data,u=[];for(i in r)r.hasOwnProperty(i)&&i!==n.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,u.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:u}),u},activate_node:function(n,i){if(this.is_disabled(n))return!1;if(i&&typeof i=="object"||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(n)&&this.get_parent(n)===this._data.core.last_clicked.parent))if(i.shiftKey){for(var e=this.get_node(n).id,o=this._data.core.last_clicked.id,u=this.get_node(this._data.core.last_clicked.parent).children,f=!1,r=0,s=u.length;r<s;r+=1)u[r]===e&&(f=!f),u[r]===o&&(f=!f),!this.is_disabled(u[r])&&(f||u[r]===e||u[r]===o)?this.is_hidden(u[r])||this.select_node(u[r],!0,!1,i):this.deselect_node(u[r],!0,i);this.trigger("changed",{action:"select_node",node:this.get_node(n),selected:this._data.core.selected,event:i})}else this.is_selected(n)?this.deselect_node(n,!1,i):this.select_node(n,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(n)?this.deselect_node(n,!1,i):(this.deselect_all(!0),this.select_node(n,!1,!1,i),this._data.core.last_clicked=this.get_node(n));this.trigger("activate_node",{node:this.get_node(n),event:i})},hover_node:function(n){if(n=this.get_node(n,!0),!n||!n.length||n.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t);n.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(n)});setTimeout(function(){i.attr("aria-activedescendant",n[0].id)},0)},dehover_node:function(n){if(n=this.get_node(n,!0),!n||!n.length||!n.children(".jstree-hovered").length)return!1;n.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(n)})},select_node:function(t,i,r,u){var f,e,o;if(n.isArray(t)){for(t=t.slice(),e=0,o=t.length;e<o;e++)this.select_node(t[e],i,r,u);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;f=this.get_node(t,!0);t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(f=this._open_to(t)),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:u}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:u}))},deselect_node:function(t,i,r){var u,e,f;if(n.isArray(t)){for(t=t.slice(),u=0,e=t.length;u<e;u++)this.deselect_node(t[u],i,r);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;f=this.get_node(t,!0);t.state.selected&&(t.state.selected=!1,this._data.core.selected=n.vakata.array_remove_item(this._data.core.selected,t.id),f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))},select_all:function(t){var u=this._data.core.selected.concat([]),i,r;for(this._data.core.selected=this._model.data[n.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;i<r;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:u})},deselect_all:function(n){for(var i=this._data.core.selected.concat([]),t=0,r=this._data.core.selected.length;t<r;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:i});n||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(t){return(t=this.get_node(t),!t||t.id===n.jstree.root)?!1:t.state.selected},get_selected:function(t){return t?n.map(this._data.core.selected,n.proxy(function(n){return this.get_node(n)},this)):this._data.core.selected.slice()},get_top_selected:function(t){for(var r=this.get_selected(!0),u={},f,o,i=0,e=r.length;i<e;i++)u[r[i].id]=r[i];for(i=0,e=r.length;i<e;i++)for(f=0,o=r[i].children_d.length;f<o;f++)u[r[i].children_d[f]]&&delete u[r[i].children_d[f]];r=[];for(i in u)u.hasOwnProperty(i)&&r.push(i);return t?n.map(r,n.proxy(function(n){return this.get_node(n)},this)):r},get_bottom_selected:function(t){for(var r=this.get_selected(!0),u=[],i=0,f=r.length;i<f;i++)r[i].children.length||u.push(r[i].id);return t?n.map(u,n.proxy(function(n){return this.get_node(n)},this)):u},get_state:function(){var i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(var t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==n.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var f,u;if(i.core.open)return n.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(n){this.open_node(n,!1,0);delete i.core.open;this.set_state(i,r)}):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return f=this,this.deselect_all(),n.each(i.core.selected,function(n,t){f.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(u in i)i.hasOwnProperty(u)&&u!=="core"&&n.inArray(u,this.settings.plugins)===-1&&delete i[u];if(n.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return n.isEmptyObject(i)?(i=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t,i){this._data.core.state=i===!0?{}:this.get_state();i&&n.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state));this._cnt=0;this._model.data={};this._model.data[n.jstree.root]={id:n.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}};this._data.core.selected=[];this._data.core.last_clicked=null;this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'><\/i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'><\/i>"+this.get_string("Loading ...")+"<\/a><\/li><\/ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node(n.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(n.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;var i=[],r=[],u=this._data.core.selected.concat([]);r.push(t.id);t.state.opened===!0&&i.push(t.id);this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id);i.push(this.id)});this._load_nodes(r,n.proxy(function(n){this.open_node(i,!1,0);this.select_node(u);this.trigger("refresh_node",{node:t,nodes:n})},this),!1,!0)},set_id:function(t,i){if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;var r,f,u=this._model.data,e=t.id;for(i=i.toString(),u[t.parent].children[n.inArray(t.id,u[t.parent].children)]=i,r=0,f=t.parents.length;r<f;r++)u[t.parents[r]].children_d[n.inArray(t.id,u[t.parents[r]].children_d)]=i;for(r=0,f=t.children.length;r<f;r++)u[t.children[r]].parent=i;for(r=0,f=t.children_d.length;r<f;r++)u[t.children_d[r]].parents[n.inArray(t.id,u[t.children_d[r]].parents)]=i;return r=n.inArray(t.id,this._data.core.selected),r!==-1&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete u[t.id],t.id=i,t.li_attr.id=i,u[i]=t,this.trigger("set_id",{node:t,"new":t.id,old:e}),!0},get_text:function(t){return t=this.get_node(t),!t||t.id===n.jstree.root?!1:t.text},set_text:function(t,i){var r,u;if(n.isArray(t)){for(t=t.slice(),r=0,u=t.length;r<u;r++)this.set_text(t[r],i);return!0}return(t=this.get_node(t),!t||t.id===n.jstree.root)?!1:(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(t=this.get_node(t||n.jstree.root),!t)return!1;i&&i.flat&&!r&&(r=[]);var u={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:n.extend(!0,{},t.li_attr),a_attr:n.extend(!0,{},t.a_attr),state:{},data:i&&i.no_data?!1:n.extend(!0,{},t.data)},f,e;if(i&&i.flat?u.parent=t.parent:u.children=[],i&&i.no_state)delete u.state;else for(f in t.state)t.state.hasOwnProperty(f)&&(u.state[f]=t.state[f]);if(i&&i.no_li_attr&&delete u.li_attr,i&&i.no_a_attr&&delete u.a_attr,i&&i.no_id&&(delete u.id,u.li_attr&&u.li_attr.id&&delete u.li_attr.id,u.a_attr&&u.a_attr.id&&delete u.a_attr.id),i&&i.flat&&t.id!==n.jstree.root&&r.push(u),!i||!i.no_children)for(f=0,e=t.children.length;f<e;f++)i&&i.flat?this.get_json(t.children[f],i,r):u.children.push(this.get_json(t.children[f],i));return i&&i.flat?r:t.id===n.jstree.root?u.children:u},create_node:function(i,r,u,f,e){if(i===null&&(i=n.jstree.root),i=this.get_node(i),!i)return!1;if(u=u===t?"last":u,!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,u,f,!0)});r||(r={text:this.get_string("New node")});typeof r=="string"&&(r={text:r});r.text===t&&(r.text=this.get_string("New node"));var o,h,s,c;i.id===n.jstree.root&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":o=this.get_node(i.parent);u=n.inArray(i.id,o.children);i=o;break;case"after":o=this.get_node(i.parent);u=n.inArray(i.id,o.children)+1;i=o;break;case"inside":case"first":u=0;break;case"last":u=i.children.length;break;default:u||(u=0)}if(u>i.children.length&&(u=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,u))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,i.id,i.parents.concat()),!r)return!1;for(o=this.get_node(r),h=[],h.push(r),h=h.concat(o.children_d),this.trigger("model",{nodes:h,parent:i.id}),i.children_d=i.children_d.concat(h),s=0,c=i.parents.length;s<c;s++)this._model.data[i.parents[s]].children_d=this._model.data[i.parents[s]].children_d.concat(h);for(r=o,o=[],s=0,c=i.children.length;s<c;s++)o[s>=u?s+1:s]=i.children[s];return o[u]=r.id,i.children=o,this.redraw_node(i,!0),f&&f.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:u}),r.id},rename_node:function(t,i){var r,u,f;if(n.isArray(t)){for(t=t.slice(),r=0,u=t.length;r<u;r++)this.rename_node(t[r],i);return!0}return(t=this.get_node(t),!t||t.id===n.jstree.root)?!1:(f=t.text,!this.check("rename_node",t,this.get_parent(t),i))?(this.settings.core.error.call(this,this._data.core.last_error),!1):(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:f}),!0)},delete_node:function(t){var e,c,i,o,r,f,l,u,s,h,a,v;if(n.isArray(t)){for(t=t.slice(),e=0,c=t.length;e<c;e++)this.delete_node(t[e]);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;if(i=this.get_node(t.parent),o=n.inArray(t.id,i.children),h=!1,!this.check("delete_node",t,i,o))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(o!==-1&&(i.children=n.vakata.array_remove(i.children,o)),r=t.children_d.concat([]),r.push(t.id),f=0,l=t.parents.length;f<l;f++)this._model.data[t.parents[f]].children_d=n.vakata.array_filter(this._model.data[t.parents[f]].children_d,function(t){return n.inArray(t,r)===-1});for(u=0,s=r.length;u<s;u++)if(this._model.data[r[u]].state.selected){h=!0;break}for(h&&(this._data.core.selected=n.vakata.array_filter(this._data.core.selected,function(t){return n.inArray(t,r)===-1})),this.trigger("delete_node",{node:t,parent:i.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:i.id}),u=0,s=r.length;u<s;u++)delete this._model.data[r[u]];return n.inArray(this._data.core.focused,r)!==-1&&(this._data.core.focused=null,a=this.element[0].scrollTop,v=this.element[0].scrollLeft,i.id===n.jstree.root?this._model.data[n.jstree.root].children[0]&&this.get_node(this._model.data[n.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(i,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=a,this.element[0].scrollLeft=v),this.redraw_node(i,!0),!0},check:function(t,i,r,u,f){i=i&&i.id?i:this.get_node(i);r=r&&r.id?r:this.get_node(r);var e=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return(t==="move_node"||t==="copy_node")&&(!f||!f.is_multi)&&(i.id===r.id||t==="move_node"&&n.inArray(i.id,r.children)===u||n.inArray(r.id,i.children_d)!==-1)?(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):(e&&e.data&&(e=e.data),e&&e.functions&&(e.functions[t]===!1||e.functions[t]===!0))?(e.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),e.functions[t]):o===!1||n.isFunction(o)&&o.call(this,t,i,r,u,f)===!1||o&&o[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(i,r,u,f,e,o,s){var k,d,y,g,l,c,nt,v,a,h,p,b,tt,w;if(r=this.get_node(r),u=u===t?0:u,!r)return!1;if(!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,u,f,!0,!1,s)});if(n.isArray(i))if(i.length===1)i=i[0];else{for(k=0,d=i.length;k<d;k++)(a=this.move_node(i[k],r,u,f,e,!1,s))&&(r=a,u="after");return this.redraw(),!0}if(i=i&&i.id?i:this.get_node(i),!i||i.id===n.jstree.root)return!1;if(y=(i.parent||n.jstree.root).toString(),l=!u.toString().match(/^(before|after)$/)||r.id===n.jstree.root?r:this.get_node(r.parent),c=s?s:this._model.data[i.id]?this:n.jstree.reference(i.id),nt=!c||!c._id||this._id!==c._id,g=c&&c._id&&y&&c._model.data[y]&&c._model.data[y].children?n.inArray(i.id,c._model.data[y].children):-1,c&&c._id&&(i=c._model.data[i.id]),nt)return(a=this.copy_node(i,r,u,f,e,!1,s))?(c&&c.delete_node(i),a):!1;r.id===n.jstree.root&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":u=n.inArray(r.id,l.children);break;case"after":u=n.inArray(r.id,l.children)+1;break;case"inside":case"first":u=0;break;case"last":u=l.children.length;break;default:u||(u=0)}if(u>l.children.length&&(u=l.children.length),!this.check("move_node",i,l,u,{core:!0,origin:s,is_multi:c&&c._id&&c._id!==this._id,is_foreign:!c||!c._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===l.id){for(v=l.children.concat(),a=n.inArray(i.id,v),a!==-1&&(v=n.vakata.array_remove(v,a),u>a&&u--),a=[],h=0,p=v.length;h<p;h++)a[h>=u?h+1:h]=v[h];a[u]=i.id;l.children=a;this._node_changed(l.id);this.redraw(l.id===n.jstree.root)}else{for(a=i.children_d.concat(),a.push(i.id),h=0,p=i.parents.length;h<p;h++){for(v=[],w=c._model.data[i.parents[h]].children_d,b=0,tt=w.length;b<tt;b++)n.inArray(w[b],a)===-1&&v.push(w[b]);c._model.data[i.parents[h]].children_d=v}for(c._model.data[y].children=n.vakata.array_remove_item(c._model.data[y].children,i.id),h=0,p=l.parents.length;h<p;h++)this._model.data[l.parents[h]].children_d=this._model.data[l.parents[h]].children_d.concat(a);for(v=[],h=0,p=l.children.length;h<p;h++)v[h>=u?h+1:h]=l.children[h];for(v[u]=i.id,l.children=v,l.children_d.push(i.id),l.children_d=l.children_d.concat(i.children_d),i.parent=l.id,a=l.parents.concat(),a.unshift(l.id),w=i.parents.length,i.parents=a,a=a.concat(),h=0,p=i.children_d.length;h<p;h++)this._model.data[i.children_d[h]].parents=this._model.data[i.children_d[h]].parents.slice(0,w*-1),Array.prototype.push.apply(this._model.data[i.children_d[h]].parents,a);(y===n.jstree.root||l.id===n.jstree.root)&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||(this._node_changed(y),this._node_changed(l.id));o||this.redraw()}return f&&f.call(this,i,l,u),this.trigger("move_node",{node:i,parent:l.id,position:u,old_parent:y,old_position:g,is_multi:c&&c._id&&c._id!==this._id,is_foreign:!c||!c._id,old_instance:c,new_instance:this}),i.id},copy_node:function(i,r,u,f,e,o,s){var w,k,v,a,l,b,y,p,c,h,d;if(r=this.get_node(r),u=u===t?0:u,!r)return!1;if(!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,u,f,!0,!1,s)});if(n.isArray(i))if(i.length===1)i=i[0];else{for(w=0,k=i.length;w<k;w++)(a=this.copy_node(i[w],r,u,f,e,!0,s))&&(r=a,u="after");return this.redraw(),!0}if(i=i&&i.id?i:this.get_node(i),!i||i.id===n.jstree.root)return!1;p=(i.parent||n.jstree.root).toString();c=!u.toString().match(/^(before|after)$/)||r.id===n.jstree.root?r:this.get_node(r.parent);h=s?s:this._model.data[i.id]?this:n.jstree.reference(i.id);d=!h||!h._id||this._id!==h._id;h&&h._id&&(i=h._model.data[i.id]);r.id===n.jstree.root&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":u=n.inArray(r.id,c.children);break;case"after":u=n.inArray(r.id,c.children)+1;break;case"inside":case"first":u=0;break;case"last":u=c.children.length;break;default:u||(u=0)}if(u>c.children.length&&(u=c.children.length),!this.check("copy_node",i,c,u,{core:!0,origin:s,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if((y=h?h.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i,!y)||(y.id===!0&&delete y.id,y=this._parse_model_from_json(y,c.id,c.parents.concat()),!y))return!1;for(a=this.get_node(y),i&&i.state&&i.state.loaded===!1&&(a.state.loaded=!1),v=[],v.push(y),v=v.concat(a.children_d),this.trigger("model",{nodes:v,parent:c.id}),l=0,b=c.parents.length;l<b;l++)this._model.data[c.parents[l]].children_d=this._model.data[c.parents[l]].children_d.concat(v);for(v=[],l=0,b=c.children.length;l<b;l++)v[l>=u?l+1:l]=c.children[l];return v[u]=a.id,c.children=v,c.children_d.push(a.id),c.children_d=c.children_d.concat(a.children_d),c.id===n.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(c.id),o||this.redraw(c.id===n.jstree.root),f&&f.call(this,a,c,u),this.trigger("copy_node",{node:a,original:i,parent:c.id,position:u,old_parent:p,old_position:h&&h._id&&p&&h._model.data[p]&&h._model.data[p].children?n.inArray(i.id,h._model.data[p].children):-1,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),a.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),n.isArray(t)||(t=[t]),!t.length)return!1;for(var o=[],i,e=0,s=t.length;e<s;e++)i=this.get_node(t[e]),i&&i.id&&i.id!==n.jstree.root&&o.push(i);if(!o.length)return!1;u=o;f=this;r="move_node";this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),n.isArray(t)||(t=[t]),!t.length)return!1;for(var o=[],i,e=0,s=t.length;e<s;e++)i=this.get_node(t[e]),i&&i.id&&i.id!==n.jstree.root&&o.push(i);if(!o.length)return!1;u=o;f=this;r="copy_node";this.trigger("copy",{node:t})},get_buffer:function(){return{mode:r,node:u,inst:f}},can_paste:function(){return r!==!1&&u!==!1},paste:function(n,t){if(n=this.get_node(n),!n||!r||!r.match(/^(copy_node|move_node)$/)||!u)return!1;this[r](u,n,t,!1,!1,!1,f)&&this.trigger("paste",{parent:n.id,node:u,mode:r});u=!1;r=!1;f=!1},clear_buffer:function(){u=!1;r=!1;f=!1;this.trigger("clear_buffer")},edit:function(t,r,u){var v,l,f,h,e,c,o,a,s,y=!1;if(t=this.get_node(t),!t)return!1;if(this.settings.core.check_callback===!1)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;s=t;r=typeof r=="string"?r:t.text;this.set_text(t,"");t=this._open_to(t);s.text=r;v=this._data.core.rtl;l=this.element.width();this._data.core.focused=s.id;f=t.children(".jstree-anchor").focus();h=n("<span>");
/*!
            oi = obj.children("i:visible"),
            ai = a.children("i:visible"),
            w1 = oi.width() * oi.length,
            w2 = ai.width() * ai.length,
            */
e=r;c=n("<div />",{css:{position:"absolute",top:"-200px",left:v?"0px":"-1000px",visibility:"hidden"}}).appendTo("body");o=n("<input />",{value:e,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:n.proxy(function(i){i.stopImmediatePropagation();i.preventDefault();var v=h.children(".jstree-rename-input"),r=v.val(),a=this.settings.core.force_text,l;r===""&&(r=e);c.remove();h.replaceWith(f);h.remove();e=a?e:n("<div><\/div>").append(n.parseHTML(e)).html();this.set_text(t,e);l=!!this.rename_node(t,a?n("<div><\/div>").text(r).text():n("<div><\/div>").append(n.parseHTML(r)).html());l||this.set_text(t,e);this._data.core.focused=s.id;setTimeout(n.proxy(function(){var n=this.get_node(s.id,!0);n.length&&(this._data.core.focused=s.id,n.children(".jstree-anchor").focus())},this),0);u&&u.call(this,s,l,y);o=null},this),keydown:function(n){var t=n.which;t===27&&(y=!0,this.value=e);(t===27||t===13||t===37||t===38||t===39||t===40||t===32)&&n.stopImmediatePropagation();(t===27||t===13)&&(n.preventDefault(),this.blur())},click:function(n){n.stopImmediatePropagation()},mousedown:function(n){n.stopImmediatePropagation()},keyup:function(){o.width(Math.min(c.text("pW"+this.value).width(),l))},keypress:function(n){if(n.which===13)return!1}});a={fontFamily:f.css("fontFamily")||"",fontSize:f.css("fontSize")||"",fontWeight:f.css("fontWeight")||"",fontStyle:f.css("fontStyle")||"",fontStretch:f.css("fontStretch")||"",fontVariant:f.css("fontVariant")||"",letterSpacing:f.css("letterSpacing")||"",wordSpacing:f.css("wordSpacing")||""};h.attr("class",f.attr("class")).append(f.contents().clone()).append(o);f.replaceWith(h);c.css(a);o.css(a).width(Math.min(c.text("pW"+o[0].value).width(),l))[0].select();n(i).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){o&&t.target!==o&&n(o).blur()})},set_theme:function(t,i){if(!t)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=n.jstree.path+"/themes");i=r+"/"+t+"/style.css"}i&&n.inArray(i,v)===-1&&(n("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),v.push(i));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=t;this.element.addClass("jstree-"+t);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive");this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(n){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);this._data.core.themes.variant=n;n&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped");this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped");this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots");this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots");this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons");this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons");this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0;this.get_container_ul().addClass("jstree-ellipsis");this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1;this.get_container_ul().removeClass("jstree-ellipsis");this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(i,r){var e,o,f,u;if(n.isArray(i)){for(i=i.slice(),e=0,o=i.length;e<o;e++)this.set_icon(i[e],r);return!0}return(i=this.get_node(i),!i||i.id===n.jstree.root)?!1:(u=i.icon,i.icon=r===!0||r===null||r===t||r===""?!0:r,f=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),r===!1?this.hide_icon(i):r===!0||r===null||r===t||r===""?(f.removeClass("jstree-themeicon-custom "+u).css("background","").removeAttr("rel"),u===!1&&this.show_icon(i)):r.indexOf("/")===-1&&r.indexOf(".")===-1?(f.removeClass(u).css("background",""),f.addClass(r+" jstree-themeicon-custom").attr("rel",r),u===!1&&this.show_icon(i)):(f.removeClass(u).css("background",""),f.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),u===!1&&this.show_icon(i)),!0)},get_icon:function(t){return t=this.get_node(t),!t||t.id===n.jstree.root?!1:t.icon},hide_icon:function(t){var i,r;if(n.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.hide_icon(t[i]);return!0}return(t=this.get_node(t),!t||t===n.jstree.root)?!1:(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,u,r;if(n.isArray(t)){for(t=t.slice(),i=0,u=t.length;i<u;i++)this.show_icon(t[i]);return!0}return(t=this.get_node(t),!t||t===n.jstree.root)?!1:(r=this.get_node(t,!0),t.icon=r.length?r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},n.vakata={},n.vakata.attributes=function(t,i){t=n(t)[0];var r=i?{}:[];return t&&t.attributes&&n.each(t.attributes,function(t,u){n.inArray(u.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])===-1&&u.value!==null&&n.trim(u.value)!==""&&(i?r[u.name]=u.value:r.push(u.name))}),r},n.vakata.array_unique=function(n){for(var r=[],f={},i=0,u=n.length;i<u;i++)f[n[i]]===t&&(r.push(n[i]),f[n[i]]=!0);return r},n.vakata.array_remove=function(n,t){return n.splice(t,1),n},n.vakata.array_remove_item=function(t,i){var r=n.inArray(i,t);return r!==-1?n.vakata.array_remove(t,r):t},n.vakata.array_filter=function(n,t,i,r,u){if(n.filter)return n.filter(t,i);r=[];for(u in n)~~u+""==u+""&&u>=0&&t.call(i,n[u],+u,n)&&r.push(n[u]);return r},n.jstree.plugins.changed=function(n,t){var i=[];this.trigger=function(n,r){var u,f,e;if(r||(r={}),n.replace(".jstree","")==="changed"){for(r.changed={selected:[],deselected:[]},e={},u=0,f=i.length;u<f;u++)e[i[u]]=1;for(u=0,f=r.selected.length;u<f;u++)e[r.selected[u]]?e[r.selected[u]]=2:r.changed.selected.push(r.selected[u]);for(u=0,f=i.length;u<f;u++)e[i[u]]===1&&r.changed.deselected.push(i[u]);i=r.selected.slice()}t.trigger.call(this,n,r)};this.refresh=function(){return i=[],t.refresh.apply(this,arguments)}},s=i.createElement("I"),s.className="jstree-icon jstree-checkbox",s.setAttribute("role","presentation"),n.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},n.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this);this._data.checkbox.uto=!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",n.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",n.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1)this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",n.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(n.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",n.proxy(function(n,t){for(var u=this._model.data,e=u[t.parent],r=t.nodes,i=0,f=r.length;i<f;i++)u[r[i]].state.checked=u[r[i]].state.checked||u[r[i]].original&&u[r[i]].original.state&&u[r[i]].original.state.checked,u[r[i]].state.checked&&this._data.checkbox.selected.push(r[i])},this));if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1)this.element.on("model.jstree",n.proxy(function(t,i){var f=this._model.data,s=f[i.parent],e=i.nodes,a=[],r,o,h,c,l=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(l.indexOf("down")!==-1)if(s.state[u?"selected":"checked"]){for(r=0,o=e.length;r<o;r++)f[e[r]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(e)}else for(r=0,o=e.length;r<o;r++)if(f[e[r]].state[u?"selected":"checked"]){for(h=0,c=f[e[r]].children_d.length;h<c;h++)f[f[e[r]].children_d[h]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(f[e[r]].children_d)}if(l.indexOf("up")!==-1)for(r=0,o=s.children_d.length;r<o;r++)f[s.children_d[r]].children.length||a.push(f[s.children_d[r]].parent);this._data[u?"core":"checkbox"].selected=n.vakata.array_unique(this._data[u?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",n.proxy(function(n,t){for(var u=t.node,l=this._model.data,a=this.get_node(u.parent),c=this.get_node(u,!0),r,h=this.settings.checkbox.cascade,o=this.settings.checkbox.tie_selection,s={},f=this._data[o?"core":"checkbox"].selected,i=0,e=f.length;i<e;i++)s[f[i]]=!0;if(h.indexOf("down")!==-1)for(i=0,e=u.children_d.length;i<e;i++)s[u.children_d[i]]=!0,r=l[u.children_d[i]],r.state[o?"selected":"checked"]=!0,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);h.indexOf("up")!==-1;f=[];for(i in s)s.hasOwnProperty(i)&&f.push(i);this._data[o?"core":"checkbox"].selected=f;h.indexOf("down")!==-1&&c.length&&c.find(".jstree-anchor").addClass(o?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",n.proxy(function(){for(var r=this.get_node(n.jstree.root),f=this._model.data,t,i=0,u=r.children_d.length;i<u;i++)t=f[r.children_d[i]],t&&t.original&&t.original.state&&t.original.state.undetermined&&(t.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",n.proxy(function(t,i){var f=i.node,l=this.get_node(f,!0),r,o,u,h=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,e=this._data[s?"core":"checkbox"].selected,c={};if(f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1),h.indexOf("down")!==-1)for(r=0,o=f.children_d.length;r<o;r++)u=this._model.data[f.children_d[r]],u.state[s?"selected":"checked"]=!1,u&&u.original&&u.original.state&&u.original.state.undetermined&&(u.original.state.undetermined=!1);if(h.indexOf("up")!==-1)for(r=0,o=f.parents.length;r<o;r++)u=this._model.data[f.parents[r]],u.state[s?"selected":"checked"]=!1,u&&u.original&&u.original.state&&u.original.state.undetermined&&(u.original.state.undetermined=!1),u=this.get_node(f.parents[r],!0),u&&u.length&&u.attr("aria-selected",!1).children(".jstree-anchor").removeClass(s?"jstree-clicked":"jstree-checked");for(c={},r=0,o=e.length;r<o;r++)(h.indexOf("down")===-1||n.inArray(e[r],f.children_d)===-1)&&(h.indexOf("up")===-1||n.inArray(e[r],f.parents)===-1)&&(c[e[r]]=!0);e=[];for(r in c)c.hasOwnProperty(r)&&e.push(r);this._data[s?"core":"checkbox"].selected=e;h.indexOf("down")!==-1&&l.length&&l.find(".jstree-anchor").removeClass(s?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this));if(this.settings.checkbox.cascade.indexOf("up")!==-1)this.element.on("delete_node.jstree",n.proxy(function(t,i){for(var r=this.get_node(i.parent),h=this._model.data,f,e,s,o,u=this.settings.checkbox.tie_selection;r&&r.id!==n.jstree.root&&!r.state[u?"selected":"checked"];){for(s=0,f=0,e=r.children.length;f<e;f++)s+=h[r.children[f]].state[u?"selected":"checked"];if(e>0&&s===e)r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked");else break;r=this.get_node(r.parent)}},this)).on("move_node.jstree",n.proxy(function(t,i){var c=i.is_multi,l=i.old_parent,a=this.get_node(i.parent),h=this._model.data,r,s,e,o,f,u=this.settings.checkbox.tie_selection;if(!c)for(r=this.get_node(l);r&&r.id!==n.jstree.root&&!r.state[u?"selected":"checked"];){for(s=0,e=0,o=r.children.length;e<o;e++)s+=h[r.children[e]].state[u?"selected":"checked"];if(o>0&&s===o)r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),f=this.get_node(r,!0),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked");else break;r=this.get_node(r.parent)}for(r=a;r&&r.id!==n.jstree.root;){for(s=0,e=0,o=r.children.length;e<o;e++)s+=h[r.children[e]].state[u?"selected":"checked"];if(s===o)r.state[u?"selected":"checked"]||(r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),f=this.get_node(r,!0),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"));else if(r.state[u?"selected":"checked"])r.state[u?"selected":"checked"]=!1,this._data[u?"core":"checkbox"].selected=n.vakata.array_remove_item(this._data[u?"core":"checkbox"].selected,r.id),f=this.get_node(r,!0),f&&f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass(u?"jstree-clicked":"jstree-checked");else break;r=this.get_node(r.parent)}},this))};this._undetermined=function(){return;var u,o,i,f,r,s,e,h};this.redraw_node=function(t,i,u){if(t=r.redraw_node.apply(this,arguments),t){for(var e=null,o=null,f=0,h=t.childNodes.length;f<h;f++)if(t.childNodes[f]&&t.childNodes[f].className&&t.childNodes[f].className.indexOf("jstree-anchor")!==-1){e=t.childNodes[f];break}e&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(e.className+=" jstree-checked"),o=s.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(o.className+=" jstree-checkbox-disabled"),e.insertBefore(o,e.childNodes[0]))}return u||this.settings.checkbox.cascade.indexOf("undetermined")===-1||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(n.proxy(this._undetermined,this),50)),t};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(t){t=this.get_node(t);var r=this.settings.checkbox.cascade,i,u,f=this.settings.checkbox.tie_selection,o=this._data[f?"core":"checkbox"].selected,e=this._model.data;if(!t||t.state[f?"selected":"checked"]===!0||r.indexOf("undetermined")===-1||r.indexOf("down")===-1&&r.indexOf("up")===-1)return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(i=0,u=t.children_d.length;i<u;i++)if(n.inArray(t.children_d[i],o)!==-1||!e[t.children_d[i]].state.loaded&&e[t.children_d[i]].original.state.undetermined)return!0;return!1};this.disable_checkbox=function(t){var i,u,r;if(n.isArray(t)){for(t=t.slice(),i=0,u=t.length;i<u;i++)this.disable_checkbox(t[i]);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;r=this.get_node(t,!0);t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))};this.enable_checkbox=function(t){var i,u,r;if(n.isArray(t)){for(t=t.slice(),i=0,u=t.length;i<u;i++)this.enable_checkbox(t[i]);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;r=this.get_node(t,!0);t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))};this.activate_node=function(t,i){if(n(i.target).hasClass("jstree-checkbox-disabled"))return!1;if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||n(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!n(i.target).hasClass("jstree-checkbox"))return r.activate_node.call(this,t,i);if(this.is_disabled(t))return!1;this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i);this.trigger("activate_node",{node:this.get_node(t)})};this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,u,f;if(n.isArray(t)){for(t=t.slice(),u=0,f=t.length;u<f;u++)this.check_node(t[u],i);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;r=this.get_node(t,!0);t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))};this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,f,u;if(n.isArray(t)){for(t=t.slice(),r=0,f=t.length;r<f;r++)this.uncheck_node(t[r],i);return!0}if(t=this.get_node(t),!t||t.id===n.jstree.root)return!1;u=this.get_node(t,!0);t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=n.vakata.array_remove_item(this._data.checkbox.selected,t.id),u.length&&u.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var r=this._data.checkbox.selected.concat([]),t,i;for(this._data.checkbox.selected=this._model.data[n.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;t<i;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();for(var i=this._data.checkbox.selected.concat([]),n=0,t=this._data.checkbox.selected.length;n<t;n++)this._model.data[this._data.checkbox.selected[n]]&&(this._model.data[this._data.checkbox.selected[n]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})};this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):(t=this.get_node(t),!t||t.id===n.jstree.root)?!1:t.state.checked};this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?n.map(this._data.checkbox.selected,n.proxy(function(n){return this.get_node(n)},this)):this._data.checkbox.selected};this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);for(var r=this.get_checked(!0),u={},f,o,i=0,e=r.length;i<e;i++)u[r[i].id]=r[i];for(i=0,e=r.length;i<e;i++)for(f=0,o=r[i].children_d.length;f<o;f++)u[r[i].children_d[f]]&&delete u[r[i].children_d[f]];r=[];for(i in u)u.hasOwnProperty(i)&&r.push(i);return t?n.map(r,n.proxy(function(n){return this.get_node(n)},this)):r};this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);for(var r=this.get_checked(!0),u=[],i=0,f=r.length;i<f;i++)r[i].children.length||u.push(r[i].id);return t?n.map(u,n.proxy(function(n){return this.get_node(n)},this)):u};this.load_node=function(t){var u,f,e,i;if(!n.isArray(t)&&!this.settings.checkbox.tie_selection&&(i=this.get_node(t),i&&i.state.loaded))for(u=0,f=i.children_d.length;u<f;u++)this._model.data[i.children_d[u]].state.checked&&(e=!0,this._data.checkbox.selected=n.vakata.array_remove_item(this._data.checkbox.selected,i.children_d[u]));return r.load_node.apply(this,arguments)};this.get_state=function(){var n=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?n:(n.checkbox=this._data.checkbox.selected.slice(),n)};this.set_state=function(t,i){var u=r.set_state.apply(this,arguments),f;return u&&t.checkbox?(this.settings.checkbox.tie_selection||(this.uncheck_all(),f=this,n.each(t.checkbox,function(n,t){f.check_node(t)})),delete t.checkbox,this.set_state(t,i),!1):u};this.refresh=function(){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},n.jstree.defaults.conditionalselect=function(){return!0},n.jstree.plugins.conditionalselect=function(n,t){this.activate_node=function(n,i){this.settings.conditionalselect.call(this,this.get_node(n),i)&&t.activate_node.call(this,n,i)}},n.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(n){setTimeout(function(){i.edit(n)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!n.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=n.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},n.jstree.plugins.contextmenu=function(r,u){this.bind=function(){u.bind.call(this);var r=0,t=null,f,e;this.element.on("contextmenu.jstree",".jstree-anchor",n.proxy(function(n,i){n.target.tagName.toLowerCase()!=="input"&&(n.preventDefault(),r=n.ctrlKey?+new Date:0,(i||t)&&(r=+new Date+1e4),t&&clearTimeout(t),this.is_loading(n.currentTarget)||this.show_contextmenu(n.currentTarget,n.pageX,n.pageY,n))},this)).on("click.jstree",".jstree-anchor",n.proxy(function(){this._data.contextmenu.visible&&(!r||+new Date-r>250)&&n.vakata.context.hide();r=0},this)).on("touchstart.jstree",".jstree-anchor",function(i){i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(f=i.originalEvent.changedTouches[0].clientX,e=i.originalEvent.changedTouches[0].clientY,t=setTimeout(function(){n(i.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(n){t&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(Math.abs(f-n.originalEvent.changedTouches[0].clientX)>50||Math.abs(e-n.originalEvent.changedTouches[0].clientY)>50)&&clearTimeout(t)}).on("touchend.vakata.jstree",function(){t&&clearTimeout(t)});
/*!
            if(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {
                var el = null, tm = null;
                this.element
                    .on("touchstart", ".jstree-anchor", function (e) {
                        el = e.currentTarget;
                        tm = +new Date();
                        $(document).one("touchend", function (e) {
                            e.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);
                            e.currentTarget = e.target;
                            tm = ((+(new Date())) - tm);
                            if(e.target === el && tm > 600 && tm < 1000) {
                                e.preventDefault();
                                $(el).trigger('contextmenu', e);
                            }
                            el = null;
                            tm = null;
                        });
                    });
            }
            */
n(i).on("context_hide.vakata.jstree",n.proxy(function(t,i){this._data.contextmenu.visible=!1;n(i.reference).removeClass("jstree-context")},this))};this.teardown=function(){this._data.contextmenu.visible&&n.vakata.context.hide();u.teardown.call(this)};this.show_contextmenu=function(i,r,u,f){if(i=this.get_node(i),!i||i.id===n.jstree.root)return!1;var s=this.settings.contextmenu,h=this.get_node(i,!0),c=h.children(".jstree-anchor"),o=!1,e=!1;(s.show_at_node||r===t||u===t)&&(o=c.offset(),r=o.left,u=o.top+this._data.core.li_height);this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,f);e=s.items;n.isFunction(e)&&(e=e.call(this,i,n.proxy(function(n){this._show_contextmenu(i,r,u,n)},this)));n.isPlainObject(e)&&this._show_contextmenu(i,r,u,e)};this._show_contextmenu=function(t,r,u,f){var o=this.get_node(t,!0),e=o.children(".jstree-anchor");n(i).one("context_show.vakata.jstree",n.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";n(i.element).addClass(r);e.addClass("jstree-context")},this));this._data.contextmenu.visible=!0;n.vakata.context.show(e,{x:r,y:u},f);this.trigger("show_contextmenu",{node:t,x:r,y:u})}},function(n){var r=!1,t={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};n.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(r){n(i).triggerHandler("context_"+r+".vakata",{reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}})},_execute:function(i){return i=t.items[i],i&&(!i._disabled||n.isFunction(i._disabled)&&!i._disabled({item:i,reference:t.reference,element:t.element}))&&i.action?i.action.call(null,{item:i,reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}}):!1},_parse:function(i,r){if(!i)return!1;r||(t.html="",t.items=[]);var u="",f=!1,e;return r&&(u+="<ul>"),n.each(i,function(i,r){if(!r)return!0;t.items.push(r);!f&&r.separator_before&&(u+="<li class='vakata-context-separator'><a href='#' "+(n.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<\/a><\/li>");f=!1;u+="<li class='"+(r._class||"")+(r._disabled===!0||n.isFunction(r._disabled)&&r._disabled({item:r,reference:t.reference,element:t.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">";u+="<a href='#' rel='"+(t.items.length-1)+"' "+(r.title?"title='"+r.title+"'":"")+">";n.vakata.context.settings.icons&&(u+="<i ",r.icon&&(u+=r.icon.indexOf("/")!==-1||r.icon.indexOf(".")!==-1?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),u+="><\/i><span class='vakata-contextmenu-sep'>&#160;<\/span>");u+=(n.isFunction(r.label)?r.label({item:i,reference:t.reference,element:t.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"<\/span>":"")+"<\/a>";r.submenu&&(e=n.vakata.context._parse(r.submenu,!0),e&&(u+=e));u+="<\/li>";r.separator_after&&(u+="<li class='vakata-context-separator'><a href='#' "+(n.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<\/a><\/li>",f=!0)}),u=u.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(u+="<\/ul>"),r||(t.html=u,n.vakata.context._trigger("parse")),u.length>10?u:!1},_show_submenu:function(t){if(t=n(t),t.length&&t.children("ul").length){var i=t.children("ul"),e=t.offset().left,f=e+t.outerWidth(),s=t.offset().top,u=i.width(),h=i.height(),o=n(window).width()+n(window).scrollLeft(),c=n(window).height()+n(window).scrollTop();r?t[f-(u+10+t.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):t[f+u>o&&e>o-f?"addClass":"removeClass"]("vakata-context-right");s+h+10>c&&i.css("bottom","-1px");t.hasClass("vakata-context-right")?e<u&&i.css("margin-right",e-u):o-f<u&&i.css("margin-left",o-f-u);i.show()}},show:function(i,u,f){var h,o,e,s,c,l,a,v;t.element&&t.element.length&&t.element.width("");switch(!0){case!u&&!i:return!1;case!!u&&!!i:t.reference=i;t.position_x=u.x;t.position_y=u.y;break;case!u&&!!i:t.reference=i;h=i.offset();t.position_x=h.left+i.outerHeight();t.position_y=h.top;break;case!!u&&!i:t.position_x=u.x;t.position_y=u.y}!i||f||!n(i).data("vakata_contextmenu")||(f=n(i).data("vakata_contextmenu"));n.vakata.context._parse(f)&&t.element.html(t.html);t.items.length&&(t.element.appendTo("body"),o=t.element,e=t.position_x,s=t.position_y,c=o.width(),l=o.height(),a=n(window).width()+n(window).scrollLeft(),v=n(window).height()+n(window).scrollTop(),r&&(e-=o.outerWidth()-n(i).outerWidth(),e<n(window).scrollLeft()+20&&(e=n(window).scrollLeft()+20)),e+c+20>a&&(e=a-(c+20)),s+l+20>v&&(s=v-(l+20)),t.element.css({left:e,top:s}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),t.is_visible=!0,n.vakata.context._trigger("show"))},hide:function(){t.is_visible&&(t.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),t.is_visible=!1,n.vakata.context._trigger("hide"))}};n(function(){r=n("body").css("direction")==="rtl";var u=!1;t.element=n("<ul class='vakata-context'><\/ul>");t.element.on("mouseenter","li",function(i){(i.stopImmediatePropagation(),n.contains(this,i.relatedTarget))||(u&&clearTimeout(u),t.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),n(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),n.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){n.contains(this,t.relatedTarget)||n(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){n(this).find(".vakata-context-hover").removeClass("vakata-context-hover");n.vakata.context.settings.hide_onmouseleave&&(u=setTimeout(function(){return function(){n.vakata.context.hide()}}(this),n.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault();n(this).blur().parent().hasClass("vakata-context-disabled")||n.vakata.context._execute(n(this).attr("rel"))===!1||n.vakata.context.hide()}).on("keydown","a",function(i){var r=null;switch(i.which){case 13:case 32:i.type="click";i.preventDefault();n(i.currentTarget).trigger(i);break;case 37:t.is_visible&&(t.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 38:t.is_visible&&(r=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 39:t.is_visible&&(t.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 40:t.is_visible&&(r=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 27:n.vakata.context.hide();i.preventDefault()}}).on("keydown",function(n){n.preventDefault();var i=t.element.find(".vakata-contextmenu-shortcut-"+n.which).parent();i.parent().not(".vakata-context-disabled")&&i.click()});n(i).on("mousedown.vakata.jstree",function(i){t.is_visible&&!n.contains(t.element[0],i.target)&&n.vakata.context.hide()}).on("context_show.vakata.jstree",function(){t.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");r&&t.element.addClass("vakata-context-rtl").css("direction","rtl");t.element.find("ul").hide().end()})})}(n),n.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1},n.jstree.plugins.dnd=function(t,r){this.init=function(n,t){r.init.call(this,n,t);this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in i.createElement("span")};this.bind=function(){r.bind.call(this);this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",n.proxy(function(t){if(this.settings.dnd.large_drag_target&&n(t.target).closest(".jstree-node")[0]!==t.currentTarget||t.type==="touchstart"&&(!this.settings.dnd.touch||this.settings.dnd.touch==="selected"&&!n(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,u=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(u=n.vakata.html.escape(u)),i&&i.id&&i.id!==n.jstree.root&&(t.which===1||t.type==="touchstart"||t.type==="dragstart")&&(this.settings.dnd.is_draggable===!0||n.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t)))if(o={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},h=t.currentTarget,this.settings.dnd.use_html5)n.vakata.dnd._trigger("start",t,{helper:n(),element:h,data:o});else return this.element.trigger("mousedown.jstree"),n.vakata.dnd.start(t,o,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"><\/i>'+u+'<ins class="jstree-copy" style="display:none;">+<\/ins><\/div>')},this));if(this.settings.dnd.use_html5)this.element.on("dragover.jstree",function(t){return t.preventDefault(),n.vakata.dnd._trigger("move",t,{helper:n(),element:h,data:o}),!1}).on("drop.jstree",n.proxy(function(t){return t.preventDefault(),n.vakata.dnd._trigger("stop",t,{helper:n(),element:h,data:o}),!1},this))};this.redraw_node=function(n){if(n=r.redraw_node.apply(this,arguments),n&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)n.setAttribute("draggable",!0);else{for(var i=null,t=0,u=n.childNodes.length;t<u;t++)if(n.childNodes[t]&&n.childNodes[t].className&&n.childNodes[t].className.indexOf("jstree-anchor")!==-1){i=n.childNodes[t];break}i&&i.setAttribute("draggable",!0)}return n}},n(function(){var r=!1,o=!1,u=!1,f=!1,e=n('<div id="jstree-marker">&#160;<\/div>').hide();n(i).on("dnd_start.vakata.jstree",function(n,t){(r=!1,u=!1,t&&t.data&&t.data.jstree)&&e.appendTo("body")}).on("dnd_move.vakata.jstree",function(i,s){if((f&&(s.event&&s.event.type==="dragover"&&s.event.target===u.target||clearTimeout(f)),s&&s.data&&s.data.jstree)&&(!s.event.target.id||s.event.target.id!=="jstree-marker")){u=s.event;var h=n.jstree.reference(s.event.target),c=!1,v=!1,d=!1,g,nt,p,y,w,tt,a,l,it,ft,rt,ot,b,k,ut,et;if(h&&h._data&&h._data.dnd)if(e.attr("class","jstree-"+h.get_theme()+(h.settings.core.themes.responsive?" jstree-dnd-responsive":"")),ut=s.data.origin&&(s.data.origin.settings.dnd.always_copy||s.data.origin.settings.dnd.copy&&(s.event.metaKey||s.event.ctrlKey)),s.helper.children().attr("class","jstree-"+h.get_theme()+" jstree-"+h.get_theme()+"-"+h.get_theme_variant()+" "+(h.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[ut?"show":"hide"](),(s.event.target===h.element[0]||s.event.target===h.get_container_ul()[0])&&h.get_container_ul().children().length===0){for(a=!0,l=0,it=s.data.nodes.length;l<it;l++)if(a=a&&h.check(s.data.origin&&(s.data.origin.settings.dnd.always_copy||s.data.origin.settings.dnd.copy&&(s.event.metaKey||s.event.ctrlKey))?"copy_node":"move_node",s.data.origin&&s.data.origin!==h?s.data.origin.get_node(s.data.nodes[l]):s.data.nodes[l],n.jstree.root,"last",{dnd:!0,ref:h.get_node(n.jstree.root),pos:"i",origin:s.data.origin,is_multi:s.data.origin&&s.data.origin!==h,is_foreign:!s.data.origin}),!a)break;if(a){r={ins:h,par:n.jstree.root,pos:"last"};e.hide();s.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");s.event.originalEvent&&s.event.originalEvent.dataTransfer&&(s.event.originalEvent.dataTransfer.dropEffect=ut?"copy":"move");return}}else if(c=h.settings.dnd.large_drop_target?n(s.event.target).closest(".jstree-node").children(".jstree-anchor"):n(s.event.target).closest(".jstree-anchor"),c&&c.length&&c.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(v=c.offset(),d=(s.event.pageY!==t?s.event.pageY:s.event.originalEvent.pageY)-v.top,p=c.outerHeight(),tt=d<p/3?["b","i","a"]:d>p-p/3?["a","i","b"]:d>p/2?["i","a","b"]:["i","b","a"],n.each(tt,function(t,i){switch(i){case"b":g=v.left-6;nt=v.top;y=h.get_parent(c);w=c.parent().index();break;case"i":b=h.settings.dnd.inside_pos;k=h.get_node(c.parent());g=v.left-2;nt=v.top+p/2+1;y=k.id;w=b==="first"?0:b==="last"?k.children.length:Math.min(b,k.children.length);break;case"a":g=v.left-6;nt=v.top+p;y=h.get_parent(c);w=c.parent().index()+1}for(a=!0,l=0,it=s.data.nodes.length;l<it;l++)if(ft=s.data.origin&&(s.data.origin.settings.dnd.always_copy||s.data.origin.settings.dnd.copy&&(s.event.metaKey||s.event.ctrlKey))?"copy_node":"move_node",rt=w,ft==="move_node"&&i==="a"&&s.data.origin&&s.data.origin===h&&y===h.get_parent(s.data.nodes[l])&&(ot=h.get_node(y),rt>n.inArray(s.data.nodes[l],ot.children)&&(rt-=1)),a=a&&(h&&h.settings&&h.settings.dnd&&h.settings.dnd.check_while_dragging===!1||h.check(ft,s.data.origin&&s.data.origin!==h?s.data.origin.get_node(s.data.nodes[l]):s.data.nodes[l],y,rt,{dnd:!0,ref:h.get_node(c.parent()),pos:i,origin:s.data.origin,is_multi:s.data.origin&&s.data.origin!==h,is_foreign:!s.data.origin})),!a){h&&h.last_error&&(o=h.last_error());break}return i==="i"&&c.parent().is(".jstree-closed")&&h.settings.dnd.open_timeout&&(f=setTimeout(function(n,t){return function(){n.open_node(t)}}(h,c),h.settings.dnd.open_timeout)),a?(et=h.get_node(y,!0),et.hasClass(".jstree-dnd-parent")||(n(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),et.addClass("jstree-dnd-parent")),r={ins:h,par:y,pos:i==="i"&&b==="last"&&w===0&&!h.is_loaded(k)?"last":w},e.css({left:g+"px",top:nt+"px"}).show(),s.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),s.event.originalEvent&&s.event.originalEvent.dataTransfer&&(s.event.originalEvent.dataTransfer.dropEffect=ut?"copy":"move"),o={},tt=!0,!1):void 0}),tt===!0))return;n(".jstree-dnd-parent").removeClass("jstree-dnd-parent");r=!1;s.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");s.event.originalEvent&&s.event.originalEvent.dataTransfer&&(s.event.originalEvent.dataTransfer.dropEffect="none");e.hide()}}).on("dnd_scroll.vakata.jstree",function(n,t){t&&t.data&&t.data.jstree&&(e.hide(),r=!1,u=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,i){if(n(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),f&&clearTimeout(f),i&&i.data&&i.data.jstree){e.hide().detach();var s,h,c=[];if(r){for(s=0,h=i.data.nodes.length;s<h;s++)c[s]=i.data.origin?i.data.origin.get_node(i.data.nodes[s]):i.data.nodes[s];r.ins[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node"](c,r.par,r.pos,!1,!1,!1,i.data.origin)}else s=n(i.event.target).closest(".jstree"),s.length&&o&&o.error&&o.error==="check"&&(s=s.jstree(!0),s&&s.settings.core.error.call(this,o));u=!1;r=!1}}).on("keyup.jstree keydown.jstree",function(t,i){i=n.vakata.dnd._get();i&&i.data&&i.data.jstree&&(t.type==="keyup"&&t.which===27?(f&&clearTimeout(f),r=!1,o=!1,u=!1,f=!1,e.hide().detach(),n.vakata.dnd._clean()):(i.helper.find(".jstree-copy").first()[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),u&&(u.metaKey=t.metaKey,u.ctrlKey=t.ctrlKey,n.vakata.dnd._trigger("move",u))))})}),function(n){n.vakata.html={div:n("<div />"),escape:function(t){return n.vakata.html.div.text(t).html()},strip:function(t){return n.vakata.html.div.empty().append(n.parseHTML(t)).text()}};var r={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};n.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(r,u,f){f===t&&(f=n.vakata.dnd._get());f.event=u;n(i).triggerHandler("dnd_"+r+".vakata",f)},_get:function(){return{data:r.data,element:r.element,helper:r.helper}},_clean:function(){r.helper&&r.helper.remove();r.scroll_i&&(clearInterval(r.scroll_i),r.scroll_i=!1);r={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};n(i).off("mousemove.vakata.jstree touchmove.vakata.jstree",n.vakata.dnd.drag);n(i).off("mouseup.vakata.jstree touchend.vakata.jstree",n.vakata.dnd.stop)},_scroll:function(t){if(!r.scroll_e||!r.scroll_l&&!r.scroll_t)return r.scroll_i&&(clearInterval(r.scroll_i),r.scroll_i=!1),!1;if(!r.scroll_i)return r.scroll_i=setInterval(n.vakata.dnd._scroll,100),!1;if(t===!0)return!1;var i=r.scroll_e.scrollTop(),u=r.scroll_e.scrollLeft();r.scroll_e.scrollTop(i+r.scroll_t*n.vakata.dnd.settings.scroll_speed);r.scroll_e.scrollLeft(u+r.scroll_l*n.vakata.dnd.settings.scroll_speed);(i!==r.scroll_e.scrollTop()||u!==r.scroll_e.scrollLeft())&&n.vakata.dnd._trigger("scroll",r.scroll_e)},start:function(t,u,f){t.type==="touchstart"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=i.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset));r.is_drag&&n.vakata.dnd.stop({});try{t.currentTarget.unselectable="on";t.currentTarget.onselectstart=function(){return!1};t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}r.init_x=t.pageX;r.init_y=t.pageY;r.data=u;r.is_down=!0;r.element=t.currentTarget;r.target=t.target;r.is_touch=t.type==="touchstart";f!==!1&&(r.helper=n("<div id='vakata-dnd'><\/div>").html(f).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));n(i).on("mousemove.vakata.jstree touchmove.vakata.jstree",n.vakata.dnd.drag);n(i).on("mouseup.vakata.jstree touchend.vakata.jstree",n.vakata.dnd.stop);return!1},drag:function(t){if(t.type==="touchmove"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=i.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),r.is_down){if(!r.is_drag)if(Math.abs(t.pageX-r.init_x)>(r.is_touch?n.vakata.dnd.settings.threshold_touch:n.vakata.dnd.settings.threshold)||Math.abs(t.pageY-r.init_y)>(r.is_touch?n.vakata.dnd.settings.threshold_touch:n.vakata.dnd.settings.threshold)){r.helper&&(r.helper.appendTo("body"),r.helper_w=r.helper.outerWidth());r.is_drag=!0;n(r.target).one("click.vakata",!1);n.vakata.dnd._trigger("start",t)}else return;var u=!1,l=!1,f=!1,o=!1,e=!1,s=!1,a=!1,v=!1,h=!1,c=!1;return r.scroll_t=0,r.scroll_l=0,r.scroll_e=!1,n(n(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(n(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var u=n(this),i=u.offset();return this.scrollHeight>this.offsetHeight&&(i.top+u.height()-t.pageY<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_t=1),t.pageY-i.top<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(i.left+u.width()-t.pageX<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_l=1),t.pageX-i.left<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_l=-1)),r.scroll_t||r.scroll_l?(r.scroll_e=n(this),!1):void 0}),r.scroll_e||(u=n(i),l=n(window),f=u.height(),o=l.height(),e=u.width(),s=l.width(),a=u.scrollTop(),v=u.scrollLeft(),f>o&&t.pageY-a<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_t=-1),f>o&&o-(t.pageY-a)<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_t=1),e>s&&t.pageX-v<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_l=-1),e>s&&s-(t.pageX-v)<n.vakata.dnd.settings.scroll_proximity&&(r.scroll_l=1),(r.scroll_t||r.scroll_l)&&(r.scroll_e=u)),r.scroll_e&&n.vakata.dnd._scroll(!0),r.helper&&(h=parseInt(t.pageY+n.vakata.dnd.settings.helper_top,10),c=parseInt(t.pageX+n.vakata.dnd.settings.helper_left,10),f&&h+25>f&&(h=f-50),e&&c+r.helper_w>e&&(c=e-(r.helper_w+2)),r.helper.css({left:c+"px",top:h+"px"})),n.vakata.dnd._trigger("move",t),!1}},stop:function(t){if(t.type==="touchend"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=i.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),r.is_drag)t.target!==r.target&&n(r.target).off("click.vakata"),n.vakata.dnd._trigger("stop",t);else if(t.type==="touchend"&&t.target===r.target){var u=setTimeout(function(){n(t.target).click()},100);n(t.target).one("click",function(){u&&clearTimeout(u)})}return n.vakata.dnd._clean(),!1}}}(n),n.jstree.defaults.massload=null,n.jstree.plugins.massload=function(t,i){this.init=function(n,t){this._data.massload={};i.init.call(this,n,t)};this._load_nodes=function(t,r,u,f){var e=this.settings.massload,a=JSON.stringify(t),h=[],c=this._model.data,s,l,o;if(!u){for(s=0,l=t.length;s<l;s++)c[t[s]]&&(c[t[s]].state.loaded||c[t[s]].state.failed)&&!f||(h.push(t[s]),o=this.get_node(t[s],!0),o&&o.length&&o.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},h.length){if(n.isFunction(e))return e.call(this,h,n.proxy(function(n){var e,s;if(n)for(e in n)n.hasOwnProperty(e)&&(this._data.massload[e]=n[e]);for(e=0,s=t.length;e<s;e++)o=this.get_node(t[e],!0),o&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,u,f)},this));if(typeof e=="object"&&e&&e.url)return e=n.extend(!0,{},e),n.isFunction(e.url)&&(e.url=e.url.call(this,h)),n.isFunction(e.data)&&(e.data=e.data.call(this,h)),n.ajax(e).done(n.proxy(function(n){var e,s;if(n)for(e in n)n.hasOwnProperty(e)&&(this._data.massload[e]=n[e]);for(e=0,s=t.length;e<s;e++)o=this.get_node(t[e],!0),o&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,u,f)},this)).fail(n.proxy(function(){i._load_nodes.call(this,t,r,u,f)},this))}}return i._load_nodes.call(this,t,r,u,f)};this._load_node=function(t,r){var u=this._data.massload[t.id],e=null,f;return u?(e=this[typeof u=="string"?"_append_html_data":"_append_json_data"](t,typeof u=="string"?n(n.parseHTML(u)).filter(function(){return this.nodeType!==3}):u,function(n){r.call(this,n)}),f=this.get_node(t.id,!0),f&&f.length&&f.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],e):i._load_node.call(this,t,r)}},n.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},n.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this);this._data.search.str="";this._data.search.dom=n();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=!1;this._data.search.smc=!1;this._data.search.hdn=[];this.element.on("search.jstree",n.proxy(function(t,i){if(this._data.search.som&&i.res.length){for(var u=this._model.data,f=[],e,s,r=0,o=i.res.length;r<o;r++)if(u[i.res[r]]&&!u[i.res[r]].state.hidden&&(f.push(i.res[r]),f=f.concat(u[i.res[r]].parents),this._data.search.smc))for(e=0,s=u[i.res[r]].children_d.length;e<s;e++)u[u[i.res[r]].children_d[e]]&&!u[u[i.res[r]].children_d[e]].state.hidden&&f.push(u[i.res[r]].children_d[e]);f=n.vakata.array_remove_item(n.vakata.array_unique(f),n.jstree.root);this._data.search.hdn=this.hide_all(!0);this.show_node(f,!0);this.redraw(!0)}},this)).on("clear_search.jstree",n.proxy(function(n,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))};this.search=function(i,r,u,f,e,o){if(i===!1||n.trim(i.toString())==="")return this.clear_search();f=this.get_node(f);f=f&&f.id?f.id:null;i=i.toString();var h=this.settings.search,s=h.ajax?h.ajax:!1,v=this._model.data,y=null,a=[],c=[],l,p;if(this._data.search.res.length&&!e&&this.clear_search(),u===t&&(u=h.show_only_matches),o===t&&(o=h.show_only_matches_children),!r&&s!==!1)return n.isFunction(s)?s.call(this,i,n.proxy(function(t){t&&t.d&&(t=t.d);this._load_nodes(n.isArray(t)?n.vakata.array_unique(t):[],function(){this.search(i,!0,u,f,e,o)})},this),f):(s=n.extend({},s),s.data||(s.data={}),s.data.str=i,f&&(s.data.inside=f),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=n.ajax(s).fail(n.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(s)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(n.proxy(function(t){t&&t.d&&(t=t.d);this._load_nodes(n.isArray(t)?n.vakata.array_unique(t):[],function(){this.search(i,!0,u,f,e,o)})},this)),this._data.search.lastRequest);if(e||(this._data.search.str=i,this._data.search.dom=n(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=u,this._data.search.smc=o),y=new n.vakata.search(i,!0,{caseSensitive:h.case_sensitive,fuzzy:h.fuzzy}),n.each(v[f?f:n.jstree.root].children_d,function(n,t){var r=v[t];r.text&&!r.state.hidden&&(!h.search_leaves_only||r.state.loaded&&r.children.length===0)&&(h.search_callback&&h.search_callback.call(this,i,r)||!h.search_callback&&y.search(r.text).isMatch)&&(a.push(t),c=c.concat(r.parents))}),a.length){for(c=n.vakata.array_unique(c),l=0,p=c.length;l<p;l++)c[l]!==n.jstree.root&&v[c[l]]&&this.open_node(c[l],null,0)===!0&&this._data.search.opn.push(c[l]);e?(this._data.search.dom=this._data.search.dom.add(n(this.element[0].querySelectorAll("#"+n.map(a,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(n.jstree.idregex,"\\$&"):t.replace(n.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=n.vakata.array_unique(this._data.search.res.concat(a))):(this._data.search.dom=n(this.element[0].querySelectorAll("#"+n.map(a,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(n.jstree.idregex,"\\$&"):t.replace(n.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=a);this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:u})};this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.res.length&&(this._data.search.dom=n(this.element[0].querySelectorAll("#"+n.map(this._data.search.res,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(n.jstree.idregex,"\\$&"):t.replace(n.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"));this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=n()};this.redraw_node=function(t){if(t=r.redraw_node.apply(this,arguments),t&&n.inArray(t.id,this._data.search.res)!==-1){for(var u=null,i=0,f=t.childNodes.length;i<f;i++)if(t.childNodes[i]&&t.childNodes[i].className&&t.childNodes[i].className.indexOf("jstree-anchor")!==-1){u=t.childNodes[i];break}u&&(u.className+=" jstree-search")}return t}},function(n){n.vakata.search=function(t,i,r){r=r||{};r=n.extend({},n.vakata.search.defaults,r);r.fuzzy!==!1&&(r.fuzzy=!0);t=r.caseSensitive?t:t.toLowerCase();var f=r.location,s=r.distance,l=r.threshold,u=t.length,h,c,e,o;return u>32&&(r.fuzzy=!1),r.fuzzy&&(h=1<<u-1,c=function(){for(var i={},n=0,n=0;n<u;n++)i[t.charAt(n)]=0;for(n=0;n<u;n++)i[t.charAt(n)]|=1<<u-n-1;return i}(),e=function(n,t){var i=n/u,r=Math.abs(f-t);return s?i+r/s:r?1:i}),o=function(n){if(n=r.caseSensitive?n:n.toLowerCase(),t===n||n.indexOf(t)!==-1)return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var a,i,tt=n.length,v=l,o=n.indexOf(t,f),p,s,w=u+tt,b,g,k,y,nt,d=1,it=[];for(o!==-1&&(v=Math.min(e(0,o),v),o=n.lastIndexOf(t,f+u),o!==-1&&(v=Math.min(e(0,o),v))),o=-1,a=0;a<u;a++){for(p=0,s=w;p<s;)e(a,f+s)<=v?p=s:w=s,s=Math.floor((w-p)/2+p);for(w=s,g=Math.max(1,f-s+1),k=Math.min(f+s,tt)+u,y=new Array(k+2),y[k+1]=(1<<a)-1,i=k;i>=g;i--)if(nt=c[n.charAt(i-1)],y[i]=a===0?(y[i+1]<<1|1)&nt:(y[i+1]<<1|1)&nt|(b[i+1]|b[i])<<1|1|b[i+1],y[i]&h&&(d=e(a,i-1),d<=v))if(v=d,o=i-1,it.push(o),o>f)g=Math.max(1,2*f-o);else break;if(e(a+1,f)>v)break;b=y}return{isMatch:o>=0,score:d}},i===!0?{search:o}:o(i)};n.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(n),n.jstree.defaults.sort=function(n,t){return this.get_text(n)>this.get_text(t)?1:-1},n.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this);this.element.on("model.jstree",n.proxy(function(n,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",n.proxy(function(n,t){this.sort(t.parent||t.node.parent,!1);this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",n.proxy(function(n,t){this.sort(t.parent,!1);this.redraw_node(t.parent,!0)},this))};this.sort=function(t,i){var r,u;if(t=this.get_node(t),t&&t.children&&t.children.length&&(t.children.sort(n.proxy(this.settings.sort,this)),i))for(r=0,u=t.children_d.length;r<u;r++)this.sort(t.children_d[r],!1)}},c=!1,n.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},n.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=n.proxy(function(){this.element.on(this.settings.state.events,n.proxy(function(){c&&clearTimeout(c);c=setTimeout(n.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",n.proxy(function(){this.element.one("restore_state.jstree",t);this.restore_state()||t()},this))};this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};n.vakata.storage.set(this.settings.state.key,JSON.stringify(t))};this.restore_state=function(){var t=n.vakata.storage.get(this.settings.state.key);if(!!t)try{t=JSON.parse(t)}catch(i){return!1}if(!!t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)return!1;if(!!t&&t.state&&(t=t.state),!!t&&n.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t){this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:n.extend(!0,{},t)})});return this.set_state(t),!0}return!1};this.clear_state=function(){return n.vakata.storage.del(this.settings.state.key)}},function(n){n.vakata.storage={set:function(n,t){return window.localStorage.setItem(n,t)},get:function(n){return window.localStorage.getItem(n)},del:function(n){return window.localStorage.removeItem(n)}}}(n),n.jstree.defaults.types={"default":{}},n.jstree.defaults.types[n.jstree.root]={},n.jstree.plugins.types=function(i,r){this.init=function(i,u){var f,e;if(u&&u.types&&u.types["default"])for(f in u.types)if(f!=="default"&&f!==n.jstree.root&&u.types.hasOwnProperty(f))for(e in u.types["default"])u.types["default"].hasOwnProperty(e)&&u.types[f][e]===t&&(u.types[f][e]=u.types["default"][e]);r.init.call(this,i,u);this._model.data[n.jstree.root].type=n.jstree.root};this.refresh=function(t,i){r.refresh.call(this,t,i);this._model.data[n.jstree.root].type=n.jstree.root};this.bind=function(){this.element.on("model.jstree",n.proxy(function(i,r){for(var f=this._model.data,e=r.nodes,s=this.settings.types,o="default",h,u=0,c=e.length;u<c;u++){if(o="default",f[e[u]].original&&f[e[u]].original.type&&s[f[e[u]].original.type]&&(o=f[e[u]].original.type),f[e[u]].data&&f[e[u]].data.jstree&&f[e[u]].data.jstree.type&&s[f[e[u]].data.jstree.type]&&(o=f[e[u]].data.jstree.type),f[e[u]].type=o,f[e[u]].icon===!0&&s[o].icon!==t&&(f[e[u]].icon=s[o].icon),s[o].li_attr!==t&&typeof s[o].li_attr=="object")for(h in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(h))if(h==="id")continue;else f[e[u]].li_attr[h]===t?f[e[u]].li_attr[h]=s[o].li_attr[h]:h==="class"&&(f[e[u]].li_attr["class"]=s[o].li_attr["class"]+" "+f[e[u]].li_attr["class"]);if(s[o].a_attr!==t&&typeof s[o].a_attr=="object")for(h in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(h))if(h==="id")continue;else f[e[u]].a_attr[h]===t?f[e[u]].a_attr[h]=s[o].a_attr[h]:h==="href"&&f[e[u]].a_attr[h]==="#"?f[e[u]].a_attr.href=s[o].a_attr.href:h==="class"&&(f[e[u]].a_attr["class"]=s[o].a_attr["class"]+" "+f[e[u]].a_attr["class"])}f[n.jstree.root].type=n.jstree.root},this));r.bind.call(this)};this.get_json=function(t,i,u){var e,s,o=this._model.data,h=i?n.extend(!0,{},i,{no_id:!1}):{},f=r.get_json.call(this,t,h,u);if(f===!1)return!1;if(n.isArray(f))for(e=0,s=f.length;e<s;e++)f[e].type=f[e].id&&o[f[e].id]&&o[f[e].id].type?o[f[e].id].type:"default",i&&i.no_id&&(delete f[e].id,f[e].li_attr&&f[e].li_attr.id&&delete f[e].li_attr.id,f[e].a_attr&&f[e].a_attr.id&&delete f[e].a_attr.id);else f.type=f.id&&o[f.id]&&o[f.id].type?o[f.id].type:"default",i&&i.no_id&&(f=this._delete_ids(f));return f};this._delete_ids=function(t){if(n.isArray(t)){for(var i=0,r=t.length;i<r;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&n.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t};this.check=function(i,u,f,e,o){if(r.check.call(this,i,u,f,e,o)===!1)return!1;u=u&&u.id?u:this.get_node(u);f=f&&f.id?f:this.get_node(f);var c=u&&u.id?o&&o.origin?o.origin:n.jstree.reference(u.id):null,s,h,l,a;c=c&&c._model&&c._model.data?c._model.data:null;switch(i){case"create_node":case"move_node":case"copy_node":if(i!=="move_node"||n.inArray(u.id,f.children)===-1){if(s=this.get_rules(f),s.max_children!==t&&s.max_children!==-1&&s.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;if(s.valid_children!==t&&s.valid_children!==-1&&n.inArray(u.type||"default",s.valid_children)===-1)return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;if(c&&u.children_d&&u.parents){for(h=0,l=0,a=u.children_d.length;l<a;l++)h=Math.max(h,c[u.children_d[l]].parents.length);h=h-u.parents.length+1}(h<=0||h===t)&&(h=1);do{if(s.max_depth!==t&&s.max_depth!==-1&&s.max_depth<h)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent);s=this.get_rules(f);h++}while(f)}}return!0};this.get_rules=function(n){if(n=this.get_node(n),!n)return!1;var i=this.get_type(n,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i};this.get_type=function(t,i){return t=this.get_node(t),t?i?n.extend({type:t.type},this.settings.types[t.type]):t.type:!1};this.set_type=function(i,r){var o=this._model.data,f,c,a,e,l,u,h,s;if(n.isArray(i)){for(i=i.slice(),c=0,a=i.length;c<a;c++)this.set_type(i[c],r);return!0}if(f=this.settings.types,i=this.get_node(i),!f[r]||!i)return!1;if(h=this.get_node(i,!0),h&&h.length&&(s=h.children(".jstree-anchor")),e=i.type,l=this.get_icon(i),i.type=r,l!==!0&&f[e]&&(f[e].icon===t||l!==f[e].icon)||this.set_icon(i,f[r].icon!==t?f[r].icon:!0),f[e]&&f[e].li_attr!==t&&typeof f[e].li_attr=="object")for(u in f[e].li_attr)if(f[e].li_attr.hasOwnProperty(u))if(u==="id")continue;else u==="class"?(o[i.id].li_attr["class"]=(o[i.id].li_attr["class"]||"").replace(f[e].li_attr[u],""),h&&h.removeClass(f[e].li_attr[u])):o[i.id].li_attr[u]===f[e].li_attr[u]&&(o[i.id].li_attr[u]=null,h&&h.removeAttr(u));if(f[e]&&f[e].a_attr!==t&&typeof f[e].a_attr=="object")for(u in f[e].a_attr)if(f[e].a_attr.hasOwnProperty(u))if(u==="id")continue;else u==="class"?(o[i.id].a_attr["class"]=(o[i.id].a_attr["class"]||"").replace(f[e].a_attr[u],""),s&&s.removeClass(f[e].a_attr[u])):o[i.id].a_attr[u]===f[e].a_attr[u]&&(u==="href"?(o[i.id].a_attr[u]="#",s&&s.attr("href","#")):(delete o[i.id].a_attr[u],s&&s.removeAttr(u)));if(f[r].li_attr!==t&&typeof f[r].li_attr=="object")for(u in f[r].li_attr)if(f[r].li_attr.hasOwnProperty(u))if(u==="id")continue;else o[i.id].li_attr[u]===t?(o[i.id].li_attr[u]=f[r].li_attr[u],h&&(u==="class"?h.addClass(f[r].li_attr[u]):h.attr(u,f[r].li_attr[u]))):u==="class"&&(o[i.id].li_attr["class"]=f[r].li_attr[u]+" "+o[i.id].li_attr["class"],h&&h.addClass(f[r].li_attr[u]));if(f[r].a_attr!==t&&typeof f[r].a_attr=="object")for(u in f[r].a_attr)if(f[r].a_attr.hasOwnProperty(u))if(u==="id")continue;else o[i.id].a_attr[u]===t?(o[i.id].a_attr[u]=f[r].a_attr[u],s&&(u==="class"?s.addClass(f[r].a_attr[u]):s.attr(u,f[r].a_attr[u]))):u==="href"&&o[i.id].a_attr[u]==="#"?(o[i.id].a_attr.href=f[r].a_attr.href,s&&s.attr("href",f[r].a_attr.href)):u==="class"&&(o[i.id].a_attr["class"]=f[r].a_attr["class"]+" "+o[i.id].a_attr["class"],s&&s.addClass(f[r].a_attr[u]));return!0}},n.jstree.defaults.unique={case_sensitive:!1,duplicate:function(n,t){return n+" ("+t+")"}},n.jstree.plugins.unique=function(i,r){this.check=function(t,i,u,f,e){if(r.check.call(this,t,i,u,f,e)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),u=u&&u.id?u:this.get_node(u),!u||!u.children)return!0;for(var s=t==="rename_node"?f:i.text,h=[],c=this.settings.unique.case_sensitive,l=this._model.data,o=0,a=u.children.length;o<a;o++)h.push(c?l[u.children[o]].text:l[u.children[o]].text.toLowerCase());c||(s=s.toLowerCase());switch(t){case"delete_node":return!0;case"rename_node":return o=n.inArray(s,h)===-1||i.text&&i.text[c?"toString":"toLowerCase"]()===s,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+s+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o;case"create_node":return o=n.inArray(s,h)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+s+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o;case"copy_node":return o=n.inArray(s,h)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+s+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o;case"move_node":return o=i.parent===u.id&&(!e||!e.is_multi)||n.inArray(s,h)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+s+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o}return!0};this.create_node=function(i,u,f,e,o){if(!u||u.text===t){if((i===null&&(i=n.jstree.root),i=this.get_node(i),!i)||(f=f===t?"last":f,!f.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i)))return r.create_node.call(this,i,u,f,e,o);u||(u={});var l,h,c,s,a,v=this._model.data,y=this.settings.unique.case_sensitive,p=this.settings.unique.duplicate;for(h=l=this.get_string("New node"),c=[],s=0,a=i.children.length;s<a;s++)c.push(y?v[i.children[s]].text:v[i.children[s]].text.toLowerCase());for(s=1;n.inArray(y?h:h.toLowerCase(),c)!==-1;)h=p.call(this,l,++s).toString();u.text=h}return r.create_node.call(this,i,u,f,e,o)}},e=i.createElement("DIV"),e.setAttribute("unselectable","on"),e.setAttribute("role","presentation"),e.className="jstree-wholerow",e.innerHTML="&#160;",n.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this);this.element.on("ready.jstree set_state.jstree",n.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",n.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",n.proxy(function(){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",n.proxy(function(n,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");for(var i=!1,r=0,u=t.selected.length;r<u;r++)i=this.get_node(t.selected[r],!0),i&&i.length&&i.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",n.proxy(function(n,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",n.proxy(function(n,t){n.type==="hover_node"&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")[n.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",n.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=n.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});n(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=n.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});n(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("dblclick.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=n.Event("dblclick",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});n(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",n.proxy(function(t){t.stopImmediatePropagation();var i=n.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});n(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",n.proxy(function(n){return n.stopImmediatePropagation(),this.is_disabled(n.currentTarget)||this.hover_node(n.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",n.proxy(function(n){this.dehover_node(n.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();i.teardown.call(this)};this.redraw_node=function(t){if(t=i.redraw_node.apply(this,arguments),t){var r=e.cloneNode(!0);n.inArray(t.id,this._data.core.selected)!==-1&&(r.className+=" jstree-wholerow-clicked");this._data.core.focused&&this._data.core.focused===t.id&&(r.className+=" jstree-wholerow-hovered");t.insertBefore(r,t.childNodes[0])}return t}},i.registerElement&&Object&&Object.create){a=Object.create(HTMLElement.prototype);a.createdCallback=function(){var i={core:{},plugins:[]};for(var t in n.jstree.plugins)n.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in n.jstree.defaults.core)n.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));n(this).jstree(i)};try{i.registerElement("vakata-jstree",{prototype:a})}catch(p){}}}});
/*!
 * Globalize
 *
 * http://github.com/jquery/globalize
 *
 * Copyright Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(n,t){var i,g,nt,tt,it,r,h,v,c,rt,y,f,u,p,e,l,w,b,ut,k,o,a,d,s;i=function(n){return new i.prototype.init(n)};typeof require!="undefined"&&typeof exports!="undefined"&&typeof module!="undefined"?module.exports=i:n.Globalize=i;i.cultures={};i.prototype={constructor:i,init:function(n){return this.cultures=i.cultures,this.cultureSelector=n,this}};i.prototype.init.prototype=i.prototype;i.cultures["default"]={name:"en",englishName:"English",nativeName:"English",isRTL:!1,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",NaN:"NaN",negativeInfinity:"-Infinity",positiveInfinity:"Infinity",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}},messages:{}};i.cultures["default"].calendar=i.cultures["default"].calendars.standard;i.cultures.en=i.cultures["default"];i.cultureSelector="en";g=/^0x[a-f0-9]+$/i;nt=/^[+\-]?infinity$/i;tt=/^[+\-]?\d*\.?\d*(e[+\-]?\d+)?$/;it=/^\s+|\s+$/g;r=function(n,t){if(n.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1};h=function(n,t){return n.substr(n.length-t.length)===t};v=function(){var e,u,r,i,o,s,n=arguments[0]||{},f=1,l=arguments.length,h=!1;for(typeof n=="boolean"&&(h=n,n=arguments[1]||{},f=2),typeof n=="object"||rt(n)||(n={});f<l;f++)if((e=arguments[f])!=null)for(u in e)(r=n[u],i=e[u],n!==i)&&(h&&i&&(y(i)||(o=c(i)))?(o?(o=!1,s=r&&c(r)?r:[]):s=r&&y(r)?r:{},n[u]=v(h,s,i)):i!==t&&(n[u]=i));return n};c=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};rt=function(n){return Object.prototype.toString.call(n)==="[object Function]"};y=function(n){return Object.prototype.toString.call(n)==="[object Object]"};f=function(n,t){return n.indexOf(t)===0};u=function(n){return(n+"").replace(it,"")};p=function(n){return isNaN(n)?NaN:Math[n<0?"ceil":"floor"](n)};e=function(n,t,i){for(var r=n.length;r<t;r+=1)n=i?"0"+n:n+"0";return n};l=function(n,t){for(var u,f=0,i=!1,r=0,e=n.length;r<e;r++){u=n.charAt(r);switch(u){case"'":i?t.push("'"):f++;i=!1;break;case"\\":i&&t.push("\\");i=!i;break;default:t.push(u);i=!1}}return f};w=function(n,t){t=t||"F";var i,u=n.patterns,r=t.length;if(r===1){if(i=u[t],!i)throw"Invalid date format string '"+t+"'.";t=i}else r===2&&t.charAt(0)==="%"&&(t=t.charAt(1));return t};b=function(n,t,i){function e(n,t){var i,r=n+"";return t>1&&r.length<t?(i=st[t-2]+r,i.substr(i.length-t,t)):r}function ct(){return c||ut?c:(c=ht.test(t),ut=!0,c)}function it(n,t){if(v)return v[t];switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();default:throw"Invalid part value "+t;}}var u=i.calendar,d=u.convert,r,g,rt,nt,tt,p,f,ot,h;if(!t||!t.length||t==="i")return i&&i.name.length?d?r=b(n,u.patterns.F,i):(g=new Date(n.getTime()),rt=o(n,u.eras),g.setFullYear(a(n,u,rt)),r=g.toLocaleString()):r=n.toString(),r;nt=u.eras;tt=t==="s";t=w(u,t);r=[];var s,st=["0","00","000"],c,ut,ht=/([^d]|^)(d|dd)([^d]|$)/g,ft=0,et=k(),v;for(!tt&&d&&(v=d.fromGregorian(n));;){var lt=et.lastIndex,y=et.exec(t),at=t.slice(lt,y?y.index:t.length);if(ft+=l(at,r),!y)break;if(ft%2){r.push(y[0]);continue}p=y[0];f=p.length;switch(p){case"ddd":case"dddd":ot=f===3?u.days.namesAbbr:u.days.names;r.push(ot[n.getDay()]);break;case"d":case"dd":c=!0;r.push(e(it(n,2),f));break;case"MMM":case"MMMM":h=it(n,1);r.push(u.monthsGenitive&&ct()?u.monthsGenitive[f===3?"namesAbbr":"names"][h]:u.months[f===3?"namesAbbr":"names"][h]);break;case"M":case"MM":r.push(e(it(n,1)+1,f));break;case"y":case"yy":case"yyyy":h=v?v[0]:a(n,u,o(n,nt),tt);f<4&&(h=h%100);r.push(e(h,f));break;case"h":case"hh":s=n.getHours()%12;s===0&&(s=12);r.push(e(s,f));break;case"H":case"HH":r.push(e(n.getHours(),f));break;case"m":case"mm":r.push(e(n.getMinutes(),f));break;case"s":case"ss":r.push(e(n.getSeconds(),f));break;case"t":case"tt":h=n.getHours()<12?u.AM?u.AM[0]:" ":u.PM?u.PM[0]:" ";r.push(f===1?h.charAt(0):h);break;case"f":case"ff":case"fff":r.push(e(n.getMilliseconds(),3).substr(0,f));break;case"z":case"zz":s=n.getTimezoneOffset()/60;r.push((s<=0?"+":"-")+e(Math.floor(Math.abs(s)),f));break;case"zzz":s=n.getTimezoneOffset()/60;r.push((s<=0?"+":"-")+e(Math.floor(Math.abs(s)),2)+":"+e(Math.abs(n.getTimezoneOffset()%60),2));break;case"g":case"gg":u.eras&&r.push(u.eras[o(n,nt)].name);break;case"/":r.push(u["/"]);break;default:throw"Invalid date format pattern '"+p+"'.";}}return r.join("")},function(){var n;n=function(n,t,i){var l=i.groupSizes,c=l[0],a=1,p=Math.pow(10,t),v=Math.round(n*p)/p;isFinite(v)||(v=n);n=v;var r=n+"",u="",o=r.split(/e/i),f=o.length>1?parseInt(o[1],10):0;r=o[0];o=r.split(".");r=o[0];u=o.length>1?o[1]:"";f>0?(u=e(u,f,!1),r+=u.slice(0,f),u=u.substr(f)):f<0&&(f=-f,r=e(r,f+1,!0),u=r.slice(-f,r.length)+u,r=r.slice(0,-f));u=t>0?i["."]+(u.length>t?u.slice(0,t):e(u,t)):"";for(var s=r.length-1,y=i[","],h="";s>=0;){if(c===0||c>s)return r.slice(0,s+1)+(h.length?y+h+u:u);h=r.slice(s-c+1,s+1)+(h.length?y+h:"");s-=c;a<l.length&&(c=l[a],a++)}return r.slice(0,s+1)+y+h+u};ut=function(t,i,r){var a,f,v,o,y,l;if(!isFinite(t))return t===Infinity?r.numberFormat.positiveInfinity:t===-Infinity?r.numberFormat.negativeInfinity:r.numberFormat.NaN;if(!i||i==="i")return r.name.length?t.toLocaleString():t.toString();i=i||"D";var s=r.numberFormat,u=Math.abs(t),h=-1,c;i.length>1&&(h=parseInt(i.slice(1),10));a=i.charAt(0).toUpperCase();switch(a){case"D":c="n";u=p(u);h!==-1&&(u=e(""+u,h,!0));t<0&&(u="-"+u);break;case"N":f=s;case"C":f=f||s.currency;case"P":f=f||s.percent;c=t<0?f.pattern[0]:f.pattern[1]||"n";h===-1&&(h=f.decimals);u=n(u*(a==="P"?100:1),h,f);break;default:throw"Bad number format specifier: "+a;}for(v=/n|\$|-|%/g,o="";;){if(y=v.lastIndex,l=v.exec(c),o+=c.slice(y,l?l.index:c.length),!l)break;switch(l[0]){case"n":o+=u;break;case"$":o+=s.currency.symbol;break;case"-":/[1-9]/.test(u)&&(o+=s["-"]);break;case"%":o+=s.percent.symbol}}return o}}();k=function(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g};o=function(n,t){var r,u,i,f;if(!t)return 0;for(u=n.getTime(),i=0,f=t.length;i<f;i++)if(r=t[i].start,r===null||u>=r)return i;return 0};a=function(n,t,i,r){var u=n.getFullYear();return!r&&t.eras&&(u-=t.eras[i].offset),u},function(){var e,s,h,c,n,i,t;e=function(n,t){if(t<100){var r=new Date,f=o(r),u=a(r,n,f),i=n.twoDigitYearMax;i=typeof i=="string"?(new Date).getFullYear()%100+parseInt(i,10):i;t+=u-u%100;t>i&&(t-=100)}return t};s=function(n,u,f){var e,s=n.days,o=n._upperDays;return o||(n._upperDays=o=[t(s.names),t(s.namesAbbr),t(s.namesShort)]),u=i(u),f?(e=r(o[1],u),e===-1&&(e=r(o[2],u))):e=r(o[0],u),e};h=function(n,u,f){var h=n.months,c=n.monthsGenitive||n.months,e=n._upperMonths,s=n._upperMonthsGen,o;return e||(n._upperMonths=e=[t(h.names),t(h.namesAbbr)],n._upperMonthsGen=s=[t(c.names),t(c.namesAbbr)]),u=i(u),o=r(f?e[1]:e[0],u),o<0&&(o=r(f?s[1]:s[0],u)),o};c=function(n,t){var f=n._parseRegExp,o,y,e,p,i,b,d;if(f){if(o=f[t],o)return o}else n._parseRegExp=f={};for(var s=w(n,t).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1"),r=["^"],c=[],h=0,a=0,v=k(),u;(u=v.exec(s))!==null;){if(y=s.slice(h,u.index),h=v.lastIndex,a+=l(y,r),a%2){r.push(u[0]);continue}e=u[0];p=e.length;switch(e){case"dddd":case"ddd":case"MMMM":case"MMM":case"gg":case"g":i="(\\D+)";break;case"tt":case"t":i="(\\D*)";break;case"yyyy":case"fff":case"ff":case"f":i="(\\d{"+p+"})";break;case"dd":case"d":case"MM":case"M":case"yy":case"y":case"HH":case"H":case"hh":case"h":case"mm":case"m":case"ss":case"s":i="(\\d\\d?)";break;case"zzz":i="([+-]?\\d\\d?:\\d{2})";break;case"zz":case"z":i="([+-]?\\d\\d?)";break;case"/":i="(\\/)";break;default:throw"Invalid date format pattern '"+e+"'.";}i&&r.push(i);c.push(u[0])}return l(s.slice(h),r),r.push("$"),b=r.join("").replace(/\s+/g,"\\s+"),d={regExp:b,groups:c},f[t]=d};n=function(n,t,i){return n<t||n>i};i=function(n){return n.split("").join(" ").toUpperCase()};t=function(n){for(var r=[],t=0,u=n.length;t<u;t++)r[t]=i(n[t]);return r};d=function(t,i,r){var d,wt,l,ft,et,g,nt,kt,a,dt,tt,at;t=u(t);var o=r.calendar,vt=c(o,i),yt=new RegExp(vt.regExp).exec(t);if(yt===null)return null;var pt=vt.groups,ot=null,w=null,p=null,b=null,it=null,y=0,k,st=0,ht=0,ct=0,rt=null,lt=!1;for(d=0,wt=pt.length;d<wt;d++)if(l=yt[d+1],l){var bt=pt[d],ut=bt.length,v=parseInt(l,10);switch(bt){case"dd":case"d":if(b=v,n(b,1,31))return null;break;case"MMM":case"MMMM":if(p=h(o,l,ut===3),n(p,0,11))return null;break;case"M":case"MM":if(p=v-1,n(p,0,11))return null;break;case"y":case"yy":case"yyyy":if(w=ut<4?e(o,v):v,n(w,0,9999))return null;break;case"h":case"hh":if(y=v,y===12&&(y=0),n(y,0,11))return null;break;case"H":case"HH":if(y=v,n(y,0,23))return null;break;case"m":case"mm":if(st=v,n(st,0,59))return null;break;case"s":case"ss":if(ht=v,n(ht,0,59))return null;break;case"tt":case"t":if(lt=o.PM&&(l===o.PM[0]||l===o.PM[1]||l===o.PM[2]),!lt&&(!o.AM||l!==o.AM[0]&&l!==o.AM[1]&&l!==o.AM[2]))return null;break;case"f":case"ff":case"fff":if(ct=v*Math.pow(10,3-ut),n(ct,0,999))return null;break;case"ddd":case"dddd":if(it=s(o,l,ut===3),n(it,0,6))return null;break;case"zzz":if((ft=l.split(/:/),ft.length!==2)||(k=parseInt(ft[0],10),n(k,-12,13))||(et=parseInt(ft[1],10),n(et,0,59)))return null;rt=k*60+(f(l,"-")?-et:et);break;case"z":case"zz":if(k=v,n(k,-12,13))return null;rt=k*60;break;case"g":case"gg":if(g=l,!g||!o.eras)return null;for(g=u(g.toLowerCase()),nt=0,kt=o.eras.length;nt<kt;nt++)if(g===o.eras[nt].name.toLowerCase()){ot=nt;break}if(ot===null)return null}}if(a=new Date,tt=o.convert,dt=tt?tt.fromGregorian(a)[0]:a.getFullYear(),w===null?w=dt:o.eras&&(w+=o.eras[ot||0].offset),p===null&&(p=0),b===null&&(b=1),tt){if(a=tt.toGregorian(w,p,b),a===null)return null}else if((a.setFullYear(w,p,b),a.getDate()!==b)||it!==null&&a.getDay()!==it)return null;return lt&&y<12&&(y+=12),a.setHours(y,st,ht,ct),rt!==null&&(at=a.getMinutes()-(rt+a.getTimezoneOffset()),a.setHours(a.getHours()+parseInt(at/60,10),at%60)),a}}();s=function(n,t,i){var r=t["-"],u=t["+"],e;switch(i){case"n -":r=" "+r;u=" "+u;case"n-":h(n,r)?e=["-",n.substr(0,n.length-r.length)]:h(n,u)&&(e=["+",n.substr(0,n.length-u.length)]);break;case"- n":r+=" ";u+=" ";case"-n":f(n,r)?e=["-",n.substr(r.length)]:f(n,u)&&(e=["+",n.substr(u.length)]);break;case"(n)":f(n,"(")&&h(n,")")&&(e=["-",n.substr(1,n.length-2)])}return e||["",n]};i.prototype.findClosestCulture=function(n){return i.findClosestCulture.call(this,n)};i.prototype.format=function(n,t,r){return i.format.call(this,n,t,r)};i.prototype.localize=function(n,t){return i.localize.call(this,n,t)};i.prototype.parseInt=function(n,t,r){return i.parseInt.call(this,n,t,r)};i.prototype.parseFloat=function(n,t,r){return i.parseFloat.call(this,n,t,r)};i.prototype.culture=function(n){return i.culture.call(this,n)};i.addCultureInfo=function(n,t,i){var r={},u=!1;typeof n!="string"?(i=n,n=this.culture().name,r=this.cultures[n]):typeof t!="string"?(i=t,u=this.cultures[n]==null,r=this.cultures[n]||this.cultures["default"]):(u=!0,r=this.cultures[t]);this.cultures[n]=v(!0,{},r,i);u&&(this.cultures[n].calendar=this.cultures[n].calendars.standard)};i.findClosestCulture=function(n){var r,f,h,l,y,a;if(!n)return this.findClosestCulture(this.cultureSelector)||this.cultures["default"];if(typeof n=="string"&&(n=n.split(",")),c(n)){for(var i,o=this.cultures,v=n,s=v.length,e=[],t=0;t<s;t++)n=u(v[t]),h=n.split(";"),i=u(h[0]),h.length===1?f=1:(n=u(h[1]),n.indexOf("q=")===0?(n=n.substr(2),f=parseFloat(n),f=isNaN(f)?0:f):f=1),e.push({lang:i,pri:f});for(e.sort(function(n,t){return n.pri<t.pri?1:n.pri>t.pri?-1:0}),t=0;t<s;t++)if(i=e[t].lang,r=o[i],r)return r;for(t=0;t<s;t++){i=e[t].lang;do{if(l=i.lastIndexOf("-"),l===-1)break;if(i=i.substr(0,l),r=o[i],r)return r}while(1)}for(t=0;t<s;t++){i=e[t].lang;for(y in o)if(a=o[y],a.language==i)return a}}else if(typeof n=="object")return n;return r||null};i.format=function(n,t,i){var r=this.findClosestCulture(i);return n instanceof Date?n=b(n,t,r):typeof n=="number"&&(n=ut(n,t,r)),n};i.localize=function(n,t){return this.findClosestCulture(t).messages[n]||this.cultures["default"].messages[n]};i.parseDate=function(n,t,i){var r,o,f,u,s,e;if(i=this.findClosestCulture(i),t){if(typeof t=="string"&&(t=[t]),t.length)for(u=0,s=t.length;u<s;u++)if(e=t[u],e&&(r=d(n,e,i),r))break}else{f=i.calendar.patterns;for(o in f)if(r=d(n,f[o],i),r)break}return r||null};i.parseInt=function(n,t,r){return p(i.parseFloat(n,t,r))};i.parseFloat=function(n,t,i){var y,c,l,h,p,k,w,b,d,a,it;typeof t!="number"&&(i=t,t=10);var f=this.findClosestCulture(i),v=NaN,r=f.numberFormat;if(n.indexOf(f.numberFormat.currency.symbol)>-1&&(n=n.replace(f.numberFormat.currency.symbol,""),n=n.replace(f.numberFormat.currency["."],f.numberFormat["."])),n.indexOf(f.numberFormat.percent.symbol)>-1&&(n=n.replace(f.numberFormat.percent.symbol,"")),n=n.replace(/ /g,""),nt.test(n))v=parseFloat(n);else if(!t&&g.test(n))v=parseInt(n,16);else{var u=s(n,r,r.pattern[0]),e=u[0],o=u[1];e===""&&r.pattern[0]!=="(n)"&&(u=s(n,r,"(n)"),e=u[0],o=u[1]);e===""&&r.pattern[0]!=="-n"&&(u=s(n,r,"-n"),e=u[0],o=u[1]);e=e||"+";l=o.indexOf("e");l<0&&(l=o.indexOf("E"));l<0?(c=o,y=null):(c=o.substr(0,l),y=o.substr(l+1));k=r["."];w=c.indexOf(k);w<0?(h=c,p=null):(h=c.substr(0,w),p=c.substr(w+k.length));b=r[","];h=h.split(b).join("");d=b.replace(/\u00A0/g," ");b!==d&&(h=h.split(d).join(""));a=e+h;p!==null&&(a+="."+p);y!==null&&(it=s(y,r,"-n"),a+="e"+(it[0]||"+")+it[1]);tt.test(a)&&(v=parseFloat(a))}return v};i.culture=function(n){return typeof n!="undefined"&&(this.cultureSelector=n),this.findClosestCulture(n)||this.cultures["default"]}})(this);
/*!
 * JavaScript Cookie v2.0.4
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
(function(n){if(typeof define=="function"&&define.amd)define(n);else if(typeof exports=="object")module.exports=n();else{var i=window.Cookies,t=window.Cookies=n();t.noConflict=function(){return window.Cookies=i,t}}})(function(){function n(){for(var n=0,r={},t,i;n<arguments.length;n++){t=arguments[n];for(i in t)r[i]=t[i]}return r}function t(i){function r(t,u,f){var o,s;if(arguments.length>1){f=n({path:"/"},r.defaults,f);typeof f.expires=="number"&&(s=new Date,s.setMilliseconds(s.getMilliseconds()+f.expires*864e5),f.expires=s);try{o=JSON.stringify(u);/^[\{\[]/.test(o)&&(u=o)}catch(y){}return u=encodeURIComponent(String(u)),u=u.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",u,f.expires&&"; expires="+f.expires.toUTCString(),f.path&&"; path="+f.path,f.domain&&"; domain="+f.domain,f.secure?"; secure":""].join("")}t||(o={});for(var l=document.cookie?document.cookie.split("; "):[],a=/(%[0-9A-Z]{2})+/g,h=0;h<l.length;h++){var v=l[h].split("="),c=v[0].replace(a,decodeURIComponent),e=v.slice(1).join("=");e.charAt(0)==='"'&&(e=e.slice(1,-1));try{if(e=i&&i(e,c)||e.replace(a,decodeURIComponent),this.json)try{e=JSON.parse(e)}catch(y){}if(t===c){o=e;break}t||(o[c]=e)}catch(y){}}return o}return r.get=r.set=r,r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,i){r(t,"",n(i,{expires:-1}))},r.withConverter=t,r}return t()});
/**
 * @license jQuery paging plugin v1.1.0 02/05/2013
 * http://www.xarg.org/2011/09/jquery-pagination-revised/
 *
 * Copyright (c) 2011, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * 
 * [2015-11-05] Changed how onFormat and onSelect callbacks are invoked. Instead of passing data that is accessible using 'this',
 *              the data was passed as a parameter. This was required to avoid conflicts with how TypeScript uses 'this'.
 **/
(function(n,t,i){n.fn.paging=function(r,u){var f=this,e={setOptions:function(r){function u(n){for(var s=0,u=0,e=1,r={fstack:[],asterisk:0,inactive:0,blockwide:5,current:3,rights:0,lefts:0},t,h=/[*<>pq\[\]().-]|[nc]+!?/g,o={"[":"first","]":"last","<":"prev",">":"next",q:"left",p:"right","-":"fill",".":"leap"},f={};t=h.exec(n);)t=String(t),i===o[t]?"("===t?u=++s:")"===t?u=0:e&&("*"===t?(r.asterisk=1,r.inactive=0):(r.asterisk=0,r.inactive="!"===t.charAt(t.length-1),r.blockwide=t.length-r.inactive,(r.current=1+t.indexOf("c"))||(r.current=1+r.blockwide>>1)),r.fstack[r.fstack.length]={ftype:"block",fgroup:0,fpos:0},e=0):(r.fstack[r.fstack.length]={ftype:o[t],fgroup:u,fpos:i===f[t]?f[t]=1:++f[t]},"q"===t?++r.lefts:"p"===t&&++r.rights);return r}return this.opts=n.extend(this.opts||{lapping:0,perpage:10,page:1,refresh:{interval:10,url:null},format:"",onLock:null,onFormat:function(){},onSelect:function(){return!0},onRefresh:function(){}},r||{}),this.opts.lapping|=0,this.opts.perpage|=0,this.opts.page!==null&&(this.opts.page|=0),this.opts.perpage<1&&(this.opts.perpage=10),this.interval&&t.clearInterval(this.interval),this.opts.refresh.url&&(this.interval=t.setInterval(function(t){n.ajax({url:t.opts.refresh.url,success:function(i){if(typeof i=="string")try{i=n.parseJSON(i)}catch(t){return}t.opts.onRefresh(i)}})},1e3*this.opts.refresh.interval,this)),this.format=u(this.opts.format),this},setNumber:function(n){return this.number=i===n||n<0?-1:n,this},setPage:function(r){function k(n,t,i){i=String(n.onFormat.call(f,t,i));w+=t.value?i.replace(/<a/i,'<a data-page="'+t.value+'"'):i}if(i===r){if(r=this.opts.page,null===r)return this}else if(this.opts.page==r)return this;if(this.opts.page=r|=0,null!==this.opts.onLock)return this.opts.onLock.call(null,r),this;var v=this.number,l=this.opts,a,y,o,w,d=1,s=this.format,u,h,c,p,g=s.fstack.length,b=g;for(l.perpage<=l.lapping&&(l.lapping=l.perpage-1),p=v<=l.lapping?0:l.lapping|0,v<0?(v=-1,o=-1,a=Math.max(1,r-s.current+1-p),y=a+s.blockwide):(o=1+Math.ceil((v-l.perpage)/(l.perpage-p)),r=Math.max(1,Math.min(r<0?1+o+r:r,o)),s.asterisk?(a=1,y=1+o,s.current=r,s.blockwide=o):(a=Math.max(1,Math.min(r-s.current,o-s.blockwide)+1),y=s.inactive?a+s.blockwide:Math.min(a+s.blockwide,1+o)));b--;){h=0;c=s.fstack[b];switch(c.ftype){case"left":h=c.fpos<a;break;case"right":h=y<=o-s.rights+c.fpos;break;case"first":h=s.current<r;break;case"last":h=s.blockwide<s.current+o-r;break;case"prev":h=1<r;break;case"next":h=r<o}d|=h<<c.fgroup}for(u={number:v,lapping:p,pages:o,perpage:l.perpage,page:r,slice:[(h=r*(l.perpage-p)+p)-l.perpage,Math.min(h,v)]},w="";++b<g;){c=s.fstack[b];h=d>>c.fgroup&1;switch(c.ftype){case"block":for(;a<y;++a)u.value=a,u.pos=1+s.blockwide-y+a,u.active=a<=o||v<0,u.first=1===a,u.last=a==o&&0<v,k(l,u,c.ftype);continue;case"left":u.value=c.fpos;u.active=c.fpos<a;break;case"right":u.value=o-s.rights+c.fpos;u.active=y<=u.value;break;case"first":u.value=1;u.active=h&&1<r;break;case"prev":u.value=Math.max(1,r-1);u.active=h&&1<r;break;case"last":(u.active=v<0)?u.value=1+r:(u.value=o,u.active=h&&r<o);break;case"next":(u.active=v<0)?u.value=1+r:(u.value=Math.min(1+r,o),u.active=h&&r<o);break;case"leap":case"fill":u.pos=c.fpos;u.active=h;k(l,u,c.ftype);continue}u.pos=c.fpos;u.last=u.first=i;k(l,u,c.ftype)}return f.length&&(n("a",f.html(w)).click(function(i){i.preventDefault();var r=this;do if("a"===r.nodeName.toLowerCase())break;while(r=r.parentNode);e.setPage(n(r).data("page"));e.locate&&(t.location=r.href)}),this.locate=l.onSelect.call(f,{number:v,lapping:p,pages:o,slice:u.slice},r)),this}};return e.setNumber(r).setOptions(u).setPage()}})(jQuery,this),function(n){var t=0;n.fn.splitter=function(r){return r=r||{},this.each(function(){function y(n){f.removeClass(u.barStateClasses).addClass(n)}function d(t){if(t.which==1){f.removeClass(u.barHoverClass);u.outline&&(v=v||f.clone(!1).insertAfter(o),f.removeClass(u.barDockedClass));y(u.barActiveClass);c.css("-webkit-user-select","none").find("iframe").addClass(u.iframeClass);o._posSplit=o[0][u.pxSplit]-t[u.eventPos];n(document).on("mousemove"+u.eventNamespace,g).on("mouseup"+u.eventNamespace,nt)}}function g(n){var t=o._posSplit+n[u.eventPos],r=Math.max(0,Math.min(t,e._DA-f._DA)),i=Math.max(o._min,e._DA-s._max,Math.min(t,o._max,e._DA-f._DA-s._min));u.outline?(u.dockPane==o&&t<Math.max(o._min,f._DA)||u.dockPane==s&&t>Math.min(t,o._max,e._DA-f._DA-s._min)?f.addClass(u.barDockedClass).css(u.origin,r):f.removeClass(u.barDockedClass).css(u.origin,i),f._DA=f[0][u.pxSplit]):l(t);y(t==i?u.barActiveClass:u.barLimitClass)}function nt(t){y(u.barNormalClass);f.addClass(u.barHoverClass);var i=o._posSplit+t[u.eventPos];u.outline&&(v.remove(),v=null,l(i));c.css("-webkit-user-select","text").find("iframe").removeClass(u.iframeClass);n(document).off("mousemove"+u.eventNamespace+" mouseup"+u.eventNamespace)}function l(n){for(f._DA=f[0][u.pxSplit],u.dockPane==o&&n<Math.max(o._min,f._DA)||u.dockPane==s&&n>Math.min(n,o._max,e._DA-f._DA-s._min)?(f.addClass(u.barDockedClass),f._DA=f[0][u.pxSplit],n=u.dockPane==o?0:e._DA-f._DA,f._pos==null&&(f._pos=o[0][u.pxSplit])):(f.removeClass(u.barDockedClass),f._DA=f[0][u.pxSplit],f._pos=null,n=Math.max(o._min,e._DA-s._max,Math.min(n,o._max,e._DA-f._DA-s._min))),f.css(u.origin,n).css(u.fixed,e._DF),o.css(u.origin,0).css(u.split,n).css(u.fixed,e._DF),s.css(u.origin,n+f._DA).css(u.split,e._DA-f._DA-n).css(u.fixed,e._DF),i=0;i<=t;i++)c.trigger("resize"+k+i)}function h(n){for(var i=0,t=1;t<arguments.length;t++)i+=Math.max(parseInt(n.css(arguments[t]),10)||0,0);return i}var v,p,f,a,w;if(!n(this).is(".splitter")){var b=(r.splitHorizontal?"h":r.splitVertical?"v":r.type)||"v",k=".splitter",u=n.extend({splitterClass:"splitter gsp-ui-widget gsp-ui-widget-content",paneClass:"splitter-pane",barClass:"splitter-bar",barNormalClass:"gsp-ui-state-default",barHoverClass:"gsp-ui-state-hover",barActiveClass:"gsp-ui-state-highlight",barLimitClass:"gsp-ui-state-error",iframeClass:"splitter-iframe-hide",eventNamespace:k+ ++t,pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,cursor:"e-resize",barStateClass:"splitter-bar-vertical",barDockedClass:"splitter-bar-vertical-docked"},h:{keyTop:40,keyBottom:38,cursor:"n-resize",barStateClass:"splitter-bar-horizontal",barDockedClass:"splitter-bar-horizontal-docked"}}[b],r,{v:{type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[b]);u.barStateClasses=[u.barNormalClass,u.barHoverClass,u.barActiveClass,u.barLimitClass].join(" ");var e=n(this).css({position:"relative"}).addClass(u.splitterClass),c=n(">*",e[0]).addClass(u.paneClass).css({position:"absolute","z-index":"1","-moz-outline-style":"none"}),o=n(c[0]),s=n(c[1]);if(u.dockPane=u.dock&&(/right|bottom/.test(u.dock)?s:o),p=n('<a href="javascript:void(0)"><\/a>').attr({accessKey:u.accessKey,tabIndex:u.tabIndex,title:u.splitbarClass}).on("focus"+u.eventNamespace,function(){this.focus();f.addClass(u.barActiveClass)}).on("keydown"+u.eventNamespace,function(n){var t=n.which||n.keyCode,i=t==u["key"+u.side1]?1:t==u["key"+u.side2]?-1:0;i&&l(o[0][u.pxSplit]+i*u.pxPerKey,!1)}).on("blur"+u.eventNamespace,function(){f.removeClass(u.barActiveClass)}),f=n("<div><\/div>").insertAfter(o).addClass(u.barClass).addClass(u.barStateClass).append(p).attr({unselectable:"on"}).css({position:"absolute","user-select":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","z-index":"2"}).on("mousedown"+u.eventNamespace,d).on("mouseover"+u.eventNamespace,function(){n(this).addClass(u.barHoverClass)}).on("mouseout"+u.eventNamespace,function(){n(this).removeClass(u.barHoverClass)}),/^(auto|default|)$/.test(f.css("cursor"))&&f.css("cursor",u.cursor),f._DA=f[0][u.pxSplit],e._PBF=h(e,"border"+u.side3+"Width","border"+u.side4+"Width"),e._PBA=h(e,"border"+u.side1+"Width","border"+u.side2+"Width"),o._pane=u.side1,s._pane=u.side2,n.each([o,s],function(){this._splitter_style=this.style;this._min=u["min"+this._pane]||h(this,"min-"+u.split);this._max=u["max"+this._pane]||h(this,"max-"+u.split)||9999;this._init=u["size"+this._pane]===!0?parseInt(n.css(this[0],u.split),10):u["size"+this._pane]}),a=o._init,isNaN(s._init)||(a=e[0][u.pxSplit]-e._PBA-s._init-f._DA),u.cookie){Gs.Vars.Cookies||alert("jQuery.splitter(): jQuery cookie plugin required");w=parseInt(Gs.Vars.Cookies.get(u.cookie),10);isNaN(w)||(a=w);n(window).on("unload"+u.eventNamespace,function(){var n=String(f.css(u.origin));Gs.Vars.Cookies.set(u.cookie,n,{expires:u.cookieExpires||365,path:u.cookiePath||document.location.pathname})})}if(isNaN(a)&&(a=Math.round((e[0][u.pxSplit]-e._PBA-f._DA)/2)),u.anchorToWindow&&(u.resizeTo=window),u.resizeTo)e._hadjust=h(e,"borderTopWidth","borderBottomWidth","marginBottom","paddingBottom"),e._hadjust+=h(n("body"),"paddingBottom"),e._hadjust+=h(n("html"),"paddingBottom"),e._hadjust+=1,e._hmin=Math.max(h(e,"minHeight"),20),n(window).on("resize"+u.eventNamespace,function(t){if(t.target==window){var i=e.offset().top,r=n(u.resizeTo).height();e.css("height",Math.max(r-i-e._hadjust-0,e._hmin)+"px");e.trigger("resize"+u.eventNamespace)}}).trigger("resize"+u.eventNamespace);else if(u.resizeToWidth)n(window).on("resize"+u.eventNamespace,function(n){n.target==window&&e.trigger("resize"+u.eventNamespace)});if(u.dock){e.on("toggleDock"+u.eventNamespace,function(){var n=u.dockPane[0][u.pxSplit];e.trigger(n?"dock"+u.eventNamespace:"undock"+u.eventNamespace)}).on("dock"+u.eventNamespace,function(){var t=o[0][u.pxSplit],n;t&&(f._pos=t,n={},n[u.origin]=u.dockPane==o?0:e[0][u.pxSplit]-e._PBA-f[0][u.pxSplit],f.animate(n,u.dockSpeed||1,u.dockEasing,function(){f.addClass(u.barDockedClass);l(n[u.origin])}))}).on("undock"+u.eventNamespace,function(){var t=u.dockPane[0][u.pxSplit],n;t||(n={},n[u.origin]=f._pos+"px",f.removeClass(u.barDockedClass).animate(n,u.undockSpeed||u.dockSpeed||1,u.undockEasing||u.dockEasing,function(){l(f._pos);f._pos=null}))});if(u.dockKey)n('<a title="'+u.splitbarClass+' toggle dock" href="javascript:void(0)"><\/a>').attr({accessKey:u.dockKey,tabIndex:-1}).appendTo(f).on("focus",function(){e.trigger("toggleDock"+u.eventNamespace);this.blur()});f.on("dblclick",function(){e.trigger("toggleDock"+u.eventNamespace)})}e.on("destroy"+u.eventNamespace,function(){n([window,document]).off(u.eventNamespace);f.off().remove();c.removeClass(u.paneClass);e.removeClass(u.splitterClass).add(c).off(u.eventNamespace).attr("style",function(){return this._splitter_style||""});e=f=p=c=o=s=u=r=null}).on("resize"+u.eventNamespace,function(n,t){n.target==this&&((e._DF=e[0][u.pxFixed]-e._PBF,e._DA=e[0][u.pxSplit]-e._PBA,e._DF<=0||e._DA<=0)||(l(isNaN(t)?(u.sizeRight||u.sizeBottom)?e._DA-s[0][u.pxSplit]-f._DA:o[0][u.pxSplit]:t),y(u.barNormalClass)))}).trigger("resize"+u.eventNamespace,[a])}})}}(jQuery),function(n){n.fn.autoSuggest=function(t,i){var s={asHtmlID:!1,startText:"Enter Name Here",emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",retrieveLimit:!1,extraParams:"",matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,neverSubmit:!1,selectionLimit:!1,showResultList:!0,start:function(){},selectionClick:function(){},selectionAdded:function(){},selectionRemoved:function(n){n.remove()},formatList:!1,beforeRetrieve:function(n){return n},retrieveComplete:function(n){return n},resultClick:function(){},resultsComplete:function(){}},r=n.extend(s,i),f="object",u=0,e,o;if(typeof t=="string")f="string",e=t;else{o=t;for(k in t)t.hasOwnProperty(k)&&u++}if(f=="object"&&u>0||f=="string")return this.each(function(t){function ft(){var t,c;if(lastKeyPressCode==46||lastKeyPressCode>8&&lastKeyPressCode<32)return i.hide();(t=s.val().replace(/[\\]+|[\/]+/g,""),t.length>0&&t==nt)||(nt=t,t.length>=r.minChars?(h.addClass("loading"),f=="string"?(c="",r.retrieveLimit&&(c="&limit="+encodeURIComponent(r.retrieveLimit)),r.beforeRetrieve&&(t=r.beforeRetrieve.call(this,t)),n.getJSON(e+"?"+r.queryParam+"="+encodeURIComponent(t)+c+r.extraParams,function(n){u=0;var i=r.retrieveComplete.call(this,n);for(k in i)i.hasOwnProperty(k)&&u++;st(i,t)})):(r.beforeRetrieve&&(t=r.beforeRetrieve.call(this,t)),st(o,t))):(h.removeClass("loading"),i.hide()))}function st(t,f){var y,w,o,k,e,d,b,g,a,l,rt;for(r.matchCase||(f=f.toLowerCase()),y=0,i.html(p.html("")).hide(),w=0;w<u;w++){if(o=w,et++,k=!1,r.searchObjProps=="value")e=t[o].value;else for(e="",d=r.searchObjProps.split(","),b=0;b<d.length;b++)g=n.trim(d[b]),e=e+t[o][g]+" ";if(e){r.matchCase||(e=e.toLowerCase());var ut=e.search(f)>=0,ft=t[o][r.selectedValuesProp],ot=new RegExp(",\\s*"+ft+","),st=c.val().search(ot)>=0;ut&&!st&&(k=!0)}if(k&&(a=n('<li class="as-result-item" id="as-result-item-'+o+'"><\/li>').click(function(){var t=n(this).data("data"),u=t.num,f;n("#as-selection-"+u,h).length<=0&&!tt&&(f=t.attributes,s.val("").focus(),nt="",it(f,u),r.resultClick.call(this,t),i.hide());tt=!1}).mousedown(function(){v=!1}).mouseover(function(){n("li",p).removeClass("active");n(this).addClass("active")}).data("data",{attributes:t[o],num:et}),l=n.extend({},t[o]),rt=r.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+f+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+f+")(?![^<>]*>)(?![^&;]+;)","gi"),r.resultsHighlight&&f.length>0&&(l[r.selectedItemProp]=l[r.selectedItemProp].replace(rt,"<em>$1<\/em>")),a=r.formatList?r.formatList.call(this,l,a):a.html(l[r.selectedItemProp]),p.append(a),delete l,y++,r.retrieveLimit&&r.retrieveLimit==y))break}h.removeClass("loading");y<=0&&p.html('<li class="as-message">'+r.emptyText+"<\/li>");p.css("width",h.outerWidth());i.show();r.resultsComplete.call(this)}function it(t,i){c.val()===""&&c.val(",");c.val(c.val()+t[r.selectedValuesProp]+",");var u=n('<li class="as-selection-item" id="as-selection-'+i+'"><\/li>').click(function(){r.selectionClick.call(this,n(this));h.children().removeClass("selected");n(this).addClass("selected")}).mousedown(function(){v=!1}),f=n('<a class="as-close">&times;<\/a>').click(function(){return c.val(c.val().replace(","+t[r.selectedValuesProp]+",",",")),r.selectionRemoved.call(this,u),v=!0,s.focus(),!1});y.before(u.html(t[r.selectedItemProp]).prepend(f));r.selectionAdded.call(this,y.prev())}function ht(t){var r,f,u;n(":visible",i).length>0&&(r=n("li",i),f=t=="down"?r.eq(0):r.filter(":last"),u=n("li.active:first",i),u.length>0&&(f=t=="down"?u.next():u.prev()),r.removeClass("active"),f.addClass("active"))}var rt,s,v,d,ut,g,l,b,ot,et;r.asHtmlID?(t=r.asHtmlID,rt=t):(t=t+""+Math.floor(Math.random()*100),rt="as-input-"+t);r.start.call(this);s=n(this);s.attr("autocomplete","off").addClass("as-input").attr("id",rt).val(r.startText);v=!1;s.wrap('<ul class="as-selections" id="as-selections-'+t+'"><\/ul>').wrap('<li class="as-original" id="as-original-'+t+'"><\/li>');var h=n("#as-selections-"+t),y=n("#as-original-"+t),i=n('<div class="as-results" id="as-results-'+t+'"><\/div>').hide(),p=n('<ul class="as-list"><\/ul>'),c=n('<input type="hidden" class="as-values" name="as_values_'+t+'" id="as-values-'+t+'" />'),a="";if(typeof r.preFill=="string"){for(d=r.preFill.split(","),l=0;l<d.length;l++)ut={},ut[r.selectedValuesProp]=d[l],d[l]!=""&&it(ut,"000"+l);a=r.preFill}else{a="";g=0;for(k in r.preFill)r.preFill.hasOwnProperty(k)&&g++;if(g>0)for(l=0;l<g;l++)b=r.preFill[l][r.selectedValuesProp],b==undefined&&(b=""),a=a+b+",",b!=""&&it(r.preFill[l],"000"+l)}a!=""&&(s.val(""),ot=a.substring(a.length-1),ot!=","&&(a=a+","),c.val(","+a),n("li.as-selection-item",h).addClass("blur").removeClass("selected"));s.after(c);h.click(function(){v=!0;s.focus()}).mousedown(function(){v=!1}).after(i);var w=null,nt="",tt=!1;s.focus(function(){return n(this).val()==r.startText&&c.val()==""?n(this).val(""):v&&(n("li.as-selection-item",h).removeClass("blur"),n(this).val()!=""&&(p.css("width",h.outerWidth()),i.show())),v=!0,r.minChars===0&&(lastKeyPressCode=0,ft()),!0}).blur(function(){v&&(n("li.as-selection-item",h).addClass("blur").removeClass("selected"),i.hide());n(this).val(r.startText)}).keydown(function(t){var f,e,u,o,l;lastKeyPressCode=t.keyCode;first_focus=!1;switch(t.keyCode){case 38:t.preventDefault();ht("up");break;case 40:t.preventDefault();ht("down");break;case 8:s.val()==""&&(f=c.val().split(","),f=f[f.length-2],h.children().not(y.prev()).removeClass("selected"),y.prev().hasClass("selected")?(c.val(c.val().replace(","+f+",",",")),r.selectionRemoved.call(this,y.prev())):(r.selectionClick.call(this,y.prev()),y.prev().addClass("selected")));s.val().length==1&&(i.hide(),nt="");n(":visible",i).length>0&&(w&&clearTimeout(w),w=setTimeout(function(){ft()},r.keyDelay));break;case 9:case 188:case 13:e=n("li.active:first",i);e.length>0?(tt=!1,e.click().removeClass("active"),(r.neverSubmit||e.length>0)&&t.preventDefault()):(tt=!0,u=s.val().replace(/(,)/g,""),u!=""&&c.val().search(","+u+",")<0&&u.length>=r.minChars&&(t.preventDefault(),o={},o[r.selectedItemProp]=u,o[r.selectedValuesProp]=u,l=n("li",h).length,it(o,"00"+(l+1)),s.val("")));i.hide();break;case 27:i.hide();s.val("");break;default:r.showResultList&&(r.selectionLimit&&n("li.as-selection-item",h).length>=r.selectionLimit?(p.html('<li class="as-message">'+r.limitText+"<\/li>"),i.show()):(w&&clearTimeout(w),w=setTimeout(function(){ft()},r.keyDelay)))}});et=0})}}(jQuery),function(n){n.widget("ui.menubar",{version:"@VERSION",options:{autoExpand:!1,buttons:!1,items:"li",menuElement:"ul",menuIcon:!1,position:{my:"left top",at:"left bottom"}},_create:function(){var t=this;this.menuItems=this.element.children(this.options.items);this.items=this.menuItems.children("button, a");this.menuItems.addClass("ui-menubar-item").attr("role","presentation");this.items.slice(1).attr("tabIndex",-1);this.element.addClass("ui-menubar ui-widget-header ui-helper-clearfix").attr("role","menubar");this._focusable(this.items);this._hoverable(this.items);this.items.siblings(this.options.menuElement).menu({position:{within:this.options.position.within},select:function(i,r){r.item.parents("ul.ui-menu:last").hide();t._close();n(i.target).prev().focus();t._trigger("select",i,r)},menus:t.options.menuElement}).hide().attr({"aria-hidden":"true","aria-expanded":"false"}).bind("keydown.menubar",function(i){var r=n(this);if(!r.is(":hidden"))switch(i.keyCode){case n.ui.keyCode.LEFT:t.previous(i);i.preventDefault();break;case n.ui.keyCode.RIGHT:t.next(i);i.preventDefault()}});this.items.each(function(){var i=n(this),r=i.next(t.options.menuElement),u;r.length?(u="focus.menubar mouseenter.menubar"+(t.options.autoExpand?"":" click.menubar"),i.bind(u,function(n){if(n.type!=="focus"||n.originalEvent){if(n.preventDefault(),n.type==="click"&&r.is(":visible")&&t.active&&t.active[0]===r[0]){t._close();return}(t.open&&n.type==="mouseenter"||n.type==="click"||t.options.autoExpand)&&(t.options.autoExpand&&clearTimeout(t.closeTimer),t.options.autoExpand?t.openTimer=window.setTimeout(function(){t._open(n,r)},200):t._open(n,r))}}).bind("keydown",function(i){switch(i.keyCode){case n.ui.keyCode.SPACE:case n.ui.keyCode.UP:case n.ui.keyCode.DOWN:t._open(i,n(this).next());i.preventDefault();break;case n.ui.keyCode.LEFT:t.previous(i);i.preventDefault();break;case n.ui.keyCode.RIGHT:t.next(i);i.preventDefault()}}).attr("aria-haspopup","true"),t.options.menuIcon&&(i.addClass("ui-state-default").append("<span class='ui-button-icon-secondary ui-icon ui-icon-triangle-1-s'><\/span>"),i.removeClass("ui-button-text-only").addClass("ui-button-text-icon-secondary"))):i.bind("click.menubar mouseenter.menubar",function(n){(t.open&&n.type==="mouseenter"||n.type==="click")&&t._close()});i.addClass("ui-button ui-widget ui-button-text-only ui-menubar-link").attr("role","menuitem").wrapInner("<span class='ui-button-text'><\/span>");t.options.buttons&&i.removeClass("ui-menubar-link").addClass("ui-state-default")});t._on({keydown:function(i){if(i.keyCode===n.ui.keyCode.ESCAPE&&t.active&&t.active.menu("collapse",i)!==!0){var r=t.active;t.active.blur();t._close(i);r.prev().focus()}},focusin:function(){clearTimeout(t.closeTimer)},focusout:function(n){clearTimeout(t.openTimer);t.closeTimer=setTimeout(function(){t._close(n)},150)},"mouseleave .ui-menubar-item":function(n){t.options.autoExpand&&(clearTimeout(t.openTimer),t.closeTimer=setTimeout(function(){t._close(n)},150))},"mouseenter .ui-menubar-item":function(){clearTimeout(t.closeTimer)}});this.openSubmenus=0},_destroy:function(){this.menuItems.removeClass("ui-menubar-item").removeAttr("role");this.element.removeClass("ui-menubar ui-widget-header ui-helper-clearfix").removeAttr("role").unbind(".menubar");this.items.unbind(".menubar").removeClass("ui-button ui-widget ui-button-text-only ui-menubar-link ui-state-default").removeAttr("role").removeAttr("aria-haspopup").children("span.ui-button-text").each(function(){var t=n(this);t.parent().html(t.html())}).end().children(".ui-icon").remove();this.element.find(":ui-menu").menu("destroy").show().removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("tabindex").unbind(".menubar")},_close:function(){this.active&&this.active.length&&(this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"}),this.active.prev().removeClass("ui-state-active").removeAttr("tabIndex"),this.active=null,this.open=!1,this.openSubmenus=0)},_open:function(t,i){if(!this.active||this.active[0]!==i[0]){this.active&&(this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"}),this.active.prev().removeClass("ui-state-active"));var r=i.prev().addClass("ui-state-active").attr("tabIndex",-1);this.active=i.slideDown(200).position(n.extend({of:r},this.options.position)).removeAttr("aria-hidden").attr("aria-expanded","true").menu("focus",t,i.children(".ui-menu-item").first()).focus().focusin();this.open=!0}},next:function(n){if(this.open&&this.active.data("menu").active.has(".ui-menu").length){this.openSubmenus++;return}this.openSubmenus=0;this._move("next","first",n)},previous:function(n){if(this.open&&this.openSubmenus){this.openSubmenus--;return}this.openSubmenus=0;this._move("prev","last",n)},_move:function(t,i,r){var u,f;this.open?(u=this.active.closest(".ui-menubar-item")[t+"All"](this.options.items).first().children(".ui-menu").eq(0),f=this.menuItems[i]().children(".ui-menu").eq(0)):r?(u=n(r.target).closest(".ui-menubar-item")[t+"All"](this.options.items).children(".ui-menubar-link").eq(0),f=this.menuItems[i]().children(".ui-menubar-link").eq(0)):u=f=this.menuItems.children("a").eq(0);u.length?this.open?this._open(r,u):u.removeAttr("tabIndex")[0].focus():this.open?this._open(r,f):f.removeAttr("tabIndex")[0].focus()}})}(jQuery),function(n){function t(n){var u=n.originalEvent.changedTouches,t=u[0],i="",r;switch(n.type){case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}r=document.createEvent("MouseEvent");r.initMouseEvent(i,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null);t.target.dispatchEvent(r);n.preventDefault()}n.fn.rateit=function(i,r){var u={},e="init",o=function(n){return n.charAt(0).toUpperCase()+n.substr(1)},f;if(this.length==0)return this;if(f=n.type(i),f=="object"||i===undefined||i==null)u=n.extend({},n.fn.rateit.defaults,i);else{if(f=="string"&&r===undefined)return this.data("rateit"+o(i));f=="string"&&(e="setvalue")}return this.each(function(){var h=n(this),f=function(n){return arguments[0]="rateit"+o(n),h.data.apply(h,arguments)},a,s,c,v,y,l,p;if(h.hasClass("rateit")||h.addClass("rateit"),a=h.css("direction")!="rtl",e=="setvalue"){if(!f("init"))throw"Can't set value before init";i!="readonly"||f("readonly")||(h.find(".rateit-range").off(),f("wired",!1));i=="value"&&r==null&&(r=f("min"));f("backingfld")&&(s=n(f("backingfld")),i=="value"&&s.val(r),i=="min"&&s[0].min&&(s[0].min=r),i=="max"&&s[0].max&&(s[0].max=r),i=="step"&&s[0].step&&(s[0].step=r));f(i,r)}if(f("init")||(f("min",f("min")||u.min),f("max",f("max")||u.max),f("step",f("step")||u.step),f("readonly",f("readonly")!==undefined?f("readonly"):u.readonly),f("resetable",f("resetable")!==undefined?f("resetable"):u.resetable),f("backingfld",f("backingfld")||u.backingfld),f("starwidth",f("starwidth")||u.starwidth),f("starheight",f("starheight")||u.starheight),f("value",f("value")||u.value||u.min),f("ispreset",f("ispreset")!==undefined?f("ispreset"):u.ispreset),f("backingfld")&&(s=n(f("backingfld")),f("value",s.hide().val()),(s.attr("disabled")||s.attr("readonly"))&&f("readonly",!0),s[0].nodeName=="INPUT"&&(s[0].type=="range"||s[0].type=="text")&&(f("min",parseInt(s.attr("min"))||f("min")),f("max",parseInt(s.attr("max"))||f("max")),f("step",parseInt(s.attr("step"))||f("step"))),s[0].nodeName=="SELECT"&&s[0].options.length>1&&(f("min",Number(s[0].options[0].value)),f("max",Number(s[0].options[s[0].length-1].value)),f("step",Number(s[0].options[1].value)-Number(s[0].options[0].value)))),h.append('<div class="rateit-reset"><\/div><div class="rateit-range"><div class="rateit-selected" style="height:'+f("starheight")+'px"><\/div><div class="rateit-hover" style="height:'+f("starheight")+'px"><\/div><\/div>'),a||(h.find(".rateit-reset").css("float","right"),h.find(".rateit-selected").addClass("rateit-selected-rtl"),h.find(".rateit-hover").addClass("rateit-hover-rtl")),f("init",!0)),c=h.find(".rateit-range"),c.width(f("starwidth")*(f("max")-f("min"))).height(f("starheight")),v="rateit-preset"+(a?"":"-rtl"),f("ispreset")?h.find(".rateit-selected").addClass(v):h.find(".rateit-selected").removeClass(v),f("value")!=null&&(y=(f("value")-f("min"))*f("starwidth"),h.find(".rateit-selected").width(y)),l=h.find(".rateit-reset"),l.data("wired")!==!0&&l.click(function(){f("value",f("min"));c.find(".rateit-hover").hide().width(0);c.find(".rateit-selected").width(0).show();f("backingfld")&&n(f("backingfld")).val(f("min"));h.trigger("reset")}).data("wired",!0),p=function(t,i){var u=i.changedTouches?i.changedTouches[0].pageX:i.pageX,r=u-n(t).offset().left;return a||(r=c.width()-r),r>c.width()&&(r=c.width()),r<0&&(r=0),y=Math.ceil(r/f("starwidth")*(1/f("step")))},f("readonly"))l.hide();else{if(f("resetable")||l.hide(),!f("wired")){c.on("touchmove touchend",t);c.mousemove(function(n){var r=p(this,n),t=r*f("starwidth")*f("step"),u=c.find(".rateit-hover"),i;u.data("width")!=t&&(c.find(".rateit-selected").hide(),u.width(t).show().data("width",t),i=[r*f("step")+f("min")],h.trigger("hover",i).trigger("over",i))});c.mouseleave(function(){c.find(".rateit-hover").hide().width(0).data("width","");h.trigger("hover",[null]).trigger("over",[null]);c.find(".rateit-selected").show()});c.mouseup(function(t){var r=p(this,t),i=r*f("step")+f("min");f("value",i);f("backingfld")&&n(f("backingfld")).val(i);f("ispreset")&&(c.find(".rateit-selected").removeClass(v),f("ispreset",!1));c.find(".rateit-hover").hide();c.find(".rateit-selected").width(r*f("starwidth")*f("step")).show();h.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[i])});f("wired",!0)}f("resetable")&&l.show()}})};n.fn.rateit.defaults={min:0,max:5,step:.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1}}(jQuery),function(n){n.supersized=function(t){if(t==="getApi")return api;var i=this;i.init=function(){n.supersized.vars=n.extend(n.supersized.vars,n.supersized.themeVars);n.supersized.vars.options=n.extend({},n.supersized.defaultOptions,n.supersized.themeOptions,t);i.options=n.supersized.vars.options;i._build()};i._build=function(){var t=0,o="",r="",u,f="",e,s;for(n("body").children(":visible").hide().addClass("supersized_hidden"),n("body").append(n(n.supersized.vars.options.html_template),'<div id="supersized-loader"><\/div><ul id="supersized"><\/ul>'),s="#supersized",i.$el=n(s),i.el=s,vars=n.supersized.vars,vars.$container=i.$el,i.$el.data("supersized",i),api=i.$el.data("supersized");t<=i.options.slides.length-1;){switch(i.options.slide_links){case"num":u=t;break;case"name":u=i.options.slides[t].title;break;case"blank":u=""}o=o+'<li class="slide-'+t+'"><\/li>';t==i.options.start_slide-1?(i.options.slide_links&&(r=r+'<li class="slide-link-'+t+' current-slide"><a>'+u+"<\/a><\/li>"),i.options.thumb_links&&(e=i.options.slides[t].thumb?i.options.slides[t].thumb:i.options.slides[t].image,f=f+'<li class="thumb'+t+' current-thumb"><img src="'+e+'"/><\/li>')):(i.options.slide_links&&(r=r+'<li class="slide-link-'+t+'" ><a>'+u+"<\/a><\/li>"),i.options.thumb_links&&(e=i.options.slides[t].thumb?i.options.slides[t].thumb:i.options.slides[t].image,f=f+'<li class="thumb'+t+'"><img src="'+e+'"/><\/li>'));t++}i.options.slide_links&&n(vars.slide_list).html(r);i.options.thumb_links&&vars.thumb_tray.length&&n(vars.thumb_tray).append('<ul id="'+vars.thumb_list.replace("#","")+'">'+f+"<\/ul>");n(i.el).append(o);i.options.thumbnail_navigation&&(prevThumb=vars.current_slide-1<0?i.options.slides.length-1:vars.current_slide-1,n(vars.prev_thumb).show().html(n("<img/>").attr("src",i.options.slides[prevThumb].image)),nextThumb=vars.current_slide==i.options.slides.length-1?0:vars.current_slide+1,n(vars.next_thumb).show().html(n("<img/>").attr("src",i.options.slides[nextThumb].image)));i._start()};i._start=function(){var u,f,s,t,e,c,o,l;if(vars.current_slide=i.options.start_slide?i.options.start_slide-1:Math.floor(Math.random()*i.options.slides.length),u=i.options.new_window?' target="_blank"':"",i.options.performance==3?i.$el.addClass("speed"):(i.options.performance==1||i.options.performance==2)&&i.$el.addClass("quality"),i.options.random){for(arr=i.options.slides,t=arr.length;t;f=parseInt(Math.random()*t),s=arr[--t],arr[t]=arr[f],arr[f]=s);i.options.slides=arr}if(i.options.slides.length>1&&i.options.slides.length>2){loadPrev=vars.current_slide-1<0?i.options.slides.length-1:vars.current_slide-1;var r=i.options.slides[loadPrev].url?"href='"+i.options.slides[loadPrev].url+"'":"",h=n('<img src="'+i.options.slides[loadPrev].image+'"/>'),a=i.el+" li:eq("+loadPrev+")";h.appendTo(a).wrap("<a "+r+u+"><\/a>").parent().parent().addClass("image-loading prevslide");h.load(function(){n(this).data("origWidth",n(this).width()).data("origHeight",n(this).height());i.resizeNow()})}r=api.getField("url")?"href='"+api.getField("url")+"'":"";e=n('<img src="'+api.getField("image")+'"/>');c=i.el+" li:eq("+vars.current_slide+")";e.appendTo(c).wrap("<a "+r+u+"><\/a>").parent().parent().addClass("image-loading activeslide").css("visibility","visible");e.load(function(){i._origDim(n(this));i.resizeNow();i.launch();typeof theme!="undefined"&&typeof theme._init=="function"&&theme._init()});i.options.slides.length>1&&(loadNext=vars.current_slide==i.options.slides.length-1?0:vars.current_slide+1,r=i.options.slides[loadNext].url?"href='"+i.options.slides[loadNext].url+"'":"",o=n('<img src="'+i.options.slides[loadNext].image+'"/>'),l=i.el+" li:eq("+loadNext+")",o.appendTo(l).wrap("<a "+r+u+"><\/a>").parent().parent().addClass("image-loading"),o.load(function(){n(this).data("origWidth",n(this).width()).data("origHeight",n(this).height());i.resizeNow()}));i.$el.css("visibility","hidden");n(".load-item").hide()};i.launch=function(){if(n("#supersized-loader").remove(),typeof theme!="undefined"&&typeof theme.beforeAnimation=="function"&&theme.beforeAnimation("next"),n(".load-item").show(),i.options.keyboard_nav)n(document.documentElement).on("keyup.supersized",function(t){if(vars.in_animation||n(document.activeElement).is("input, textarea"))return!1;t.keyCode==37||t.keyCode==40?(clearInterval(vars.slideshow_interval),i.prevSlide()):t.keyCode==39||t.keyCode==38?(clearInterval(vars.slideshow_interval),i.nextSlide()):t.keyCode!=32||vars.hover_pause||(clearInterval(vars.slideshow_interval),i.playToggle())});i.options.slideshow&&i.options.pause_hover&&n(i.el).hover(function(){if(vars.in_animation)return!1;vars.hover_pause=!0;vars.is_paused||(vars.hover_pause="resume",i.playToggle())},function(){vars.hover_pause=="resume"&&(i.playToggle(),vars.hover_pause=!1)});i.options.slide_links&&n(vars.slide_list+"> li").click(function(){return index=n(vars.slide_list+"> li").index(this),targetSlide=index+1,i.goTo(targetSlide),!1});i.options.thumb_links&&n(vars.thumb_list+"> li").click(function(){return index=n(vars.thumb_list+"> li").index(this),targetSlide=index+1,api.goTo(targetSlide),!1});i.options.slideshow&&i.options.slides.length>1&&(i.options.autoplay&&i.options.slides.length>1?vars.slideshow_interval=setInterval(i.nextSlide,i.options.slide_interval):vars.is_paused=!0,n(".load-item img").bind("contextmenu mousedown",function(){return!1}));n(window).resize(function(){i.resizeNow()})};i.resizeNow=function(){return i.$el.each(function(){return n("img",i.el).each(function(){function f(n){n?(thisSlide.width()<r||thisSlide.width()<i.options.min_width)&&(thisSlide.width()*t>=i.options.min_height?(thisSlide.width(i.options.min_width),thisSlide.height(thisSlide.width()*t)):e()):i.options.min_height>=u&&!i.options.fit_landscape?r*t>=i.options.min_height||r*t>=i.options.min_height&&t<=1?(thisSlide.width(r),thisSlide.height(r*t)):t>1?(thisSlide.height(i.options.min_height),thisSlide.width(thisSlide.height()/t)):thisSlide.width()<r&&(thisSlide.width(r),thisSlide.height(thisSlide.width()*t)):(thisSlide.width(r),thisSlide.height(r*t))}function e(n){n?thisSlide.height()<u&&(thisSlide.height()/t>=i.options.min_width?(thisSlide.height(i.options.min_height),thisSlide.width(thisSlide.height()/t)):f(!0)):i.options.min_width>=r?u/t>=i.options.min_width||t>1?(thisSlide.height(u),thisSlide.width(u/t)):t<=1&&(thisSlide.width(i.options.min_width),thisSlide.height(thisSlide.width()*t)):(thisSlide.height(u),thisSlide.width(u/t))}thisSlide=n(this);var t=(thisSlide.data("origHeight")/thisSlide.data("origWidth")).toFixed(2),r=i.$el.width(),u=i.$el.height();i.options.fit_always?u/r>t?f():e():u<=i.options.min_height&&r<=i.options.min_width?u/r>t?i.options.fit_landscape&&t<1?f(!0):e(!0):i.options.fit_portrait&&t>=1?e(!0):f(!0):r<=i.options.min_width?u/r>t?i.options.fit_landscape&&t<1?f(!0):e():i.options.fit_portrait&&t>=1?e():f(!0):u<=i.options.min_height?u/r>t?i.options.fit_landscape&&t<1?f():e(!0):i.options.fit_portrait&&t>=1?e(!0):f():u/r>t?i.options.fit_landscape&&t<1?f():e():i.options.fit_portrait&&t>=1?e():f();thisSlide.parents("li").hasClass("image-loading")&&n(".image-loading").removeClass("image-loading");i.options.horizontal_center&&n(this).css("left",(r-n(this).width())/2);i.options.vertical_center&&n(this).css("top",(u-n(this).height())/2)}),i.options.image_protect&&n("img",i.el).bind("contextmenu mousedown",function(){return!1}),!1})};i.nextSlide=function(){var e,s,r,t,h,u,o,f;if(i.options.slideshow&&!vars.is_paused&&i.options.auto_exit&&vars.current_slide==i.options.slides.length-1)return i.destroy(!0),!1;if(e=vars.current_slide,vars.current_slide<i.options.slides.length-1?vars.current_slide++:i.options.loop&&(vars.current_slide=0),e==vars.current_slide)return vars.in_animation=!1,!1;if(vars.in_animation||!api.options.slideshow)return!1;vars.in_animation=!0;clearInterval(vars.slideshow_interval);s=i.options.slides;r=i.$el.find(".activeslide");n(".prevslide").removeClass("prevslide");r.removeClass("activeslide").addClass("prevslide");t=n(i.el+" li:eq("+vars.current_slide+")");h=i.$el.find(".prevslide");i.options.performance==1&&i.$el.removeClass("quality").addClass("speed");loadSlide=!1;loadSlide=vars.current_slide==i.options.slides.length-1?0:vars.current_slide+1;u=i.el+" li:eq("+loadSlide+")";n(u).html()||(o=i.options.new_window?' target="_blank"':"",imageLink=i.options.slides[loadSlide].url?"href='"+i.options.slides[loadSlide].url+"'":"",f=n('<img src="'+i.options.slides[loadSlide].image+'"/>'),f.appendTo(u).wrap("<a "+imageLink+o+"><\/a>").parent().parent().addClass("image-loading").css("visibility","hidden"),f.load(function(){i._origDim(n(this));i.resizeNow()}));i.options.thumbnail_navigation==1&&(prevThumb=vars.current_slide-1<0?i.options.slides.length-1:vars.current_slide-1,n(vars.prev_thumb).html(n("<img/>").attr("src",i.options.slides[prevThumb].image)),nextThumb=loadSlide,n(vars.next_thumb).html(n("<img/>").attr("src",i.options.slides[nextThumb].image)));typeof theme!="undefined"&&typeof theme.beforeAnimation=="function"&&theme.beforeAnimation("next");i.options.slide_links&&(n(".current-slide").removeClass("current-slide"),n(vars.slide_list+"> li").eq(vars.current_slide).addClass("current-slide"));t.css("visibility","hidden").addClass("activeslide");switch(i.options.transition){case 0:case"none":t.css("visibility","visible");vars.in_animation=!1;i.afterAnimation();break;case 1:case"fade":t.css({opacity:0,visibility:"visible"}).animate({opacity:1,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 2:case"slideTop":t.css({top:-i.$el.height(),visibility:"visible"}).animate({top:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 3:case"slideRight":t.css({left:i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 4:case"slideBottom":t.css({top:i.$el.height(),visibility:"visible"}).animate({top:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 5:case"slideLeft":t.css({left:-i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 6:case"carouselRight":t.css({left:i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});r.animate({left:-i.$el.width(),avoidTransforms:!1},i.options.transition_speed);break;case 7:case"carouselLeft":t.css({left:-i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});r.animate({left:i.$el.width(),avoidTransforms:!1},i.options.transition_speed)}return!1};i.prevSlide=function(){var e,s,r,t,h,u,o,f;if(vars.in_animation||!api.options.slideshow)return!1;if(vars.in_animation=!0,e=vars.current_slide,vars.current_slide>0?vars.current_slide--:i.options.loop&&(vars.current_slide=i.options.slides.length-1),e==vars.current_slide)return vars.in_animation=!1,!1;clearInterval(vars.slideshow_interval);s=i.options.slides;r=i.$el.find(".activeslide");n(".prevslide").removeClass("prevslide");r.removeClass("activeslide").addClass("prevslide");t=n(i.el+" li:eq("+vars.current_slide+")");h=i.$el.find(".prevslide");i.options.performance==1&&i.$el.removeClass("quality").addClass("speed");loadSlide=vars.current_slide;u=i.el+" li:eq("+loadSlide+")";n(u).html()||(o=i.options.new_window?' target="_blank"':"",imageLink=i.options.slides[loadSlide].url?"href='"+i.options.slides[loadSlide].url+"'":"",f=n('<img src="'+i.options.slides[loadSlide].image+'"/>'),f.appendTo(u).wrap("<a "+imageLink+o+"><\/a>").parent().parent().addClass("image-loading").css("visibility","hidden"),f.load(function(){i._origDim(n(this));i.resizeNow()}));i.options.thumbnail_navigation==1&&(prevThumb=loadSlide==0?i.options.slides.length-1:loadSlide-1,n(vars.prev_thumb).html(n("<img/>").attr("src",i.options.slides[prevThumb].image)),nextThumb=vars.current_slide==i.options.slides.length-1?0:vars.current_slide+1,n(vars.next_thumb).html(n("<img/>").attr("src",i.options.slides[nextThumb].image)));typeof theme!="undefined"&&typeof theme.beforeAnimation=="function"&&theme.beforeAnimation("prev");i.options.slide_links&&(n(".current-slide").removeClass("current-slide"),n(vars.slide_list+"> li").eq(vars.current_slide).addClass("current-slide"));t.css("visibility","hidden").addClass("activeslide");switch(i.options.transition){case 0:case"none":t.css("visibility","visible");vars.in_animation=!1;i.afterAnimation();break;case 1:case"fade":t.css({opacity:0,visibility:"visible"}).animate({opacity:1,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 2:case"slideTop":t.css({top:i.$el.height(),visibility:"visible"}).animate({top:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 3:case"slideRight":t.css({left:-i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 4:case"slideBottom":t.css({top:-i.$el.height(),visibility:"visible"}).animate({top:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 5:case"slideLeft":t.css({left:i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});break;case 6:case"carouselRight":t.css({left:-i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});r.css({left:0}).animate({left:i.$el.width(),avoidTransforms:!1},i.options.transition_speed);break;case 7:case"carouselLeft":t.css({left:i.$el.width(),visibility:"visible"}).animate({left:0,avoidTransforms:!1},i.options.transition_speed,function(){i.afterAnimation()});r.css({left:0}).animate({left:-i.$el.width(),avoidTransforms:!1},i.options.transition_speed)}return!1};i.playToggle=function(){return vars.in_animation||!api.options.slideshow?!1:(vars.is_paused?(vars.is_paused=!1,typeof theme!="undefined"&&typeof theme.playToggle=="function"&&theme.playToggle("play"),vars.slideshow_interval=setInterval(i.nextSlide,i.options.slide_interval)):(vars.is_paused=!0,typeof theme!="undefined"&&typeof theme.playToggle=="function"&&theme.playToggle("pause"),clearInterval(vars.slideshow_interval)),!1)};i.destroy=function(t){if(!vars.in_animation&&api.options.slideshow){vars.is_paused&&api.playToggle();clearInterval(vars.slideshow_interval);n(document.documentElement).off(".supersized");n(".ssControlsContainer *").off("click");var r=vars.options.slides[vars.current_slide].id;vars=null;api=null;n("#supersized-loader,#supersized,.ssControlsContainer").remove();n("body .supersized_hidden").show().removeClass("supersized_hidden");n(window).off("resize");i.options.on_destroy.apply(null,[r,t||!1])}};i.goTo=function(t){if(vars.in_animation||!api.options.slideshow)return!1;var r=i.options.slides.length;if(t<0?t=r:t>r&&(t=1),t=r-t+1,clearInterval(vars.slideshow_interval),typeof theme!="undefined"&&typeof theme.goTo=="function"&&theme.goTo(),vars.current_slide==r-t)return vars.is_paused||(vars.slideshow_interval=setInterval(i.nextSlide,i.options.slide_interval)),!1;r-t>vars.current_slide?(vars.current_slide=r-t-1,vars.update_images="next",i._placeSlide(vars.update_images)):r-t<vars.current_slide&&(vars.current_slide=r-t+1,vars.update_images="prev",i._placeSlide(vars.update_images));i.options.slide_links&&(n(vars.slide_list+"> .current-slide").removeClass("current-slide"),n(vars.slide_list+"> li").eq(r-t).addClass("current-slide"));i.options.thumb_links&&(n(vars.thumb_list+"> .current-thumb").removeClass("current-thumb"),n(vars.thumb_list+"> li").eq(r-t).addClass("current-thumb"))};i._placeSlide=function(t){var f=i.options.new_window?' target="_blank"':"",r,u;loadSlide=!1;t=="next"?(loadSlide=vars.current_slide==i.options.slides.length-1?0:vars.current_slide+1,r=i.el+" li:eq("+loadSlide+")",n(r).html()||(f=i.options.new_window?' target="_blank"':"",imageLink=i.options.slides[loadSlide].url?"href='"+i.options.slides[loadSlide].url+"'":"",u=n('<img src="'+i.options.slides[loadSlide].image+'"/>'),u.appendTo(r).wrap("<a "+imageLink+f+"><\/a>").parent().parent().addClass("image-loading").css("visibility","hidden"),u.load(function(){i._origDim(n(this));i.resizeNow()})),i.nextSlide()):t=="prev"&&(loadSlide=vars.current_slide-1<0?i.options.slides.length-1:vars.current_slide-1,r=i.el+" li:eq("+loadSlide+")",n(r).html()||(f=i.options.new_window?' target="_blank"':"",imageLink=i.options.slides[loadSlide].url?"href='"+i.options.slides[loadSlide].url+"'":"",u=n('<img src="'+i.options.slides[loadSlide].image+'"/>'),u.appendTo(r).wrap("<a "+imageLink+f+"><\/a>").parent().parent().addClass("image-loading").css("visibility","hidden"),u.load(function(){i._origDim(n(this));i.resizeNow()})),i.prevSlide())};i._origDim=function(n){n.data("origWidth",n.width()).data("origHeight",n.height())};i.afterAnimation=function(){return i.options.performance==1&&i.$el.removeClass("speed").addClass("quality"),vars.update_images&&(setPrev=vars.current_slide-1<0?i.options.slides.length-1:vars.current_slide-1,vars.update_images=!1,n(".prevslide").removeClass("prevslide"),n(i.el+" li:eq("+setPrev+")").addClass("prevslide")),vars.in_animation=!1,!vars.is_paused&&i.options.slideshow&&(vars.slideshow_interval=setInterval(i.nextSlide,i.options.slide_interval),i.options.loop||i.options.auto_exit||vars.current_slide!=i.options.slides.length-1||i.playToggle()),typeof theme!="undefined"&&typeof theme.afterAnimation=="function"&&theme.afterAnimation(),!1};i.getField=function(n){return i.options.slides[vars.current_slide][n]};i.init()};n.supersized.vars={thumb_tray:"#thumb-tray",thumb_list:"#thumb-list",slide_list:"#slide-list",current_slide:0,in_animation:!1,is_paused:!1,hover_pause:!1,slideshow_interval:!1,update_images:!1,options:{}};n.supersized.defaultOptions={slideshow:1,autoplay:1,auto_exit:0,start_slide:1,loop:1,random:0,slide_interval:5e3,transition:1,transition_speed:750,new_window:1,pause_hover:0,keyboard_nav:1,performance:1,image_protect:1,fit_always:0,fit_landscape:0,fit_portrait:1,min_width:0,min_height:0,horizontal_center:1,vertical_center:1,slide_links:1,thumb_links:1,thumbnail_navigation:0,on_destroy:function(){}};n.fn.supersized=function(t){return this.each(function(){new n.supersized(t)})}}(jQuery),function(n){theme={_init:function(){var t,i;api.options.slide_links&&(t=n(vars.slide_list).parent().width()-400,n(vars.slide_list).css("margin-left",-n(vars.slide_list).width()/2).css("max-width",t));api.options.autoplay?api.options.progress_bar?theme.progressBar():n(vars.progress_bar).parent().hide():(n(vars.play_button).attr("src")&&n(vars.play_button).attr("src",api.options.image_path+"play.png"),api.options.progress_bar?n(vars.progress_bar).stop().css({left:-n(window).width()}):n(vars.progress_bar).parent().hide());n(vars.thumb_tray).css({bottom:-(n(vars.thumb_tray).outerHeight()+5)});n(vars.tray_button).click(function(t){var i=n(t.currentTarget).data("isExpanded")||!1;return i?(n(vars.thumb_tray).stop().animate({bottom:-(n(vars.thumb_tray).outerHeight()+5),avoidTransforms:!0},300),n(vars.tray_arrow).attr("src")&&n(vars.tray_arrow).attr("src",api.options.image_path+"button-tray-up.png")):(n(vars.thumb_tray).stop().animate({bottom:0,avoidTransforms:!0},300),n(vars.tray_arrow).attr("src")&&n(vars.tray_arrow).attr("src",api.options.image_path+"button-tray-down.png")),n(t.currentTarget).data("isExpanded",!i),!1});n(vars.thumb_list).width(n("> li",vars.thumb_list).length*n("> li",vars.thumb_list).outerWidth(!0));n(vars.slide_total).length&&n(vars.slide_total).html(api.options.slides.length);api.options.thumb_links&&(n(vars.thumb_list).width()<=n(vars.thumb_tray).width()&&n(vars.thumb_back+","+vars.thumb_forward).fadeOut(0),vars.thumb_interval=Math.floor(n(vars.thumb_tray).width()/n("> li",vars.thumb_list).outerWidth(!0))*n("> li",vars.thumb_list).outerWidth(!0),vars.thumb_page=0,n(vars.thumb_forward).click(function(){vars.thumb_page-vars.thumb_interval<=-n(vars.thumb_list).width()?(vars.thumb_page=0,n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"})):(vars.thumb_page=vars.thumb_page-vars.thumb_interval,n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"}))}),n(vars.thumb_back).click(function(){vars.thumb_page+vars.thumb_interval>0?(vars.thumb_page=Math.floor(n(vars.thumb_list).width()/vars.thumb_interval)*-vars.thumb_interval,n(vars.thumb_list).width()<=-vars.thumb_page&&(vars.thumb_page=vars.thumb_page+vars.thumb_interval),n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"})):(vars.thumb_page=vars.thumb_page+vars.thumb_interval,n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"}))}));n(vars.next_slide).click(function(){api.nextSlide()});n(vars.prev_slide).click(function(){api.prevSlide()});i=!!("ontouchstart"in window)||!!navigator.msMaxTouchPoints;i&&n.fn.touchwipe&&vars.$container.touchwipe({wipeLeft:function(){api.nextSlide()},wipeRight:function(){api.prevSlide()}});jQuery.support.opacity&&n(vars.prev_slide+","+vars.next_slide).mouseover(function(){n(this).stop().animate({opacity:1},100)}).mouseout(function(){n(this).stop().animate({opacity:.6},100)});api.options.thumbnail_navigation&&(n(vars.next_thumb).click(function(){api.nextSlide()}),n(vars.prev_thumb).click(function(){api.prevSlide()}));n(vars.play_button).click(function(){api.playToggle()});api.options.mouse_scrub&&n(vars.thumb_tray).mousemove(function(t){var r=n(vars.thumb_tray).width(),f=n(vars.thumb_list).width(),u,i;f>r&&(u=1,i=t.pageX-u,(i>10||i<-10)&&(u=t.pageX,newX=(r-f)*(t.pageX/r),i=parseInt(Math.abs(parseInt(n(vars.thumb_list).css("left"))-newX)).toFixed(0),n(vars.thumb_list).stop().animate({left:newX},{duration:i*3,easing:"easeOutExpo"})))});n(window).resize(function(){api.options.progress_bar&&!vars.in_animation&&(vars.slideshow_interval&&clearInterval(vars.slideshow_interval),api.options.slides.length-1>0&&clearInterval(vars.slideshow_interval),n(vars.progress_bar).stop().css({left:-n(window).width()}),!vars.progressDelay&&api.options.slideshow&&(vars.progressDelay=setTimeout(function(){vars.is_paused||(theme.progressBar(),vars.slideshow_interval=setInterval(api.nextSlide,api.options.slide_interval));vars.progressDelay=!1},1e3)));api.options.thumb_links&&vars.thumb_tray.length&&(vars.thumb_page=0,vars.thumb_interval=Math.floor(n(vars.thumb_tray).width()/n("> li",vars.thumb_list).outerWidth(!0))*n("> li",vars.thumb_list).outerWidth(!0),n(vars.thumb_list).width()>n(vars.thumb_tray).width()?(n(vars.thumb_back+","+vars.thumb_forward).fadeIn("fast"),n(vars.thumb_list).stop().animate({left:0},200)):n(vars.thumb_back+","+vars.thumb_forward).fadeOut("fast"));api.options.slide_links&&(t=n(vars.slide_list).parent().width()-400,n(vars.slide_list).css("margin-left",-n(vars.slide_list).width()/2).css("max-width",t))})},goTo:function(){api.options.progress_bar&&!vars.is_paused&&(n(vars.progress_bar).stop().css({left:-n(window).width()}),theme.progressBar())},playToggle:function(t){t=="play"?(n(vars.play_button).attr("src")&&n(vars.play_button).attr("src",api.options.image_path+"pause.png"),api.options.progress_bar&&!vars.is_paused&&theme.progressBar()):t=="pause"&&(n(vars.play_button).attr("src")&&n(vars.play_button).attr("src",api.options.image_path+"play.png"),api.options.progress_bar&&vars.is_paused&&n(vars.progress_bar).stop().css({left:-n(window).width()}))},beforeAnimation:function(t){if(api.options.progress_bar&&!vars.is_paused&&n(vars.progress_bar).stop().css({left:-n(window).width()}),n(vars.slide_caption).length&&(api.getField("title")?n(vars.slide_caption).html(api.getField("title")):n(vars.slide_caption).html("")),vars.slide_current.length&&n(vars.slide_current).html(vars.current_slide+1),api.options.thumb_links&&(n(".current-thumb").removeClass("current-thumb"),n("li",vars.thumb_list).eq(vars.current_slide).addClass("current-thumb"),n(vars.thumb_list).width()>n(vars.thumb_tray).width()))if(t=="next")vars.current_slide==0?(vars.thumb_page=0,n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"})):n(".current-thumb").offset().left-n(vars.thumb_tray).offset().left>=vars.thumb_interval&&(vars.thumb_page=vars.thumb_page-vars.thumb_interval,n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"}));else if(t=="prev")if(vars.current_slide==api.options.slides.length-1)vars.thumb_page=Math.floor(n(vars.thumb_list).width()/vars.thumb_interval)*-vars.thumb_interval,n(vars.thumb_list).width()<=-vars.thumb_page&&(vars.thumb_page=vars.thumb_page+vars.thumb_interval),n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"});else if(n(".current-thumb").offset().left-n(vars.thumb_tray).offset().left<0){if(vars.thumb_page+vars.thumb_interval>0)return!1;vars.thumb_page=vars.thumb_page+vars.thumb_interval;n(vars.thumb_list).stop().animate({left:vars.thumb_page},{duration:500,easing:"easeOutExpo"})}},afterAnimation:function(){api.options.progress_bar&&!vars.is_paused&&theme.progressBar()},progressBar:function(){n(vars.progress_bar).stop().css({left:-n(window).width()}).animate({left:0},api.options.slide_interval)}};n.supersized.themeVars={progress_delay:!1,thumb_page:!1,thumb_interval:!1,play_button:"#pauseplay",next_slide:"#nextslide",prev_slide:"#prevslide",next_thumb:"#nextthumb",prev_thumb:"#prevthumb",slide_caption:"#slidecaption",slide_current:".slidenumber",slide_total:".totalslides",slide_list:"#slide-list",thumb_tray:"#thumb-tray",thumb_list:"#thumb-list",thumb_forward:"#thumb-forward",thumb_back:"#thumb-back",tray_arrow:"#tray-arrow",tray_button:"#tray-button",progress_bar:"#progress-bar"};n.supersized.themeOptions={progress_bar:1,image_path:"img/",mouse_scrub:0,html_template:'<div class="ssControlsContainer"> \t\t<!--Thumbnail Navigation--> \t\t<div id="prevthumb"><\/div> \t\t<div id="nextthumb"><\/div> \t\t<!--Arrow Navigation--> \t\t<a id="prevslide" class="load-item"><\/a> \t\t<a id="nextslide" class="load-item"><\/a> \t\t<div id="thumb-tray" class="load-item"> \t\t\t<div id="thumb-back"><\/div> \t\t\t<div id="thumb-forward"><\/div> \t\t<\/div> \t\t<!--Time Bar--> \t\t<div id="progress-back" class="load-item"> \t\t\t<div id="progress-bar"><\/div> \t\t<\/div> \t\t<!--Control Bar--> \t\t<div id="controls-wrapper" class="load-item"> \t\t\t<div id="controls"> \t\t\t\t<a id="play-button"> \t\t\t\t\t<img id="pauseplay" src="img/pause.png" /><\/a> \t\t\t\t<a id="stop-button"> \t\t\t\t\t<img src="img/stop.png" /><\/a> \t\t\t\t<!--Slide counter--> \t\t\t\t<div id="slidecounter"> \t\t\t\t\t<span class="slidenumber"><\/span>/ <span class="totalslides"><\/span> \t\t\t\t<\/div> \t\t\t\t<!--Slide captions displayed here--> \t\t\t\t<div id="slidecaption"><\/div> \t\t\t\t<!--Thumb Tray button--> \t\t\t\t<a id="tray-button"> \t\t\t\t\t<img id="tray-arrow" src="img/button-tray-up.png" /><\/a> \t\t\t\t<!--Navigation--> \t\t\t\t<ul id="slide-list"><\/ul> \t\t\t<\/div> \t\t<\/div> <\/div>'}}(jQuery),function(n){var t=0;n.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{}},_create:function(){var i=this.element.hide(),t=this.options;this.speed=n.fx.speeds._default;this._isOpen=!1;var u=(this.button=n('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"><\/span><\/button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(t.classes).attr({title:i.attr("title"),"aria-haspopup":!0,tabIndex:i.attr("tabIndex")}).insertAfter(i),e=(this.buttonlabel=n("<span />")).html(t.noneSelectedText).appendTo(u),r=(this.menu=n("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(t.classes).appendTo(document.body),f=(this.header=n("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(r),o=(this.headerLinkContainer=n("<ul />")).addClass("ui-helper-reset").html(function(){return t.header===!0?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"><\/span><span>'+t.checkAllText+'<\/span><\/a><\/li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"><\/span><span>'+t.uncheckAllText+"<\/span><\/a><\/li>":typeof t.header=="string"?"<li>"+t.header+"<\/li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"><\/span><\/a><\/li>').appendTo(f),s=(this.checkboxContainer=n("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(r);this._bindEvents();this.refresh(!0);t.multiple||r.addClass("ui-multiselect-single")},_init:function(){this.options.header===!1&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(i){var u=this.element,f=this.options,s=this.menu,h=this.checkboxContainer,e=[],r="",o=u.attr("id")||t++;u.find("option").each(function(t){var w=n(this),u=this.parentNode,c=this.innerHTML,v=this.title,y=this.value,l="ui-multiselect-"+(this.id||o+"-option-"+t),s=this.disabled,a=this.selected,h=["ui-corner-all"],p=(s?"ui-multiselect-disabled ":" ")+this.className,i;u.tagName==="OPTGROUP"&&(i=u.getAttribute("label"),n.inArray(i,e)===-1&&(r+='<li class="ui-multiselect-optgroup-label '+u.className+'"><a href="#">'+i+"<\/a><\/li>",e.push(i)));s&&h.push("ui-state-disabled");a&&!f.multiple&&h.push("ui-state-active");r+='<li class="'+p+'">';r+='<label for="'+l+'" title="'+v+'" class="'+h.join(" ")+'">';r+='<input id="'+l+'" name="multiselect_'+o+'" type="'+(f.multiple?"checkbox":"radio")+'" value="'+y.replace(/\"/g,"&quot;")+'" title="'+c.replace(/\"/g,"&quot;")+'"';a&&(r+=' checked="checked"',r+=' aria-selected="true"');s&&(r+=' disabled="disabled"',r+=' aria-disabled="true"');r+=" /><span>"+c+"<\/span><\/label><\/li>"});h.html(r);this.labels=s.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();i||this._trigger("refresh")},update:function(){var t=this.options,r=this.inputs,u=r.filter(":checked"),i=u.length,f;return f=i===0?t.noneSelectedText:n.isFunction(t.selectedText)?t.selectedText.call(this,i,r.length,u.get()):/\d/.test(t.selectedList)&&t.selectedList>0&&i<=t.selectedList?u.map(function(){return n(this).next().html()}).get().join(", "):t.selectedText.replace("#",i).replace("#",r.length),this.buttonlabel.html(f),f},_bindEvents:function(){function r(){return t[t._isOpen?"close":"open"](),!1}var t=this,i=this.button;i.find("span").bind("click.multiselect",r);i.bind({click:r,keypress:function(n){switch(n.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}},mouseenter:function(){i.hasClass("ui-state-disabled")||n(this).addClass("ui-state-hover")},mouseleave:function(){n(this).removeClass("ui-state-hover")},focus:function(){i.hasClass("ui-state-disabled")||n(this).addClass("ui-state-focus")},blur:function(){n(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(i){n(this).hasClass("ui-multiselect-close")?t.close():t[n(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();i.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(i){i.preventDefault();var f=n(this),r=f.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),u=r.get(),e=f.parent().text();t._trigger("beforeoptgrouptoggle",i,{inputs:u,label:e})!==!1&&(t._toggleChecked(r.filter(":checked").length!==r.length,r),t._trigger("optgrouptoggle",i,{inputs:u,label:e,checked:u[0].checked}))}).delegate("label","mouseenter.multiselect",function(){n(this).hasClass("ui-state-disabled")||(t.labels.removeClass("ui-state-hover"),n(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(i){i.preventDefault();switch(i.which){case 9:case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(i.which,this);break;case 13:n(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(i){var u=n(this),f=this.value,r=this.checked,e=t.element.find("option");if(this.disabled||t._trigger("click",i,{value:f,text:this.title,checked:r})===!1){i.preventDefault();return}u.focus();u.attr("aria-selected",r);e.each(function(){this.value===f?this.selected=r:t.options.multiple||(this.selected=!1)});t.options.multiple||(t.labels.removeClass("ui-state-active"),u.closest("label").toggleClass("ui-state-active",r),t.close());t.element.trigger("change");setTimeout(n.proxy(t.update,t),10)});n(document).bind("mousedown.multiselect",function(i){!t._isOpen||n.contains(t.menu[0],i.target)||n.contains(t.button[0],i.target)||i.target===t.button[0]||t.close()});n(this.element[0].form).bind("reset.multiselect",function(){setTimeout(n.proxy(t.refresh,t),10)})},_setButtonWidth:function(){var n=this.element.outerWidth(),t=this.options;/\d/.test(t.minWidth)&&n<t.minWidth&&(n=t.minWidth);this.button.width(n)},_setMenuWidth:function(){var n=this.menu,t=this.button.outerWidth()-parseInt(n.css("padding-left"),10)-parseInt(n.css("padding-right"),10)-parseInt(n.css("border-right-width"),10)-parseInt(n.css("border-left-width"),10);n.width(t||this.button.outerWidth())},_traverse:function(t,i){var e=n(i),r=t===38||t===37,f=e.parent()[r?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[r?"last":"first"](),u;f.length?f.find("label").trigger("mouseover"):(u=this.menu.find("ul").last(),this.menu.find("label")[r?"last":"first"]().trigger("mouseover"),u.scrollTop(r?u.height():0))},_toggleState:function(n,t){return function(){this.disabled||(this[n]=t);t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,i){var r=i&&i.length?i:this.inputs,f=this,u;r.each(this._toggleState("checked",t));r.eq(0).focus();this.update();u=r.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&n.inArray(this.value,u)>-1&&f._toggleState("selected",t).call(this)});r.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("ui-state-disabled");var i=this.menu.find("input"),r="ech-multiselect-disabled";i=t?i.filter(":enabled").data(r,!0):i.filter(function(){return n.data(this,r)===!0}).removeData(r);i.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:t,"aria-disabled":t})},open:function(){var s=this,i=this.button,r=this.menu,f=this.speed,t=this.options,e=[];if(this._trigger("beforeopen")!==!1&&!i.hasClass("ui-state-disabled")&&!this._isOpen){var h=r.find("ul").last(),u=t.show,o=i.offset();n.isArray(t.show)&&(u=t.show[0],f=t.show[1]||s.speed);u&&(e=[u,f]);h.scrollTop(0).height(t.height);n.ui.position&&!n.isEmptyObject(t.position)?(t.position.of=t.position.of||i,r.show().position(t.position).hide()):r.css({top:o.top+i.outerHeight(),left:o.left});n.fn.show.apply(r,e);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");i.addClass("ui-state-active");this._isOpen=!0;this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==!1){var t=this.options,i=t.hide,r=this.speed,u=[];n.isArray(t.hide)&&(i=t.hide[0],r=t.hide[1]||this.speed);i&&(u=[i,r]);n.fn.hide.apply(this.menu,u);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return n.Widget.prototype.destroy.call(this),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(t,i){var r=this.menu;switch(t){case"header":r.find("div.ui-multiselect-header")[i?"show":"hide"]();break;case"checkAllText":r.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":r.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":r.find("ul").last().height(parseInt(i,10));break;case"minWidth":this.options[t]=parseInt(i,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=i;this.update();break;case"classes":r.add(this.button).removeClass(this.options.classes).addClass(i);break;case"multiple":r.toggleClass("ui-multiselect-single",!i);this.options.multiple=i;this.element[0].multiple=i;this.refresh()}n.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);
/*!
 * jQCloud Plugin for jQuery https://github.com/lucaong/jQCloud
 * 
 * Version 1.0.4
 *
 * Copyright 2011, Luca Ongaro
 * Licensed under the MIT license.
 *
 * Date: 2013-05-09 18:54:22 +0200
*/
(function(n){"use strict";n.fn.jQCloud=function(t,i){var r=this,f=r.attr("id")||Math.floor(Math.random()*1e6).toString(36),e={width:r.width(),height:r.height(),center:{x:(i&&i.width?i.width:r.width())/2,y:(i&&i.height?i.height:r.height())/2},delayedMode:t.length>50,shape:!1,encodeURI:!0,removeOverflowing:!0},u;return i=n.extend(e,i||{}),r.addClass("jqcloud").width(i.width).height(i.height),r.css("position")==="static"&&r.css("position","relative"),u=function(){for(var l=function(n,t){for(var r=function(n,t){return Math.abs(2*n.offsetLeft+n.offsetWidth-2*t.offsetLeft-t.offsetWidth)<n.offsetWidth+t.offsetWidth&&Math.abs(2*n.offsetTop+n.offsetHeight-2*t.offsetTop-t.offsetHeight)<n.offsetHeight+t.offsetHeight?!0:!1},i=0,i=0;i<t.length;i++)if(r(n,t[i]))return!0;return!1},e=0;e<t.length;e++)t[e].weight=parseFloat(t[e].weight,10);t.sort(function(n,t){return n.weight<t.weight?1:n.weight>t.weight?-1:0});var u=i.shape==="rectangular"?18:2,h=[],o=i.width/i.height,c=function(e,s){var it=f+"_word_"+e,ft="#"+it,b=6.28*Math.random(),k=0,d=0,w=0,rt=5,ut="",g="",c,y;if(s.html=n.extend(s.html,{id:it}),s.html&&s.html["class"]&&(ut=s.html["class"],delete s.html["class"]),t[0].weight>t[t.length-1].weight&&(rt=Math.round((s.weight-t[t.length-1].weight)/(t[0].weight-t[t.length-1].weight)*9)+1),c=n("<span>").attr(s.html).addClass("w"+rt+" "+ut),s.link?(typeof s.link=="string"&&(s.link={href:s.link}),i.encodeURI&&(s.link=n.extend(s.link,{href:encodeURI(s.link.href).replace(/'/g,"%27")})),g=n("<a>").attr(s.link).text(s.text)):g=s.text,c.append(g),!!s.handlers)for(y in s.handlers)s.handlers.hasOwnProperty(y)&&typeof s.handlers[y]=="function"&&n(c).bind(y,s.handlers[y]);r.append(c);var nt=c.width(),tt=c.height(),a=i.center.x-nt/2,v=i.center.y-tt/2,p=c[0].style;for(p.position="absolute",p.left=a+"px",p.top=v+"px";l(c[0],h);){if(i.shape==="rectangular"){d++;d*u>(1+Math.floor(w/2))*u*(w%4%2==0?1:o)&&(d=0,w++);switch(w%4){case 1:a+=u*o+Math.random()*2;break;case 2:v-=u+Math.random()*2;break;case 3:a-=u*o+Math.random()*2;break;case 0:v+=u+Math.random()*2}}else k+=u,b+=(e%2==0?1:-1)*u,a=i.center.x-nt/2+k*Math.cos(b)*o,v=i.center.y+k*Math.sin(b)-tt/2;p.left=a+"px";p.top=v+"px"}if(i.removeOverflowing&&(a<0||v<0||a+nt>i.width||v+tt>i.height)){c.remove();return}h.push(c[0]);n.isFunction(s.afterWordRender)&&s.afterWordRender.call(c)},s=function(u){if(u=u||0,!r.is(":visible")){setTimeout(function(){s(u)},10);return}u<t.length?(c(u,t[u]),setTimeout(function(){s(u+1)},10)):n.isFunction(i.afterCloudRender)&&i.afterCloudRender.call(r)};i.delayedMode?s():(n.each(t,c),n.isFunction(i.afterCloudRender)&&i.afterCloudRender.call(r))},setTimeout(function(){u()},10),r}})(jQuery);
/*!
   * jQuery UI Touch Punch 0.2.3
   * http://touchpunch.furf.com
   *
   * Copyright 20112014, Dave Furfero
   * Dual licensed under the MIT or GPL Version 2 licenses.
   *
   * Depends:
   *  jquery.ui.widget.js
   *  jquery.ui.mouse.js
   *
   * [2015-08-06] Bug fix: Chrome on some devices was sending touchmove events even during careful touches by users, preventing them from being
   * converted into click events. I implemented the changed suggested in this pull request: https://github.com/furf/jquery-ui-touch-punch/pull/151
   */
(function(n){function i(n,t){if(!(n.originalEvent.touches.length>1)){n.preventDefault();var i=n.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null);n.target.dispatchEvent(r)}}if(n.support.touch="ontouchend"in document,n.support.touch){var t=n.ui.mouse.prototype,u=t._mouseInit,f=t._mouseDestroy,r;t._touchStart=function(n){var t=this;!r&&t._mouseCapture(n.originalEvent.changedTouches[0])&&(r=!0,t._touchMoved=0,i(n,"mouseover"),i(n,"mousemove"),i(n,"mousedown"))};t._touchMove=function(n){r&&(this._touchMoved+=1,i(n,"mousemove"))};t._touchEnd=function(n){r&&(i(n,"mouseup"),i(n,"mouseout"),this._touchMoved<=5&&i(n,"click"),r=!1)};t._mouseInit=function(){var t=this;t.element.bind({touchstart:n.proxy(t,"_touchStart"),touchmove:n.proxy(t,"_touchMove"),touchend:n.proxy(t,"_touchEnd")});u.call(t)};t._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:n.proxy(t,"_touchStart"),touchmove:n.proxy(t,"_touchMove"),touchend:n.proxy(t,"_touchEnd")});f.call(t)}}})(jQuery),function(n){n.fn.touchwipe=function(t){var i={min_move_x:20,min_move_y:20,wipeLeft:function(){},wipeRight:function(){},wipeUp:function(){},wipeDown:function(){},preventDefaultEvents:!0};return t&&n.extend(i,t),this.each(function(){function u(){this.removeEventListener("touchmove",f);n=null;t=!1}function f(f){if(i.preventDefaultEvents&&f.preventDefault(),t){var s=f.touches[0].pageX,h=f.touches[0].pageY,e=n-s,o=r-h;Math.abs(e)>=i.min_move_x?(u(),e>0?i.wipeLeft():i.wipeRight()):Math.abs(o)>=i.min_move_y&&(u(),o>0?i.wipeDown():i.wipeUp())}}function e(i){i.touches.length==1&&(n=i.touches[0].pageX,r=i.touches[0].pageY,t=!0,this.addEventListener("touchmove",f,!1))}var n,r,t=!1;"ontouchstart"in document.documentElement&&this.addEventListener("touchstart",e,!1)}),this}}(jQuery),function(n){"use strict";function i(){return n(".tx-editor-overlay").length>0}function r(t){var i=(n(window).height()-t.height())/2,r=(n(window).width()-t.width())/2;t.css({top:i,left:r})}function u(n,t){r(t);i()?n.focus():(n.focus(),t.css("opacity",1))}function t(t,i){var u,r;for(this.$el=n(t),this.settings={overlay:!0,maxWidth:"",maxHeight:""},r=0;r<this.bindMethods.length;r++)u=this.bindMethods[r],this[u]=n.proxy(this,u);this.init(i)}t.prototype.$el=null;t.prototype.$widget=null;t.prototype.$editor=null;t.prototype.$icon=null;t.prototype.init=function(t){var i;if(this.settings=n.extend(!0,this.settings,t),!this.$el.is("textarea")){n.error("Error initializing Textarea Fullscreen Editor Plugin. It can only work on <textarea> element.");return}i='<div class="tx-editor-wrapper"><div class="tx-editor"><span class="fa fa-2x tx-icon" title="Click to expand/collapse"><\/span><\/div><\/div>';this.$wrapper=n(i).insertAfter(this.$el);this.$editor=this.$wrapper.find(".tx-editor");this.$icon=this.$editor.find(".tx-icon");this.$editor.append(this.$el);this.$el.css({width:"100%",height:"100%",resize:"none"});this.$icon.on("click.txeditor.icon",this.onIconClick)};t.prototype.bindMethods=["onOverlayClick","onIconClick","onKeyUp","onResize"];t.prototype.showOverlay=function(){return n('<div class="tx-editor-overlay" />').appendTo("body").fadeTo(0,1).click(this.onOverlayClick),this};t.prototype.removeOverlay=function(){var t=n(".tx-editor-overlay");return t.length&&t.fadeTo(0,0,function(){n(this).remove()}),this};t.prototype.expand=function(){var t=this.settings,i=this.$editor;t.maxWidth&&i.css("max-width",t.maxWidth);t.maxHeight&&i.css("max-height",t.maxHeight);t.overlay&&this.showOverlay();i.addClass("expanded");u(this.$el,this.$editor);n(window).on("resize.txeditor",this.onResize);n(window).on("keyup.txeditor",this.onKeyUp);return this};t.prototype.minimize=function(){var i=this.settings,t=this.$editor;return n(window).off("resize.txeditor",this.onResize),n(window).off("keyup.txeditor",this.onKeyUp),t.removeClass("expanded").css({"max-width":"none","max-height":"none"}),u(this.$el,t),i.overlay&&this.removeOverlay(),this};t.prototype.destroy=function(){var t=this.$wrapper;return this.removeOverlay(),this.$el=this.$el.detach(),this.$el.insertBefore(t),t.remove(),this.$wrapper=null,this.$icon=null,this.$editor=null,n(window).off("keyup.txeditor",this.onKeyUp).off("resize.txeditor",this.onResize),this};t.prototype.onOverlayClick=function(){this.minimize()};t.prototype.onIconClick=function(n){n.preventDefault();i()?this.minimize():this.expand()};t.prototype.onKeyUp=function(n){n.keyCode===27&&i()&&this.minimize()};t.prototype.onResize=function(){r(this.$editor)};n.fn.textareafullscreen=function(i){return this.each(function(){var u=n(this),r,f;if("string"==typeof i){if(r=u.data("textareafullscreendata"),"function"==typeof r[i])return f=Array.prototype.slice.call(arguments,1),r[i].apply(r,f);n.error("Method "+i+" does not exist on jQuery.textareafullscreen")}else u.data("textareafullscreendata",new t(this,i))})}}(jQuery);var Gs;(function(n){var t=jQuery,f,i,o,r,a,v,y,s,p,w,b,k,d,g,nt,tt,it,e,h,c,rt,ut,ft,et,ot,st,l,u,ht;(function(n){n.AppRoot="";n.AppUrl="";n.GalleryResourcesRoot="";n.msAjaxComponentId="";n.href=""})(f=n.Vars||(n.Vars={}));i=function(){function n(){}return n.escape=function(n){return n.replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},n.htmlEncode=function(n){return t("<div/>").text(n).html()},n.htmlDecode=function(n){return t("<div/>").html(n).text()},n.removeHtmlTags=function(t){return n.escape(t.replace(/(<[^<>]*>)/g,""))},n.hasFormValidation=function(){return typeof document.createElement("input").checkValidity=="function"},n.isTouchScreen=function(){return!!("ontouchstart"in window)||!!navigator.msMaxTouchPoints},n.isWidthLessThan=function(n){return window.matchMedia&&window.matchMedia("(max-device-width: "+n+"px)").matches||screen.width<=n},n.isSinglePaneTouchScreen=function(){return n.isTouchScreen()&&n.isWidthLessThan(750)},n.getViewportWidth=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},n.getViewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},n.isNullOrEmpty=function(n){return!n&&n!==!1||!(n.length>0)?!0:!1},n.deepCopy=function(t){var r=t,i;if(t&&typeof t=="object"){r=Object.prototype.toString.call(t)==="[object Array]"?[]:{};for(i in t)t.hasOwnProperty(i)&&(r[i]=n.deepCopy(t[i]))}return r},n.convertAlbumToGalleryItem=function(n){return{Id:n.Id,ParentId:n.ParentId,IsAlbum:!0,MimeType:0,ItemType:3,NumAlbums:n.NumAlbums,NumMediaItems:n.NumMediaItems,Caption:n.Caption,Title:n.Title,ViewIndex:-1,Views:[]}},n.convertMediaItemToGalleryItem=function(t){return{Id:t.Id,ParentId:t.AlbumId,IsAlbum:!1,MimeType:t.MimeType,ItemType:t.ItemType,NumAlbums:0,NumMediaItems:0,Caption:"",Title:t.Title,ViewIndex:t.ViewIndex,Views:n.deepCopy(t.Views)}},n.getItemTypeDesc=function(n){switch(n){case r.ItemType.Album:return"Album";case r.ItemType.Image:return"Image";case r.ItemType.Audio:return"Audio";case r.ItemType.Video:return"Video";case r.ItemType.Generic:return"Generic";case r.ItemType.External:return"External";default:return"Unknown"}},n.findGalleryItem=function(n,i,r){return n.Album!=null&&n.Album.GalleryItems!=null?t.grep(n.Album.GalleryItems,function(n){return n.Id===i&&n.ItemType===r})[0]:null},n.findMediaItem=function(n,i,r){return n.Album!=null&&n.Album.MediaItems!=null?r==null?t.grep(n.Album.MediaItems,function(n){return n.Id===i})[0]:t.grep(n.Album.MediaItems,function(n){return n.Id===i&&n.ItemType===r})[0]:null},n.findMetaItem=function(n,i){return t.grep(n,function(n){return n.MTypeId===i})[0]||null},n.findMetaItemById=function(n,i){return t.grep(n,function(n){return n.Id===i})[0]||null},n.addGalleryItems=function(n,i){t.each(i,function(t,i){n.Album.GalleryItems.push(i);n.Album.NumGalleryItems++;i.IsAlbum||n.Album.NumMediaItems++})},n.removeGalleryItems=function(i,r){t.each(r,function(r,u){var f=n.findGalleryItem(i,u.Id,u.ItemType);f!=null&&(i.Album.GalleryItems.gspRemove(t.inArray(f,i.Album.GalleryItems)),i.Album.NumGalleryItems--,u.IsAlbum||i.Album.NumMediaItems--)})},n.removeMediaItem=function(n,i){var r=t.inArray(i,n.Album.MediaItems);n.Album.MediaItems.gspRemove(r);r>=0?(t.each(n.Album.MediaItems,function(n,t){t.Index=n+1}),n.Album.NumGalleryItems--,n.Album.NumMediaItems--,r>=n.Album.MediaItems.length&&(r=n.Album.MediaItems.length-1),n.MediaItem=n.Album.MediaItems[r-1]):n.MediaItem=null},n.getView=function(n,t){for(var u=null,i=0;i<n.Views.length;i++){if(n.Views[i].ViewSize===t)return n.Views[i];n.Views[i].ViewSize===r.ViewSize.Original&&(u=n.Views[i])}return u},n.hasView=function(n,t){if(n.Views==null)return!1;for(var i=0;i<n.Views.length;i++)if(n.Views[i].ViewSize===t)return!0;return!1},n.Init=function(){f.Cookies=Cookies.noConflict();t(".gsp_ns input:submit, .gsp_ns button").button();t.views.converters({getItemTypeDesc:function(t){return n.getItemTypeDesc(t)},stripHtml:function(t){return n.removeHtmlTags(t)}});t.views.helpers({htmlEscape:function(t){return n.escape(t)},parseDate:function(n,t,i){return Globalize.parseDate(n,t,i)},parseInt:function(n,t,i){return Globalize.parseInt(n,t,i)},parseFloat:function(n,t,i){return Globalize.parseFloat(n,t,i)},findMetaItem:function(t,i){return n.findMetaItem(t,i)||new s(i)},getAlbumUrl:function(t,i){return n.GetAlbumUrl(t,i)},getGalleryItemUrl:function(t,i){var r={aid:t.IsAlbum?t.Id:null,moid:t.IsAlbum?null:t.Id};return i||(r.title=null,r.tag=null,r.people=null,r.search=null,r.latest=null,r.filter=null,r.rating=null,r.top=null),n.GetUrl(f.href,r)},getView:function(t,i){return n.getView(t,i)},getMediaUrl:function(t,i){return n.GetMediaUrl(t,i)},getDownloadUrl:function(t){return n.GetUrl(window.location.href,{g:"task_downloadobjects",moid:null,aid:t})},getAddUrl:function(t){return n.GetUrl(window.location.href,{g:"task_addobjects",aid:t.Album.Id})},getPageUrl:function(t,i){var r={title:null,tag:null,people:null,search:null,latest:null,filter:null,rating:null,top:null,aid:null,moid:null};return r.g=t,i.MediaItem!=null?r.moid=i.MediaItem.Id:i.Album.Id>o.IntMinValue&&(r.aid=i.Album.Id),n.GetUrl(window.location.href,r)},isTouchScreen:function(){return n.isTouchScreen()},isWidthLessThan:function(t){return n.isWidthLessThan(t)},isSinglePaneTouchScreen:function(){return n.isSinglePaneTouchScreen()}});f.href=window.location.href.replace(/#\d+/,"");n.StoreParentFrameUrlInSession()},n.ReloadPage=function(){window.location.href=n.RemoveQSParm(window.location.href,"msg")},n.GetEmbedCode=function(t){var i=n.GetUrl(f.AppUrl+"/"+f.GalleryResourcesRoot+"/embed.aspx"+location.search,{aid:null,moid:t});return"<iframe allowtransparency='true' frameborder='0' sandbox='allow-same-origin allow-forms allow-scripts' scrolling='auto' src='"+i+"' style='width:100%;height:100%'><\/iframe>"},n.GetAlbumUrl=function(t,i){var r={aid:null,moid:null};return i||(r.title=null,r.tag=null,r.people=null,r.search=null,r.latest=null,r.filter=null,r.rating=null,r.top=null),t>o.IntMinValue&&(r.aid=t),n.GetUrl(document.location.href,r)},n.GetAlbumExternalUrl=function(t){var r={aid:null,moid:null},i;return t>o.IntMinValue&&(r.aid=t),i=document.location.href,n.GetParentFrameUrl()!=null&&(i=n.GetParentFrameUrl()+document.location.search),n.GetUrl(i,r)},n.GetMediaUrl=function(t,i){var r={aid:null,moid:t};return i||(r.title=null,r.tag=null,r.people=null,r.search=null,r.latest=null,r.filter=null,r.rating=null,r.top=null),n.GetUrl(document.location.href,r)},n.GetMediaExternalUrl=function(t){var r={aid:null,moid:t},i=document.location.href;return n.GetParentFrameUrl()!=null&&(i=n.GetParentFrameUrl()+document.location.search),n.GetUrl(i,r)},n.StoreParentFrameUrlInSession=function(){var i=parent!==window,n,t;i?(n=void 0,n=document.referrer.indexOf("?")>=0?document.referrer.substring(0,document.referrer.indexOf("?")):document.referrer,t=document.location.origin+document.location.pathname,n!==t&&sessionStorage&&sessionStorage.setItem("parentFrameUrl",document.referrer)):sessionStorage&&sessionStorage.removeItem("parentFrameUrl")},n.GetParentFrameUrl=function(){return sessionStorage&&sessionStorage.getItem("parentFrameUrl")},n.GetUrl=function(i,r){return typeof r.ss=="undefined"&&(r.ss=null),typeof r.msg=="undefined"&&(r.msg=null),t.each(r,function(t,r){i=n.AddQSParm(n.RemoveQSParm(i,t),t,r)}),i},n.IsQSParmPresent=function(t){var i=n.GetQS[t];return i!=null&&i.length>0},n.GetQS=function(){for(var t={},i=location.search.substring(1),r=/([^&=]+)=([^&]*)/g,n;n=r.exec(i);)t[decodeURIComponent(n[1])]=decodeURIComponent(n[2]);return t},n.GetQSParm=function(t){return n.GetQS()[t]},n.AddQSParm=function(n,t,i){var f,r,u,e;if(!t||!i)return n;if(t=encodeURIComponent(t),i=encodeURIComponent(i),f=n.split("?"),f.length<2)return n+"?"+t+"="+i;for(r=f[1].split(/[&;]/g),u=r.length-1;u>=0;u--)if(e=r[u].split("="),e[0]===t){e[1]=i;r[u]=e.join("=");break}return u<0&&(r[r.length]=[t,i].join("=")),f[0]+"?"+r.join("&")},n.RemoveQSParm=function(n,t){var u=n.split("?"),f,i,r;if(u.length<2)return n;for(f=encodeURIComponent(t)+"=",i=u[1].split(/[&;]/g),r=i.length-1;r>=0;r--)i[r].lastIndexOf(f,0)!==-1&&i.splice(r,1);return i.length>0?u[0]+"?"+i.join("&"):u[0]},n.DisposeAjaxComponent=function(n){if(typeof Sys!="undefined"&&typeof Sys.Application!="undefined"&&n&&n.length>0){var t=Sys.Application.findComponent(n);t&&t.dispose()}},n.selectElementContents=function(n){var t=function(){var i=document.createRange(),t;i.selectNodeContents(n);t=window.getSelection();t.removeAllRanges();t.addRange(i)};typeof requestAnimationFrame!="undefined"?requestAnimationFrame(function(){return t()}):t()},n.createPseudoGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})},n.parseJqXhrMsg=function(n){return n.responseJSON&&n.responseJSON.Message&&n.responseJSON.MessageDetail?n.responseJSON.Message+" "+n.responseJSON.MessageDetail:n.responseText},n}();n.Utils=i,function(n){n.IntMinValue=-2147483648;n.IntMaxValue=2147483647}(o=n.Constants||(n.Constants={})),function(n){var t,i,r,u,f,e,o,s,h,c,l,a,v;(function(n){n[n.Unknown=0]="Unknown";n[n.Thumbnail=1]="Thumbnail";n[n.Optimized=2]="Optimized";n[n.Original=3]="Original";n[n.External=4]="External"})(t=n.ViewSize||(n.ViewSize={})),function(n){n[n.NotSet=0]="NotSet";n[n.Other=1]="Other";n[n.Image=2]="Image";n[n.Video=3]="Video";n[n.Audio=4]="Audio"}(i=n.MimeType||(n.MimeType={})),function(n){n[n.NotSpecified=0]="NotSpecified";n[n.Album=3]="Album";n[n.Image=4]="Image";n[n.Audio=5]="Audio";n[n.Video=6]="Video";n[n.Generic=7]="Generic";n[n.External=8]="External"}(r=n.ItemType||(n.ItemType={})),function(n){n[n.NotSet=0]="NotSet";n[n.NotEditable=3]="NotEditable";n[n.PlainTextEditor=2]="PlainTextEditor";n[n.TinyMCEHtmlEditor=3]="TinyMCEHtmlEditor"}(u=n.PropertyEditorMode||(n.PropertyEditorMode={})),function(n){n[n.AddChildAlbum=2]="AddChildAlbum";n[n.AddMediaObject=4]="AddMediaObject";n[n.EditAlbum=8]="EditAlbum"}(f=n.SecurityActions||(n.SecurityActions={})),function(n){n[n.NotVirtual=1]="NotVirtual"}(e=n.VirtualAlbumType||(n.VirtualAlbumType={})),function(n){n[n.NotSet=0]="NotSet";n[n.Inline=1]="Inline";n[n.FullScreen=2]="FullScreen"}(o=n.SlideShowType||(n.SlideShowType={})),function(n){n[n.None=0]="None";n[n.AlbumSuccessfullyDeleted=11]="AlbumSuccessfullyDeleted"}(s=n.MessageType||(n.MessageType={})),function(n){n[n.NotSet=0]="NotSet";n[n.Title=29]="Title";n[n.Caption=41]="Caption";n[n.HtmlSource=112]="HtmlSource"}(h=n.MetaType||(n.MetaType={})),function(n){n[n.NotSet=0]="NotSet";n[n.Enter=13]="Enter";n[n.Escape=27]="Escape";n[n.CursorLeft=37]="CursorLeft";n[n.CursorRight=39]="CursorRight"}(c=n.KeyCode||(n.KeyCode={})),function(n){n[n.NotSet=0]="NotSet";n[n.Rotate0FlipNone=1]="Rotate0FlipNone";n[n.Rotate0FlipX=2]="Rotate0FlipX";n[n.Rotate0FlipY=3]="Rotate0FlipY";n[n.Rotate90FlipNone=4]="Rotate90FlipNone";n[n.Rotate180FlipNone=7]="Rotate180FlipNone";n[n.Rotate270FlipNone=10]="Rotate270FlipNone"}(l=n.RotateFlip||(n.RotateFlip={})),function(n){n[n.none=0]="none";n[n.admin_albums=1]="admin_albums";n[n.admin_backuprestore=2]="admin_backuprestore";n[n.admin_css=3]="admin_css";n[n.admin_eventlog=4]="admin_eventlog";n[n.admin_galleries=5]="admin_galleries";n[n.admin_gallerysettings=6]="admin_gallerysettings";n[n.admin_gallerycontrolsettings=7]="admin_gallerycontrolsettings";n[n.admin_images=8]="admin_images";n[n.admin_manageroles=9]="admin_manageroles";n[n.admin_manageusers=10]="admin_manageusers";n[n.admin_mediaobjects=11]="admin_mediaobjects";n[n.admin_metadata=12]="admin_metadata";n[n.admin_filetypes=13]="admin_filetypes";n[n.admin_mediatemplates=14]="admin_mediatemplates";n[n.admin_sitesettings=15]="admin_sitesettings";n[n.admin_uitemplates=16]="admin_uitemplates";n[n.admin_usersettings=17]="admin_usersettings";n[n.admin_videoaudioother=18]="admin_videoaudioother";n[n.admin_mediaqueue=19]="admin_mediaqueue";n[n.album=20]="album";n[n.changepassword=21]="changepassword";n[n.createaccount=22]="createaccount";n[n.error_cannotwritetodirectory=23]="error_cannotwritetodirectory";n[n.error_generic=24]="error_generic";n[n.login=25]="login";n[n.mediaobject=26]="mediaobject";n[n.myaccount=27]="myaccount";n[n.recoverpassword=28]="recoverpassword";n[n.task_addobjects=29]="task_addobjects";n[n.task_synchronize=30]="task_synchronize"}(a=n.PageId||(n.PageId={})),function(n){n[n.NotSet=0]="NotSet";n[n.TrialExpired=1]="TrialExpired";n[n.Free=2]="Free";n[n.HomeNonprofit=3]="HomeNonprofit";n[n.Enterprise=4]="Enterprise";n[n.EnterpriseUltimate=5]="EnterpriseUltimate";n[n.Trial=6]="Trial"}(v=n.LicenseLevel||(n.LicenseLevel={}))}(r=n.Enums||(n.Enums={}));a=function(){function n(){}return n}();n.App=a;v=function(){function n(){}return n}();n.GalleryItem=v;y=function(){function n(){}return n}();n.DisplayObject=y;s=function(){function n(n){this.Id=0;this.MediaId=0;this.MTypeId=n;this.GTypeId=0;this.Desc="";this.Value="";this.EditMode=r.PropertyEditorMode.NotSet}return n}();n.MetaItem=s;p=function(){function n(){}return n}();n.Permissions=p;w=function(){function n(){}return n}();n.Album=w;b=function(){function n(){}return n}();n.MediaItem=b;k=function(){function n(){}return n}();n.Resource=k;d=function(){function n(){}return n}();n.Settings=d;g=function(){function n(){}return n}();n.User=g;nt=function(){function n(){}return n}();n.GalleryData=nt;tt=function(){function n(){}return n}();n.ActionResult=tt;it=function(){function n(){}return n}();n.GalleryItemMeta=it;typeof tinyMCE!="undefined"&&tinyMCE.PluginManager.add("placeholder",function(n){n.on("init",function(){function u(){n.getContent()===""?r.show():r.hide()}var r=new i(n);u();tinyMCE.DOM.bind(r.placeholderElement,"click",function(n){r.hide();t(n.target).prevAll(".mce-content-body").focus()});n.on("focus",function(){r.hide()});n.on("blur",u)});var i=function(){function n(n){this.placeholderText=n.getElement().getAttribute("placeholder")||n.settings.placeholder_text||"Add...";this.placeholderParent=t(n.getElement()).parent()[0];tinyMCE.DOM.setStyle(this.placeholderParent,"position","relative");this.placeholderElement=tinyMCE.DOM.add(this.placeholderParent,"label",{"class":"gs_meta_placeholder"},this.placeholderText)}return n.prototype.show=function(){tinyMCE.DOM.setStyle(this.placeholderElement,"display","")},n.prototype.hide=function(){tinyMCE.DOM.setStyle(this.placeholderElement,"display","none")},n}()});t(document).ready(i.Init);e=function(){function n(){}return n.logOff=function(n){t.post(f.AppRoot+"/api/task/logoff",function(t){n(t)})},n.getGalleryItems=function(n,i,r,u){t.ajax({type:"GET",url:f.AppRoot+"/api/albums/"+n+"/galleryitems",dataType:"json"}).done(r).always(i).fail(u)},n.deleteGalleryItems=function(n,i,r,u,e){t.ajax({type:"DELETE",url:f.AppRoot+"/api/galleryitems/delete?deleteFromFileSystem="+i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(u).always(r).fail(e)},n.deleteOriginalFiles=function(n,i,r,u){t.ajax({type:"DELETE",url:f.AppRoot+"/api/galleryitems/deleteoriginalfiles",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(r).always(i).fail(u)},n.getMediaAsset=function(n,i,r,u){t.ajax({type:"GET",url:f.AppRoot+"/api/mediaitems/"+n+"/get"}).done(r).always(i).fail(u)},n.deleteMediaAsset=function(n,i,r,u){t.ajax({type:"DELETE",url:f.AppRoot+"/api/mediaitems/"+n}).done(r).always(i).fail(u)},n.prepareZipDownload=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/mediaitems/preparezipdownload?mediaSize="+i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(u).always(r).fail(e)},n.createAlbum=function(n,i,r,u){t.ajax({type:"PUT",url:f.AppRoot+"/api/albums/createalbum",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(r).always(i).fail(u)},n.sortAlbum=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/sortalbum?persistToAlbum="+i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(u).always(r).fail(e)},n.changeAlbumOwner=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/changealbumowner?albumId="+n+"&ownerName="+i,dataType:"json"}).done(u).always(r).fail(e)},n.saveAlbum=function(n,r,u,e){var o=i.deepCopy(n);o.MediaItems=null;o.GalleryItems=null;o.MetaItems=null;o.Permissions=null;t.ajax({type:"POST",url:f.AppRoot+"/api/albums/post",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(u).always(r).fail(e)},n.moveTo=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/movetoalbum?destinationAlbumId="+n,data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json"}).done(u).always(r).fail(e)},n.copyTo=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/copytoalbum?destinationAlbumId="+n,data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(u).always(r).fail(e)},n.sortGalleryItems=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/sortgalleryobjects",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(r).always(i).fail(u)},n.saveMeta=function(n,i,r,u){t.ajax({type:"PUT",url:f.AppRoot+"/api/galleryitemmeta",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(r).always(i).fail(u)},n.deleteMeta=function(n,i,r,u){t.ajax({type:"DELETE",url:f.AppRoot+"/api/galleryitemmeta",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(r).always(i).fail(u)},n.canUserEdit=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/galleryitemmeta/canuseredit",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(r).always(i).fail(u)},n.getMeta=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/galleryitemmeta/galleryitems",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(r).always(i).fail(u)},n.assignThumbnail=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/assignThumbnail?albumId="+i,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(u).always(r).fail(e)},n.cancelMediaQueueItem=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/mediaqueueitem/cancel/?mediaQueueId="+n}).done(r).always(i).fail(u)},n.saveCurrentUserProfile=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/users/currentuserprofile",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(r).always(i).fail(u)},n.clearUserProfile=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/users/clearuserprofile?userName="+n,contentType:"application/json; charset=utf-8"}).done(r).always(i).fail(u)},n.purgeCache=function(n,i,r){t.ajax({url:f.AppRoot+"/api/task/purgecache"}).done(i).always(n).fail(r)},n.calculateOriginalFileSize=function(n,i,r,u){t.ajax({type:"POST",url:f.AppRoot+"/api/albums/calculateoriginalfilesize",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(r).always(i).fail(u)},n.replaceWithEditedImage=function(n,i,r,u,e){t.ajax({type:"POST",url:f.AppRoot+"/api/mediaitems/replacewitheditedimage?mediaAssetId="+n+"&fileNameOnServer="+encodeURIComponent(i),dataType:"json"}).done(u).always(r).fail(e)},n.replaceMediaAssetFile=function(n,i,r,u,e,o){t.ajax({type:"POST",url:f.AppRoot+"/api/mediaitems/replacemediaassetfile?mediaAssetId="+n+"&fileNameOnServer="+encodeURIComponent(i)+"&fileName="+encodeURIComponent(r),dataType:"json"}).done(e).always(u).fail(o)},n.rotateFlipMediaAsset=function(n,i,r,u,e,o){t.ajax({type:"POST",url:f.AppRoot+"/api/galleryitems/rotateflip?rotateFlip="+i+"&viewSize="+r,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(e).always(u).fail(o)},n.getAsJson=function(n,i,r,u,f){t.ajax({type:"GET",url:n,data:i,dataType:"json"}).done(u).always(r).fail(f)},n}();n.DataService=e;t.fn.gsTagCloud=function(n,r){var f=this,o=t.extend({},t.fn.gsTagCloud.defaults,r),c=function(){e.getAsJson(r.tagCloudUrl,null,function(){f.removeClass("gsp_wait")},function(n){var t=new h(f,n,o);t.render()},function(n){u.show("Cannot Retrieve Tag Cloud Data",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},s;return n==null?c():(s=new h(this,n,o),s.render()),this};t.fn.gsTagCloud.defaults={clientId:"",tagCloudType:"tag",tagCloudUrl:"",shape:"rectangular"};h=function(){function n(n,t,i){this.$target=n;this.TagCloudOptions=i;this.Data=t}return n.prototype.render=function(){var r=this,n={title:null,tag:null,people:null,search:null,latest:null,filter:null,rating:null,top:null,aid:null,moid:null},u=window.location.href,f=t.map(this.Data,function(t){return n[r.TagCloudOptions.tagCloudType]=t.value,{text:t.value,weight:t.count,link:i.GetUrl(u,n)}});this.$target.jQCloud(f,{encodeURI:!1,shape:this.TagCloudOptions.shape})},n}();t.fn.gsTreeView=function(n,r){var o=this,f=t.extend({},t.fn.gsTreeView.defaults,r),h=function(){var n={id:f.albumId,gid:f.galleryId,secaction:f.requiredSecurityPermissions,sc:f.enableCheckboxPlugin,navurl:f.navigateUrl,levels:f.numberOfLevels,includealbum:f.includeAlbum,idtoselect:f.albumIdsToSelect};e.getAsJson(f.treeDataUrl,n,function(){o.removeClass("gsp_wait")},function(n){var t=typeof n=="string"?JSON.parse(n):n,i=new c(o,t,f);i.render()},function(n){u.show("Cannot Retrieve Tag Cloud Data",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},s;return n==null?h():(s=new c(this,n,f),s.render()),this};t.fn.gsTreeView.defaults={albumId:0,galleryId:0,containerClientId:"",allowMultiSelect:!1,numberOfLevels:1,albumIdsToSelect:null,checkedAlbumIdsHiddenFieldClientId:"",theme:"gsp",requiredSecurityPermissions:1,navigateUrl:"",enableCheckboxPlugin:!1,includeAlbum:!0,treeDataUrl:""};c=function(){function n(n,t,i){this.$target=n;this.TreeViewOptions=i;this.Data=t}return n.prototype.render=function(){var n=this,t;this.updateNodeDataWithAlbumIdsToSelect();t={core:{worker:!1,check_callback:!0,data:function(t,r){if(t.id==="#")return r(n.Data);var o=f.GalleryResourcesRoot+"/handler/gettreeview.ashx",s={id:t.li_attr["data-id"],secaction:n.TreeViewOptions.requiredSecurityPermissions,sc:n.TreeViewOptions.enableCheckboxPlugin,navurl:n.TreeViewOptions.navigateUrl,levels:1,includealbum:!1};return e.getAsJson(o,s,null,function(n){r(n)},function(n){u.show("Cannot Retrieve Tree Data",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}),null},multiple:this.TreeViewOptions.allowMultiSelect,themes:{name:this.TreeViewOptions.theme,dots:!1,icons:!1,responsive:!1},error:function(){var i="An error occurred in jsTree.",t=n.$target.jstree(!0).last_error();t&&t.reason&&t.error&&t.id&&t.plugin&&t.data&&(i=i+" "+t.reason+" Error: "+t.error+"; ID: "+t.id+"; Plugin: "+t.plugin+"; Data: "+t.data);u.show("jsTree Error",i,{msgType:"error",autoCloseDelay:0})}}};this.TreeViewOptions.enableCheckboxPlugin&&(t.plugins=["checkbox"],t.checkbox={keep_selected_style:!1,three_state:this.TreeViewOptions.allowMultiSelect,visible:!0,whole_node:!0,cascade:"",tie_selection:!0});this.$target.jstree(t).on("ready.jstree",function(t,i){n.onLoaded(t,i)}).on("changed.jstree",function(t,i){n.onChangeState(t,i)}).on("deselect_node.jstree",function(t,i){n.onDeselectNode(t,i)})},n.prototype.storeSelectedNodesInHiddenFormField=function(n){if(this.TreeViewOptions.checkedAlbumIdsHiddenFieldClientId!=null&&this.TreeViewOptions.checkedAlbumIdsHiddenFieldClientId.length!==0){var i=n.instance.get_top_selected(!0),r=t.map(i,function(n){return n.li_attr["data-id"]}).join();t("#"+this.TreeViewOptions.checkedAlbumIdsHiddenFieldClientId).val(r)}},n.prototype.updateNodeDataWithAlbumIdsToSelect=function(){var r=this,n;i.isNullOrEmpty(this.TreeViewOptions.albumIdsToSelect)||(n=function(r,u){if(i.isNullOrEmpty(r))return null;var f=t.grep(r,function(n){return n.li_attr["data-id"]===u})[0]||null;return f!=null?f:(t.each(r,function(t,i){return f=n(i.children,u),f!=null?!1:!0}),f)},t.each(this.TreeViewOptions.albumIdsToSelect,function(t,i){var u=n(r.Data,i);u!=null&&(u.state.selected=!0)}))},n.prototype.onChangeState=function(n,t){if(t.action==="select_node"){var i=t.instance.get_node(t.node,!0).children("a").attr("href");if(i!=null&&i.length>1){document.location.href=i;return}}(t.action==="deselect_node"||t.action==="select_node")&&this.storeSelectedNodesInHiddenFormField(t)},n.prototype.onDeselectNode=function(n,t){this.TreeViewOptions.allowMultiSelect||t.instance.get_selected().length!==0||t.instance.select_node(t.node)},n.prototype.onLoaded=function(n,i){var r,u,f;(this.storeSelectedNodesInHiddenFormField(i),this.TreeViewOptions.containerClientId.length<1)||(r=i.instance.get_selected(),r!=null&&r.length===1&&(u=t("#"+r[0]).position().top,f=t("#"+this.TreeViewOptions.containerClientId).height(),u>f&&t("#"+this.TreeViewOptions.containerClientId).animate({scrollTop:u},200,"linear")))},n}();t.widget("gs.gsMedia",{options:{clientId:""},_create:function(){var n=f[this.options.clientId].gsData;this.gspMedia=new rt(this.element,n,this.options);this.gspMedia.initialize()},showNextMediaObject:function(){this.gspMedia.showNextMediaObject()},startSlideshow:function(){this.gspMedia.startSlideshow()},stopSlideshow:function(){this.gspMedia.stopSlideshow()},render:function(){this.gspMedia.render()},preloadImages:function(){this.gspMedia.preloadImages()},addCursorNavigationHandler:function(){this.gspMedia.addCursorNavigationHandler()},removeCursorNavigationHandler:function(){this.gspMedia.removeCursorNavigationHandler()}});rt=function(){function n(n,t,i){this.$target=n;this.data=t;this.gsMediaOptions=i;this.timer=null}return n.prototype.initialize=function(){if(!this.data.MediaItem){u.show("Cannot Render Media Object","<p>Cannot render the media object template. Navigate to a media object and then return to this page.<\/p><p>You'll know you got it right when you see 'moid' In the URL's query string.<\/p><p>ERROR: this.Data.MediaItem is null.<\/p>",{msgType:"error",autoCloseDelay:0});return}this.jsRenderSetup();this.overwriteMediaObject();this.attachEvents();this.render();this.preloadImages()},n.prototype.jsRenderSetup=function(){var n=this;t.views.helpers({prevUrl:function(){var t=n.getPreviousMediaObject();return t?n.getPermalink(t.Id):i.GetAlbumUrl(n.data.Album.Id,!0)},nextUrl:function(){var t=n.getNextMediaObject();return t?n.getPermalink(t.Id):i.GetAlbumUrl(n.data.Album.Id,!0)},getEmbedCode:function(){var t=i.GetUrl(n.data.App.AppUrl+"/"+n.data.App.GalleryResourcesPath+"/embed.aspx"+location.search,{aid:null,moid:n.data.MediaItem.Id});return"<iframe allowtransparency='true' frameborder='0' sandbox='allow-same-origin allow-forms allow-scripts' scrolling='auto' src='"+t+"' style='width:100%;height:100%'><\/iframe>"}})},n.prototype.render=function(){this.setSize();this.dataBind();this.runMediaObjectScript();this.ScaleDownOriginalIfNecessary();this.data.Settings.SlideShowIsRunning&&this.startSlideshow();history.replaceState&&history.replaceState(null,"",this.getPermalink(this.data.MediaItem.Id))},n.prototype.ScaleDownOriginalIfNecessary=function(){var f,e;if(this.data.Settings.MediaViewSize===r.ViewSize.Original){var i=t(".gsp_moContainer",this.$target),u=i.width(),o="img:first-child, video:first-child, object:first-child",n=t(o,i).first();n.length!==0&&(f=n.outerWidth(),e=function(n){f>u&&n.css({"box-sizing":"border-box",width:u,height:"auto"})},f>u?e(n):this.data.MediaItem.ItemType!==r.ItemType.Image||n[0].complete||n.load(function(){var n=t(o,i).first();u=i.width();f=n.outerWidth();e(n)}))}},n.prototype.setSize=function(){for(var t=0,n=0;n<this.data.MediaItem.Views.length;n++){if(this.data.MediaItem.Views[n].ViewSize===this.data.Settings.MediaViewSize){this.data.MediaItem.ViewIndex=this.data.ActiveGalleryItems[0].ViewIndex=n;return}(this.data.MediaItem.Views[n].ViewSize===r.ViewSize.Original||this.data.MediaItem.Views[n].ViewSize===r.ViewSize.External)&&(t=n)}this.data.MediaItem.ViewIndex=this.data.ActiveGalleryItems[0].ViewIndex=t},n.prototype.startSlideshow=function(){var n=this,t;if(this.data.Settings.SlideShowType===r.SlideShowType.FullScreen)this.removeCursorNavigationHandler(),t=new st(this.data,{viewSize:this.data.Settings.MediaViewSize,on_exit:function(t,i){n.data.Settings.SlideShowIsRunning=!1;n.addCursorNavigationHandler();i?n.redirectToAlbum():n.showMediaObject(t)}}),this.data.Settings.SlideShowIsRunning=t.startSlideShow();else if(this.data.Settings.SlideShowType===r.SlideShowType.Inline){if(this.timer&&this.timer.isRunning)return!0;this.data.Settings.SlideShowIsRunning=!0;this.data.MediaItem.ItemType===r.ItemType.Image||this.getNextMediaObject()!=null?(this.timer=new l(this.showNextMediaObject,this.data.Settings.SlideShowIntervalMs,this),this.timer.start()):(this.data.Settings.SlideShowIsRunning=!1,u.show(this.data.Resource.MoNoSsHdr,this.data.Resource.MoNoSsBdy,{msgType:"info"}))}return this.data.Settings.SlideShowIsRunning},n.prototype.stopSlideshow=function(){this.timer&&this.timer.stop();this.data.Settings.SlideShowIsRunning=!1},n.prototype.dataBind=function(){i.DisposeAjaxComponent(f.msAjaxComponentId);this.$target.html(t.render[this.data.Settings.MediaTmplName](this.data));this.animateMediaObject();this.attachMediaEvents();this.makeMetaItemsEditable()},n.prototype.makeMetaItemsEditable=function(){var n=this,o,f;this.data.Album.Permissions.EditMediaObject&&(o={selector:"#"+this.data.Settings.MediaClientId+" section[data-editMode=2]",menubar:!1,inline:!0,skin:this.data.App.Skin,plugins:["placeholder"],toolbar:!1,forced_root_block:!1,verify_html:!1,placeholder_text:this.data.Resource.MetaEditPlaceholder,setup:function(f){var s="sgi",o="cmi";f.on("init",function(){t(f.getBody()).on("click","a[href]",function(n){window.location.href=t(n.currentTarget).attr("href")})});f.on("focus",function(u){var f=i.findMetaItemById(n.data.MediaItem.MetaItems,t(u.target.targetElm).data("id")),e;n.$target.data(s,n.data.ActiveGalleryItems);n.$target.data(o,f);f.EditMode===r.PropertyEditorMode.PlainTextEditor&&(e=tinyMCE.get(u.target.id),e.setContent(i.htmlEncode(f.Value)));t("#"+n.data.Settings.MediaClientId).gsMedia("removeCursorNavigationHandler")});f.on("blur",function(f){var h=tinyMCE.get(f.target.id),c=t(h.targetElm);if(h.isDirty()){var l=[i.convertMediaItemToGalleryItem(n.data.MediaItem)],s=n.$target.data(o),a=s.EditMode===r.PropertyEditorMode.TinyMCEHtmlEditor?"html":"text",v={GalleryItems:l,MetaItem:{MTypeId:s.MTypeId,Value:h.getContent({format:a})}},y=t(f.target.targetElm).addClass("gsp_wait_center");e.saveMeta(v,function(){y.removeClass("gsp_wait_center")},function(e){switch(e.ActionResult.Status){case"Success":case"Info":case"Warning":var o=i.findMetaItemById(n.data.MediaItem.MetaItems,t(f.target.targetElm).data("id"));o!=null&&(o.MTypeId===r.MetaType.Title&&(n.data.MediaItem.Title=e.MetaItem.Value),o.Value=e.MetaItem.Value,s.EditMode===r.PropertyEditorMode.PlainTextEditor&&(tinyMCE.get(f.target.id).targetElm.innerHTML=e.MetaItem.Value),n.$target.trigger("mediaUpdate."+n.data.Settings.ClientId,[n.data.ActiveGalleryItems]));break;case"Error":c.html(s.Value).nextAll("label").toggle(s.Value.length===0)}e.ActionResult.Status!=="Success"&&u.show(e.ActionResult.Title,e.ActionResult.Message,{msgType:e.ActionResult.Status.toLowerCase(),autoCloseDelay:0})},function(n){c.html(s.Value).nextAll("label").toggle(s.Value.length===0);u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})}t("#"+n.data.Settings.MediaClientId).gsMedia("addCursorNavigationHandler")});f.on("keydown",function(t){var u=tinyMCE.get(t.target.id),f;return t.keyCode===r.KeyCode.Escape?(f=n.$target.data(o),u.setContent(f.MTypeId===r.MetaType.HtmlSource?i.htmlEncode(f.Value):f.Value),u.setDirty(!1),u.targetElm.blur(),!1):t.keyCode===r.KeyCode.Enter&&n.$target.data(o).EditMode===r.PropertyEditorMode.PlainTextEditor?(u.targetElm.blur(),!1):!0})}},tinyMCE.init(o),this.data.App.License>=r.LicenseLevel.HomeNonprofit&&(f=i.deepCopy(o),f.selector="#"+this.data.Settings.MediaClientId+" section[data-editMode=3]",f.plugins=["code autolink image link textcolor placeholder"],f.image_advtab=!0,f.verify_html=!1,f.toolbar1="formatselect fontsizeselect forecolor backcolor image",f.toolbar2="undo redo | code bold italic link | alignleft aligncenter alignright | bullist numlist indent",delete f.forced_root_block,tinyMCE.init(f)))},n.prototype.animateMediaObject=function(){var u=this,f=function(n){var t=u.data.MediaItem.ItemType===r.ItemType.Image,i=u.data.Settings.TransitionType!=="none";return t&&i?(n.hide(),!0):!1},n=t(".gsp_moContainer",this.$target),i;if(f(n))switch(this.data.Settings.TransitionType){case"none":n.show();break;case"fade":n.fadeIn(this.data.Settings.TransitionDurationMs);break;default:i={};this.data.Settings.TransitionType==="scale"&&(i={percent:100});n.toggle(this.data.Settings.TransitionType,i,this.data.Settings.TransitionDurationMs)}},n.prototype.showPreviousMediaObject=function(n){typeof tinyMCE!="undefined"&&tinyMCE.activeEditor&&tinyMCE.activeEditor.destroy();this.data.MediaItem=this.getPreviousMediaObject();this.data.MediaItem?(n&&n.preventDefault(),this.data.ActiveGalleryItems=[i.convertMediaItemToGalleryItem(this.data.MediaItem)],t("#"+this.data.Settings.ClientId+"_moid").val(this.data.MediaItem.Id.toString()),this.setSize(),this.render(),this.$target.trigger("previous."+this.data.Settings.ClientId,[this.data.ActiveGalleryItems])):this.redirectToAlbum()},n.prototype.showNextMediaObject=function(n){if(typeof tinyMCE!="undefined"&&tinyMCE.activeEditor&&tinyMCE.activeEditor.destroy(),this.data.MediaItem=this.getNextMediaObject(),this.data.MediaItem==null&&this.data.Settings.SlideShowLoop&&this.data.Album.MediaItems.length>0){for(var u=this.data.Album.MediaItems[0];u&&u.MimeType!==r.MimeType.Image;)u=this.data.Album.MediaItems[t.inArray(u,this.data.Album.MediaItems)+1];this.data.MediaItem=u}this.data.MediaItem?(n&&n.preventDefault(),this.data.ActiveGalleryItems=[i.convertMediaItemToGalleryItem(this.data.MediaItem)],t("#"+this.data.Settings.ClientId+"_moid").val(this.data.MediaItem.Id.toString()),this.setSize(),this.render(),this.$target.trigger("next."+this.data.Settings.ClientId,[this.data.ActiveGalleryItems])):this.redirectToAlbum()},n.prototype.showMediaObject=function(n){this.data.MediaItem=i.findMediaItem(this.data,n);this.data.MediaItem?(this.data.ActiveGalleryItems=[i.convertMediaItemToGalleryItem(this.data.MediaItem)],t("#"+this.data.Settings.ClientId+"_moid").val(this.data.MediaItem.Id.toString()),this.setSize(),this.render(),this.$target.trigger("mediaUpdate."+this.data.Settings.ClientId,[this.data.ActiveGalleryItems])):this.redirectToAlbum()},n.prototype.getPreviousMediaObject=function(){return this.data.Album.MediaItems[t.inArray(this.data.MediaItem,this.data.Album.MediaItems)-1]},n.prototype.getNextMediaObject=function(){if(this.data.Settings.SlideShowIsRunning){var n=this.data.MediaItem;do n=this.data.Album.MediaItems[t.inArray(n,this.data.Album.MediaItems)+1];while(n&&n.MimeType!==r.MimeType.Image);return n}return this.data.Album.MediaItems[t.inArray(this.data.MediaItem,this.data.Album.MediaItems)+1]},n.prototype.redirectToAlbum=function(){window.location.href=i.GetAlbumUrl(this.data.Album.Id,!0)},n.prototype.runMediaObjectScript=function(){this.data.MediaItem.Views[this.data.MediaItem.ViewIndex].ScriptOutput.length>0&&new Function(this.data.MediaItem.Views[this.data.MediaItem.ViewIndex].ScriptOutput)()},n.prototype.getPermalink=function(n){return i.GetUrl(document.location.href,{moid:n})},n.prototype.overwriteMediaObject=function(){for(var n=0;n<this.data.Album.MediaItems.length;n++)if(this.data.Album.MediaItems[n].Id===this.data.MediaItem.Id){this.data.MediaItem=this.data.Album.MediaItems[n];return}},n.prototype.attachEvents=function(){var n=this;t("#"+this.data.Settings.MediaClientId).on("metaUpdate."+this.data.Settings.ClientId,function(t,i){n.onMetaUpdate(t,i)});this.addCursorNavigationHandler()},n.prototype.attachMediaEvents=function(){var n=this;t(".gsp_mvPrevBtn",this.$target).on("click",function(t){n.showPreviousMediaObject(t)});t(".gsp_mvNextBtn",this.$target).on("click",function(t){n.showNextMediaObject(t)});i.isTouchScreen&&t(".gsp_moContainer",this.$target).touchwipe({preventDefaultEvents:!1,wipeLeft:function(){n.showNextMediaObject()},wipeRight:function(){n.showPreviousMediaObject()}})},n.prototype.addCursorNavigationHandler=function(){var n=this;if(this.data.Settings.ShowMediaObjectNavigation)t(document.documentElement).on("keydown."+this.data.Settings.ClientId,function(t){t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&(t.keyCode===r.KeyCode.CursorLeft&&n.showPreviousMediaObject(t),t.keyCode===r.KeyCode.CursorRight&&n.showNextMediaObject(t))})},n.prototype.removeCursorNavigationHandler=function(){t(document.documentElement).off("keydown."+this.data.Settings.ClientId)},n.prototype.onMetaUpdate=function(n,t){t.MetaItem.MTypeId===r.MetaType.Title?this.render():t.MetaItem.MTypeId===r.MetaType.HtmlSource&&this.render()},n.prototype.preloadImages=function(){var n=this,i=t.map(this.data.Album.MediaItems,function(t){for(var i=0;i<t.Views.length;i++)if(t.Views[i].ViewType===r.MimeType.Image&&t.Views[i].ViewSize===n.data.Settings.MediaViewSize)return t.Views[i].Url;return null});t.each(i,function(n,i){t("<img>").attr("src",i)})},n}();t.widget("gs.gsThumbnails",{options:{clientId:""},_create:function(){var n=f[this.options.clientId].gsData;this.gsThumbnails=new ut(this.element,n,this.options)},renderThumbnails:function(){this.gsThumbnails.renderThmbView()},selectThumbnails:function(){this.gsThumbnails.selectThumbnails()},deselectThumbnails:function(){this.gsThumbnails.deselectThumbnails()}});ut=function(){function n(n,t,i){if(this.hndleDom="<div class='hndl'><span class='fa fa-arrows'><\/span><\/div>",this.$target=n,this.data=t,this.gsThumbnailsOptions=i,!this.data.Album.GalleryItems){u.show("Cannot Render Album","<p>Cannot render the album thumbnails. Navigate to an album and then return to this page.<\/p><p>You'll know you got it right when you see 'aid' In the URL's query string.<\/p><p>ERROR: data.Album.GalleryItems is null.<\/p>",{msgType:"error",autoCloseDelay:0});return}this.jsRenderSetup();this.attachEvents();this.renderThmbView()}return n.prototype.attachEvents=function(){var n=this;t("#"+this.data.Settings.ThumbnailClientId).on("metaUpdate."+this.data.Settings.ClientId,function(t,i){n.onMetaUpdate(t,i)})},n.prototype.onMetaUpdate=function(n){var i=t(".ui-selected",n.currentTarget);this.renderThmbView();t(".thmb",this.$target).filter(function(n,r){return i.is("li[data-id="+t(r).data("id")+"][data-it="+t(r).data("it")+"]")}).addClass("ui-selected")},n.prototype.renderThmbView=function(){var i=t.render[this.data.Settings.ThumbnailTmplName](this.data),n;this.renderPager(i)||(n=t(i),this.activateImages(n),this.$target.empty().append(n),this.configThmbs());this.configHeader()},n.prototype.selectThumbnails=function(){t(".thmb",this.$target).addClass("ui-selected");this.triggerThumbnailSelectionStopEvent()},n.prototype.deselectThumbnails=function(){t(".thmb",this.$target).removeClass("ui-selected");this.triggerThumbnailSelectionStopEvent()},n.prototype.triggerThumbnailSelectionStopEvent=function(){var n=t(".thmb",this.$target).parent().selectable("option","stop");typeof n=="function"&&n()},n.prototype.configHeader=function(){var n=this;t(".gsp_abm_sum",this.$target).click(function(){t(".thmb",n.$target).removeClass("ui-selected");n.data.ActiveGalleryItems=[i.convertAlbumToGalleryItem(n.data.Album)];n.$target.trigger("select."+n.data.Settings.ClientId,[n.data.ActiveGalleryItems])})},n.prototype.pagerRequired=function(){return this.data.Settings.PageSize>0&&this.data.Album.GalleryItems.length>this.data.Settings.PageSize},n.prototype.activateImages=function(n){t("img.gsp_thmb_img",n).each(function(n,t){t.getAttribute("srcDelay")&&(t.setAttribute("src",t.getAttribute("srcDelay")),t.removeAttribute("srcDelay"))})},n.prototype.renderPager=function(n){var f=this,i,r,u;if(!this.pagerRequired())return!1;var e=t(n),o=e.find(".thmb").clone(),s=e.find(".thmb").remove().end(),h={format:"[< c >]",page:null,lapping:0,perpage:this.data.Settings.PageSize,onSelect:function(n,t){return f.onPagerSelect(n,t,o)},onFormat:function(n,t){return f.onPagerFormat(n,t)}};this.$target.html(s);i=t();r='<div class="gsp_pager"><\/div>';(this.data.Settings.PagerLocation==="Top"||this.data.Settings.PagerLocation==="TopAndBottom")&&(i=t(r).prependTo(this.$target));(this.data.Settings.PagerLocation==="Bottom"||this.data.Settings.PagerLocation==="TopAndBottom")&&(i=i.add(t(r).appendTo(this.$target)));u=i.paging(this.data.Album.GalleryItems.length,h);t(window).on("hashchange",function(){window.location.hash?u.setPage(parseInt(window.location.hash.substr(1),10)):u.setPage(1)});return t(window).trigger("hashchange"),!0},n.prototype.onPagerSelect=function(n,i,r){var f=n.slice,u;return t(".thmb",this.$target).remove(),u=r.slice(f[0],f[1]),this.activateImages(u),t(".gsp_abm_thmbs").append(u.hide().fadeIn()),this.configThmbs(),this.$target.trigger("page."+this.data.Settings.ClientId,this),!0},n.prototype.onPagerFormat=function(n,t){switch(t){case"block":return'<span class="gsp_pagerText">'+this.data.Resource.AbmPgrStatus.format(n.value,n.pages)+"<\/span>";case"next":return n.active?'<a href="#'+n.value+'" title="'+this.data.Resource.AbmPgrNextTt+'"><\/a>':'<span class="gsp_disabled"><\/span>';case"prev":return n.active?'<a href="#'+n.value+'" title="'+this.data.Resource.AbmPgrPrevTt+'"><\/a>':'<span class="gsp_disabled"><\/span>';case"first":return n.active?'<a href="#'+n.value+'" title="'+this.data.Resource.AbmPgrFirstTt+'" class="gsp_first-child"><\/a>':'<span class="gsp_disabled gsp_first-child"><\/span>';case"last":return n.active?'<a href="#'+n.value+'" title="'+this.data.Resource.AbmPgrLastTt+'" class="gsp_last-child"><\/a>':'<span class="gsp_disabled gsp_last-child"><\/span>';default:return""}},n.prototype.thmbSelected=function(){var r=this,n=t.map(t(".ui-selected",this.$target),function(n){var i=t(n),u=i.data("id"),f=i.data("it");return t.map(r.data.Album.GalleryItems,function(n){return n.Id===u&&n.ItemType===f?n:null})[0]});this.data.Album.Permissions.EditAlbum&&this.data.Album.SortById===o.IntMinValue&&i.isTouchScreen()&&n.length===1&&t(".ui-selected",this.$target).prepend(this.hndleDom);this.data.ActiveGalleryItems=n.length>0?n:[i.convertAlbumToGalleryItem(this.data.Album)];n.length===1&&n[0].Id===o.IntMinValue||t(".mce-edit-focus",this.$target).blur();this.$target.trigger("select."+this.data.Settings.ClientId,[this.data.ActiveGalleryItems])},n.prototype.thmbUnselected=function(n,i){t(".hndl",i.unselected).remove()},n.prototype.configThmbs=function(){var r=this,n=t(".thmb",this.$target),f,s;n.equalSize();f=i.isTouchScreen()&&i.isWidthLessThan(750);f?n.click(function(i){n.removeClass("ui-selected").filter(t(i.currentTarget)).addClass("ui-selected");r.thmbSelected(i,null)}):n.parent().selectable({filter:"li",cancel:"a,.hndl,input,.mce-edit-focus",stop:this.thmbSelected.bind(this),unselected:this.thmbUnselected.bind(this)});this.data.Album.Permissions.EditAlbum&&this.data.Album.SortById===o.IntMinValue&&(s=function(n,r){var f=r.item,o;f.addClass("gsp_wait");o=t.map(f.parent().children(),function(n){var i=t(n),r=i.data("id"),u=i.data("it");return{Id:r,ItemType:u}});e.sortGalleryItems(o,function(){f.removeClass("gsp_wait")},null,function(n){u.show("Cannot Save",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},n.css({"-ms-touch-action":"none","touch-action":"none"}).parent().sortable({start:function(n,t){t.placeholder.width(t.helper.width());t.placeholder.height(t.helper.height())},stop:s,scroll:!0,containment:"document",cursor:"move",handle:".hndl"}),i.isTouchScreen()||n.hover(function(n){t(n.currentTarget).prepend(r.hndleDom)},function(n){t(".hndl",t(n.currentTarget)).remove()}))},n.prototype.jsRenderSetup=function(){var n=this;t.views.converters({stripHtmlAndTruncate:function(t){var r=t.replace(/(<[^<>]*>)/g,""),u=n.data.Settings.MaxThmbTitleDisplayLength;return r.length>u?i.escape(r.substr(0,u))+"...":i.escape(r)}})},n}();t.fn.gspMeta=function(n,i){var r=this;return this.each(function(){if(!t.data(this,"plugin_gspMeta")){var u=new ft;u.init(r,n,i);t.data(this,"plugin_gspMeta",u)}})};t.fn.gspMeta.defaults={tmplName:""};ft=function(){function n(){}return n.prototype.init=function(n,i,r){this.$target=n;this.data=i;this.settings=t.extend({},t.fn.gspMeta.defaults,r);this.bindData();t("#"+this.data.Settings.MediaClientId).on("next."+this.data.Settings.ClientId+" previous."+this.data.Settings.ClientId+" mediaUpdate."+this.data.Settings.ClientId,t.proxy(this.showMeta,this));t("#"+this.data.Settings.ThumbnailClientId).on("select."+this.data.Settings.ClientId,t.proxy(this.showMeta,this))},n.prototype.bindData=function(){var n=this,f,o;this.$target.removeClass("gsp_wait").html(t.render[this.settings.tmplName](this.data));t(".gsp_m1Row:last").after('<tr class="gsp_mSep"><td colspan="2"><\/td><\/tr>');f=this.data.ActiveMetaItems.length>0;o=function(f){var o,s;t.each(n.data.ActiveGalleryItems,function(n,t){t.IsAlbum?o=!0:s=!0});var h=(!o||n.data.Album.Permissions.EditAlbum)&&(!s||n.data.Album.Permissions.EditMediaObject),c=n.data.Album.VirtualType!==r.VirtualAlbumType.NotVirtual,l=n.data.ActiveGalleryItems.length>=0&&n.data.ActiveGalleryItems[0].Id!==n.data.Album.Id;!h&&c&&l&&n.data.User.IsAuthenticated?e.canUserEdit(n.data.ActiveGalleryItems,null,function(t){f.apply(n,[t])},function(n){u.show("Cannot Determine User Permission",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}):f.apply(n,[h])};f&&o(function(t){t?n.makeMetaEditable():n.convertTagsToLinks()});this.configureRating()},n.prototype.convertTagsToLinks=function(){var n=this;t.each(["tag","people"],function(r,u){var f=t(".gsp_meta tr td.gsp_m"+u,n.$target),e=t.map(f.text().split(","),function(n){var t=n.trim(),r;return t.length>0?(r={title:null,tag:null,people:null,search:null,latest:null,filter:null,rating:null,top:null,aid:null,moid:null},r[u]=t.replace(/\s+\(\d+\)$/gi,""),'<a href="'+i.GetUrl(window.location.href,r)+'" class="gsp_mtaglink">'+t+"<\/a>"):null});f.text("").html(e.join(""))})},n.prototype.configureRating=function(){var n=this,r=t("tr[data-editmode=2] .gsp_rating, tr[data-editmode=3] .gsp_rating",this.$target);if(r.length>0&&(this.data.User.IsAuthenticated||this.data.Settings.AllowAnonymousRating))r.rateit({min:0,max:5,resetable:!1}).on("rated",function(r,f){n.$target.addClass("gsp_wait");var o=n.getMetaItem(t(r.target).closest(".gsp_m2Row").data("id")).MTypeId,s={GalleryItems:n.data.ActiveGalleryItems,MetaItem:{MTypeId:o,Value:f}};e.saveMeta(s,function(){n.$target.removeClass("gsp_wait")},function(t){switch(t.ActionResult.Status){case"Success":n.syncGalleryDataOnMetaUpdate(t);break;case"Info":case"Warning":case"Error":u.show(t.ActionResult.Title,t.ActionResult.Message,{msgType:t.ActionResult.Status.toLowerCase(),autoCloseDelay:0})}},function(n){u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})});else t(".gsp_rating",this.$target).rateit({min:0,max:5,resetable:!1,readonly:!0})},n.prototype.syncGalleryDataOnMetaUpdate=function(n){for(var f,h,c,l,e=0;e<n.GalleryItems.length;e++){var u=n.GalleryItems[e],o=void 0,s=i.findGalleryItem(this.data,u.Id,u.ItemType);if(s!=null)switch(n.MetaItem.MTypeId){case r.MetaType.Title:s.Title=n.MetaItem.Value;break;case r.MetaType.Caption:s.Caption=n.MetaItem.Value}if(f=i.findMediaItem(this.data,u.Id,u.ItemType),f!=null){switch(n.MetaItem.MTypeId){case r.MetaType.Title:f.Title=n.MetaItem.Value;break;case r.MetaType.HtmlSource:h=i.getView(f,r.ViewSize.External);h&&(h.HtmlOutput=n.MetaItem.Value)}o=f.MetaItems}if(this.data.Album!=null&&this.data.Album.Id===u.Id&&u.ItemType===r.ItemType.Album){switch(n.MetaItem.MTypeId){case r.MetaType.Title:this.data.Album.Title=n.MetaItem.Value;break;case r.MetaType.Caption:this.data.Album.Caption=n.MetaItem.Value}o=this.data.Album.MetaItems}o!=null&&(c=i.findMetaItem(o,n.MetaItem.MTypeId),c!=null&&(c.Value=n.MetaItem.Value));l=t.grep(this.data.ActiveMetaItems,function(t){return t.MTypeId===n.MetaItem.MTypeId})[0];l!=null&&(l.Value=n.MetaItem.Value)}},n.prototype.makeMetaEditable=function(){var n=this,h={selector:"#"+this.data.Settings.RightPaneClientId+" tr[data-editMode=2] .gs_vv",menubar:!1,inline:!0,skin:this.data.App.Skin,plugins:["placeholder"],toolbar:!1,forced_root_block:!1,verify_html:!1,placeholder_text:this.data.Resource.MetaEditPlaceholder,setup:function(f){var s="sgi",h="sk",c=function(n){return n.closest("tr").data("id")},o=function(n){return"cmi_"+c(n).toString()};f.on("init",function(){t(f.getBody()).on("click","a[href]",function(n){window.location.href=t(n.currentTarget).attr("href")})});f.on("focus",function(u){var e=t(u.target.targetElm),f,l;e.data(h,!0);n.$target.data(s,n.data.ActiveGalleryItems);f=n.getMetaItem(c(e));n.$target.data(o(e),f);f.EditMode===r.PropertyEditorMode.PlainTextEditor?(l=tinyMCE.get(u.target.id),l.setContent(i.htmlEncode(f.Value))):f.MTypeId===r.MetaType.HtmlSource&&tinyMCE.get(u.target.id).setContent(f.Value);t("#"+n.data.Settings.MediaClientId).gsMedia("removeCursorNavigationHandler")});f.on("blur",function(f){var a=tinyMCE.get(f.target.id),l=t(a.targetElm),v=a.isDirty()||n.data.ActiveGalleryItems.length>1&&a.getContent().length===0;if(v){var y=n.$target.data(s),c=n.$target.data(o(l)),p=c.EditMode===r.PropertyEditorMode.TinyMCEHtmlEditor?"html":"text",w={GalleryItems:y,MetaItem:{MTypeId:c.MTypeId,Value:a.getContent({format:p})}},b=l.parent().addClass("gsp_wait_center");e.saveMeta(w,function(){b.removeClass("gsp_wait_center")},function(e){switch(e.ActionResult.Status){case"Success":case"Info":case"Warning":n.syncGalleryDataOnMetaUpdate(e);c.MTypeId===r.MetaType.HtmlSource?tinyMCE.get(f.target.id).targetElm.innerHTML=i.htmlEncode(e.MetaItem.Value):c.EditMode===r.PropertyEditorMode.PlainTextEditor&&(tinyMCE.get(f.target.id).targetElm.innerHTML=e.MetaItem.Value);t("#"+n.data.Settings.MediaClientId).trigger("metaUpdate."+n.data.Settings.ClientId,[e]);t("#"+n.data.Settings.ThumbnailClientId).trigger("metaUpdate."+n.data.Settings.ClientId,[e]);var o=typeof l.data(h)=="undefined",s=function(t){var i=!1;return t.length>0&&t.forEach(function(t){t.Id===n.data.ActiveGalleryItems[n.data.ActiveGalleryItems.length-1].Id&&(i=!0)}),i};o&&s(e.GalleryItems)&&t("#"+n.data.Settings.ThumbnailClientId).trigger("select."+n.data.Settings.ClientId,[n.data.ActiveGalleryItems]);break;case"Error":l.html(c.Value).nextAll("label").toggle(c.Value.length===0)}e.ActionResult.Status!=="Success"&&u.show(e.ActionResult.Title,e.ActionResult.Message,{msgType:e.ActionResult.Status.toLowerCase(),autoCloseDelay:0})},function(n){l.html(c.Value).nextAll("label").toggle(c.Value.length===0);u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})}t("#"+n.data.Settings.MediaClientId).gsMedia("addCursorNavigationHandler")});f.on("keydown",function(u){var f=tinyMCE.get(u.target.id),e;return u.keyCode===r.KeyCode.Escape?(e=n.$target.data(o(t(f.targetElm))),f.setContent(e.MTypeId===r.MetaType.HtmlSource?i.htmlEncode(e.Value):e.Value),f.setDirty(!1),f.targetElm.blur(),!1):u.keyCode===r.KeyCode.Enter&&n.$target.data(o(t(f.targetElm))).EditMode===r.PropertyEditorMode.PlainTextEditor?(f.targetElm.blur(),!1):!0})}},o,s;tinyMCE.init(h);this.data.App.License>=r.LicenseLevel.HomeNonprofit&&(o=i.deepCopy(h),o.selector="#"+this.data.Settings.RightPaneClientId+" tr[data-editMode=3] section",o.plugins=["code autolink image link textcolor placeholder"],o.image_advtab=!0,o.verify_html=!1,o.toolbar1="formatselect fontsizeselect forecolor backcolor image",o.toolbar2="undo redo | code bold italic link | alignleft aligncenter alignright | bullist numlist indent",delete o.forced_root_block,tinyMCE.init(o));s=function(n){return n.contents().filter(function(n,t){return t.nodeType===3}).text().trim().replace(/\s+\(\d+\)$/gi,"")};t(".gsp_ns .gsp_meta tr[data-editmode=2] .gsp_mtag,.gsp_ns .gsp_meta tr[data-editmode=2] .gsp_mpeople").each(function(r,o){t(o).html("<input class='' value='"+i.escape(t(o).text())+"' placeholder='"+n.data.Resource.MetaEditPlaceholder+"' />");var c=!1,h=t("input",t(o)),l=h.closest(".gsp_mtag").length>0?"tags":"people";h.autoSuggest(f.AppRoot+"/api/meta/"+l,{extraParams:"&galleryId="+n.data.Settings.GalleryId,preFill:h.val(),minChars:1,startText:"",selectionClick:function(n){var t=n.parents(".gsp_mtag").length===0?null:s(n),r=n.parents(".gsp_mpeople").length===0?null:s(n);window.location.href=i.GetUrl(window.location.href,{title:null,tag:t,people:r,search:null,latest:null,filter:null,rating:null,top:null,aid:null,moid:null})},selectionAdded:function(t){if(c){t.addClass("gsp_wait_spinner");var r=t.contents().filter(function(n,t){return t.nodeType===3}).text().trim(),f=n.getMetaItem(t.closest(".gsp_mRowDtl").data("id")).MTypeId,o={GalleryItems:n.data.ActiveGalleryItems,MetaItem:{MTypeId:f,Value:r}};e.saveMeta(o,function(){t.removeClass("gsp_wait_spinner")},function(r){var f,e;switch(r.ActionResult.Status){case"Success":case"Info":case"Warning":n.data.MediaItem!=null&&(f=i.findMetaItem(n.data.MediaItem.MetaItems,r.MetaItem.MTypeId),f!=null&&(f.Value+=", "+r.MetaItem.Value));n.data.ActiveGalleryItems.length>1&&(e=t.contents().filter(function(n,t){return t.nodeType===3})[0],e.textContent=e.textContent+" ("+n.data.ActiveGalleryItems.length+")")}r.ActionResult.Status!=="Success"&&u.show(r.ActionResult.Title,r.ActionResult.Message,{msgType:r.ActionResult.Status.toLowerCase(),autoCloseDelay:0})},function(n){u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})}},selectionRemoved:function(r){r.animate({opacity:.2},"slow",function(){r.addClass("gsp_wait_spinner")});var o=s(r),h=n.getMetaItem(r.closest(".gsp_mRowDtl").data("id")).MTypeId,f={GalleryItems:n.data.ActiveGalleryItems,MetaItem:{MTypeId:h,Value:o}};e.deleteMeta(f,null,function(){if(r.remove(),n.data.MediaItem!=null){var u=i.findMetaItem(n.data.MediaItem.MetaItems,h);u!=null&&(u.Value=t.grep(u.Value.split(/\s*,\s*/),function(n){return n!==o}).join(", "))}t("#"+n.data.Settings.MediaClientId).trigger("metaUpdate."+n.data.Settings.ClientId,[f]);t("#"+n.data.Settings.ThumbnailClientId).trigger("metaUpdate."+n.data.Settings.ClientId,[f])},function(n){u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})}});c=!0})},n.prototype.getMetaItem=function(n){return t.grep(this.data.ActiveMetaItems,function(t){return t.Id===n})[0]},n.prototype.showMeta=function(n,t){var s=this,c,h,l,a;if(this.$target.addClass("gsp_wait"),c=t!=null&&t.length===1&&t[0].ItemType!==r.ItemType.Album&&this.data.MediaItem!=null&&this.data.MediaItem.Id===t[0].Id,c&&this.data.MediaItem.MetaItems){this.data.ActiveMetaItems=this.data.MediaItem.MetaItems;this.bindData();return}t==null||t.length<1?(this.data.ActiveMetaItems=[],this.bindData()):t.length===1?(h=t[0],h.Id===o.IntMinValue?(this.data.ActiveMetaItems=this.data.Album.MetaItems,this.bindData()):(l=h.ItemType===r.ItemType.Album?"albums":"mediaitems",a=f.AppRoot+"/api/"+l+"/"+h.Id+"/meta",e.getAsJson(a,null,null,function(n){s.data.ActiveMetaItems=n;s.data.MediaItem!=null&&(s.data.MediaItem.MetaItems=n);s.bindData()},function(n){s.$target.removeClass("gsp_wait");u.show("Cannot Retrieve Data From Server",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}))):e.getMeta(t,null,function(n){s.data.ActiveMetaItems=n;s.data.MediaItem!=null&&(s.data.MediaItem.MetaItems=n);s.bindData()},function(n){u.show("Cannot Retrieve Data",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},n}();t.widget("gs.gsHeader",{options:{clientId:""},_create:function(){this.gsHeader=new et(this.element,f[this.options.clientId].gsData);this.gsHeader.initialize()}});et=function(){function n(n,s){var h=this;this.viewSizeClick=function(n){var f=t(n.currentTarget).parent().siblings(".gs_rbn_hm_vs").removeClass("gs_rbn_tab_slctd").end().addClass("gs_rbn_tab_slctd"),r=parseInt(f.data("size"),10);return r===h.data.Settings.MediaViewSize?!0:(h.data.Settings.MediaViewSize=r,t("#"+h.data.Settings.MediaClientId).gsMedia("render").gsMedia("preloadImages"),h.data.User.GalleryId=h.data.Album.GalleryId,h.data.User.MediaViewSize=h.data.Settings.MediaViewSize,h.data.User.SlideShowType=h.data.Settings.SlideShowType,h.data.User.SlideShowLoop=h.data.Settings.SlideShowLoop,e.saveCurrentUserProfile(h.data.User,null,null,function(n){u.show("Could not update user profile",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}),!0)};this.selectClick=function(n){var i=t(n.currentTarget).data("action")==="select"?"selectThumbnails":"deselectThumbnails";return t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails(i),!0};this.slideShowOptionsClick=function(n){var f=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),r=t(".gs_rbn_hm_ss_mr_dlg",h.$target);if(r.is(":ui-dialog")){if(r.dialog("isOpen"))return r.dialog("close"),f.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180"),!1}else{t(".gs_rbn_mr_dlg_ss_type",r).on("change",function(n){return h.data.Settings.SlideShowType=parseInt(n.currentTarget.value,10),h.data.User.GalleryId=h.data.Album.GalleryId,h.data.User.MediaViewSize=h.data.Settings.MediaViewSize,h.data.User.SlideShowType=h.data.Settings.SlideShowType,h.data.User.SlideShowLoop=h.data.Settings.SlideShowLoop,e.saveCurrentUserProfile(h.data.User,null,null,function(n){u.show("Could not update user profile",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}),!0});t(".gs_rbn_mr_dlg_ss_loop",r).on("click",function(n){return h.data.Settings.SlideShowLoop=t(n.currentTarget).prop("checked"),h.data.User.GalleryId=h.data.Album.GalleryId,h.data.User.MediaViewSize=h.data.Settings.MediaViewSize,h.data.User.SlideShowType=h.data.Settings.SlideShowType,h.data.User.SlideShowLoop=h.data.Settings.SlideShowLoop,e.saveCurrentUserProfile(h.data.User,null,null,function(n){u.show("Could not update user profile",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}),!0})}return r.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:320,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:f},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_hm_ss").length===0&&(r.dialog("close"),f.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180"),t(document).unbind(n))})},close:function(){f.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180")}}),t(".fa",f).addClass("fa-rotate-180"),!0};this.slideShowClick=function(n){var o,f,e;return h.data.Settings.SlideShowIsRunning?(t("#"+h.data.Settings.MediaClientId).gsMedia("stopSlideshow"),t(".gs_rbn_hm_ss_icon",t(n.currentTarget)).removeClass("fa-pause").addClass("fa-eject fa-rotate-90")):h.data.MediaItem!=null?(t("#"+h.data.Settings.MediaClientId).gsMedia("startSlideshow"),h.data.Settings.SlideShowIsRunning&&h.data.Settings.SlideShowType===r.SlideShowType.Inline&&t(".gs_rbn_hm_ss_icon",t(n.currentTarget)).removeClass("fa-eject fa-rotate-90").addClass("fa-pause")):(o=function(){return h.data.Album!=null&&h.data.Album.GalleryItems!=null?t.grep(h.data.Album.GalleryItems,function(n){return n.ItemType===r.ItemType.Image})[0]:null},f=o(),f!=null?(e={aid:null,moid:null,ss:"1"},e.moid=f.Id,window.location.href=i.GetUrl(document.location.href,e)):u.show(h.data.Resource.MoNoSsHdr,h.data.Resource.MoNoSsBdy,{msgType:"info"})),!0};this.downloadClick=function(n){var s=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),o=t(".gs_rbn_hm_dl_mr_dlg",h.$target);if(o.is(":ui-dialog")){if(o.dialog("isOpen"))return o.dialog("close"),s.removeClass("gs_rbn_tab_slctd"),!1}else{t(".chkCheckUncheckAll",o).on("click",h.toggleThumbnailSelection);t(".gs_rbn_hm_dl_btn",o).button();t(".gs_rbn_hm_dl_btn",o).click(function(n){var c,l,a;return document.getElementById(h.data.Settings.ThumbnailClientId)!==null&&t("#"+h.data.Settings.ThumbnailClientId+" .thmb.ui-selected").length===0?(u.show("No Thumbnail Selected","Select one or more thumbnails and try again.",{msgType:"warning"}),!1):(c=parseInt(t(".gs_rbn_mr_dlg_mv_size",o).val(),10),h.data.ActiveGalleryItems.length===1&&h.data.ActiveGalleryItems[0].ItemType!==r.ItemType.Album?(l=h.data.ActiveGalleryItems[0],l.ItemType===r.ItemType.External&&c!==r.ViewSize.Thumbnail?u.show("Download not available","External media objects cannot be downloaded. However, the source HTML can be accessed in the right pane.",{msgType:"info",autoCloseDelay:0}):(a=i.getView(l,c),document.location.href=a.Url+"&sa=1",o.dialog("close"),s.removeClass("gs_rbn_tab_slctd"))):(t(n.currentTarget).siblings(".gs_rbn_hm_dl_btn_lbl").toggleClass("gsp_invisible"),e.prepareZipDownload(h.data.ActiveGalleryItems,c,function(){t(n.currentTarget).siblings(".gs_rbn_hm_dl_btn_lbl").toggleClass("gsp_invisible");o.dialog("close");s.removeClass("gs_rbn_tab_slctd")},function(n){switch(n.Status){case"Success":document.location.href=i.AddQSParm(f.AppRoot+"/api/mediaitems/downloadzip","filename",n.ActionTarget);break;default:u.show(n.Title,n.Message,{msgType:n.Status.toLowerCase(),autoCloseDelay:0})}},function(n){u.show("Cannot Download",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})),!1)})}return o.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:320,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:s},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_hm_dl").length===0&&(o.dialog("close"),s.removeClass("gs_rbn_tab_slctd"),t(document).unbind(n))})},close:function(){s.removeClass("gs_rbn_tab_slctd")}}),!0};this.shareClick=function(n){var f=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),r=t(".gs_rbn_hm_sh_mr_dlg",h.$target),c,e,o,s,u,a,l;return r.is(":ui-dialog")&&r.dialog("isOpen")?(r.dialog("close"),f.removeClass("gs_rbn_tab_slctd"),!1):(e=null,s=null,h.data.ActiveGalleryItems.length===1?(u=h.data.ActiveGalleryItems[0],a=u.IsAlbum?h.data.Resource.RbnShAbm:h.data.Resource.RbnShAsset,u.IsAlbum?o=i.GetAlbumExternalUrl(u.Id):(s=i.GetEmbedCode(u.Id),l=i.getView(h.data.ActiveGalleryItems[0],h.data.Settings.MediaViewSize),l!=null&&(e=l.Url),o=i.GetMediaExternalUrl(u.Id)),c=a+" <span class='gsp_vibrant'>"+u.Title+"<\/span>"):(o=i.GetAlbumExternalUrl(h.data.Album.Id),c=h.data.Resource.RbnShAbm+" <span class='gsp_vibrant'>"+h.data.Album.Title+"<\/span>"),t(".gs_rbn_mr_dlg_sh_hdr").html(c),t(".gs_rbn_mr_dlg_sh_ipt_url",r).val(o),e!=null?(t(".gs_rbn_mr_dlg_asset_sh_ipt_url",r).val(e),t(".gs_rbn_mr_dlg_sh_asset_pg_hdr,.gs_rbn_mr_dlg_sh_asset_pg_dtl",r).show()):t(".gs_rbn_mr_dlg_sh_asset_pg_hdr,.gs_rbn_mr_dlg_sh_asset_pg_dtl",r).hide(),s!=null?(t(".gs_rbn_mr_dlg_sh_ipt_embed",r).text(s),t(".gs_rbn_mr_dlg_sh_html_hdr,.gs_rbn_mr_dlg_sh_html_dtl",r).show()):t(".gs_rbn_mr_dlg_sh_html_hdr,.gs_rbn_mr_dlg_sh_html_dtl",r).hide(),r.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:i.isWidthLessThan(420)?i.getViewportWidth():420,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:f},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_hm_sh").length===0&&(r.dialog("close"),f.removeClass("gs_rbn_tab_slctd"),t(document).unbind(n))})},close:function(){f.removeClass("gs_rbn_tab_slctd")},create:function(){}}),!0)};this.sortClick=function(n){var o=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),f=t(".gs_rbn_hm_st_mr_dlg",h.$target),s;if(f.is(":ui-dialog")){if(f.dialog("isOpen"))return f.dialog("close"),o.removeClass("gs_rbn_tab_slctd"),!1}else t(".gs_rbn_mr_dlg_st_btn_group a[data-sortup="+h.data.Album.SortUp+"]",f).addClass("gs_rbn_mr_dlg_st_sltd"),s=function(){var s=h.data.Album.Permissions.EditAlbum&&h.data.Album.VirtualType===r.VirtualAlbumType.NotVirtual,n;t(".gs_rbn_mr_dlg_st_mi_ctr .fa").removeClass("fa-check").parent().filter("[data-id="+h.data.Album.SortById+"]").find(".fa").addClass("fa-spinner fa-spin");n=i.deepCopy(h.data.Album);h.data.Album.VirtualType===r.VirtualAlbumType.NotVirtual&&(n.GalleryItems=null);n.MediaItems=null;n.MetaItems=null;n.Permissions=null;e.sortAlbum(n,s,function(){t(".gs_rbn_mr_dlg_st_mi_ctr a[data-id="+h.data.Album.SortById+"] .fa").removeClass("fa-spinner fa-spin").addClass("fa-check");f.dialog("close");o.removeClass("gs_rbn_tab_slctd")},function(n){h.data.Album.GalleryItems!=null&&(h.data.Album.GalleryItems=n,t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("renderThumbnails"))},function(n){u.show("Cannot Sort",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},t(".gs_rbn_mr_dlg_st_btn",f).click(function(n){t(n.currentTarget).addClass("gs_rbn_mr_dlg_st_sltd").siblings().removeClass("gs_rbn_mr_dlg_st_sltd");var i=t(n.currentTarget).data("sortup");return h.data.Album.SortUp!==i&&(h.data.Album.SortUp=i,s()),!1}),t(".gs_rbn_mr_dlg_st_mi_ctr",f).menu({select:function(n,t){var i=t.item.find("a").data("id");i!=null&&(h.data.Album.SortById=i,s())}}).find("a[data-id="+h.data.Album.SortById+"] .fa").addClass("fa-check");return f.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:320,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:o},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_hm_st").length===0&&(f.dialog("close"),o.removeClass("gs_rbn_tab_slctd"),t(document).unbind(n))})},close:function(){o.removeClass("gs_rbn_tab_slctd")}}),!0};this.createAlbumClick=function(n){var o=t(n.currentTarget);if(o.hasClass("gs_rbn_tab_slctd")||(o.addClass("gs_rbn_tab_slctd"),o.parents(".gs_rbn_tab").hasClass("gsp_disabled")))return!1;var s=function(){t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("renderThumbnails")},c=f.AppRoot+"/"+f.GalleryResourcesRoot+"/handler/getmedia.ashx?moid=0&dt=1&g="+h.data.Album.GalleryId,l={Width:h.data.Settings.EmptyAlbumThmbWidth,Height:h.data.Settings.EmptyAlbumThmbHeight,ViewSize:r.ViewSize.Thumbnail,ViewType:r.MimeType.Image,Url:c},a={Id:0,ParentId:0,IsAlbum:!0,MimeType:0,ItemType:r.ItemType.Album,NumAlbums:0,NumMediaItems:0,Caption:"",Title:h.data.Resource.AbmDefTitle,ViewIndex:0,Views:[l]};return h.data.Album.GalleryItems.splice(0,0,a),s(),tinyMCE.init({menubar:!1,inline:!0,skin:h.data.App.Skin,selector:"#"+h.data.Settings.ThumbnailClientId+" .gsp_abm_thmbs li:first .gsp_go_t",toolbar:!1,forced_root_block:!1,setup:function(n){n.on("focus",function(n){i.selectElementContents(n.target.targetElm)});n.on("blur",function(n){var r=tinyMCE.get(n.target.id),f={Title:r.getContent({format:"text"}),ParentId:h.data.Album.Id,GalleryId:h.data.Album.GalleryId},c=t(n.target.targetElm).addClass("gsp_wait_center");e.createAlbum(f,function(){c.removeClass("gsp_wait_center")},function(n){var r,f;switch(n.Status){case"Success":case"Info":case"Warning":o.removeClass("gs_rbn_tab_slctd");r=h.data.Album.GalleryItems[0];r.Title=n.ActionTarget.Title;r.Id=n.ActionTarget.Id;s();f=t("#"+h.data.Settings.ClientId+"_lptv").jstree(!0);f&&(f.create_node(f.get_selected()[0],{text:r.Title,state:{opened:!0},a_attr:{href:i.GetAlbumUrl(r.Id),title:r.Title},li_attr:{id:"tv_"+r.Id,"data-id":r.Id}},"first"),f.open_node(f.get_selected()[0]));break;case"Error":h.data.Album.GalleryItems.gspRemove(0);s()}n.Status!=="Success"&&u.show(n.Title,n.Message,{msgType:n.Status.toLowerCase(),autoCloseDelay:0})},function(n){h.data.Album.GalleryItems.gspRemove(0);s();u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})});n.on("keydown",function(n){var t=tinyMCE.get(n.target.id);return n.keyCode===r.KeyCode.Escape?(t.destroy(),o.removeClass("gs_rbn_tab_slctd"),h.data.Album.GalleryItems.gspRemove(0),s(),!1):n.keyCode===r.KeyCode.Enter?(t.targetElm.blur(),!1):!0})},init_instance_callback:function(){t("#"+h.data.Settings.ThumbnailClientId+" .gsp_abm_thmbs li:first .gsp_go_t").focus()}}),!0};this.transferToAlbumClick=function(n){var s=t(n.currentTarget),o,c;if(t(n.currentTarget).parents(".gs_rbn_tab").hasClass("gsp_disabled"))return!1;if(o=t(".gs_rbn_mng_mt_tv_dlg",h.$target),o.length===0){o=t("<div class='gs_rbn_mng_mt_tv_dlg gsp_dlg'><div class='gs_am_rbn_mt_tv'><div class='gsp_textcenter'><span class='fa fa-2x fa-spinner fa-pulse'><\/span><\/div><\/div><\/div>");o.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!1,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:i.isWidthLessThan(420)?i.getViewportWidth():420,minHeight:0,show:"fade",hide:"fade",open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_mng_mt,.gs_rbn_mng_ct").length===0&&(o.dialog("close"),s.removeClass("gs_rbn_tab_slctd"),t(document).unbind(n))})}});c={galleryId:h.data.Album.Permissions.AdministerSite||h.data.Album.Permissions.AdministerGallery?"all":h.data.Album.GalleryId,containerClientId:h.data.Settings.ClientId,treeDataUrl:f.GalleryResourcesRoot+"/handler/gettreeview.ashx",requiredSecurityPermissions:r.SecurityActions.AddChildAlbum|r.SecurityActions.AddMediaObject,albumIdsToSelect:h.data.Album.Id};t(".gs_am_rbn_mt_tv",o).gsTreeView(null,c);t(".gs_am_rbn_mt_tv",o).on("changed.jstree",function(n,f){if(f.action==="select_node"){t(f.event.currentTarget).append("<span class='fa fa-spinner fa-pulse gsp_addleftmargin3'><\/span>");var s=h.$target.data("transfertype"),c=parseInt(f.node.li_attr["data-id"],10);e[s](c,h.data.ActiveGalleryItems,function(){t(f.event.currentTarget).find(".fa-spinner").remove()},function(n){switch(n.Status){case"Success":u.show(n.Title,n.Message,{msgType:"success"});s==="moveTo"&&h.data.Album.VirtualType===r.VirtualAlbumType.NotVirtual?(h.data.MediaItem!=null?(i.removeMediaItem(h.data,h.data.MediaItem),t("#"+h.data.Settings.MediaClientId).gsMedia("showNextMediaObject")):h.data.Album.GalleryItems!=null&&c!==h.data.Album.Id&&(i.removeGalleryItems(h.data,h.data.ActiveGalleryItems),h.data.ActiveGalleryItems=[i.convertAlbumToGalleryItem(h.data.Album)],t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("renderThumbnails")),t("#"+h.data.Settings.ThumbnailClientId).trigger("select."+h.data.Settings.ClientId,[h.data.ActiveGalleryItems])):s==="copyTo"&&c===h.data.Album.Id&&h.data.Album.GalleryItems!=null&&e.getGalleryItems(h.data.Album.Id,null,function(n){h.data.Album.GalleryItems=n;t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("renderThumbnails")},function(n){u.show("Action Aborted",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})});break;default:u.show(n.Title,n.Message,{msgType:"error",autoCloseDelay:0})}o.dialog("close")},function(n){u.show("Cannot Move Items",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})}})}return o.dialog("isOpen")?o.dialog("close"):(h.$target.data("transfertype",s.data("transfertype")),o.dialog("option","hide",null).dialog("close").dialog("option","hide","fade"),o.dialog("option","position",{my:"left top",at:"left bottom",of:s}),o.dialog("option","close",function(){s.removeClass("gs_rbn_tab_slctd")}),o.dialog("open"),s.addClass("gs_rbn_tab_slctd")),!0};this.replaceFileClick=function(n){var a,o,r,s,c,l;if(h.data.ActiveGalleryItems.length!==1||h.data.ActiveGalleryItems[0].IsAlbum)return!1;if(a=h.data.Resource.RbnShAsset+" <span class='gsp_vibrant'>"+h.data.ActiveGalleryItems[0].Title+"<\/span>",t(".gs_rbn_mr_dlg_rf_hdr").html(a),o=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),r=t(".gs_rbn_mng_rf_mr_dlg",h.$target),r.is(":ui-dialog")){if(r.dialog("isOpen"))return r.dialog("close"),o.removeClass("gs_rbn_tab_slctd"),!1}else t(".gs_rbn_mng_rf_btn",r).button({disabled:!0}),s=function(){var n=function(n){t(".gs_rbn_mng_rf_btn",r).siblings(".gs_rbn_mng_rf_btn_lbl").find(".fa").attr("class",n)},o=function(){t(".plupload_droptext",r).html("Drag file here")},c=function(){t(".plupload_droptext",r).html("")},l=function(r,f){var o=h.data.ActiveGalleryItems[0].Id;e.replaceMediaAssetFile(o,f.file.target_name,f.file.name,function(){},function(r){var s={msgType:r.Status.toLowerCase()},f;(r.Status==="Warning"||r.Status==="Error")&&(s.autoCloseDelay=0);r.Message!=null&&u.show(r.Title,r.Message,s);r.Status==="Success"?(f=t("#"+h.data.Settings.MediaClientId+" .gsp_mo_img, #"+h.data.Settings.ThumbnailClientId+" .thmb[data-id="+o+"] .gsp_thmb_img"),f.add(f.parents(".thmb")).css({width:"",height:""}),t("#"+h.data.Settings.ThumbnailClientId).length>0&&f.parents(".thmb").css({"max-width":h.data.Settings.MaxThumbnailLength+40+"px"}),f.length>0&&typeof f.attr("src")!="undefined"?(f[0].src+="&ver="+(new Date).getTime().toString(),h.data.Album.GalleryItems&&!f[0].complete&&f.load(function(){var n=h.data.Album.GalleryItems.length>1?0:20;t("#"+h.data.Settings.ThumbnailClientId+" .thmb").equalSize(n,0)})):h.data.ActiveGalleryItems.length===1?e.getMediaAsset(h.data.ActiveGalleryItems[0].Id,null,function(n){h.data.MediaItem=n;t("#"+h.data.Settings.MediaClientId).gsMedia("render")},function(n){u.show("Cannot Refresh Media Asset",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}):u.show("Cannot Refresh Media Asset","Refresh your browser to see the updated media asset.",{msgType:"info",autoCloseDelay:0}),n("fa fa-check gsp_msgfriendly")):n("fa fa-close gsp_msgattention")},function(t){u.show("Cannot Replace File",i.parseJqXhrMsg(t),{msgType:"error",autoCloseDelay:0});n("fa fa-close gsp_msgattention")})},a=function(){var n=t(".gs_rbn_mr_dlg_rf_uploader",r).plupload("getUploader");t.each(n.files,function(t,i){return n.removeFile(i)})},v=function(t,i){var r=function(){if(i.error.code===plupload.FILE_SIZE_ERROR)return"File size must be less than "+i.up.settings.max_file_size+". The file '"+i.error.file.name+"' is "+Globalize.format(i.error.file.size/1048576,"n1")+" MB.";if(i.error.code===plupload.FILE_EXTENSION_ERROR)return"The file '"+i.error.file.name+"' has an extension not currently allowed by the gallery configuration. If you are an administrator, you can enable this extension in the site administration.";var n="<p>"+i.error.message+" Code "+i.error.code+".<\/p>";return i.error.file!=null&&(n+="<p>File: "+i.error.file.name+".<\/p>"),i.error.response!=null&&(n+="<p>HTTP response data: "+i.error.response+"<\/p>"),n};u.show("Cannot Replace File",r(),{msgType:"error",autoCloseDelay:0});n("fa fa-close gsp_msgattention")},s;t(".gs_rbn_mr_dlg_rf_uploader",r).plupload({browse_button:null,runtimes:"html5,silverlight,flash,html4",url:"",flash_swf_url:f.GalleryResourcesRoot+"/script/plupload/Moxie.swf",silverlight_xap_url:f.GalleryResourcesRoot+"/script/plupload/Moxie.xap",multi_selection:!1,unique_names:!0,max_file_size:h.data.Settings.MaxUploadSizeKB+" KB",chunk_size:"2mb",views:{list:!1,thumbs:!0,active:"thumbs"},uploaded:l,complete:a,error:v,init:{FilesAdded:function(i){t(".gs_rbn_mng_rf_btn",r).button("option","disabled",i.files.length!==1);c();i.files.length>1?n("fa fa-close gsp_msgattention"):n("fa")},FilesRemoved:function(i){t(".gs_rbn_mng_rf_btn",r).button("option","disabled",i.files.length!==1);i.files.length===1?n("fa"):i.files.length<1&&o()}}});o();s=function(){var i=t(".gs_rbn_mr_dlg_rf_uploader",r).plupload("getUploader"),e=h.data.ActiveGalleryItems[0].Id,o=h.data.ActiveGalleryItems[0].ParentId;i.settings.url=f.GalleryResourcesRoot+"/handler/upload.ashx?aid="+o+"&moid="+e;i.files.length===1?(n("fa fa-spinner fa-pulse"),i.start()):(n("fa"),u.show("Replacement canceled","Select or drag a single replacement file. Multiple replacement files are not supported.",{msgType:"warning",autoCloseDelay:0}))};t(".gs_rbn_mng_rf_btn",r).click(function(n){h.data.ActiveGalleryItems.length!==1||h.data.ActiveGalleryItems[0].IsAlbum?u.show("Replacement canceled","Multiple assets are selected or the selected asset is an album. Select a single media asset and try again.",{msgType:"warning",autoCloseDelay:0}):s(n);n.preventDefault()})},c=function(n,i){t.getScript(n.shift(),n.length?function(){c(n,i)}:i)},jQuery().plupload?s():(l=[f.GalleryResourcesRoot+"/script/plupload/plupload.full.min.js",f.GalleryResourcesRoot+"/script/plupload/jquery.ui.plupload.min.js"],h.data.App.IsDebugEnabled&&(l=[f.GalleryResourcesRoot+"/script/plupload/moxie.js",f.GalleryResourcesRoot+"/script/plupload/plupload.dev.js",f.GalleryResourcesRoot+"/script/plupload/jquery.ui.plupload.js"]),c(l,s)),t(".gs_rbn_hlp_ctr span",r).gsTooltip({title:h.data.Resource.RbnRplTtHdr,content:h.data.Resource.RbnRplTtDtl});return r.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:320,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:o},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_mng_rf").length===0&&(r.dialog("close"),o.removeClass("gs_rbn_tab_slctd"),t(document).unbind(n))})},close:function(){o.removeClass("gs_rbn_tab_slctd")}}),!0};this.appendOriginalFileSizeUsage=function(){var f=function(n){var t=0;return n.ItemType===r.ItemType.Album?t=i.getView(n,r.ViewSize.Original).FileSizeKB:i.hasView(n,r.ViewSize.Optimized)&&i.hasView(n,r.ViewSize.Original)&&(t=i.getView(n,r.ViewSize.Original).FileSizeKB),t<1024?"("+t+" KB)":"("+Globalize.format(t/1024,"n1")+" MB)"},n=function(n,t){var i=n.find(".gs_of_svgs");i.length>0?i.html(t):n.append("<p class='gs_of_svgs gsp_msgsuccess'>"+t+"<\/p>")},u=t("#"+h.data.Settings.ThumbnailClientId+" .thmb");t.each(h.data.Album.GalleryItems,function(t,o){var s=u.filter("[data-id="+o.Id+"][data-it="+o.ItemType+"]");o.ItemType!==r.ItemType.Album||i.hasView(o,r.ViewSize.Original)?n(s,f(o)):(s.find(".gsp_go_t").addClass("gsp_wait"),n(s,"(Estimating savings...)"),e.calculateOriginalFileSize(o,null,function(t){o.Views=t.Views;s.find(".gsp_go_t").removeClass("gsp_wait");n(s,f(o));u.css("height","auto").equalHeights()},null))});u.css("height","auto").equalHeights()};this.deleteOptionsClick=function(n){var r=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),i=t(".gs_rbn_mng_dlt_mr_dlg",h.$target),u=function(){t("#"+h.data.Settings.ThumbnailClientId+" .thmb").find("p.gs_of_svgs").remove().end().css("height","auto").equalHeights()};if(i.is(":ui-dialog")){if(i.dialog("isOpen"))return i.dialog("close"),r.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180"),!1}else{t(".chkCheckUncheckAll",i).on("click",h.toggleThumbnailSelection);t(".gs_delete_db_records_only_lbl",i).gsTooltip({title:h.data.Resource.RbnDelDbRcrdsTtHdr,content:h.data.Resource.RbnDelDbRcrdsTtDtl});t(".gs_delete_original_files_lbl",i).gsTooltip({title:h.data.Resource.RbnDelOrgTtHdr,content:h.data.Resource.RbnDelOrgTtDtl});t(".gs_delete_db_records_only, .gs_delete_original_files",i).on("click",function(n){t(n.currentTarget).hasClass("gs_delete_db_records_only")?(t(".gs_delete_original_files",i).prop("checked",!1),u()):(t(".gs_delete_db_records_only",i).prop("checked",!1),h.data.Album.GalleryItems!=null&&(t(".gs_delete_original_files",i).prop("checked")?h.appendOriginalFileSizeUsage():u()))})}return i.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:"auto",minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:r},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_mng_dlt").length===0&&(i.dialog("close"),r.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180"),t(document).unbind(n))})},close:function(){r.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180")}}),t(".fa",r).addClass("fa-rotate-180"),!0};this.toggleThumbnailSelection=function(n){var i=t(n.target),r=i.data("ischecked");return r?(i.text(h.data.Resource.ThmbSltAll),t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("deselectThumbnails")):(i.text(h.data.Resource.ThmbSltNone),t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("selectThumbnails")),i.data("ischecked",!r),!0};this.deleteClick=function(n){var f;(function(n){n[n.Unknown=0]="Unknown";n[n.Delete=1]="Delete";n[n.DeleteOriginalFiles=2]="DeleteOriginalFiles";n[n.DeleteDbRecordsOnly=3]="DeleteDbRecordsOnly"})(f||(f={}));var s=function(){var n=t(".gs_rbn_mng_dlt_mr_dlg",h.$target);return t(".gs_delete_original_files",n).prop("checked")?f.DeleteOriginalFiles:t(".gs_delete_db_records_only",n).prop("checked")?f.DeleteDbRecordsOnly:f.Delete},c=function(){var o=s(),y=h.data.ActiveGalleryItems.length===1&&h.data.ActiveGalleryItems[0].Id===h.data.Album.Id,p=h.data.Album.VirtualType!==r.VirtualAlbumType.NotVirtual,e,a,v;y&&(p||o===f.DeleteOriginalFiles)&&t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("selectThumbnails");var c=h.data.ActiveGalleryItems.length===1&&h.data.ActiveGalleryItems[0].ItemType!==r.ItemType.Album,l=h.data.ActiveGalleryItems.length===1&&h.data.ActiveGalleryItems[0].ItemType===r.ItemType.Album,n=h.data.ActiveGalleryItems.filter(function(n){return n.ItemType===r.ItemType.Album}).length,u=h.data.ActiveGalleryItems.length-n;switch(o){case f.DeleteOriginalFiles:return e=0,t.each(h.data.ActiveGalleryItems,function(n,t){var u=t.ItemType===r.ItemType.Album&&i.hasView(t,r.ViewSize.Original),f=t.ItemType!==r.ItemType.Album&&i.hasView(t,r.ViewSize.Optimized)&&i.hasView(t,r.ViewSize.Original);(u||f)&&(e+=i.getView(t,r.ViewSize.Original).FileSizeKB)}),a=e<1024?e+" KB":Globalize.format(e/1024,"n1")+" MB","<p>The original file"+(n+u===1?"":"s")+" for "+u+" media asset"+(u===1?"":"s")+" and "+n+" child album"+(n===1?"":"s")+" will be permanently deleted, but the items will stay in the gallery along with their thumbnail and optimized files.<\/p><p class='gsp_msgfriendly'>This is expected to free up "+a+" of disk space.<\/p>";case f.DeleteDbRecordsOnly:return v=c?"<p>The media asset '"+i.removeHtmlTags(h.data.ActiveGalleryItems[0].Title)+"' will be removed from the gallery but the original file will be left in its current location.<\/p>":l?"<p>The album '"+i.removeHtmlTags(h.data.ActiveGalleryItems[0].Title)+"' and its contents will be removed from the gallery but the original directory and files will be left in their current location.<\/p>":"<p>"+u+" media asset"+(u===1?"":"s")+" and "+n+" album"+(n===1?"":"s")+" will be removed from the gallery but the original directories and files will be left in their current location.<\/p>",v+"<p class='gsp_msgfriendly'>You can add them back at a later time with the synchronize function.<\/p>";case f.Delete:default:return c?"<p class='gsp_msgwarning'>The media asset '"+i.removeHtmlTags(h.data.ActiveGalleryItems[0].Title)+"' will be permanently deleted.<\/p>":l?"<p class='gsp_msgwarning'>The album '"+i.removeHtmlTags(h.data.ActiveGalleryItems[0].Title)+"' will be permanently deleted.<\/p>":"<p class='gsp_msgwarning'>"+u+" media asset"+(u===1?"":"s")+" and "+n+" album"+(n===1?"":"s")+" will be permanently deleted.<\/p>"}},l=function(){switch(s()){case f.DeleteOriginalFiles:return"Delete original media files";case f.DeleteDbRecordsOnly:return"Delete from gallery";default:return"Delete"}},a=function(){var n=t(".gs_delete_db_records_only",h.$target).prop("checked");e.deleteGalleryItems(h.data.ActiveGalleryItems,!n,function(){t(".gs_rbn_mng_dlt",h.$target).removeClass("gsp_wait")},function(n){var e={msgType:n.Status.toLowerCase()},f;if((n.Status==="Warning"||n.Status==="Error")&&(e.autoCloseDelay=0),u.show(n.Title,n.Message,e),h.data.MediaItem!=null)i.removeMediaItem(h.data,h.data.MediaItem),t("#"+h.data.Settings.MediaClientId).gsMedia("showNextMediaObject");else if(h.data.Album.GalleryItems!=null){if(f=n.ActionTarget,h.data.ActiveGalleryItems.length===1&&h.data.ActiveGalleryItems[0].Id===h.data.Album.Id&&f.length===h.data.ActiveGalleryItems.length){window.location.href=i.AddQSParm(i.GetAlbumUrl(h.data.Album.ParentId),"msg",String(r.MessageType.AlbumSuccessfullyDeleted));return}i.removeGalleryItems(h.data,f);h.data.ActiveGalleryItems=[i.convertAlbumToGalleryItem(h.data.Album)];t("#"+h.data.Settings.ThumbnailClientId).gsThumbnails("renderThumbnails")}t("#"+h.data.Settings.ThumbnailClientId).trigger("select."+h.data.Settings.ClientId,[h.data.ActiveGalleryItems])},function(n){u.show("Cannot Delete Items",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},v=function(){e.deleteOriginalFiles(h.data.ActiveGalleryItems,function(){t(".gs_rbn_mng_dlt",h.$target).removeClass("gsp_wait")},function(n){var f={msgType:n.Status.toLowerCase()};(n.Status==="Warning"||n.Status==="Error")&&(f.autoCloseDelay=0);u.show(n.Title,n.Message,f);t.each(n.ActionTarget,function(n,t){var e=i.findGalleryItem(h.data,t.Id,t.ItemType),u=i.getView(e,r.ViewSize.Original),f=i.getView(t,r.ViewSize.Original);u!=null&&f!=null&&(u.FileSizeKB=f.FileSizeKB);h.appendOriginalFileSizeUsage()})},function(n){u.show("Cannot Delete Original Files",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})},o=t(".gs_rbn_mg_dlt_confirm_dlg",h.$target);if(!o.is(":ui-dialog")){o.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,resizable:!0,width:i.isWidthLessThan(420)?i.getViewportWidth():420,modal:!0,show:"fade",hide:"fade",position:{my:"center top",at:"right bottom",of:t(n.currentTarget)}});t(".ui-dialog-buttonset button",o).button();t(".gs_rbn_mg_dlt_confirm_dlt_btn",o).on("click",function(){o.dialog("close");t(".gs_rbn_mng_dlt",h.$target).addClass("gsp_wait");t(".gs_delete_original_files",h.$target).prop("checked")?v():a()});t(".gs_rbn_mg_dlt_confirm_cncl_btn",o).on("click",function(){o.dialog("close")})}return t(".gs_rbn_mg_dlt_confirm_msg",o).html(c()),t(".gs_rbn_mg_dlt_confirm_dlt_btn",o).text(l()),o.dialog("open"),!0};this.assignThumbnailOptionsClick=function(n){var u,i,e;if(t(n.currentTarget).parents(".gs_rbn_tab").hasClass("gsp_disabled"))return!1;if(u=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),i=t(".gs_rbn_mng_at_mr_dlg",h.$target),i.is(":ui-dialog")){if(i.dialog("isOpen"))return i.dialog("close"),u.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180"),!1}else{e={galleryId:h.data.Album.GalleryId,containerClientId:h.data.Settings.ClientId,treeDataUrl:f.GalleryResourcesRoot+"/handler/gettreeview.ashx",numberOfLevels:2,requiredSecurityPermissions:r.SecurityActions.EditAlbum,albumIdsToSelect:h.data.Album.Id};t(".gs_rbn_at_tv",i).gsTreeView(null,e);t(".gs_rbn_at_tv",i).on("changed.jstree",function(n,i){i.action==="select_node"&&(t(i.event.currentTarget).append("<span class='fa fa-spinner fa-pulse gsp_addleftmargin3'><\/span>"),t(".gs_rbn_mng_thmb .gs_rbn_btn",h.$target).click())});t(".gs_rbn_hlp_ctr span",i).gsTooltip({title:h.data.Resource.RbnThmbTtHdr,content:h.data.Resource.RbnThmbTtDtl})}return i.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:"auto",minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:u},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_mng_thmb").length===0&&(i.dialog("close"),u.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180"),t(document).unbind(n))})},close:function(){u.removeClass("gs_rbn_tab_slctd").find(".fa").removeClass("fa-rotate-180")}}),t(".fa",u).addClass("fa-rotate-180"),!0};this.assignThumbnailClick=function(){var r=function(){var n=t(".gs_rbn_mng_at_mr_dlg",h.$target);n.is(":ui-dialog")&&n.dialog("isOpen")&&(n.dialog("close"),t(".fa-spinner",n).remove())},n,f,s;return document.getElementById(h.data.Settings.ThumbnailClientId)!==null&&t("#"+h.data.Settings.ThumbnailClientId+" .thmb.ui-selected").length===0?(u.show("No Thumbnail Selected","Select a thumbnail and try again.",{msgType:"warning"}),r(),!1):(n=h.data.Album.Id,f=t(t(".gs_rbn_at_tv",h.$target)).jstree(!0),f&&(s=f.get_selected(!0)[0],s!=null&&(n=s.li_attr["data-id"])),n===o.IntMinValue)?(u.show("No Album Selected","Select an album from the thumbnail options window and try again.",{msgType:"warning"}),r(),!1):(e.assignThumbnail(h.data.ActiveGalleryItems[0],n,function(){r()},function(n){var t={msgType:n.Status.toLowerCase()};(n.Status==="Warning"||n.Status==="Error")&&(t.autoCloseDelay=0);u.show(n.Title,n.Message,t)},function(n){u.show("Cannot Assign Thumbnail",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}),!0)};this.editImageClick=function(n){var e=t(n.currentTarget).addClass("gsp_wait_center"),o=h.data.ActiveGalleryItems[0],f,s;return o.ItemType!==r.ItemType.Image?(u.show("Image Not Selected","Select an image and try again.",{msgType:"warning"}),e.removeClass("gsp_wait_center"),!0):(f=i.getView(o,r.ViewSize.Original),f==null||f.ViewSize!==r.ViewSize.Original)?(u.show("Image Editor Requires Original Image","The image editor requires access to the original, high resolution image, but it is not available. Your security settings may be preventing you from accessing it.",{msgType:"warning",autoCloseDelay:0}),e.removeClass("gsp_wait_center"),!0):!t(f.HtmlOutput).is("img")||!t(f.HtmlOutput).has("img")?(u.show("Unsupported Image Type","The image editor supports browser-compatible images. Unfortunately, the original, high-resolution file associated with this image cannot be displayed in a browser window.",{msgType:"warning",autoCloseDelay:0}),e.removeClass("gsp_wait_center"),!0):(t(".gs_tinymce_wrapper",h.$target).remove(),s=t("<div>",{"class":"gs_tinymce_wrapper",style:"display:none"}).append(f.HtmlOutput).appendTo(h.$target),h.makeImageEditable(s,e),!0)};this.makeImageEditable=function(n,r){typeof tinyMCE=="undefined"&&(u.show("tinyMCE Not Found","The image editor requires tinyMCE, but it was not found.",{msgType:"warning"}),r.removeClass("gsp_wait_center"));tinyMCE.init({selector:"#"+h.data.Settings.HeaderClientId+" .gs_tinymce_wrapper",menubar:!1,inline:!0,skin:h.data.App.Skin,toolbar:!1,plugins:"imagetools",setup:function(i){i.on("init",function(){i.selection.select(t(".gsp_mo_img",n)[0]);i.execCommand("mceEditImage");r.removeClass("gsp_wait_center")})},images_upload_handler:function(r,f,o,s){var l,c,a,v;t("#"+h.data.Settings.MediaClientId+" .gsp_mvMediaHeader, #"+h.data.Settings.ThumbnailClientId+" .gsp_abm_sum").addClass("gsp_wait_center");l=h.data.ActiveGalleryItems[0];c=new XMLHttpRequest;c.open("POST","gs/handler/upload.ashx?aid="+l.ParentId+"&moid="+l.Id);c.withCredentials=!0;s(0);tinyMCE.activeEditor.notificationManager.notifications.length>0&&tinyMCE.activeEditor.notificationManager.notifications[0].$el.css({left:"50%",transform:"translate(-50%, 0)"});a=i.createPseudoGuid()+"."+r.filename().split(".").pop();c.upload.onprogress=function(n){var t=Math.round(n.loaded/n.total*100);s(t)};c.onload=function(){if(c.status!==200){o("HTTP Error: "+c.status);return}e.replaceWithEditedImage(l.Id,a,function(){t("#"+h.data.Settings.MediaClientId+" .gsp_mvMediaHeader, #"+h.data.Settings.ThumbnailClientId+" .gsp_abm_sum").removeClass("gsp_wait_center");n.remove();tinyMCE.activeEditor.destroy()},function(n){var r={msgType:n.Status.toLowerCase()},i;(n.Status==="Warning"||n.Status==="Error")&&(r.autoCloseDelay=0);n.Message!=null&&u.show(n.Title,n.Message,r);n.Status==="Success"&&(i=t("#"+h.data.Settings.MediaClientId+" .gsp_mo_img, #"+h.data.Settings.ThumbnailClientId+" .thmb[data-id="+l.Id+"] .gsp_thmb_img"),i.add(i.parents(".thmb")).css({width:"",height:""}),t("#"+h.data.Settings.ThumbnailClientId).length>0&&i.parents(".thmb").css({"max-width":h.data.Settings.MaxThumbnailLength+40+"px"}),i.length>0&&typeof i.attr("src")!="undefined"?(i[0].src+="&ver="+(new Date).getTime().toString(),h.data.Album.GalleryItems&&!i[0].complete&&i.load(function(){var n=h.data.Album.GalleryItems.length>1?0:20;t("#"+h.data.Settings.ThumbnailClientId+" .thmb").equalSize(n,0)})):u.show("Cannot Refresh Image","Your changes were successfully saved on the server, but we couldn't refresh the image in your browser because an error occurred while trying to find the image element. $imgEl.length=="+i.length,{msgType:"error",autoCloseDelay:0}))},function(n){u.show("Cannot Save Changes",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})};v=new FormData;v.append("name",a);v.append("file",r.blob(),a);c.send(v)}})};this.rotateLeftClick=function(n){return h.rotateFlip(r.RotateFlip.Rotate270FlipNone,n),!0};this.rotateRightClick=function(n){return h.rotateFlip(r.RotateFlip.Rotate90FlipNone,n),!0};this.flipHorizontalClick=function(n){return h.rotateFlip(r.RotateFlip.Rotate0FlipX,n),!0};this.flipVerticalClick=function(n){return h.rotateFlip(r.RotateFlip.Rotate0FlipY,n),!0};this.rotateFlip=function(n,f){var s=function(){switch(n){case r.RotateFlip.Rotate270FlipNone:return"fa-rotate-left";case r.RotateFlip.Rotate90FlipNone:return"fa-rotate-right";case r.RotateFlip.Rotate0FlipX:return"fa-shield fa-rotate-270";case r.RotateFlip.Rotate0FlipY:return"fa-shield fa-rotate-180";default:return null}},c=function(n){return n[0].Views[n[0].ViewIndex].ViewSize},o=t.grep(h.data.ActiveGalleryItems,function(n){return n.ItemType===r.ItemType.Image||n.ItemType===r.ItemType.Video});if(o.length===0){u.show("Image or Video Not Selected","Select an image or video and try again.",{msgType:"warning"});return}t(f.currentTarget).find(".fa").removeClass(s()).addClass("fa-spinner fa-spin");e.rotateFlipMediaAsset(o,n,c(o),function(){t(f.currentTarget).find(".fa").removeClass("fa-spinner fa-spin").addClass(s())},function(n){var i={msgType:n.Status.toLowerCase()},r;(n.Status==="Warning"||n.Status==="Error")&&(i.autoCloseDelay=0);n.Message!=null&&u.show(n.Title,n.Message,i);r=n.ActionTarget;t.each(r,function(n,i){var r=t("#"+h.data.Settings.MediaClientId+" .gsp_mo_img, #"+h.data.Settings.ThumbnailClientId+" .thmb[data-id="+i.Id+"] .gsp_thmb_img");r.add(r.parents(".thmb")).css({width:"",height:""});r.length>0&&typeof r.attr("src")!="undefined"&&(r[0].src+="&ver="+(new Date).getTime().toString(),h.data.Album.GalleryItems&&!r[0].complete&&r.load(function(){var n=h.data.Album.GalleryItems.length>1?0:20;t("#"+h.data.Settings.ThumbnailClientId+" .thmb").equalSize(n,0)}))})},function(n){u.show("Cannot Rotate/Flip",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})})};this.securityClick=function(n){var f=t(n.currentTarget).addClass("gs_rbn_tab_slctd"),r=t(".gs_rbn_mng_sc_mr_dlg",h.$target);if(r.is(":ui-dialog")){if(r.dialog("isOpen"))return r.dialog("close"),f.removeClass("gs_rbn_tab_slctd"),!1}else{t(".gs_rbn_mng_sc_isprivate_lbl",r).gsTooltip({title:h.data.Resource.AbmPvtHdr,content:h.data.Resource.AbmPvtDtl});t(".gs_rbn_mr_pvt_abm_ownr_ipt",r).gsTooltip({title:h.data.Resource.AbmOwnrLbl,content:h.data.Resource.AbmOwnrTtDtl}).on("change",function(n){var r=h.data.Album.Owner;h.data.Album.Owner=t(n.currentTarget).val();r!==h.data.Album.Owner&&(t(n.currentTarget).addClass("gsp_wait_center"),e.changeAlbumOwner(h.data.Album.Id,encodeURIComponent(h.data.Album.Owner),function(){t(n.currentTarget).removeClass("gsp_wait_center");t(n.currentTarget).val(h.data.Album.Owner)},function(n){var t={msgType:n.Status.toLowerCase()};(n.Status==="Warning"||n.Status==="Error")&&(t.autoCloseDelay=0);u.show(n.Title,n.Message,t);h.data.Album.Owner=n.Status==="Error"?r:n.ActionTarget},function(n){h.data.Album.Owner=r;u.show("Cannot Edit Album",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0})}))});t(".gs_rbn_mng_sc_isprivate",r).on("change",function(n){if(!h.data.Settings.AllowAnonBrowsing)return u.show(h.data.Resource.AbmAnonDisabledTitle,h.data.Resource.AbmAnonDisabledMsg,{msgType:"warning",autoCloseDelay:0}),n.currentTarget.checked=!0,!1;var f=t(".gs_isp_icn",r);return h.data.Album.IsPrivate=n.currentTarget.checked,f.removeClass("gsp_gold").toggleClass("fa-lock fa-spinner fa-spin"),e.saveAlbum(h.data.Album,function(){f.toggleClass("fa-lock fa-spinner fa-spin").attr("title",h.data.Album.IsPrivate?h.data.Resource.AbmIsPvtTt:h.data.Resource.AbmNotPvtTt);h.data.Album.IsPrivate&&f.addClass("gsp_gold")},function(){},function(t){h.data.Album.IsPrivate=n.currentTarget.checked=!h.data.Album.IsPrivate;u.show("Cannot Edit Album",i.parseJqXhrMsg(t),{msgType:"error",autoCloseDelay:0})}),!1})}return r.dialog({appendTo:"#"+h.data.Settings.HeaderClientId,autoOpen:!0,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gs_rbn_mr_dlg_container"},width:i.isWidthLessThan(420)?i.getViewportWidth():420,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:f},open:function(){t(document).on("click",function(n){t(n.target).parents(".gs_rbn_mr_dlg_container,.gs_rbn_mng_sc").length===0&&(r.dialog("close"),f.removeClass("gs_rbn_tab_slctd"),t(document).unbind(n))})},close:function(){f.removeClass("gs_rbn_tab_slctd")}}),!0};this.$target=n;this.data=s}return n.prototype.initialize=function(){this.renderHeader();this.configRibbon();this.configLogin();this.configSearch();t(document.documentElement).trigger("gsHeaderLoaded."+this.data.Settings.ClientId)},n.prototype.renderHeader=function(){this.$target.html(t.render[this.data.Settings.HeaderTmplName](this.data))},n.prototype.configRibbon=function(){var b=this,n=!this.data.Settings.IsReadOnlyGallery,s,i,h,c,l,a,e,o;t(".gs_rbn_hm_opt .gs_rbn_btn,.gs_rbn_hm_hr .gs_rbn_btn",this.$target).on("click",this.viewSizeClick);t(".gs_rbn_hm_slt .gs_rbn_btn",this.$target).on("click",this.selectClick);t(".gs_rbn_hm_ss .gs_rbn_mr",this.$target).on("click",this.slideShowOptionsClick);t(".gs_rbn_hm_ss .gs_rbn_btn",this.$target).on("click",this.slideShowClick);t(".gs_rbn_hm_dl .gs_rbn_btn",this.$target).on("click",this.downloadClick);t(".gs_rbn_hm_sh .gs_rbn_btn",this.$target).on("click",this.shareClick);t(".gs_rbn_hm_st .gs_rbn_btn",this.$target).on("click",this.sortClick);if(s=n&&this.data.Album.GalleryItems!=null&&this.data.Album.VirtualType===r.VirtualAlbumType.NotVirtual&&this.data.Album.Permissions.AddChildAlbum,s)t(".gs_rbn_mng_ca .gs_rbn_btn",this.$target).on("click",this.createAlbumClick);else i="This function is disabled",this.data.Album.GalleryItems==null?i="Disabled - navigate to the album thumbnail view to create an album":this.data.Album.VirtualType!==r.VirtualAlbumType.NotVirtual?i="Disabled because you are looking at a virtual album - navigate to a physical album to enable this function":this.data.Album.Permissions.AddChildAlbum?n||(i="Disabled because the gallery is read only"):i="Disable because you do not have permission to create an album",t(".gs_rbn_mng_ca",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title",i);if(this.data.Album.Permissions.AddMediaObject||t(".gs_task_addobjects",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because you do not have permission for this action"),h=n&&(this.data.Album.Permissions.DeleteChildAlbum&&this.data.User.CanAddAlbumToAtLeastOneAlbum||this.data.Album.Permissions.DeleteMediaObject&&this.data.User.CanAddMediaToAtLeastOneAlbum),h)t(".gs_rbn_mng_mt .gs_rbn_btn",this.$target).on("click",this.transferToAlbumClick);else t(".gs_rbn_mng_mt",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only or you do not have permission for this action");if(c=n&&(this.data.Settings.AllowCopyingReadOnlyObjects?this.data.User.CanAddAlbumToAtLeastOneAlbum||this.data.User.CanAddMediaToAtLeastOneAlbum:this.data.Album.Permissions.AddMediaObject),c)t(".gs_rbn_mng_ct .gs_rbn_btn",this.$target).on("click",this.transferToAlbumClick);else t(".gs_rbn_mng_ct",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only or you do not have permission for this action");if(l=n&&this.data.Album.Permissions.EditMediaObject,l)t(".gs_rbn_mng_rf .gs_rbn_btn",this.$target).on("click",this.replaceFileClick);else t(".gs_rbn_mng_rf",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only, you do not have permission for this action, or you have not selected a single media asset");if(this.data.MediaItem==null&&t(".gs_rbn_mng_rf",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only, you do not have permission for this action, or you have not selected a single media asset"),a=n&&(this.data.Album.Permissions.EditMediaObject||this.data.Album.Permissions.DeleteMediaObject||this.data.Album.Permissions.DeleteChildAlbum),a){t(".gs_rbn_mng_dlt .gs_rbn_mr",this.$target).on("click",this.deleteOptionsClick);t(".gs_rbn_mng_dlt .gs_rbn_btn",this.$target).on("click",this.deleteClick)}else t(".gs_rbn_mng_dlt",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only or you do not have permission for this action");if(this.data.User.CanEditAtLeastOneAlbum){t(".gs_rbn_mng_thmb .gs_rbn_mr",this.$target).on("click",this.assignThumbnailOptionsClick);t(".gs_rbn_mng_thmb .gs_rbn_btn",this.$target).on("click",this.assignThumbnailClick)}else t(".gs_rbn_mng_thmb",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because you do not have permission for this action");if(n&&this.data.Album.Permissions.EditMediaObject){t(".gs_rbn_mng_edt .gs_rbn_btn",this.$target).on("click",this.editImageClick);t(".gs_rbn_mng_rtfp .gs_rbn_btn.gs_rt_lt",this.$target).on("click",this.rotateLeftClick);t(".gs_rbn_mng_rtfp .gs_rbn_btn.gs_rt_rt",this.$target).on("click",this.rotateRightClick);t(".gs_rbn_mng_rtfp .gs_rbn_btn.gs_fh",this.$target).on("click",this.flipHorizontalClick);t(".gs_rbn_mng_rtfp .gs_rbn_btn.gs_fv",this.$target).on("click",this.flipVerticalClick)}else t(".gs_rbn_mng_edt,.gs_rbn_mng_rtfp",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only or you do not have permission for this action");if(this.data.Album.VirtualType===r.VirtualAlbumType.NotVirtual&&this.data.Album.Permissions.EditAlbum)t(".gs_rbn_mng_sc .gs_rbn_btn",this.$target).on("click",this.securityClick);else t(".gs_rbn_mng_sc",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because you do not have permission for this action or a virtual album is being displayed");this.data.Album.Permissions.Synchronize||t(".gs_task_synchronize",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because you do not have permission for this action");this.data.Album.Permissions.AdministerSite||(t(".gs_admin_sitesettings,.gs_admin_mediaqueue,.gs_admin_mediatemplates,.gs_admin_css,.gs_admin_backuprestore,.gs_admin_filetypes",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled - Requires site administrator permission"),this.data.Album.Permissions.AdministerGallery&&!this.data.App.AllowGalleryAdminToManageUsersAndRoles&&t(".gs_admin_manageusers,.gs_admin_manageroles",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because you do not have permission for this action"));t(".gs_rbn_tab_ctr:has(.gs_rbn_tab > li:not(li.gsp_disabled))",this.$target).each(function(n,i){t(".gs_rbn_ctr li:has(a[href='#"+i.id+"'])",b.$target).removeClass("gsp_invisible")});var v=this.data.Settings.ClientId+"_rbtb_cookie",y=this.data.Settings.ClientId+"_rbstate_cookie",k=sessionStorage&&parseInt(sessionStorage.getItem("rbnTabIndex"),10)||parseInt(f.Cookies.get(v),10)||0,p=sessionStorage&&sessionStorage.getItem("isRbnExpanded")||f.Cookies.get(y)||"true",u=t("#"+this.data.Settings.HeaderClientId+"_rbn_ctr"),w=u.tabs({collapsible:!0,active:p==="true"?k||0:!1,activate:function(n,i){t(".gs_rbn_tab > li",i.newPanel).equalHeights();f.Cookies.set(v,i.newTab.index(),{expires:365});f.Cookies.set(y,i.newTab.length>0,{expires:365});typeof Storage!="undefined"&&(sessionStorage.setItem("rbnTabIndex",i.newTab.index().toString()),sessionStorage.setItem("isRbnExpanded",(i.newTab.length>0).toString()))}}).show().tabs("option","active");p==="true"&&w===!1&&t("ul.gs_rbn_tab_ctr > li:first a",u).click();e=t("#"+this.data.Settings.ClientId+" .gs_rbn_ctr .gs_"+r.PageId[this.data.Settings.PageId]).addClass("gs_rbn_tab_slctd").parents(".ui-tabs-panel");e.length>0&&!e.is(":visible")&&u.tabs("option","active",t("#"+this.data.Settings.ClientId+" .gs_rbn_ctr .ui-tabs-panel").index(e));o=t(".gs_rbn_ctr .ui-tabs-nav li.ui-tabs-active",this.$target);o.length>0&&o.hasClass("gsp_invisible")&&u.tabs("option","active",0);w!==!1&&t("#"+this.data.Settings.ClientId+" .gs_rbn_tab > li").equalHeights();(this.data.Settings.PageId===r.PageId.task_addobjects||this.data.Settings.PageId===r.PageId.task_synchronize||r.PageId[this.data.Settings.PageId].lastIndexOf("admin_",0)===0)&&t(".gs_rbn_mng_tab_ctr .gs_rbn_tab > li:not(.gs_task_addobjects,.gs_task_synchronize)",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").off("click");this.data.Settings.AllowUrlOverride||t(".albumMenu a",this.$target).contents().filter(function(n,t){return t.nodeType===Node.TEXT_NODE}).unwrap();t("#"+this.data.Settings.ThumbnailClientId).on("select."+this.data.Settings.ClientId,t.proxy(this.thumbnailsSelected,this))},n.prototype.thumbnailsSelected=function(){this.data.Settings.IsReadOnlyGallery||!this.data.Album.Permissions.EditMediaObject||this.data.ActiveGalleryItems.length!==1||this.data.ActiveGalleryItems[0].IsAlbum?(t(".gs_rbn_mng_rf",this.$target).addClass("gsp_disabled").find(".gs_rbn_btn").attr("title","Disabled because the gallery is read only, you do not have permission for this action, or you have not selected a single media asset"),t(".gs_rbn_mr_dlg_rf_hdr").html(this.data.Resource.RbnShAsset+" <span class='gsp_vibrant'><\/span>")):(t(".gs_rbn_mng_rf",this.$target).removeClass("gsp_disabled").find(".gs_rbn_btn").attr("title",this.data.Resource.RbnRplTt),t(".gs_rbn_mr_dlg_rf_hdr").html(this.data.Resource.RbnShAsset+" <span class='gsp_vibrant'>"+this.data.ActiveGalleryItems[0].Title+"<\/span>"))},n.prototype.configLogin=function(){var n,u;if(this.data.User.IsAuthenticated)t(".gsp_logoffLink",this.$target).click(function(n){n.preventDefault();n.stopPropagation();e.logOff(function(){i.ReloadPage()})});else{n=t("#"+this.data.Settings.ClientId+"_loginDlg");n.data("dgLoginWidth",420);n.dialog({appendTo:"#"+this.data.Settings.ClientId,autoOpen:!1,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gsp_loginDlgContainer"},width:n.data("dgLoginWidth"),minHeight:0,show:"fade",hide:"fade",open:function(){setTimeout(function(){t(".gsp_login_textbox:first",n).focus()},50)}});u=function(n){t(".gsp_createuser input[data-required=true]").prop("required",!n)};t(".gsp_login_trigger",this.$target).click(function(t){return n.dialog("isOpen")?(n.dialog("close"),u(!1)):(n.dialog("option","hide",null).dialog("close").dialog("option","hide","fade"),n.dialog("option","position",{my:"right bottom",at:"right top",of:t.currentTarget}),n.dialog("open"),u(!0)),!1});t(".gsp_login_textbox",n).on("keydown",function(i){return i.keyCode===r.KeyCode.Enter?(t(".gsp_login_button",n).click(),!1):!0});t(".gsp_login_button",n).button();t("body").on("click",function(i){!n.dialog("isOpen")||t(i.target).is(".ui-dialog, a")||t(i.target).closest(".ui-dialog").length||(n.dialog("close"),u(!1))})}},n.prototype.configSearch=function(){var u=this,n;if(this.data.Settings.ShowSearch){n=t(".gsp_search_dlg",this.$target);n.data("dgSearchWidth",420);n.dialog({appendTo:"#"+this.data.Settings.ClientId,autoOpen:!1,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gsp_searchDlgContainer"},width:n.data("dgSearchWidth"),minHeight:0,show:"fade",hide:"fade",open:function(){setTimeout(function(){t(".gsp_searchbox",n).focus()},50)}});t(".gsp_search_trigger",this.$target).click(function(t){return n.dialog("isOpen")?n.dialog("close"):(n.dialog("option","hide",null).dialog("close").dialog("option","hide","fade"),n.dialog("option","position",{my:"right bottom",at:"right top",of:t.currentTarget}),n.dialog("open")),!1});t(".gsp_searchbutton",n).on("click",function(r){var c=function(n){var r="",i;return t.each(n.split(""),function(n,t){(t==='"'||t==="'")&&(i=!i);r+=!i&&t===" "?"+":t}),r},s,f,h,e,o;r.preventDefault();r.stopPropagation();s=3;f=t(".gsp_searchbox",n).val();f.length>=s?(h=t("[name="+u.data.Settings.ClientId+"_searchType]:checked").val(),e={title:null,tag:null,people:null,search:null,latest:null,filter:null,rating:null,top:null,aid:null,moid:null},e[h]=c(f),window.location.href=i.GetUrl(window.location.href,e)):(o=t(".gsp_search_msg",n),o.css("visibility","visible"),t(".gsp_searchbox",n).one("keydown",function(){o.css("visibility","hidden")}).focus())}).button();t(".gsp_searchbox, .gsp_search_type_container input",n).on("keydown",function(i){return i.keyCode===r.KeyCode.Enter?(t(".gsp_searchbutton",n).click(),!1):!0});t("body").on("click",function(i){!n.dialog("isOpen")||t(i.target).is(".ui-dialog, a")||t(i.target).closest(".ui-dialog").length||n.dialog("close")})}},n}();t.fn.gsTooltip=function(n){var i=this;return this.each(function(){if(!t.data(this,"plugin_gspTooltip")){var r=new ot;r.init(i,n);t.data(this,"plugin_gspTooltip",r)}})};t.fn.gsTooltip.defaults={title:"",content:""};ot=function(){function n(){}return n.prototype.init=function(n,i){this.$target=n;this.settings=t.extend({},t.fn.gsTooltip.defaults,i);this.initVars();this.configureDialog();this.configureTooltip()},n.prototype.initVars=function(){this.$dgTrigger=t("<button class='gsp_tt_tgr'><\/button>");this.$dgTooltip=t("<div class='gsp_tt_dlg'><div class='gsp_tt_dlg_title'>"+this.settings.title+"<\/div><div class='gsp_tt_dlg_bdy'>"+this.settings.content+"<\/div><\/div>")},n.prototype.configureDialog=function(){var n=this;this.$dgTooltip.dialog({appendTo:".gsp_ns:first",autoOpen:!1,draggable:!1,resizable:!1,closeOnEscape:!0,classes:{"ui-dialog":"gsp_tt_dlg_container"},width:i.isWidthLessThan(420)?i.getViewportWidth():420,minHeight:0,show:"fade",hide:"fade",position:{my:"left top",at:"left bottom",of:this.$dgTrigger},open:function(){n.onTooltipOpen()}})},n.prototype.onTooltipOpen=function(){var n=this;t(document).on("click",function(i){t(i.target).parents(".gsp_tt_dlg_container").length===0&&(n.$dgTooltip.dialog("close"),t(document).unbind(i))})},n.prototype.configureTooltip=function(){var n=this;this.$dgTrigger.insertAfter(this.$target).button({showLabel:!1,icon:"gsp-ui-icon-help"}).click(function(){return n.$dgTooltip.dialog("isOpen")?n.$dgTooltip.dialog("close"):n.$dgTooltip.dialog("open"),!1})},n}();jQuery.fn.equalHeights=function(n){return n=n||0,this.height(n+Math.max.apply(null,this.map(function(){return jQuery(this).height()}).get()))};jQuery.fn.equalWidths=function(n){return n=n||0,this.width(n+Math.max.apply(null,this.map(function(){return jQuery(this).width()}).get()))};jQuery.fn.equalSize=function(n,t){return n=n||0,t=t||0,this.width(n+Math.max.apply(null,this.map(function(){return jQuery(this).width()}).get())).height(t+Math.max.apply(null,this.map(function(){return jQuery(this).height()}).get()))};st=function(){function n(n,i){var u={viewSize:r.ViewSize.Optimized,on_exit:function(){}};this.data=n;this.settings=t.extend({},u,i)}return n.prototype.startSlideShow=function(){var n=this,e=this.data.Album.MediaItems||this.data.Album.GalleryItems,f=t.map(e,function(t){return t.ItemType===r.ItemType.Image?{id:t.Id,thumb:i.getView(t,r.ViewSize.Thumbnail).Url,title:t.Title,image:i.getView(t,n.settings.viewSize).Url}:null});if(f.length===0)return u.show(this.data.Resource.MoNoSsHdr,this.data.Resource.MoNoSsBdy,{msgType:"info"}),!1;var o='<div class="ssControlsContainer">             <!--Thumbnail Navigation-->             <div id="prevthumb"><\/div>             <div id="nextthumb"><\/div>                 <!--Arrow Navigation-->             <a id="prevslide" class="load-item"><\/a>             <a id="nextslide" class="load-item"><\/a>                 <div id="thumb-tray" class="load-item">                 <div id="thumb-back"><\/div>                 <div id="thumb-forward"><\/div>             <\/div>                 <!--Time Bar-->             <div id="progress-back" class="load-item">                 <div id="progress-bar"><\/div>             <\/div>                 <!--Control Bar-->             <div id="controls-wrapper" class="load-item">                 <div id="controls">                         <a id="play-button">                         <img id="pauseplay" src="{0}/pause.png" /><\/a>                         <a id="stop-button">                         <img src="{0}/stop.png" /><\/a>                         <!--Slide counter-->                     <div id="slidecounter">                         <span class="slidenumber"><\/span> / <span class="totalslides"><\/span>                     <\/div>                         <!--Slide captions displayed here-->                     <div id="slidecaption"><\/div>                         <!--Thumb Tray button-->                     <a id="tray-button">                         <img id="tray-arrow" src="{0}/button-tray-up.png" /><\/a>                         <!--Navigation-->                     <ul id="slide-list"><\/ul>                     <\/div>             <\/div>     <\/div>                     '.format(this.data.App.SkinPath+"/images/supersized"),s=function(n){switch(n){case"fade":return 1;case"slide":return 3;default:return 0}},h=function(){var i=1;return n.data.MediaItem==null?i:(t.each(f,function(t,r){return n.data.MediaItem.Id===r.id?(i=t+1,!1):!0}),i)};t.supersized({image_path:this.data.App.SkinPath+"/images/supersized/",slideshow:1,autoplay:1,auto_exit:this.data.Settings.SlideShowLoop?0:1,start_slide:h(),loop:this.data.Settings.SlideShowLoop?1:0,random:0,slide_interval:this.data.Settings.SlideShowIntervalMs,transition:s(this.data.Settings.TransitionType),transition_speed:500,new_window:1,pause_hover:0,keyboard_nav:1,performance:1,image_protect:0,min_width:0,min_height:0,vertical_center:1,horizontal_center:1,fit_always:1,fit_portrait:1,fit_landscape:1,slide_links:"blank",thumb_links:1,thumbnail_navigation:0,slides:f,progress_bar:0,mouse_scrub:0,html_template:o,on_destroy:function(t,i){n.settings.on_exit.apply(null,[t,i])}});t("#stop-button").on("click",function(){t.supersized("getApi").destroy()});return!0},n}();l=function(){function n(n,t,i){this.isRunning=!1;this.milliseconds=t;this.callback=n;this.context=i;this.context||(this.context=this);this.handle=null}return n.prototype.start=function(){var i=this,n,t;this.isRunning||(n=this.context,t=function(){i.callback.apply(n)},this.handle=setInterval(t,this.milliseconds),this.isRunning=!0)},n.prototype.stop=function(){this.isRunning&&(clearInterval(this.handle),this.isRunning=!1)},n}();n.GsTimer=l;u=function(){function n(){}return n.show=function(n,r,u){var f=t.extend({},{msgType:"success",autoCloseDelay:4e3,width:500},u),e,o;t(".gsp_msg").remove();e=t("<div>");o="gsp_msg";r?(e.append(r),o+=" gsp_msgHasContent"):o+=" gsp_msgNoContent";o+=" gsp_msg_"+f.msgType;e.dialog({appendTo:".gsp_ns:first",position:{my:"top",at:"top"},title:n,width:typeof f.width=="number"&&i.isWidthLessThan(f.width)?i.getViewportWidth():f.width,height:"auto",resizable:!1,classes:{"ui-dialog":o},show:"fade",hide:"fade"});f.autoCloseDelay>0&&setTimeout(function(){e.is(":ui-dialog")&&e.dialog("destroy")},f.autoCloseDelay)},n}();n.Msg=u;ht=function(){function n(n){var r=this,f;this.internalProgressCallback=function(){t.ajax({url:r.taskSettings.taskProgressUrl,cache:!1,headers:{"X-ServerTask-TaskId":r.taskSettings.taskId}}).done(function(n){r.taskSettings.timerId=window.setTimeout(r.internalProgressCallback,r.taskSettings.interval);r.taskSettings.userDefinedProgressCallback!=null&&r.taskSettings.userDefinedProgressCallback(n,r)}).fail(function(n){u.show("Error retrieving status",i.parseJqXhrMsg(n),{msgType:"error",autoCloseDelay:0});r.taskSettings.taskFailedCallback!=null&&r.taskSettings.taskFailedCallback(n,r)})};f={taskId:this.createTaskId(),timerId:0,taskBeginData:null,taskBeginUrl:null,taskProgressUrl:null,taskAbortUrl:null,interval:1e3,userDefinedProgressCallback:null,taskFailedCallback:null,taskAbortedCallback:null};this.taskSettings=t.extend({},f,n)}return n.prototype.createTaskId=function(){return i.createPseudoGuid()},n.prototype.abortTask=function(){this.taskSettings.taskAbortUrl!=null&&this.taskSettings.taskAbortUrl!==""&&t.ajax({url:this.taskSettings.taskAbortUrl,async:!1,cache:!1,headers:{"X-ServerTask-TaskId":this.taskSettings.taskId}})},n.prototype.startTask=function(){var n=this;t.ajax({url:this.taskSettings.taskBeginUrl,type:"POST",data:JSON.stringify(this.taskSettings.taskBeginData),contentType:"application/json; charset=utf-8",headers:{"X-ServerTask-TaskId":this.taskSettings.taskId}}).always(function(t){t.status===0&&n.taskSettings.taskAbortedCallback!=null&&n.taskSettings.taskAbortedCallback(self)}).done(function(){n.taskSettings.userDefinedProgressCallback!=null&&n.taskSettings.taskProgressUrl!=null&&(n.taskSettings.timerId=window.setTimeout(n.internalProgressCallback,n.taskSettings.interval))}).fail(function(t){u.show("Error starting task",i.parseJqXhrMsg(t),{msgType:"error",autoCloseDelay:0});n.taskSettings.taskFailedCallback!=null&&n.taskSettings.taskFailedCallback(t,n)})},n.prototype.resetTask=function(){this.taskSettings.taskId="0";window.clearTimeout(this.taskSettings.timerId)},n}();n.ServerTask=ht})(Gs||(Gs={}));Array.prototype.gspRemove=function(n,t){var i=this.slice((t||n)+1||this.length);return this.length=n<0?this.length+n:n,this.push.apply(this,i)};Array.prototype.gsEquals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.gsEquals=function(n){if(!n||this.length!==n.length)return!1;for(var t=0,i=this.length;t<i;t++)if(this[t]instanceof Array&&n[t]instanceof Array){if(!this[t].equals(n[t]))return!1}else if(this[t]!==n[t])return!1;return!0};Object.defineProperty(Array.prototype,"equals",{enumerable:!1});String.prototype.format=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return t=arguments,this.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});